/*!
 * jQuery Stepy - A Wizard Plugin
 * --------------------------------------------------------------
 *
 * jQuery Stepy is a plugin that generates a customizable wizard.
 *
 * Licensed under The MIT License
 *
 * @version        1.1.0
 * @since          2010-07-03
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/stepy
 *
 * --------------------------------------------------------------
 *
 *  <form>
 *    <fieldset title="Step 1">
 *      <legend>description one</legend>
 *      <!-- inputs -->
 *    </fieldset>
 *
 *    <fieldset title="Step 2">
 *      <legend>description two</legend>
 *      <!-- inputs -->
 *    </fieldset>
 *
 *    <input type="submit" />
 *  </form>
 *
 *  $('form').stepy();
 *
 */
(function(b){var a={init:function(c){return this.each(function(){a.destroy.call(this);this.stepyOptions=b.extend({},b.fn.stepy.defaults,c);var d=b(this);a._generateId.call(this);if(this.stepyOptions.header){this.header=a._header.call(this)}this.steps=d.find("."+this.stepyOptions.stepClass);var e=this;this.steps.each(function(g){var f=b(this);f.addClass(e.stepyOptions.stepClass);if(g===0){f.addClass("stepy-active")}if(e.stepyOptions.header){a._createHead.call(e,this,g)}});a._bindNextButton.call(this);a._bindBackButton.call(this);a._bindFinishButton.call(this);if(this.stepyOptions.header){a._bindHeader.call(this)}if(this.stepyOptions.enter){a._bindEnter.call(this)}this.steps.first().find(":input:visible:enabled:first").trigger("select").trigger("focus");a._setState.call(this,{settings:this.stepyOptions,index:0,stepy:true});a._stateButton.call(this,this.steps)})},_bindBackButton:function(){var c=b(this).find(this.stepyOptions.backButton);if(!c.length){return}c.on("click.stepy",function(f){f.preventDefault();var d=b(this).data("index")-1;if(d>=0&&(!this.stepyOptions.back||a._execute.call(this,this.stepyOptions.back,d,this.steps.length))){a.step.call(this,d)}}.bind(this))},_bindEnter:function(){var c=this;this.steps.find("input:not(:button, :submit)").on("keypress.stepy",function(e){var f=(e.keyCode?e.keyCode:e.which);if(f===13){e.preventDefault();var g=b(this).closest("."+c.stepyOptions.stepClass),d=g.next("."+c.stepyOptions.stepClass).length;if(d){g.find(c.stepyOptions.nextButton).trigger("click")}else{if(c.finishButton){c.finishButton.trigger("click")}}}})},_bindFinishButton:function(){this.finishButton=b(this).find(this.stepyOptions.finishButton);if(!this.finishButton.length){return b.error('submit button "'+this.stepyOptions.finishButton+'" missing.')}this.finishButton.on("click.stepy",a._onFinishButton.bind(this))},_bindHeader:function(){this.heads=this.header.find("li");this.heads.first().addClass("stepy-active");if(this.stepyOptions.titleClick){var c=this;this.heads.on("click",function(){a._bindHeaderHandler.call(c,this)})}else{this.heads.css("cursor","default")}},_bindHeaderHandler:function(d){var e=parseInt(b(this.heads).filter(".stepy-active")[0].id.match(/\d/)[0],10),c=parseInt(d.id.match(/\d/)[0],10);if(c>e){if(this.stepyOptions.next&&!a._execute.call(this,this.stepyOptions.next,c)){return false}}else{if(c<e){if(this.stepyOptions.back&&!a._execute.call(this,this.stepyOptions.back,c)){return false}}}if(c!=e){a.step.call(this,c)}},_bindNextButton:function(){var c=b(this).find(this.stepyOptions.nextButton);if(!c.length){return}c.on("click.stepy",function(f){f.preventDefault();var d=b(this).data("index")+1;if(d<this.steps.length&&(!this.stepyOptions.next||a._execute.call(this,this.stepyOptions.next,d,this.steps.length))){a.step.call(this,d)}}.bind(this))},_createHead:function(f,c){var f=b(f).attr("id",this.getAttribute("id")+"-step-"+c),d=a._head.call(this,c);d.append(a._title.call(this,f));if(this.stepyOptions.description){var e=a._description.call(this,f);if(e.length){d.append(e)}}this.header.append(d)},_description:function(d){var c=d.find("."+this.stepyOptions.legendClass);if(!this.stepyOptions.legend){c.hide()}if(!c.length){return null}return b("<span />",{html:c.html()})},_execute:function(f,c,e){if(f===undefined){return true}var d=f.call(this,c,e);return d||d===undefined},_generateId:function(){var c=this.getAttribute("id");if(c===undefined||c===""){b(this).attr("id","stepy-"+Math.random().toString().substring(2))}},_head:function(c){return b("<li />",{id:this.getAttribute("id")+"-head-"+c})},_header:function(){var c=b("<ul />",{id:this.getAttribute("id")+"-header","class":"stepy-header"});if(this.stepyOptions.titleTarget){c.appendTo(this.stepyOptions.titleTarget)}else{c.insertBefore(this)}return c},_onFinishButton:function(c){var e=undefined;if(this.tagName==="FORM"){e=this.getAttribute("onsubmit");this.setAttribute("onsubmit","return false;")}if(!a._execute.call(this,this.stepyOptions.finish,this.steps.length-1)){c.preventDefault()}else{if(this.tagName==="FORM"){if(e){this.setAttribute("onsubmit",e)}else{this.removeAttribute("onsubmit")}var d=this.finishButton.attr("type")==="submit";if(d&&(!this.stepyOptions.validate||a.validate.call(this,this.steps.length-1))){this.submit()}}}},_setState:function(d){var c=b(this);c.data(b.extend({},c.data(),d))},_stateButton:function(d){var c=b(this),e=c.data("index");if(e===0){c.find(this.stepyOptions.backButton).removeClass("stepy-active");c.find(this.stepyOptions.finishButton).removeClass("stepy-active");c.find(this.stepyOptions.nextButton).addClass("stepy-active")}else{if(e===d.length-1){c.find(this.stepyOptions.backButton).addClass("stepy-active");c.find(this.stepyOptions.finishButton).addClass("stepy-active");c.find(this.stepyOptions.nextButton).removeClass("stepy-active")}else{c.find(this.stepyOptions.backButton).addClass("stepy-active");c.find(this.stepyOptions.finishButton).removeClass("stepy-active");c.find(this.stepyOptions.nextButton).addClass("stepy-active")}}},_title:function(c){return b("<div />",{html:c.attr("title")||"--"})},_transition:function(c){var i=this.steps.eq(b(this).data("index")),h=this.steps.eq(c);if(this.stepyOptions.transition==="fade"){i.animate({opacity:0},this.stepyOptions.duration,function(){i.removeClass("stepy-active");h.addClass("stepy-active").animate({opacity:1},this.stepyOptions.duration)}.bind(this))}else{if(this.stepyOptions.transition==="slide"){var e=i.index()<h.index(),f=(e?-1:1)*i.outerWidth(),d=(e?1:-1)*h.outerWidth(),g=0;i.animate({"margin-left":f},this.stepyOptions.duration,function(){i.removeClass("stepy-active");h.animate({"margin-left":d},0).addClass("stepy-active").animate({"margin-left":g},this.stepyOptions.duration)}.bind(this))}}},destroy:function(){return b(this).each(function(){var d=b(this);if(d.data("stepy")){var c=d.data("stepy",false).find(".stepy-active").removeClass("stepy-active");d.find(".stepy-errors").remove()}})},step:function(g){var d=g,f=b(this),e=f.find("."+this.stepyOptions.stepClass);if(g>e.length){g=e.length}if(this.stepyOptions.validate){var j=true;for(var h=0;h<g;h++){j&=a.validate.call(this,h);if(this.stepyOptions.block&&!j){d=h;break}}}if(this.stepyOptions.transition){a._transition.call(this,d)}else{e.removeClass("stepy-active").eq(d).addClass("stepy-active")}if(this.stepyOptions.header){this.heads.removeClass("stepy-active").eq(d).addClass("stepy-active")}if(this.tagName==="FORM"){var c=e.eq(d);if(d===g){c=c.find(":input:enabled:visible")}else{c=c.find(".error").trigger("select").trigger("focus")}c.first().trigger("select").trigger("focus")}if(this.stepyOptions.select){this.stepyOptions.select.call(this,d,e.length)}a._setState.call(this,{index:d});a._stateButton.call(this,e);return f},validate:function(d){var c=b(this);if(!this.tagName==="FORM"){return true}var f=this,e=c.find("."+this.stepyOptions.stepClass).eq(d),g=true,h=b("#"+this.getAttribute("id")+"-header").children().eq(d);b(e.find(":input:enabled").get().reverse()).each(function(){var i=f.stepyOptions.validate.call(f,this);if(i===undefined){i=true}g=g&&i;if(g){if(f.stepyOptions.errorImage){h.removeClass("stepy-error")}}else{if(f.stepyOptions.errorImage){h.addClass("stepy-error")}this.focus()}});return g}};b.fn.stepy=function(c){if(a[c]){return a[c].apply(this[0],Array.prototype.slice.call(arguments,1))}else{if(typeof c==="object"||!c){return a.init.apply(this,arguments)}else{b.error("Method "+c+" does not exist!")}}};b.fn.stepy.defaults={back:undefined,backButton:".stepy-back",block:false,description:true,duration:0,enter:true,errorImage:false,finish:undefined,finishButton:".stepy-finish",header:true,ignore:"",legend:true,legendClass:"stepy-legend",next:undefined,nextButton:".stepy-next",select:undefined,stepClass:"stepy-step",titleClick:false,titleTarget:undefined,transition:undefined,validate:undefined}})(jQuery);