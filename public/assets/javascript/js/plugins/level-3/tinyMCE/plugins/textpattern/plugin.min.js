(function(){var a=(function(){var i=function(K){var L=K;var J=function(){return L};var N=function(O){L=O};var M=function(){return i(J())};return{get:J,set:N,clone:M}};var A=tinymce.util.Tools.resolve("tinymce.PluginManager");var G=function(K){var L=function(M){K.set(M)};var J=function(){return K.get()};return{setPatterns:L,getPatterns:J}};var D={get:G};var h=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"***",end:"***",format:["bold","italic"]},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}];var b=function(J){return J.textpattern_patterns!==undefined?J.textpattern_patterns:h};var g={getPatterns:b};var r=tinymce.util.Tools.resolve("tinymce.util.Delay");var q=tinymce.util.Tools.resolve("tinymce.util.VK");var o=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker");var l=tinymce.util.Tools.resolve("tinymce.util.Tools");var t=function(J){return J.sort(function(L,K){if(L.start.length>K.start.length){return -1}if(L.start.length<K.start.length){return 1}return 0})};var E=function(K,L){for(var J=0;J<K.length;J++){if(L.indexOf(K[J].start)!==0){continue}if(K[J].end&&L.lastIndexOf(K[J].end)!==L.length-K[J].end.length){continue}return K[J]}};var p=function(K,M,L,N){var J=M.substr(L-K.end.length-N,K.end.length);return J===K.end};var H=function(K,L,J){return K-L-J.end.length-J.start.length>0};var m=function(K,O,N,P){var M,J;var L=t(K);for(J=0;J<L.length;J++){M=L[J];if(M.end!==undefined&&p(M,O,N,P)&&H(N,P,M)){return M}}};var f={findPattern:E,findEndPattern:m};var k=function(K,N,L,J,M){K=J>0?K.splitText(J):K;K.splitText(L-J+N.end.length);K.deleteData(0,N.start.length);K.deleteData(K.data.length-N.end.length,N.end.length);return K};var n=function(N,K,J){if(K.collapsed===false){return}var M=K.startContainer;var T=M.data;var S=J===true?1:0;if(M.nodeType!==3){return}var O=f.findEndPattern(N,T,K.startOffset,S);if(O===undefined){return}var R=T.lastIndexOf(O.end,K.startOffset-S);var Q=T.lastIndexOf(O.start,R-O.end.length);R=T.indexOf(O.end,Q+O.start.length);if(Q===-1){return}var P=document.createRange();P.setStart(M,Q);P.setEnd(M,R+O.end.length);var L=f.findPattern(N,P.toString());if(O===undefined||L!==O||M.data.length<=O.start.length+O.end.length){return}return{pattern:O,startOffset:Q,endOffset:R}};var e=function(M,J,O,N){var K=l.isArray(O.pattern.format)?O.pattern.format:[O.pattern.format];var L=l.grep(K,function(P){var Q=M.formatter.get(P);return Q&&Q[0].inline});if(L.length!==0){M.undoManager.transact(function(){J=k(J,O.pattern,O.endOffset,O.startOffset,N);K.forEach(function(P){M.formatter.apply(P,{},J)})});return J}};var F=function(L,K,N){var J=L.selection.getRng(true);var M=n(K,J,N);if(M){return e(L,J.startContainer,M,N)}};var B=function(K,J){return F(K,J,true)};var z=function(K,J){return F(K,J,false)};var v=function(Q,M){var V,P,L,T,N,U,S,R,K,J,O;V=Q.selection;P=Q.dom;if(!V.isCollapsed()){return}S=P.getParent(V.getStart(),"p");if(S){K=new o(S,S);while(N=K.next()){if(N.nodeType===3){T=N;break}}if(T){R=f.findPattern(M,T.data);if(!R){return}J=V.getRng(true);L=J.startContainer;O=J.startOffset;if(T===L){O=Math.max(0,O-R.start.length)}if(l.trim(T.data).length===R.start.length){return}if(R.format){U=Q.formatter.get(R.format);if(U&&U[0].block){T.deleteData(0,R.start.length);Q.formatter.apply(R.format,{},T);J.setStart(L,O);J.collapse(true);V.setRng(J)}}if(R.cmd){Q.undoManager.transact(function(){T.deleteData(0,R.start.length);Q.execCommand(R.cmd)})}}}};var I={patternFromRng:n,applyInlineFormatSpace:B,applyInlineFormatEnter:z,applyBlockFormat:v};function s(L,K){var M,J;M=I.applyInlineFormatEnter(L,K);if(M){J=L.dom.createRng();J.setStart(M,M.data.length);J.setEnd(M,M.data.length);L.selection.setRng(J)}I.applyBlockFormat(L,K)}function x(N,M){var O,L,K,J,P;O=I.applyInlineFormatSpace(N,M);if(O){P=N.dom;L=O.data.slice(-1);if(/[\u00a0 ]/.test(L)){O.deleteData(O.data.length-1,1);K=P.doc.createTextNode(L);P.insertAfter(K,O.parentNode);J=P.createRng();J.setStart(K,1);J.setEnd(K,1);N.selection.setRng(J)}}}var w=function(K,M,J){for(var L=0;L<K.length;L++){if(J(K[L],M)){return true}}};var j=function(J,K){return w(J,K,function(M,L){return M===L.keyCode&&q.modifierPressed(L)===false})};var c=function(K,J){return w(K,J,function(L,M){return L.charCodeAt(0)===M.charCode})};var y={handleEnter:s,handleInlineKey:x,checkCharCode:c,checkKeyCode:j};var u=function(K,L){var M=[",",".",";",":","!","?"];var J=[32];K.on("keydown",function(N){if(N.keyCode===13&&!q.modifierPressed(N)){y.handleEnter(K,L.get())}},true);K.on("keyup",function(N){if(y.checkKeyCode(J,N)){y.handleInlineKey(K,L.get())}});K.on("keypress",function(N){if(y.checkCharCode(M,N)){r.setEditorTimeout(K,function(){y.handleInlineKey(K,L.get())})}})};var C={setup:u};A.add("textpattern",function(J){var K=i(g.getPatterns(J.settings));C.setup(J,K);return D.get(K)});function d(){}return d}())})();