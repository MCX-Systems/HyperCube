(function(){var a=(function(){var s=function(cX){var cY=cX;var cW=function(){return cY};var c0=function(c1){cY=c1};var cZ=function(){return s(cW())};return{get:cW,set:c0,clone:cZ}};var z=tinymce.util.Tools.resolve("tinymce.PluginManager");var bv=tinymce.util.Tools.resolve("tinymce.util.Tools");function ai(cX,cW){return ak(document.createElement("canvas"),cX,cW)}function cv(cX){var cY,cW;cY=ai(cX.width,cX.height);cW=aO(cY);cW.drawImage(cX,0,0);return cY}function aO(cW){return cW.getContext("2d")}function b0(cW){var cY=null;try{cY=cW.getContext("webgl")||cW.getContext("experimental-webgl")}catch(cX){}if(!cY){cY=null}return cY}function ak(cX,cY,cW){cX.width=cY;cX.height=cW;return cX}var cF={create:ai,clone:cv,resize:ak,get2dContext:aO,get3dContext:b0};function ax(cW){return cW.naturalWidth||cW.width}function cS(cW){return cW.naturalHeight||cW.height}var aw={getWidth:ax,getHeight:cS};var U=function(){var c2=function(c6){if(typeof this!=="object"){throw new TypeError("Promises must be constructed via new")}if(typeof c6!=="function"){throw new TypeError("not a function")}this._state=null;this._value=null;this._deferreds=[];c4(c6,c1(c3,this),c1(c5,this))};var cW=c2.immediateFn||typeof setImmediate==="function"&&setImmediate||function(c6){setTimeout(c6,1)};function c1(c7,c6){return function(){c7.apply(c6,arguments)}}var cX=Array.isArray||function(c6){return Object.prototype.toString.call(c6)==="[object Array]"};function cY(c6){var c7=this;if(this._state===null){this._deferreds.push(c6);return}cW(function(){var c8=c7._state?c6.onFulfilled:c6.onRejected;if(c8===null){(c7._state?c6.resolve:c6.reject)(c7._value);return}var c9;try{c9=c8(c7._value)}catch(da){c6.reject(da);return}c6.resolve(c9)})}function c3(c7){try{if(c7===this){throw new TypeError("A promise cannot be resolved with itself.")}if(c7&&(typeof c7==="object"||typeof c7==="function")){var c8=c7.then;if(typeof c8==="function"){c4(c1(c8,c7),c1(c3,this),c1(c5,this));return}}this._state=true;this._value=c7;cZ.call(this)}catch(c6){c5.call(this,c6)}}function c5(c6){this._state=false;this._value=c6;cZ.call(this)}function cZ(){for(var c7=0,c6=this._deferreds.length;c7<c6;c7++){cY.call(this,this._deferreds[c7])}this._deferreds=null}function c0(c9,c6,c8,c7){this.onFulfilled=typeof c9==="function"?c9:null;this.onRejected=typeof c6==="function"?c6:null;this.resolve=c8;this.reject=c7}function c4(c9,da,c7){var c6=false;try{c9(function(db){if(c6){return}c6=true;da(db)},function(db){if(c6){return}c6=true;c7(db)})}catch(c8){if(c6){return}c6=true;c7(c8)}}c2.prototype["catch"]=function(c6){return this.then(null,c6)};c2.prototype.then=function(c8,c6){var c7=this;return new c2(function(da,c9){cY.call(c7,new c0(c8,c6,da,c9))})};c2.all=function(){var c6=Array.prototype.slice.call(arguments.length===1&&cX(arguments[0])?arguments[0]:arguments);return new c2(function(db,da){if(c6.length===0){return db([])}var c9=c6.length;function c8(dd,df){try{if(df&&(typeof df==="object"||typeof df==="function")){var de=df.then;if(typeof de==="function"){de.call(df,function(dg){c8(dd,dg)},da);return}}c6[dd]=df;if(--c9===0){db(c6)}}catch(dc){da(dc)}}for(var c7=0;c7<c6.length;c7++){c8(c7,c6[c7])}})};c2.resolve=function(c6){if(c6&&typeof c6==="object"&&c6.constructor===c2){return c6}return new c2(function(c7){c7(c6)})};c2.reject=function(c6){return new c2(function(c8,c7){c7(c6)})};c2.race=function(c6){return new c2(function(da,c9){for(var c8=0,c7=c6.length;c8<c7;c8++){c6[c8].then(da,c9)}})};return c2};var cB=window.Promise?window.Promise:U();var ck=function(cW){return function(){return cW}};var cA=function(c0){var cW=[];for(var cZ=1;cZ<arguments.length;cZ++){cW[cZ-1]=arguments[cZ]}var cX=new Array(arguments.length-1);for(var cY=1;cY<arguments.length;cY++){cX[cY-1]=arguments[cY]}return function(){var c1=[];for(var c5=0;c5<arguments.length;c5++){c1[c5]=arguments[c5]}var c2=new Array(arguments.length);for(var c3=0;c3<c2.length;c3++){c2[c3]=arguments[c3]}var c4=cX.concat(c2);return c0.apply(null,c4)}};var aH=ck(false);var cy=ck(true);var y=aH;var cc=cy;var P=function(){return ab};var ab=function(){var cW=function(c3){return c3.isNone()};var cY=function(c3){return c3()};var c2=function(c3){return c3};var cX=function(){};var cZ=function(){return null};var c0=function(){return undefined};var c1={fold:function(c4,c3){return c4()},is:y,isSome:y,isNone:cc,getOr:c2,getOrThunk:cY,getOrDie:function(c3){throw new Error(c3||"error: getOrDie called on none.")},getOrNull:cZ,getOrUndefined:c0,or:c2,orThunk:cY,map:P,ap:P,each:cX,bind:P,flatten:P,exists:y,forall:cc,filter:P,equals:cW,equals_:cW,toArray:function(){return[]},toString:ck("none()")};if(Object.freeze){Object.freeze(c1)}return c1}();var aI=function(cW){var c1=function(){return cW};var cX=function(){return cY};var cZ=function(c2){return aI(c2(cW))};var c0=function(c2){return c2(cW)};var cY={fold:function(c3,c2){return c2(cW)},is:function(c2){return cW===c2},isSome:cc,isNone:y,getOr:c1,getOrThunk:c1,getOrDie:c1,getOrNull:c1,getOrUndefined:c1,or:cX,orThunk:cX,map:cZ,ap:function(c2){return c2.fold(P,function(c3){return aI(c3(cW))})},each:function(c2){c2(cW)},bind:c0,flatten:c1,exists:c0,forall:c0,filter:function(c2){return c2(cW)?cY:ab},equals:function(c2){return c2.is(cW)},equals_:function(c3,c2){return c3.fold(y,function(c4){return c2(cW,c4)})},toArray:function(){return[cW]},toString:function(){return"some("+cW+")"}};return cY};var ct=function(cW){return cW===null||cW===undefined?ab:aI(cW)};var Q={some:aI,none:P,from:ct};var cL=typeof window!=="undefined"?window:Function("return this;")();var aj=function(cY,cX){var cZ=cX!==undefined&&cX!==null?cX:cL;for(var cW=0;cW<cY.length&&cZ!==undefined&&cZ!==null;++cW){cZ=cZ[cY[cW]]}return cZ};var ay=function(cY,cW){var cX=cY.split(".");return aj(cX,cW)};var O=function(cW,cX){return ay(cW,cX)};var b1=function(cW,cX){var cY=O(cW,cX);if(cY===undefined||cY===null){throw cW+" not available on this browser"}return cY};var K={getOrDie:b1};function t(cY,cW){var cX=K.getOrDie("Blob");return new cX(cY,cW)}function b3(){var cW=K.getOrDie("FileReader");return new cW()}function cl(cW){var cX=K.getOrDie("Uint8Array");return new cX(cW)}var r=function(cX){var cW=K.getOrDie("requestAnimationFrame");cW(cX)};var cb=function(cW){var cX=K.getOrDie("atob");return cX(cW)};var a4={atob:cb,requestAnimationFrame:r};function bO(cW){var cX=cW.src;if(cX.indexOf("data:")===0){return bG(cX)}return k(cX)}function b5(cW){return new cB(function(c2,c1){var cX=URL.createObjectURL(cW);var c3=new Image();var c0=function(){c3.removeEventListener("load",cZ);c3.removeEventListener("error",cY)};function cZ(){c0();c2(c3)}function cY(){c0();c1("Unable to load data of type "+cW.type+": "+cX)}c3.addEventListener("load",cZ);c3.addEventListener("error",cY);c3.src=cX;if(c3.complete){cZ()}})}function k(cW){return new cB(function(cY,cX){var cZ=new XMLHttpRequest();cZ.open("GET",cW,true);cZ.responseType="blob";cZ.onload=function(){if(this.status==200){cY(this.response)}};cZ.onerror=function(){var c2=this;var c1=function(){var c3=new Error("No access to download image");c3.code=18;c3.name="SecurityError";return c3};var c0=function(){return new Error("Error "+c2.status+" downloading image")};cX(this.status===0?c1():c0())};cZ.send()})}function cg(cX){var c4=cX.split(",");var c5=/data:([^;]+)/.exec(c4[0]);if(!c5){return Q.none()}var da=c5[1];var c6=c4[1];var cY=1024;var c7=a4.atob(c6);var c9=c7.length;var c3=Math.ceil(c9/cY);var c8=new Array(c3);for(var cZ=0;cZ<c3;++cZ){var cW=cZ*cY;var c0=Math.min(cW+cY,c9);var db=new Array(c0-cW);for(var c1=cW,c2=0;c1<c0;++c2,++c1){db[c2]=c7[c1].charCodeAt(0)}c8[cZ]=cl(db)}return Q.some(t(c8,{type:da}))}function bG(cW){return new cB(function(cY,cX){cg(cW).fold(function(){cX("uri is not base64: "+cW)},cY)})}function be(cW){if(cW.indexOf("blob:")===0){return k(cW)}if(cW.indexOf("data:")===0){return bG(cW)}return null}function ag(cW,cX,cY){cX=cX||"image/png";if(HTMLCanvasElement.prototype.toBlob){return new cB(function(cZ){cW.toBlob(function(c0){cZ(c0)},cX,cY)})}else{return bG(cW.toDataURL(cX,cY))}}function b6(cW,cX,cY){cX=cX||"image/png";return cW.then(function(cZ){return cZ.toDataURL(cX,cY)})}function br(cW){return b5(cW).then(function(cZ){ar(cZ);var cY,cX;cX=cF.create(aw.getWidth(cZ),aw.getHeight(cZ));cY=cF.get2dContext(cX);cY.drawImage(cZ,0,0);return cX})}function b9(cW){return new cB(function(cY){var cX=new b3();cX.onloadend=function(){cY(cX.result)};cX.readAsDataURL(cW)})}function bC(cW){return new cB(function(cY){var cX=new b3();cX.onloadend=function(){cY(cX.result)};cX.readAsArrayBuffer(cW)})}function bS(cW){return b9(cW).then(function(cX){return cX.split(",")[1]})}function ar(cW){URL.revokeObjectURL(cW.src)}var cf={blobToImage:b5,imageToBlob:bO,blobToArrayBuffer:bC,blobToDataUri:b9,blobToBase64:bS,dataUriToBlobSync:cg,canvasToBlob:ag,canvasToDataURL:b6,blobToCanvas:br,uriToBlob:be};var bZ=function(cW){return cf.blobToImage(cW)};var aA=function(cW){return cf.imageToBlob(cW)};var by=function(cW){return cf.blobToDataUri(cW)};var ad=function(cW){return cf.blobToBase64(cW)};var W=function(cW){return cf.dataUriToBlobSync(cW)};var b=function(cW){return Q.from(cf.uriToBlob(cW))};var cE={blobToImage:bZ,imageToBlob:aA,blobToDataUri:by,blobToBase64:ad,dataUriToBlobSync:W,uriToBlob:b};function bH(c6,cY,cZ){var c3=cY.type;var c4=ck(c3);function c0(){return cB.resolve(cY)}function cX(){return cZ}function c7(){return cZ.split(",")[1]}function c1(c8,c9){return c6.then(function(da){return cf.canvasToBlob(da,c8,c9)})}function c5(c8,c9){return c6.then(function(da){return cf.canvasToDataURL(da,c8,c9)})}function cW(c8,c9){return c5(c8,c9).then(function(da){return da.split(",")[1]})}function c2(){return c6.then(cF.clone)}return{getType:c4,toBlob:c0,toDataURL:cX,toBase64:c7,toAdjustedBlob:c1,toAdjustedDataURL:c5,toAdjustedBase64:cW,toCanvas:c2}}function n(cW){return cf.blobToDataUri(cW).then(function(cX){return bH(cf.blobToCanvas(cW),cW,cX)})}function cj(cW,cX){return cf.canvasToBlob(cW,cX).then(function(cY){return bH(cB.resolve(cW),cY,cW.toDataURL())})}function G(cW){return cf.imageToBlob(cW).then(function(cX){return n(cX)})}var b8=function(cW,cX){return bH(cf.blobToCanvas(cW),cW,cX)};var Z={fromBlob:n,fromCanvas:cj,fromImage:G,fromBlobAndUrlSync:b8};function cT(cY,cX,cW){cY=parseFloat(cY);if(cY>cW){cY=cW}else{if(cY<cX){cY=cX}}return cY}function bU(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}var e=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];function cN(c2,c1){var c0,cZ,cW,c3,cY=[],cX=new Array(10);for(c0=0;c0<5;c0++){for(cZ=0;cZ<5;cZ++){cY[cZ]=c1[cZ+c0*5]}for(cZ=0;cZ<5;cZ++){c3=0;for(cW=0;cW<5;cW++){c3+=c2[cZ+cW*5]*cY[cW]}cX[cZ+c0*5]=c3}}return cX}function bE(cW,cX){cX=cT(cX,0,1);return cW.map(function(cZ,cY){if(cY%6===0){cZ=1-(1-cZ)*cX}else{cZ*=cX}return cT(cZ,0,1)})}function bb(cX,cY){var cW;cY=cT(cY,-1,1);cY*=100;if(cY<0){cW=127+cY/100*127}else{cW=cY%1;if(cW===0){cW=e[cY]}else{cW=e[Math.floor(cY)]*(1-cW)+e[Math.floor(cY)+1]*cW}cW=cW*127+127}return cN(cX,[cW/127,0,0,0,0.5*(127-cW),0,cW/127,0,0,0.5*(127-cW),0,0,cW/127,0,0.5*(127-cW),0,0,0,1,0,0,0,0,0,1])}function bh(cX,c0){var cW,cZ,cY,c1;c0=cT(c0,-1,1);cW=1+(c0>0?3*c0:c0);cZ=0.3086;cY=0.6094;c1=0.082;return cN(cX,[cZ*(1-cW)+cW,cY*(1-cW),c1*(1-cW),0,0,cZ*(1-cW),cY*(1-cW)+cW,c1*(1-cW),0,0,cZ*(1-cW),cY*(1-cW),c1*(1-cW)+cW,0,0,0,0,0,1,0,0,0,0,0,1])}function cu(cW,c2){var c1,cZ,cY,cX,c0;c2=cT(c2,-180,180)/180*Math.PI;c1=Math.cos(c2);cZ=Math.sin(c2);cY=0.213;cX=0.715;c0=0.072;return cN(cW,[cY+c1*(1-cY)+cZ*-cY,cX+c1*-cX+cZ*-cX,c0+c1*-c0+cZ*(1-c0),0,0,cY+c1*-cY+cZ*0.143,cX+c1*(1-cX)+cZ*0.14,c0+c1*-c0+cZ*-0.283,0,0,cY+c1*-cY+cZ*-(1-cY),cX+c1*-cX+cZ*cX,c0+c1*(1-c0)+cZ*c0,0,0,0,0,0,1,0,0,0,0,0,1])}function cp(cW,cX){cX=cT(255*cX,-255,255);return cN(cW,[1,0,0,0,cX,0,1,0,0,cX,0,0,1,0,cX,0,0,0,1,0,0,0,0,0,1])}function T(cX,cZ,cY,cW){cZ=cT(cZ,0,2);cY=cT(cY,0,2);cW=cT(cW,0,2);return cN(cX,[cZ,0,0,0,0,0,cY,0,0,0,0,0,cW,0,0,0,0,0,1,0,0,0,0,0,1])}function R(cW,cX){cX=cT(cX,0,1);return cN(cW,bE([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],cX))}function cw(cW,cX){cX=cT(cX,0,1);return cN(cW,bE([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],cX))}var cd={identity:bU,adjust:bE,multiply:cN,adjustContrast:bb,adjustBrightness:cp,adjustSaturation:bh,adjustHue:cu,adjustColors:T,adjustSepia:R,adjustGrayscale:cw};function cR(cX,cW){return cX.toCanvas().then(function(cY){return cq(cY,cX.getType(),cW)})}function cq(cY,c0,cX){var cZ=cF.get2dContext(cY);var c1;function cW(c7,c8){var dh=c7.data,c6,dd,dl,dp,da,c5=c8[0],c4=c8[1],c3=c8[2],c2=c8[3],du=c8[4],dt=c8[5],ds=c8[6],dq=c8[7],dm=c8[8],dj=c8[9],dr=c8[10],dn=c8[11],dk=c8[12],di=c8[13],dg=c8[14],df=c8[15],de=c8[16],dc=c8[17],db=c8[18],c9=c8[19];for(da=0;da<dh.length;da+=4){c6=dh[da];dd=dh[da+1];dl=dh[da+2];dp=dh[da+3];dh[da]=c6*c5+dd*c4+dl*c3+dp*c2+du;dh[da+1]=c6*dt+dd*ds+dl*dq+dp*dm+dj;dh[da+2]=c6*dr+dd*dn+dl*dk+dp*di+dg;dh[da+3]=c6*df+dd*de+dl*dc+dp*db+c9}return c7}c1=cW(cZ.getImageData(0,0,cY.width,cY.height),cX);cZ.putImageData(c1,0,0);return Z.fromCanvas(cY,c0)}function bY(cX,cW){return cX.toCanvas().then(function(cY){return bx(cY,cX.getType(),cW)})}function bx(cY,c1,cX){var c0=cF.get2dContext(cY);var cZ,c2;function cW(de,c8,dh){var c9,dn,c4,c7,dc,db,dg,dl,dm,c6,c5,dj,di,da,c3,dd,dk;function df(dr,dq,dp){if(dr>dp){dr=dp}else{if(dr<dq){dr=dq}}return dr}c4=Math.round(Math.sqrt(dh.length));c7=Math.floor(c4/2);c9=de.data;dn=c8.data;dd=de.width;dk=de.height;for(db=0;db<dk;db++){for(dc=0;dc<dd;dc++){dg=dl=dm=0;for(c5=0;c5<c4;c5++){for(c6=0;c6<c4;c6++){dj=df(dc+c6-c7,0,dd-1);di=df(db+c5-c7,0,dk-1);da=(di*dd+dj)*4;c3=dh[c5*c4+c6];dg+=c9[da]*c3;dl+=c9[da+1]*c3;dm+=c9[da+2]*c3}}da=(db*dd+dc)*4;dn[da]=df(dg,0,255);dn[da+1]=df(dl,0,255);dn[da+2]=df(dm,0,255)}}return c8}cZ=c0.getImageData(0,0,cY.width,cY.height);c2=c0.getImageData(0,0,cY.width,cY.height);c2=cW(cZ,c2,cX);c0.putImageData(c2,0,0);return Z.fromCanvas(cY,c1)}function bK(cX){var cW=function(cY,c1,c2){var c0=cF.get2dContext(cY);var c5,cZ,c4=new Array(256);function c3(c9,c7){var c8=c9.data,c6;for(c6=0;c6<c8.length;c6+=4){c8[c6]=c7[c8[c6]];c8[c6+1]=c7[c8[c6+1]];c8[c6+2]=c7[c8[c6+2]]}return c9}for(cZ=0;cZ<c4.length;cZ++){c4[cZ]=cX(cZ,c2)}c5=c3(c0.getImageData(0,0,cY.width,cY.height),c4);c0.putImageData(c5,0,0);return Z.fromCanvas(cY,c1)};return function(cZ,cY){return cZ.toCanvas().then(function(c0){return cW(c0,cZ.getType(),cY)})}}function Y(cW){return function(cX,cY){return cR(cX,cW(cd.identity(),cY))}}function cn(cW){return function(cX){return cR(cX,cW)}}function ae(cW){return function(cX){return bY(cX,cW)}}var cH={invert:cn([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:Y(cd.adjustBrightness),hue:Y(cd.adjustHue),saturate:Y(cd.adjustSaturation),contrast:Y(cd.adjustContrast),grayscale:Y(cd.adjustGrayscale),sepia:Y(cd.adjustSepia),colorize:function(cZ,cY,cX,cW){return cR(cZ,cd.adjustColors(cd.identity(),cY,cX,cW))},sharpen:ae([0,-1,0,-1,5,-1,0,-1,0]),emboss:ae([-2,-1,0,-1,1,1,0,1,2]),gamma:bK(function(cW,cX){return Math.pow(cW/255,1-cX)*255}),exposure:bK(function(cW,cX){return 255*(1-Math.exp(-(cW/255)*cX))}),colorFilter:cR,convoluteFilter:bY};function bL(cY,c1,cW){var cX=aw.getWidth(cY);var c3=aw.getHeight(cY);var c4=c1/cX;var c0=cW/c3;var c2=false;if(c4<0.5||c4>2){c4=c4<0.5?0.5:2;c2=true}if(c0<0.5||c0>2){c0=c0<0.5?0.5:2;c2=true}var cZ=w(cY,c4,c0);return !c2?cZ:cZ.then(function(c5){return bL(c5,c1,cW)})}function w(cY,cW,cX){return new cB(function(c4){var c5=aw.getWidth(cY);var c1=aw.getHeight(cY);var cZ=Math.floor(c5*cW);var c3=Math.floor(c1*cX);var c0=cF.create(cZ,c3);var c2=cF.get2dContext(c0);c2.drawImage(cY,0,0,c5,c1,0,0,cZ,c3);c4(c0)})}var cI={scale:bL};function X(cW,cX){return cW.toCanvas().then(function(cY){return co(cY,cW.getType(),cX)})}function co(c0,cY,c2){var cW=cF.create(c0.width,c0.height);var cX=cF.get2dContext(cW);var c1=0,cZ=0;c2=c2<0?360+c2:c2;if(c2==90||c2==270){cF.resize(cW,cW.height,cW.width)}if(c2==90||c2==180){c1=cW.width}if(c2==270||c2==180){cZ=cW.height}cX.translate(c1,cZ);cX.rotate(c2*Math.PI/180);cX.drawImage(c0,0,0);return Z.fromCanvas(cW,cY)}function aL(cX,cW){return cX.toCanvas().then(function(cY){return cx(cY,cX.getType(),cW)})}function cx(c0,cZ,cY){var cW=cF.create(c0.width,c0.height);var cX=cF.get2dContext(cW);if(cY=="v"){cX.scale(1,-1);cX.drawImage(c0,0,-cW.height)}else{cX.scale(-1,1);cX.drawImage(c0,-cW.width,0)}return Z.fromCanvas(cW,cZ)}function L(cZ,cW,c0,cX,cY){return cZ.toCanvas().then(function(c1){return bP(c1,cZ.getType(),cW,c0,cX,cY)})}function bP(c2,c1,cW,c3,cX,c0){var cY=cF.create(cX,c0);var cZ=cF.get2dContext(cY);cZ.drawImage(c2,-cW,-c3);return Z.fromCanvas(cY,c1)}function l(cY,cW,cX){return cY.toCanvas().then(function(cZ){return cI.scale(cZ,cW,cX).then(function(c0){return Z.fromCanvas(c0,cY.getType())})})}var S={rotate:X,flip:aL,crop:L,resize:l};var bX=function(){function cW(cX){this.littleEndian=false;this._dv=new DataView(cX)}cW.prototype.readByteAt=function(cX){return this._dv.getUint8(cX)};cW.prototype.read=function(cY,c0){if(cY+c0>this.length()){return null}var cX=this.littleEndian?0:-8*(c0-1);for(var cZ=0,c1=0;cZ<c0;cZ++){c1|=this.readByteAt(cY+cZ)<<Math.abs(cX+cZ*8)}return c1};cW.prototype.BYTE=function(cX){return this.read(cX,1)};cW.prototype.SHORT=function(cX){return this.read(cX,2)};cW.prototype.LONG=function(cX){return this.read(cX,4)};cW.prototype.SLONG=function(cX){var cY=this.read(cX,4);return cY>2147483647?cY-4294967296:cY};cW.prototype.CHAR=function(cX){return String.fromCharCode(this.read(cX,1))};cW.prototype.STRING=function(cX,cY){return this.asArray("CHAR",cX,cY).join("")};cW.prototype.SEGMENT=function(cX,cZ){var cY=this._dv.buffer;switch(arguments.length){case 2:return cY.slice(cX,cX+cZ);case 1:return cY.slice(cX);default:return cY}};cW.prototype.asArray=function(c0,cX,c1){var cY=[];for(var cZ=0;cZ<c1;cZ++){cY[cZ]=this[c0](cX+cZ)}return cY};cW.prototype.length=function(){return this._dv?this._dv.byteLength:0};return cW}();var B={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},thumb:{513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"}};var C={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};var bg=function(){function cW(cY){this._offsets={tiffHeader:10,IFD0:null,IFD1:null,exifIFD:null,gpsIFD:null};this._tiffTags={};var cX=this;cX._reader=new bX(cY);cX._idx=cX._offsets.tiffHeader;if(cX.SHORT(0)!==65505||cX.STRING(4,5).toUpperCase()!=="EXIF\0"){throw new Error("Exif data cannot be read or not available.")}cX._reader.littleEndian=cX.SHORT(cX._idx)==18761;if(cX.SHORT(cX._idx+=2)!==42){throw new Error("Invalid Exif data.")}cX._offsets.IFD0=cX._offsets.tiffHeader+cX.LONG(cX._idx+=2);cX._tiffTags=cX.extractTags(cX._offsets.IFD0,B.tiff);if("ExifIFDPointer" in cX._tiffTags){cX._offsets.exifIFD=cX._offsets.tiffHeader+cX._tiffTags.ExifIFDPointer;delete cX._tiffTags.ExifIFDPointer}if("GPSInfoIFDPointer" in cX._tiffTags){cX._offsets.gpsIFD=cX._offsets.tiffHeader+cX._tiffTags.GPSInfoIFDPointer;delete cX._tiffTags.GPSInfoIFDPointer}var cZ=cX.LONG(cX._offsets.IFD0+cX.SHORT(cX._offsets.IFD0)*12+2);if(cZ){cX._offsets.IFD1=cX._offsets.tiffHeader+cZ}}cW.prototype.BYTE=function(cX){return this._reader.BYTE(cX)};cW.prototype.SHORT=function(cX){return this._reader.SHORT(cX)};cW.prototype.LONG=function(cX){return this._reader.LONG(cX)};cW.prototype.SLONG=function(cX){return this._reader.SLONG(cX)};cW.prototype.CHAR=function(cX){return this._reader.CHAR(cX)};cW.prototype.STRING=function(cX,cY){return this._reader.STRING(cX,cY)};cW.prototype.SEGMENT=function(cX,cY){return this._reader.SEGMENT(cX,cY)};cW.prototype.asArray=function(c0,cX,c1){var cY=[];for(var cZ=0;cZ<c1;cZ++){cY[cZ]=this[c0](cX+cZ)}return cY};cW.prototype.length=function(){return this._reader.length()};cW.prototype.UNDEFINED=function(){return this.BYTE.apply(this,arguments)};cW.prototype.RATIONAL=function(cX){return this.LONG(cX)/this.LONG(cX+4)};cW.prototype.SRATIONAL=function(cX){return this.SLONG(cX)/this.SLONG(cX+4)};cW.prototype.ASCII=function(cX){return this.CHAR(cX)};cW.prototype.TIFF=function(){return this._tiffTags};cW.prototype.EXIF=function(){var cY=this;var cZ=null;if(cY._offsets.exifIFD){try{cZ=cY.extractTags(cY._offsets.exifIFD,B.exif)}catch(c1){return null}if(cZ.ExifVersion&&Array.isArray(cZ.ExifVersion)){for(var c0=0,cX="";c0<cZ.ExifVersion.length;c0++){cX+=String.fromCharCode(cZ.ExifVersion[c0])}cZ.ExifVersion=cX}}return cZ};cW.prototype.GPS=function(){var cY=this;var cX=null;if(cY._offsets.gpsIFD){try{cX=cY.extractTags(cY._offsets.gpsIFD,B.gps)}catch(cZ){return null}if(cX.GPSVersionID&&Array.isArray(cX.GPSVersionID)){cX.GPSVersionID=cX.GPSVersionID.join(".")}}return cX};cW.prototype.thumb=function(){var cY=this;if(cY._offsets.IFD1){try{var cX=cY.extractTags(cY._offsets.IFD1,B.thumb);if("JPEGInterchangeFormat" in cX){return cY.SEGMENT(cY._offsets.tiffHeader+cX.JPEGInterchangeFormat,cX.JPEGInterchangeFormatLength)}}catch(cZ){}}return null};cW.prototype.extractTags=function(cX,c5){var c8=this;var cY,c1,db,c4,c3,da,cZ,c6,c7=[],c0={};var c2={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"};var c9={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};cY=c8.SHORT(cX);for(c1=0;c1<cY;c1++){c7=[];cZ=cX+2+c1*12;db=c5[c8.SHORT(cZ)];if(db===undefined){continue}c4=c2[c8.SHORT(cZ+=2)];c3=c8.LONG(cZ+=2);da=c9[c4];if(!da){throw new Error("Invalid Exif data.")}cZ+=4;if(da*c3>4){cZ=c8.LONG(cZ)+c8._offsets.tiffHeader}if(cZ+da*c3>=c8.length()){throw new Error("Invalid Exif data.")}if(c4==="ASCII"){c0[db]=c8.STRING(cZ,c3).replace(/\0$/,"").trim();continue}else{c7=c8.asArray(c4,cZ,c3);c6=c3==1?c7[0]:c7;if(C.hasOwnProperty(db)&&typeof c6!="object"){c0[db]=C[db][c6]}else{c0[db]=c6}}}return c0};return cW}();var aE=function(cW){return cf.blobToArrayBuffer(cW).then(function(cX){try{var cZ=new bX(cX);if(cZ.SHORT(0)===65496){var c3=aU(cZ);var c1=c3.filter(function(c4){return c4.name==="APP1"});var c2={};if(c1.length){var c0=new bg(c1[0].segment);c2={tiff:c0.TIFF(),exif:c0.EXIF(),gps:c0.GPS(),thumb:c0.thumb()}}else{return cB.reject("Headers did not include required information")}c2.rawHeaders=c3;return c2}return cB.reject("Image was not a jpeg")}catch(cY){return cB.reject("Unsupported format or not an image: "+cW.type+" (Exception: "+cY.message+")")}})};var aU=function(cY){var c0=[],cW,cX,cZ=0;cW=2;while(cW<=cY.length()){cX=cY.SHORT(cW);if(cX>=65488&&cX<=65495){cW+=2;continue}if(cX===65498||cX===65497){break}cZ=cY.SHORT(cW+2)+2;if(cX>=65505&&cX<=65519){c0.push({hex:cX,name:"APP"+(cX&15),start:cW,length:cZ,segment:cY.SEGMENT(cW,cZ)})}cW+=cZ}return c0};var a9={extractFrom:aE};var bT=function(cW){return cH.invert(cW)};var A=function(cW){return cH.sharpen(cW)};var aW=function(cW){return cH.emboss(cW)};var aY=function(cX,cW){return cH.gamma(cX,cW)};var q=function(cX,cW){return cH.exposure(cX,cW)};var cO=function(cZ,cY,cX,cW){return cH.colorize(cZ,cY,cX,cW)};var g=function(cW,cX){return cH.brightness(cW,cX)};var aF=function(cW,cX){return cH.hue(cW,cX)};var cM=function(cW,cX){return cH.saturate(cW,cX)};var bQ=function(cW,cX){return cH.contrast(cW,cX)};var bd=function(cW,cX){return cH.grayscale(cW,cX)};var b2=function(cW,cX){return cH.sepia(cW,cX)};var bl=function(cX,cW){return S.flip(cX,cW)};var aP=function(cZ,cW,c0,cX,cY){return S.crop(cZ,cW,c0,cX,cY)};var j=function(cY,cW,cX){return S.resize(cY,cW,cX)};var m=function(cW,cX){return S.rotate(cW,cX)};var aK=function(c1){var cX=6;var cW=3;var c0=8;var cY=function(c3){var c2=c3.tiff.Orientation;switch(c2){case cX:return m(c1,90);case cW:return m(c1,180);case c0:return m(c1,270);default:return c1}};var cZ=function(){return c1};return c1.toBlob().then(a9.extractFrom).then(cY,cZ)};var aV={invert:bT,sharpen:A,emboss:aW,brightness:g,hue:aF,saturate:cM,contrast:bQ,grayscale:bd,sepia:b2,colorize:cO,gamma:aY,exposure:q,flip:bl,crop:aP,resize:j,rotate:m,exifRotate:aK};var ce=function(cW){return Z.fromBlob(cW)};var a2=function(cW,cX){return Z.fromBlobAndUrlSync(cW,cX)};var p=function(cW){return Z.fromImage(cW)};var cP=function(cX,cW,cY){if(cW===undefined&&cY===undefined){return an(cX)}else{return cX.toAdjustedBlob(cW,cY)}};var an=function(cW){return cW.toBlob()};var I=function(cW){return cW.toDataURL()};var a1={blobToImageResult:ce,fromBlobAndUrlSync:a2,imageToImageResult:p,imageResultToBlob:cP,imageResultToOriginalBlob:an,imageResultToDataURL:I};var cK=function(){return K.getOrDie("URL")};var bw=function(cW){return cK().createObjectURL(cW)};var cV=function(cW){cK().revokeObjectURL(cW)};var am={createObjectURL:bw,revokeObjectURL:cV};var bt=tinymce.util.Tools.resolve("tinymce.util.Delay");var bq=tinymce.util.Tools.resolve("tinymce.util.Promise");var bp=tinymce.util.Tools.resolve("tinymce.util.URI");var ao=function(cW){return cW.getParam("imagetools_toolbar","rotateleft rotateright | flipv fliph | crop editimage imageoptions")};var ba=function(cW){return cW.getParam("imagetools_proxy")};var cU=function(cW){return cW.getParam("imagetools_cors_hosts",[],"string[]")};var a0=function(cW){return cW.getParam("imagetools_credentials_hosts",[],"string[]")};var bz=function(cW){return cW.getParam("api_key",cW.getParam("imagetools_api_key","","string"),"string")};var aJ=function(cW){return cW.getParam("images_upload_timeout",30000,"number")};var bM=function(cW){return cW.getParam("images_reuse_filename",false,"boolean")};var bo=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils");var bn=tinymce.util.Tools.resolve("tinymce.ui.Factory");function ac(){var c0=[];var cY=-1;function c2(c3){var c4;c4=c0.splice(++cY);c0.push(c3);return{state:c3,removed:c4}}function cW(){if(cZ()){return c0[--cY]}}function cX(){if(c1()){return c0[++cY]}}function cZ(){return cY>0}function c1(){return cY!==-1&&cY<c0.length-1}return{data:c0,add:c2,undo:cW,redo:cX,canUndo:cZ,canRedo:c1}}var bm=tinymce.util.Tools.resolve("tinymce.geom.Rect");var f=function(cW){return new bq(function(cY){var cX=function(){cW.removeEventListener("load",cX);cY(cW)};if(cW.complete){cY(cW)}else{cW.addEventListener("load",cX)}})};var J={loadImage:f};var bk=tinymce.util.Tools.resolve("tinymce.dom.DomQuery");var bj=tinymce.util.Tools.resolve("tinymce.util.Observable");var aX=tinymce.util.Tools.resolve("tinymce.util.VK");var aT=0;function bI(c6,c9,c7,c0,db){var df;var cW;var dd;var de;var dc="mce-";var da=dc+"crid-"+aT++;cW=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}];de=["top","right","bottom","left"];function c1(dk,dj){return{x:dj.x+dk.x,y:dj.y+dk.y,w:dj.w,h:dj.h}}function c8(dj,dk){return{x:dk.x-dj.x,y:dk.y-dj.y,w:dk.w,h:dk.h}}function cX(){return c8(c7,c6)}function dh(dm,dn,dk,dj){var dr,dq,ds,dl,dp;dr=dn.x;dq=dn.y;ds=dn.w;dl=dn.h;dr+=dk*dm.deltaX;dq+=dj*dm.deltaY;ds+=dk*dm.deltaW;dl+=dj*dm.deltaH;if(ds<20){ds=20}if(dl<20){dl=20}dp=c6=bm.clamp({x:dr,y:dq,w:ds,h:dl},c7,dm.name==="move");dp=c8(c7,dp);df.fire("updateRect",{rect:dp});c5(dp)}function di(){function dj(dm){var dk;var dl=bn.get("DragHelper");return new dl(da,{document:c0.ownerDocument,handle:da+"-"+dm.name,start:function(){dk=c6},drag:function(dn){dh(dm,dk,dn.deltaX,dn.deltaY)}})}bk('<div id="'+da+'" class="'+dc+'croprect-container" role="grid" aria-dropeffect="execute">').appendTo(c0);bv.each(de,function(dk){bk("#"+da,c0).append('<div id="'+da+"-"+dk+'"class="'+dc+'croprect-block" style="display: none" data-mce-bogus="all">')});bv.each(cW,function(dk){bk("#"+da,c0).append('<div id="'+da+"-"+dk.name+'" class="'+dc+"croprect-handle "+dc+"croprect-handle-"+dk.name+'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+dk.label+'" aria-grabbed="false">')});dd=bv.map(cW,dj);cY(c6);bk(c0).on("focusin focusout",function(dk){bk(dk.target).attr("aria-grabbed",dk.type==="focus")});bk(c0).on("keydown",function(dm){var dl;bv.each(cW,function(dn){if(dm.target.id===da+"-"+dn.name){dl=dn;return false}});function dk(dq,ds,dr,dp,dn){dq.stopPropagation();dq.preventDefault();dh(dl,dr,dp,dn)}switch(dm.keyCode){case aX.LEFT:dk(dm,dl,c6,-10,0);break;case aX.RIGHT:dk(dm,dl,c6,10,0);break;case aX.UP:dk(dm,dl,c6,0,-10);break;case aX.DOWN:dk(dm,dl,c6,0,10);break;case aX.ENTER:case aX.SPACEBAR:dm.preventDefault();db();break}})}function cZ(dk){var dj;dj=bv.map(cW,function(dl){return"#"+da+"-"+dl.name}).concat(bv.map(de,function(dl){return"#"+da+"-"+dl})).join(",");if(dk){bk(dj,c0).show()}else{bk(dj,c0).hide()}}function cY(dj){function dk(dl,dm){if(dm.h<0){dm.h=0}if(dm.w<0){dm.w=0}bk("#"+da+"-"+dl,c0).css({left:dm.x,top:dm.y,width:dm.w,height:dm.h})}bv.each(cW,function(dl){bk("#"+da+"-"+dl.name,c0).css({left:dj.w*dl.xMul+dj.x,top:dj.h*dl.yMul+dj.y})});dk("top",{x:c9.x,y:c9.y,w:c9.w,h:dj.y-c9.y});dk("right",{x:dj.x+dj.w,y:dj.y,w:c9.w-dj.x-dj.w+c9.x,h:dj.h});dk("bottom",{x:c9.x,y:dj.y+dj.h,w:c9.w,h:c9.h-dj.y-dj.h+c9.y});dk("left",{x:c9.x,y:dj.y,w:dj.x-c9.x,h:dj.h});dk("move",dj)}function c4(dj){c6=dj;cY(c6)}function c2(dj){c9=dj;cY(c6)}function c5(dj){c4(c1(c7,dj))}function c3(dj){c7=dj;cY(c6)}function dg(){bv.each(dd,function(dj){dj.destroy()});dd=[]}di();df=bv.extend({toggleVisibility:cZ,setClampRect:c3,setRect:c4,getInnerRect:cX,setInnerRect:c5,setViewPortRect:c2,destroy:dg},bj);return df}var bF=function(cX){var cY=bn.get("Control");var cW=cY.extend({Defaults:{classes:"imagepanel"},selection:function(cZ){if(arguments.length){this.state.set("rect",cZ);return this}return this.state.get("rect")},imageSize:function(){var cZ=this.state.get("viewRect");return{w:cZ.w,h:cZ.h}},toggleCropRect:function(cZ){this.state.set("cropEnabled",cZ)},imageSrc:function(c0){var c1=this,cZ=new Image();cZ.src=c0;J.loadImage(cZ).then(function(){var c5,c3;var c4=c1.state.get("viewRect");c3=c1.$el.find("img");if(c3[0]){c3.replaceWith(cZ)}else{var c2=document.createElement("div");c2.className="mce-imagepanel-bg";c1.getEl().appendChild(c2);c1.getEl().appendChild(cZ)}c5={x:0,y:0,w:cZ.naturalWidth,h:cZ.naturalHeight};c1.state.set("viewRect",c5);c1.state.set("rect",bm.inflate(c5,-20,-20));if(!c4||c4.w!==c5.w||c4.h!==c5.h){c1.zoomFit()}c1.repaintImage();c1.fire("load")})},zoom:function(cZ){if(arguments.length){this.state.set("zoom",cZ);return this}return this.state.get("zoom")},postRender:function(){this.imageSrc(this.settings.imageSrc);return this._super()},zoomFit:function(){var c3=this;var c0,c2,c6,cZ,c1,c4,c5;c5=10;c0=c3.$el.find("img");c2=c3.getEl().clientWidth;c6=c3.getEl().clientHeight;cZ=c0[0].naturalWidth;c1=c0[0].naturalHeight;c4=Math.min((c2-c5)/cZ,(c6-c5)/c1);if(c4>=1){c4=1}c3.zoom(c4)},repaintImage:function(){var c6,c5,c7,c1,c8,c2,cZ,c0,c9,c4,c3;c3=this.getEl();c9=this.zoom();c4=this.state.get("rect");cZ=this.$el.find("img");c0=this.$el.find(".mce-imagepanel-bg");c8=c3.offsetWidth;c2=c3.offsetHeight;c7=cZ[0].naturalWidth*c9;c1=cZ[0].naturalHeight*c9;c6=Math.max(0,c8/2-c7/2);c5=Math.max(0,c2/2-c1/2);cZ.css({left:c6,top:c5,width:c7,height:c1});c0.css({left:c6,top:c5,width:c7,height:c1});if(this.cropRect){this.cropRect.setRect({x:c4.x*c9+c6,y:c4.y*c9+c5,w:c4.w*c9,h:c4.h*c9});this.cropRect.setClampRect({x:c6,y:c5,w:c7,h:c1});this.cropRect.setViewPortRect({x:0,y:0,w:c8,h:c2})}},bindStates:function(){var c0=this;function cZ(c1){c0.cropRect=bI(c1,c0.state.get("viewRect"),c0.state.get("viewRect"),c0.getEl(),function(){c0.fire("crop")});c0.cropRect.on("updateRect",function(c4){var c3=c4.rect;var c2=c0.zoom();c3={x:Math.round(c3.x/c2),y:Math.round(c3.y/c2),w:Math.round(c3.w/c2),h:Math.round(c3.h/c2)};c0.state.set("rect",c3)});c0.on("remove",c0.cropRect.destroy)}c0.state.on("change:cropEnabled",function(c1){c0.cropRect.toggleVisibility(c1.value);c0.repaintImage()});c0.state.on("change:zoom",function(){c0.repaintImage()});c0.state.on("change:rect",function(c2){var c1=c2.value;if(!c0.cropRect){cZ(c1)}c0.cropRect.setRect(c1)})}});return new cW(cX)};var v={create:bF};function aa(cW){return{blob:cW,url:am.createObjectURL(cW)}}function aS(cW){if(cW){am.revokeObjectURL(cW.url)}}function cJ(cW){bv.each(cW,aS)}function bB(cX,du,dr,dv){var dM,de=ac(),c7,di,c6,dh,dz,dx,dl,dF,dk,c4,da,dD,dy,dH,dg,c3,dG,dR,dP,dE,c2,df,cW,c1,dB,dJ;var dL=function(dT){return cX.rtl?dT.reverse():dT};function dm(dX){var dU,dW,dV,dT;dU=dM.find("#w")[0];dW=dM.find("#h")[0];dV=parseInt(dU.value(),10);dT=parseInt(dW.value(),10);if(dM.find("#constrain")[0].checked()&&cW&&c1&&dV&&dT){if(dX.control.settings.name==="w"){dT=Math.round(dV*dB);dW.value(dT)}else{dV=Math.round(dT*dJ);dU.value(dV)}}cW=dV;c1=dT}function dK(dT){return Math.round(dT*100)+"%"}function c9(){dM.find("#undo").disabled(!de.canUndo());dM.find("#redo").disabled(!de.canRedo());dM.statusbar.find("#save").disabled(!de.canUndo())}function db(){dM.find("#undo").disabled(true);dM.find("#redo").disabled(true)}function dd(dT){if(dT){dl.imageSrc(dT.url)}}function dI(dT){return function(){var dU=bv.grep(df,function(dV){return dV.settings.name!==dT});bv.each(dU,function(dV){dV.hide()});dT.show();dT.focus()}}function dc(dT){c6=aa(dT);dd(c6)}function dO(dT){du=aa(dT);dd(du);cJ(de.add(du).removed);c9()}function cZ(){var dT=dl.selection();a1.blobToImageResult(du.blob).then(function(dU){aV.crop(dU,dT.x,dT.y,dT.w,dT.h).then(dN).then(function(dV){dO(dV);c5()})})}var dt=function(dU){var dT=[].slice.call(arguments,1);return function(){var dV=c6||du;a1.blobToImageResult(dV.blob).then(function(dW){dU.apply(this,[dW].concat(dT)).then(dN).then(dc)})}};function c0(dV){var dT=[];for(var dW=1;dW<arguments.length;dW++){dT[dW-1]=arguments[dW]}var dU=[].slice.call(arguments,1);return function(){a1.blobToImageResult(du.blob).then(function(dX){dV.apply(this,[dX].concat(dU)).then(dN).then(dO)})}}function c5(){dd(du);aS(c6);dI(c7)();c9()}function dQ(dU,dT){if(c6){dT()}else{setTimeout(function(){if(dU-->0){dQ(dU,dT)}else{cX.windowManager.alert("Error: failed to apply image operation.")}},10)}}function dp(){if(c6){dO(c6.blob);c5()}else{dQ(100,dp)}}function dA(){var dT=dl.zoom();if(dT<2){dT+=0.1}dl.zoom(dT)}function dn(){var dT=dl.zoom();if(dT>0.1){dT-=0.1}dl.zoom(dT)}function dw(){du=de.undo();dd(du);c9()}function dj(){du=de.redo();dd(du);c9()}function dq(){dr(du.blob);dM.close()}function cY(dT){return bn.create("Form",{layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:dT})}var dN=function(dT){return dT.toBlob()};function ds(dU,dT){return cY(dL([{text:"Back",onclick:c5},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:dp}])).hide().on("show",function(){db();a1.blobToImageResult(du.blob).then(function(dV){return dT(dV)}).then(dN).then(function(dW){var dV=aa(dW);dd(dV);aS(c6);c6=dV})})}function dC(dX,dV,dW,dU,dT){function dY(dZ){a1.blobToImageResult(du.blob).then(function(d0){return dV(d0,dZ)}).then(dN).then(function(d1){var d0=aa(d1);dd(d0);aS(c6);c6=d0})}return cY(dL([{text:"Back",onclick:c5},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(dZ){dY(dZ.value)},minValue:cX.rtl?dT:dU,maxValue:cX.rtl?dU:dT,value:dW,previewFilter:dK},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:dp}])).hide().on("show",function(){this.find("slider").value(dW);db()})}function c8(dW,dV){function dX(){var d0,dZ,dY;d0=dM.find("#r")[0].value();dZ=dM.find("#g")[0].value();dY=dM.find("#b")[0].value();a1.blobToImageResult(du.blob).then(function(d1){return dV(d1,d0,dZ,dY)}).then(dN).then(function(d2){var d1=aa(d2);dd(d1);aS(c6);c6=d1})}var dU=cX.rtl?2:0;var dT=cX.rtl?0:2;return cY(dL([{text:"Back",onclick:c5},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:dU,value:1,maxValue:dT,ondragend:dX,previewFilter:dK},{type:"slider",label:"G",name:"g",minValue:dU,value:1,maxValue:dT,ondragend:dX,previewFilter:dK},{type:"slider",label:"B",name:"b",minValue:dU,value:1,maxValue:dT,ondragend:dX,previewFilter:dK},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:dp}])).hide().on("show",function(){dM.find("#r,#g,#b").value(1);db()})}dh=cY(dL([{text:"Back",onclick:c5},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:cZ}])).hide().on("show hide",function(dT){dl.toggleCropRect(dT.type==="show")}).on("show",db);function dS(dT){if(dT.control.value()===true){dB=c1/cW;dJ=cW/c1}}dz=cY(dL([{text:"Back",onclick:c5},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:dm},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:dm},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:true,onchange:dS},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}])).hide().on("submit",function(dV){var dU=parseInt(dM.find("#w").value(),10),dT=parseInt(dM.find("#h").value(),10);dV.preventDefault();c0(aV.resize,dU,dT)();c5()}).on("show",db);dx=cY(dL([{text:"Back",onclick:c5},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:dt(aV.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:dt(aV.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:dt(aV.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:dt(aV.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:dp}])).hide().on("show",db);c4=ds("Invert",aV.invert);dR=ds("Sharpen",aV.sharpen);dP=ds("Emboss",aV.emboss);da=dC("Brightness",aV.brightness,0,-1,1);dD=dC("Hue",aV.hue,180,0,360);dy=dC("Saturate",aV.saturate,0,-1,1);dH=dC("Contrast",aV.contrast,0,-1,1);dg=dC("Grayscale",aV.grayscale,0,0,1);c3=dC("Sepia",aV.sepia,0,0,1);dG=c8("Colorize",aV.colorize);dE=dC("Gamma",aV.gamma,0,-1,1);c2=dC("Exposure",aV.exposure,1,0,2);di=cY(dL([{text:"Back",onclick:c5},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:dI(dD)},{text:"saturate",icon:"saturate",onclick:dI(dy)},{text:"sepia",icon:"sepia",onclick:dI(c3)},{text:"emboss",icon:"emboss",onclick:dI(dP)},{text:"exposure",icon:"exposure",onclick:dI(c2)},{type:"spacer",flex:1}])).hide();c7=cY(dL([{tooltip:"Crop",icon:"crop",onclick:dI(dh)},{tooltip:"Resize",icon:"resize2",onclick:dI(dz)},{tooltip:"Orientation",icon:"orientation",onclick:dI(dx)},{tooltip:"Brightness",icon:"sun",onclick:dI(da)},{tooltip:"Sharpen",icon:"sharpen",onclick:dI(dR)},{tooltip:"Contrast",icon:"contrast",onclick:dI(dH)},{tooltip:"Color levels",icon:"drop",onclick:dI(dG)},{tooltip:"Gamma",icon:"gamma",onclick:dI(dE)},{tooltip:"Invert",icon:"invert",onclick:dI(c4)}]));dl=v.create({flex:1,imageSrc:du.url});dF=bn.create("Container",{layout:"flex",direction:"column",pack:"start",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:dw},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:dj},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:dA},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:dn}]});dk=bn.create("Container",{type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:dL([dF,dl])});df=[c7,dh,dz,dx,di,c4,da,dD,dy,dH,dg,c3,dG,dR,dP,dE,c2];dM=cX.windowManager.open({layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(bo.DOM.getViewPort().w,800),minHeight:Math.min(bo.DOM.getViewPort().h,650),title:"Edit image",items:df.concat([dk]),buttons:dL([{text:"Save",name:"save",subtype:"primary",onclick:dq},{text:"Cancel",onclick:"close"}])});dM.on("close",function(){dv();cJ(de.data);de=null;c6=null});de.add(du);c9();dl.on("load",function(){cW=dl.imageSize().w;c1=dl.imageSize().h;dB=c1/cW;dJ=cW/c1;dM.find("#w").value(cW);dM.find("#h").value(c1)});dl.on("crop",cZ)}function V(cX,cW){return new bq(function(cZ,cY){return cW.toBlob().then(function(c0){bB(cX,aa(c0),cZ,cY)})})}var al={edit:V};function o(cX){var cY,cW;function cZ(c0){return/^[0-9\.]+px$/.test(c0)}cY=cX.style.width;cW=cX.style.height;if(cY||cW){if(cZ(cY)&&cZ(cW)){return{w:parseInt(cY,10),h:parseInt(cW,10)}}return null}cY=cX.width;cW=cX.height;if(cY&&cW){return{w:parseInt(cY,10),h:parseInt(cW,10)}}return null}function cs(cX,cY){var cZ,cW;if(cY){cZ=cX.style.width;cW=cX.style.height;if(cZ||cW){cX.style.width=cY.w+"px";cX.style.height=cY.h+"px";cX.removeAttribute("data-mce-style")}cZ=cX.width;cW=cX.height;if(cZ||cW){cX.setAttribute("width",cY.w);cX.setAttribute("height",cY.h)}}}function F(cW){return{w:cW.naturalWidth,h:cW.naturalHeight}}var d={getImageSize:o,setImageSize:cs,getNaturalImageSize:F};var cQ=function(cW){if(cW===null){return"null"}var cX=typeof cW;if(cX==="object"&&Array.prototype.isPrototypeOf(cW)){return"array"}if(cX==="object"&&String.prototype.isPrototypeOf(cW)){return"string"}return cX};var cC=function(cW){return function(cX){return cQ(cX)===cW}};var H=cC("function");var bc=function(cZ,cY){for(var c0=0,cX=cZ.length;c0<cX;c0++){var cW=cZ[c0];if(cY(cW,c0,cZ)){return Q.some(cW)}}return Q.none()};var ap=Array.prototype.slice;var bR=H(Array.from)?Array.from:function(cW){return ap.call(cW)};function aB(){var cW=K.getOrDie("XMLHttpRequest");return new cW()}var aQ=function(cW){return cW!==null&&cW!==undefined};var aN=function(cW,cY){var cX;cX=cY.reduce(function(cZ,c0){return aQ(cZ)?cZ[c0]:undefined},cW);return aQ(cX)?cX:null};var a5=function(cX,cY,cW){return new bq(function(cZ){var c0;c0=new aB();c0.onreadystatechange=function(){if(c0.readyState===4){cZ({status:c0.status,blob:this.response})}};c0.open("GET",cX,true);c0.withCredentials=cW;bv.each(cY,function(c2,c1){c0.setRequestHeader(c1,c2)});c0.responseType="blob";c0.send()})};var cD=function(cW){return new bq(function(cY){var cX=new b3();cX.onload=function(c0){var cZ=c0.target;cY(cZ.result)};cX.readAsText(cW)})};var a3=function(cY){var cX;try{cX=JSON.parse(cY)}catch(cW){}return cX};var aD={traverse:aN,readBlob:cD,requestUrlAsBlob:a5,parseJson:a3};var bA=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}];var a8=[{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}];var ch=function(cW){return cW===400||cW===403||cW===500};var N=function(cW){var cX=bc(bA,function(cY){return cW===cY.code}).fold(ck("Unknown ImageProxy error"),function(cY){return cY.message});return"ImageProxy HTTP error: "+cX};var cm=function(cW){var cX=N(cW);return bq.reject(cX)};var aC=function(cW){return bc(a8,function(cX){return cX.type===cW}).fold(ck("Unknown service error"),function(cX){return cX.message})};var aq=function(cZ){var cW=aD.parseJson(cZ);var cY=aD.traverse(cW,["error","type"]);var cX=cY?aC(cY):"Invalid JSON in service error message";return"ImageProxy Service error: "+cX};var bJ=function(cW,cX){return aD.readBlob(cX).then(function(cZ){var cY=aq(cZ);return bq.reject(cY)})};var h=function(cW,cX){return ch(cW)?bJ(cW,cX):cm(cW)};var cr={handleServiceErrorResponse:h,handleHttpError:cm,getHttpErrorMsg:N,getServiceErrorMsg:aC};var av=function(cW,cY){var cX=cW.indexOf("?")===-1?"?":"&";if(/[?&]apiKey=/.test(cW)||!cY){return cW}else{return cW+cX+"apiKey="+encodeURIComponent(cY)}};var c=function(cW,cY){var cX={"Content-Type":"application/json;charset=UTF-8","tiny-api-key":cY};return aD.requestUrlAsBlob(av(cW,cY),cX,false).then(function(cZ){return cZ.status<200||cZ.status>=300?cr.handleServiceErrorResponse(cZ.status,cZ.blob):bq.resolve(cZ.blob)})};function bD(cX,cW){return aD.requestUrlAsBlob(cX,{},cW).then(function(cY){return cY.status<200||cY.status>=300?cr.handleHttpError(cY.status):bq.resolve(cY.blob)})}var aZ=function(cX,cY,cW){return cY?c(cX,cY):bD(cX,cW)};var af={getUrl:aZ};var x=0;var cz=function(cX,cW){var cY=cX.dom.is(cW,"img:not([data-mce-object],[data-mce-placeholder])");return cY&&(ci(cX,cW)||cG(cX,cW)||cX.settings.imagetools_proxy)};var M=function(cX,cW){cX.notificationManager.open({text:cW,type:"error"})};var aG=function(cW){return cW.selection.getNode()};var bW=function(cY,cX){var cW=cX.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);if(cW){return cY.dom.encode(cW[1])}return null};var a6=function(){return"imagetools"+x++};var ci=function(cY,cW){var cX=cW.src;return cX.indexOf("data:")===0||cX.indexOf("blob:")===0||new bp(cX).host===cY.documentBaseURI.host};var cG=function(cX,cW){return bv.inArray(cU(cX),new bp(cW.src).host)!==-1};var bV=function(cX,cW){return bv.inArray(a0(cX),new bp(cW.src).host)!==-1};var az=function(cX,cW){var cZ=cW.src,cY;if(cG(cX,cW)){return af.getUrl(cW.src,null,bV(cX,cW))}if(!ci(cX,cW)){cZ=ba(cX);cZ+=(cZ.indexOf("?")===-1?"?":"&")+"url="+encodeURIComponent(cW.src);cY=bz(cX);return af.getUrl(cZ,cY,false)}return cE.imageToBlob(cW)};var E=function(cX){var cW;cW=cX.editorUpload.blobCache.getByUri(aG(cX).src);if(cW){return bq.resolve(cW.blob())}return az(cX,aG(cX))};var aM=function(cW,cY){var cX=bt.setEditorTimeout(cW,function(){cW.editorUpload.uploadImagesAuto()},aJ(cW));cY.set(cX)};var au=function(cW){clearTimeout(cW.get())};var ca=function(cX,cZ,cY,c0,cW){return cZ.toBlob().then(function(c1){var c5,c2,c6,c3,c4;c6=cX.editorUpload.blobCache;c4=aG(cX);c5=c4.src;if(bM(cX)){c3=c6.getByUri(c5);if(c3){c5=c3.uri();c2=c3.name()}else{c2=bW(cX,c5)}}c3=c6.create({id:a6(),blob:c1,base64:cZ.toBase64(),uri:c5,name:c2});c6.add(c3);cX.undoManager.transact(function(){function c7(){cX.$(c4).off("load",c7);cX.nodeChanged();if(cY){cX.editorUpload.uploadImagesAuto()}else{au(c0);aM(cX,c0)}}cX.$(c4).on("load",c7);if(cW){cX.$(c4).attr({width:cW.w,height:cW.h})}cX.$(c4).attr({src:c3.blobUri()}).removeAttr("data-mce-src")});return c3})};var ah=function(cY,cZ,cX,cW){return function(){return cY._scanForImages().then(cA(E,cY)).then(a1.blobToImageResult).then(cX).then(function(c0){return ca(cY,c0,false,cZ,cW)},function(c0){M(cY,c0)})}};var i=function(cW,cY,cX){return function(){var cZ=d.getImageSize(aG(cW));var c0=cZ?{w:cZ.h,h:cZ.w}:null;return ah(cW,cY,function(c1){return aV.rotate(c1,cX)},c0)()}};var bi=function(cX,cY,cW){return function(){return ah(cX,cY,function(cZ){return aV.flip(cZ,cW)})()}};var a7=function(cW,cX){return function(){var c0=aG(cW),c1=d.getNaturalImageSize(c0);var cY=function(c2){return new bq(function(c3){cE.blobToImage(c2).then(function(c5){var c4=d.getNaturalImageSize(c5);if(c1.w!==c4.w||c1.h!==c4.h){if(d.getImageSize(c0)){d.setImageSize(c0,c4)}}am.revokeObjectURL(c5.src);c3(c2)})})};var cZ=function(c3,c2){return al.edit(c3,c2).then(cY).then(a1.blobToImageResult).then(function(c4){return ca(c3,c4,true,cX)},function(){})};E(cW).then(a1.blobToImageResult).then(cA(cZ,cW),function(c2){M(cW,c2)})}};var bf={rotate:i,flip:bi,editImageDialog:a7,isEditableImage:cz,cancelTimedUpload:au};var aR=function(cW,cX){bv.each({mceImageRotateLeft:bf.rotate(cW,cX,-90),mceImageRotateRight:bf.rotate(cW,cX,90),mceImageFlipVertical:bf.flip(cW,cX,"v"),mceImageFlipHorizontal:bf.flip(cW,cX,"h"),mceEditImage:bf.editImageDialog(cW,cX)},function(cY,cZ){cW.addCommand(cZ,cY)})};var b7={register:aR};var bN=function(cW,cY,cX){cW.on("NodeChange",function(c0){var cZ=cX.get();if(cZ&&cZ.src!==c0.element.src){bf.cancelTimedUpload(cY);cW.editorUpload.uploadImagesAuto();cX.set(null)}if(bf.isEditableImage(cW,c0.element)){cX.set(c0.element)}})};var b4={setup:bN};var bu=function(cW){cW.addButton("rotateleft",{title:"Rotate counterclockwise",cmd:"mceImageRotateLeft"});cW.addButton("rotateright",{title:"Rotate clockwise",cmd:"mceImageRotateRight"});cW.addButton("flipv",{title:"Flip vertically",cmd:"mceImageFlipVertical"});cW.addButton("fliph",{title:"Flip horizontally",cmd:"mceImageFlipHorizontal"});cW.addButton("editimage",{title:"Edit image",cmd:"mceEditImage"});cW.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})};var u={register:bu};var bs=function(cW){cW.addContextToolbar(cA(bf.isEditableImage,cW),ao(cW))};var D={register:bs};z.add("imagetools",function(cW){var cY=s(0);var cX=s(null);b7.register(cW,cY);u.register(cW);D.register(cW);b4.setup(cW,cY,cX)});function at(){}return at}())})();