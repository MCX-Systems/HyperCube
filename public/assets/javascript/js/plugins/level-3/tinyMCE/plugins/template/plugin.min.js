(function(){var a=(function(){var b=tinymce.util.Tools.resolve("tinymce.PluginManager");var m=function(P){var L=[];for(var O=1;O<arguments.length;O++){L[O-1]=arguments[O]}var M=new Array(arguments.length-1);for(var N=1;N<arguments.length;N++){M[N-1]=arguments[N]}return function(){var Q=[];for(var U=0;U<arguments.length;U++){Q[U]=arguments[U]}var R=new Array(arguments.length);for(var S=0;S<R.length;S++){R[S]=arguments[S]}var T=M.concat(R);return P.apply(null,T)}};var F=tinymce.util.Tools.resolve("tinymce.util.Tools");var E=tinymce.util.Tools.resolve("tinymce.util.XHR");var D=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils");var w=function(L){return L.getParam("template_cdate_classes","cdate")};var A=function(L){return L.getParam("template_mdate_classes","mdate")};var K=function(L){return L.getParam("template_selected_content_classes","selcontent")};var C=function(L){return L.getParam("template_preview_replace_values")};var c=function(L){return L.getParam("template_replace_values")};var f=function(L){return L.templates};var g=function(L){return L.getParam("template_cdate_format",L.getLang("template.cdate_format"))};var s=function(L){return L.getParam("template_mdate_format",L.getLang("template.mdate_format"))};var H=function(L){return L.getParam("template_popup_width",600)};var e=function(L){return Math.min(D.DOM.getViewPort().h,L.getParam("template_popup_height",500))};var u={getCreationDateClasses:w,getModificationDateClasses:A,getSelectedContentClasses:K,getPreviewReplaceValues:C,getTemplateReplaceValues:c,getTemplates:f,getCdateFormat:g,getMdateFormat:s,getDialogWidth:H,getDialogHeight:e};var x=function(N,L){N=""+N;if(N.length<L){for(var M=0;M<L-N.length;M++){N="0"+N}}return N};var G=function(Q,M,O){var L="Sun Mon Tue Wed Thu Fri Sat Sun".split(" ");var R="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" ");var P="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");var N="January February March April May June July August September October November December".split(" ");O=O||new Date();M=M.replace("%D","%m/%d/%Y");M=M.replace("%r","%I:%M:%S %p");M=M.replace("%Y",""+O.getFullYear());M=M.replace("%y",""+O.getYear());M=M.replace("%m",x(O.getMonth()+1,2));M=M.replace("%d",x(O.getDate(),2));M=M.replace("%H",""+x(O.getHours(),2));M=M.replace("%M",""+x(O.getMinutes(),2));M=M.replace("%S",""+x(O.getSeconds(),2));M=M.replace("%I",""+((O.getHours()+11)%12+1));M=M.replace("%p",""+(O.getHours()<12?"AM":"PM"));M=M.replace("%B",""+Q.translate(N[O.getMonth()]));M=M.replace("%b",""+Q.translate(P[O.getMonth()]));M=M.replace("%A",""+Q.translate(R[O.getDay()]));M=M.replace("%a",""+Q.translate(L[O.getDay()]));M=M.replace("%%","%");return M};var i={getDateTime:G};var J=function(L,M){return function(){var N=u.getTemplates(L);if(typeof N==="function"){N(M);return}if(typeof N==="string"){E.send({url:N,success:function(O){M(JSON.parse(O))}})}else{M(N)}}};var d=function(M,L,N){F.each(N,function(P,O){if(typeof P==="function"){P=P(O)}L=L.replace(new RegExp("\\{\\$"+O+"\\}","g"),P)});return L};var l=function(L,N){var O=L.dom,M=u.getTemplateReplaceValues(L);F.each(O.select("*",N),function(P){F.each(M,function(R,Q){if(O.hasClass(P,Q)){if(typeof M[Q]==="function"){M[Q](P)}}})})};var z=function(M,L){return new RegExp("\\b"+L+"\\b","g").test(M.className)};var r=function(N,P,L){var M;var R;var Q=N.dom;var O=N.selection.getContent();L=d(N,L,u.getTemplateReplaceValues(N));M=Q.create("div",null,L);R=Q.select(".mceTmpl",M);if(R&&R.length>0){M=Q.create("div",null);M.appendChild(R[0].cloneNode(true))}F.each(Q.select("*",M),function(S){if(z(S,u.getCreationDateClasses(N).replace(/\s+/g,"|"))){S.innerHTML=i.getDateTime(N,u.getCdateFormat(N))}if(z(S,u.getModificationDateClasses(N).replace(/\s+/g,"|"))){S.innerHTML=i.getDateTime(N,u.getMdateFormat(N))}if(z(S,u.getSelectedContentClasses(N).replace(/\s+/g,"|"))){S.innerHTML=O}});l(N,M);N.execCommand("mceInsertContent",false,M.innerHTML);N.addVisual()};var B={createTemplateList:J,replaceTemplateValues:d,replaceVals:l,insertTemplate:r};var k=function(L){L.addCommand("mceInsertTemplate",m(B.insertTemplate,L))};var I={register:k};var j=function(L){L.on("PreProcess",function(O){var N=L.dom,M=u.getMdateFormat(L);F.each(N.select("div",O.node),function(P){if(N.hasClass(P,"mceTmpl")){F.each(N.select("*",P),function(Q){if(N.hasClass(Q,L.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))){Q.innerHTML=i.getDateTime(L,M)}});B.replaceVals(L,P)}})})};var h={setup:j};var y=function(O,Q,N){if(N.indexOf("<html>")===-1){var M="";F.each(O.contentCSS,function(R){M+='<link type="text/css" rel="stylesheet" href="'+O.documentBaseURI.toAbsolute(R)+'">'});var L=O.settings.body_class||"";if(L.indexOf("=")!==-1){L=O.getParam("body_class","","hash");L=L[O.id]||""}N="<!DOCTYPE html><html><head>"+M+'</head><body class="'+L+'">'+N+"</body></html>"}N=B.replaceTemplateValues(O,N,u.getPreviewReplaceValues(O));var P=Q.find("iframe")[0].getEl().contentWindow.document;P.open();P.write(N);P.close()};var q=function(P,O){var R;var N=[];var M;if(!O||O.length===0){var Q=P.translate("No templates defined.");P.notificationManager.open({text:Q,type:"info"});return}F.each(O,function(S){N.push({selected:!N.length,text:S.title,value:{url:S.url,content:S.content,description:S.description}})});var L=function(T){var S=T.control.value();if(S.url){E.send({url:S.url,success:function(U){M=U;y(P,R,M)}})}else{M=S.content;y(P,R,M)}R.find("#description")[0].text(T.control.value().description)};R=P.windowManager.open({title:"Insert template",layout:"flex",direction:"column",align:"stretch",padding:15,spacing:10,items:[{type:"form",flex:0,padding:0,items:[{type:"container",label:"Templates",items:{type:"listbox",label:"Templates",name:"template",values:N,onselect:L}}]},{type:"label",name:"description",label:"Description",text:"\xA0"},{type:"iframe",flex:1,border:1}],onsubmit:function(){B.insertTemplate(P,false,M)},minWidth:u.getDialogWidth(P),minHeight:u.getDialogHeight(P)});R.find("listbox")[0].fire("select")};var n={open:q};var t=function(L){return function(M){n.open(L,M)}};var v=function(L){L.addButton("template",{title:"Insert template",onclick:B.createTemplateList(L.settings,t(L))});L.addMenuItem("template",{text:"Template",onclick:B.createTemplateList(L.settings,t(L)),icon:"template",context:"insert"})};var p={register:v};b.add("template",function(L){p.register(L);I.register(L);h.setup(L)});function o(){}return o}())})();