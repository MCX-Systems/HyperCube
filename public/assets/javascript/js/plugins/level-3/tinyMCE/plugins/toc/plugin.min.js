(function(){var a=(function(){var x=tinymce.util.Tools.resolve("tinymce.PluginManager");var p=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils");var m=tinymce.util.Tools.resolve("tinymce.util.I18n");var l=tinymce.util.Tools.resolve("tinymce.util.Tools");var t=function(G){return G.getParam("toc_class","mce-toc")};var y=function(H){var G=H.getParam("toc_header","h2");return/^h[1-6]$/.test(G)?G:"h2"};var b=function(G){var H=parseInt(G.getParam("toc_depth","3"),10);return H>=1&&H<=9?H:3};var e={getTocClass:t,getTocHeader:y,getTocDepth:b};var o=function(H){var G=0;return function(){var I=new Date().getTime().toString(32);return H+I+(G++).toString(32)}};var E={create:o};var s=E.create("mcetoc_");var r=function r(I){var H;var G=[];for(H=1;H<=I;H++){G.push("h"+H)}return G.join(",")};var i=function(G){return k(G).length>0};var k=function(H){var K=e.getTocClass(H);var I=e.getTocHeader(H);var G=r(e.getTocDepth(H));var J=H.$(G);if(J.length&&/^h[1-9]$/i.test(I)){J=J.filter(function(L,M){return !H.dom.hasClass(M.parentNode,K)})}return l.map(J,function(L){return{id:L.id?L.id:s(),level:parseInt(L.nodeName.replace(/^H/i,""),10),title:H.$.text(L),element:L}})};var D=function(H){var G,I=9;for(G=0;G<H.length;G++){if(H[G].level<I){I=H[G].level}if(I===1){return I}}return I};var F=function(G,J){var I="<"+G+' contenteditable="true">';var H="</"+G+">";return I+p.DOM.encode(J)+H};var B=function(H){var G=q(H);return'<div class="'+H.dom.encode(e.getTocClass(H))+'" contenteditable="false">'+G+"</div>"};var q=function(L){var I="";var N=k(L);var G=D(N)-1;var H,K,J,M;if(!N.length){return""}I+=F(e.getTocHeader(L),m.translate("Table of Contents"));for(H=0;H<N.length;H++){J=N[H];J.element.id=J.id;M=N[H+1]&&N[H+1].level;if(G===J.level){I+="<li>"}else{for(K=G;K<J.level;K++){I+="<ul><li>"}}I+='<a href="#'+J.id+'">'+J.title+"</a>";if(M===J.level||!M){I+="</li>";if(!M){I+="</ul>"}}else{for(K=J.level;K>M;K--){I+="</li></ul><li>"}}G=J.level}return I};var A=function(H,G){return !G.length||H.dom.getParents(G[0],".mce-offscreen-selection").length>0};var v=function(H){var I=e.getTocClass(H);var G=H.$("."+I);if(A(H,G)){H.insertContent(B(H))}else{z(H)}};var z=function(H){var I=e.getTocClass(H);var G=H.$("."+I);if(G.length){H.undoManager.transact(function(){G.html(q(H))})}};var h={hasHeaders:i,insertToc:v,updateToc:z};var d=function(G){G.addCommand("mceInsertToc",function(){h.insertToc(G)});G.addCommand("mceUpdateToc",function(){h.updateToc(G)})};var w={register:d};var u=function(G){var H=G.$,I=e.getTocClass(G);G.on("PreProcess",function(K){var J=H("."+I,K.node);if(J.length){J.removeAttr("contentEditable");J.find("[contenteditable]").removeAttr("contentEditable")}});G.on("SetContent",function(){var J=H("."+I);if(J.length){J.attr("contentEditable",false);J.children(":first-child").attr("contentEditable",true)}})};var j={setup:u};var n=function(G){return function(I){var H=I.control;G.on("LoadContent SetContent change",function(){H.disabled(G.readonly||!h.hasHeaders(G))})}};var c=function(G){return function(H){return H&&G.dom.is(H,"."+e.getTocClass(G))&&G.getBody().contains(H)}};var C=function(G){G.addButton("toc",{tooltip:"Table of Contents",cmd:"mceInsertToc",icon:"toc",onPostRender:n(G)});G.addButton("tocupdate",{tooltip:"Update",cmd:"mceUpdateToc",icon:"reload"});G.addMenuItem("toc",{text:"Table of Contents",context:"insert",cmd:"mceInsertToc",onPostRender:n(G)});G.addContextToolbar(c(G),"tocupdate")};var g={register:C};x.add("toc",function(G){w.register(G);g.register(G);j.setup(G)});function f(){}return f}())})();