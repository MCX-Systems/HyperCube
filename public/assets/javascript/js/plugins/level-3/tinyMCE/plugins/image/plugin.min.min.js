!function(){var aL=tinymce.util.Tools.resolve("tinymce.PluginManager"),aM=function(a){return !1!==a.settings.image_dimensions},aG=function(a){return !0===a.settings.image_advtab},aJ=function(a){return a.getParam("image_prepend_url","")},az=function(a){return a.getParam("image_class_list")},au=function(a){return !1!==a.settings.image_description},aR=function(a){return !0===a.settings.image_title},ay=function(a){return !0===a.settings.image_caption},aD=function(a){return a.getParam("image_list",!1)},aq=function(a){return a.getParam("images_upload_url",!1)},aN=function(a){return a.getParam("images_upload_handler",!1)},at=function(a){return a.getParam("images_upload_url")},aA=function(a){return a.getParam("images_upload_handler")},aK=function(a){return a.getParam("images_upload_base_path")},ax=function(a){return a.getParam("images_upload_credentials")},aH="undefined"!=typeof window?window:Function("return this;")(),ap=function(b,a){return function(f,c){for(var g=c!==undefined&&null!==c?c:aH,d=0;d<f.length&&g!==undefined&&null!==g;++d){g=g[f[d]]}return g}(b.split("."),a)},ar={getOrDie:function(b,a){var c=ap(b,a);if(c===undefined||null===c){throw b+" not available on this browser"}return c}};function aQ(){return new (ar.getOrDie("FileReader"))}var am,an=tinymce.util.Tools.resolve("tinymce.util.Promise"),ao=tinymce.util.Tools.resolve("tinymce.util.Tools"),bo=tinymce.util.Tools.resolve("tinymce.util.XHR"),a1=function(b,a){return Math.max(parseInt(b,10),parseInt(a,10))},a7=function(f,g){var d=document.createElement("img");function c(h,a){d.parentNode&&d.parentNode.removeChild(d),g({width:h,height:a})}d.onload=function(){c(a1(d.width,d.clientWidth),a1(d.height,d.clientHeight))},d.onerror=function(){c(0,0)};var b=d.style;b.visibility="hidden",b.position="fixed",b.bottom=b.left="0px",b.width=b.height="auto",document.body.appendChild(d),d.src=f},aS=function(d,b,c){return function f(g,a){return a=a||[],ao.each(g,function(i){var h={text:i.text||i.title};i.menu?h.menu=f(i.menu):(h.value=i.value,b(h)),a.push(h)}),a}(d,c||[])},bq=function(a){return a&&(a=a.replace(/px$/,"")),a},aZ=function(a){return 0<a.length&&/^[0-9]+$/.test(a)&&(a+="px"),a},a2=function(b){if(b.margin){var a=b.margin.split(" ");switch(a.length){case 1:b["margin-top"]=b["margin-top"]||a[0],b["margin-right"]=b["margin-right"]||a[0],b["margin-bottom"]=b["margin-bottom"]||a[0],b["margin-left"]=b["margin-left"]||a[0];break;case 2:b["margin-top"]=b["margin-top"]||a[0],b["margin-right"]=b["margin-right"]||a[1],b["margin-bottom"]=b["margin-bottom"]||a[0],b["margin-left"]=b["margin-left"]||a[1];break;case 3:b["margin-top"]=b["margin-top"]||a[0],b["margin-right"]=b["margin-right"]||a[1],b["margin-bottom"]=b["margin-bottom"]||a[2],b["margin-left"]=b["margin-left"]||a[1];break;case 4:b["margin-top"]=b["margin-top"]||a[0],b["margin-right"]=b["margin-right"]||a[1],b["margin-bottom"]=b["margin-bottom"]||a[2],b["margin-left"]=b["margin-left"]||a[3]}delete b.margin}return b},bd=function(b,a){var c=aD(b);"string"==typeof c?bo.send({url:c,success:function(d){a(JSON.parse(d))}}):"function"==typeof c?c(a):a(c)},a5=function(c,a,d){function b(){d.onload=d.onerror=null,c.selection&&(c.selection.select(d),c.nodeChanged())}d.onload=function(){a.width||a.height||!aM(c)||c.dom.setAttribs(d,{width:d.clientWidth,height:d.clientHeight}),b()},d.onerror=b},ba=function(a){return new an(function(c,b){var d=new aQ;d.onload=function(){c(d.result)},d.onerror=function(){b(aQ.error.message)},d.readAsDataURL(a)})},a4=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),aY=Object.prototype.hasOwnProperty,bk=(am=function(b,a){return a},function(){for(var f=new Array(arguments.length),c=0;c<f.length;c++){f[c]=arguments[c]}if(0===f.length){throw new Error("Can't merge zero objects")}for(var h={},d=0;d<f.length;d++){var b=f[d];for(var g in b){aY.call(b,g)&&(h[g]=am(h[g],b[g]))}}return h}),aE=a4.DOM,a9=function(a){return a.style.marginLeft&&a.style.marginRight&&a.style.marginLeft===a.style.marginRight?bq(a.style.marginLeft):""},bl=function(a){return a.style.marginTop&&a.style.marginBottom&&a.style.marginTop===a.style.marginBottom?bq(a.style.marginTop):""},al=function(a){return a.style.borderWidth?bq(a.style.borderWidth):""},bp=function(b,a){return b.hasAttribute(a)?b.getAttribute(a):""},bh=function(b,a){return b.style[a]?b.style[a]:""},aF=function(a){return null!==a.parentNode&&"FIGURE"===a.parentNode.nodeName},bj=function(b,a,c){b.setAttribute(a,c)},aW=function(f){var c,g,d,b;aF(f)?(b=(d=f).parentNode,aE.insertAfter(d,b),aE.remove(b)):(c=f,g=aE.create("figure",{"class":"image"}),aE.insertAfter(g,c),g.appendChild(c),g.appendChild(aE.create("figcaption",{contentEditable:!0},"Caption")),g.contentEditable="false")},bc=function(c,a){var d=c.getAttribute("style"),b=a(null!==d?d:"");0<b.length?(c.setAttribute("style",b),c.setAttribute("data-mce-style",b)):c.removeAttribute("style")},aX=function(b,a){return function(d,c,f){d.style[c]?(d.style[c]=aZ(f),bc(d,a)):bj(d,c,f)}},bi=function(b,a){return b.style[a]?bq(b.style[a]):bp(b,a)},by=function(b,a){var c=aZ(a);b.style.marginLeft=c,b.style.marginRight=c},aV=function(b,a){var c=aZ(a);b.style.marginTop=c,b.style.marginBottom=c},aw=function(b,a){var c=aZ(a);b.style.borderWidth=c},bb=function(b,a){b.style.borderStyle=a},a3=function(a){return"FIGURE"===a.nodeName},aU=function(b,a){var c=document.createElement("img");return bj(c,"style",a.style),(a9(c)||""!==a.hspace)&&by(c,a.hspace),(bl(c)||""!==a.vspace)&&aV(c,a.vspace),(al(c)||""!==a.border)&&aw(c,a.border),(bh(c,"borderStyle")||""!==a.borderStyle)&&bb(c,a.borderStyle),b(c.getAttribute("style"))},aT=function(b,a){return{src:bp(a,"src"),alt:bp(a,"alt"),title:bp(a,"title"),width:bi(a,"width"),height:bi(a,"height"),"class":bp(a,"class"),style:b(bp(a,"style")),caption:aF(a),hspace:a9(a),vspace:bl(a),border:al(a),borderStyle:bh(a,"borderStyle")}},ab=function(f,c,g,d,b){g[d]!==c[d]&&b(f,d,g[d])},bm=function(c,b){return function(d,a,f){c(d,f),bc(d,b)}},bf=function(c,a,d){var b=aT(c,d);ab(d,b,a,"caption",function(g,f,h){return aW(g)}),ab(d,b,a,"src",bj),ab(d,b,a,"alt",bj),ab(d,b,a,"title",bj),ab(d,b,a,"width",aX(0,c)),ab(d,b,a,"height",aX(0,c)),ab(d,b,a,"class",bj),ab(d,b,a,"style",bm(function(g,f){return bj(g,"style",f)},c)),ab(d,b,a,"hspace",bm(by,c)),ab(d,b,a,"vspace",bm(aV,c)),ab(d,b,a,"border",bm(aw,c)),ab(d,b,a,"borderStyle",bm(bb,c))},bE=function(f,c){var g=f.dom.styles.parse(c),d=a2(g),b=f.dom.styles.parse(f.dom.styles.serialize(d));return f.dom.styles.serialize(b)},bt=function(b){var a=b.selection.getNode(),c=b.dom.getParent(a,"figure.image");return c?b.dom.select("img",c)[0]:a&&("IMG"!==a.nodeName||a.getAttribute("data-mce-object")||a.getAttribute("data-mce-placeholder"))?null:a},aI=function(a,c){var d=a.dom,b=d.getParent(c.parentNode,function(f){return a.schema.getTextBlockElements()[f.nodeName]});return b?d.split(b,c):c},aB=function(a){var b=bt(a);return b?aT(function(c){return bE(a,c)},b):{src:"",alt:"",title:"",width:"",height:"","class":"",style:"",caption:!1,hspace:"",vspace:"",border:"",borderStyle:""}},bD=function(c,f){var g=function(i,a){var j=document.createElement("img");if(bf(i,bk(a,{caption:!1}),j),bj(j,"alt",a.alt),a.caption){var h=aE.create("figure",{"class":"image"});return h.appendChild(j),h.appendChild(aE.create("figcaption",{contentEditable:!0},"Caption")),h.contentEditable="false",h}return j}(function(a){return bE(c,a)},f);c.dom.setAttrib(g,"data-mce-id","__mcenew"),c.focus(),c.selection.setContent(g.outerHTML);var d=c.dom.select('*[data-mce-id="__mcenew"]')[0];if(c.dom.setAttrib(d,"data-mce-id",null),a3(d)){var b=aI(c,d);c.selection.select(b)}else{c.selection.select(d)}},aO=function(b,a){var c=bt(b);c?a.src?function(f,h){var i,g=bt(f);if(bf(function(j){return bE(f,j)},h,g),i=g,f.dom.setAttrib(i,"src",i.getAttribute("src")),a3(g.parentNode)){var d=g.parentNode;aI(f,d),f.selection.select(g.parentNode)}else{f.selection.select(g),a5(f,h,g)}}(b,a):function(f,d){if(d){var g=f.dom.is(d.parentNode,"figure.image")?d.parentNode:d;f.dom.remove(g),f.focus(),f.nodeChanged(),f.dom.isEmpty(f.getBody())&&(f.setContent(""),f.selection.setCursorLocation())}}(b,c):a.src&&bD(b,a)},av=function(b,a){a.find("#style").each(function(d){var c=aU(function(f){return bE(b,f)},bk({src:"",alt:"",title:"",width:"",height:"","class":"",style:"",caption:!1,hspace:"",vspace:"",border:"",borderStyle:""},a.toJSON()));d.value(c)})},bw=function(a){return{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox",onchange:(b=a,function(g){var d=b.dom,h=g.control.rootControl;if(aG(b)){var f=h.toJSON(),c=d.parseStyle(f.style);h.find("#vspace").value(""),h.find("#hspace").value(""),((c=a2(c))["margin-top"]&&c["margin-bottom"]||c["margin-right"]&&c["margin-left"])&&(c["margin-top"]===c["margin-bottom"]?h.find("#vspace").value(bq(c["margin-top"])):h.find("#vspace").value(""),c["margin-right"]===c["margin-left"]?h.find("#hspace").value(bq(c["margin-right"])):h.find("#hspace").value("")),c["border-width"]?h.find("#border").value(bq(c["border-width"])):h.find("#border").value(""),c["border-style"]?h.find("#borderStyle").value(c["border-style"]):h.find("#borderStyle").value(""),h.find("#style").value(d.serializeStyle(d.parseStyle(d.serializeStyle(c))))}})},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,defaults:{type:"textbox",maxWidth:50,onchange:function(c){av(a,c.control.rootControl)}},items:[{label:"Vertical space",name:"vspace"},{label:"Border width",name:"border"},{label:"Horizontal space",name:"hspace"},{label:"Border style",type:"listbox",name:"borderStyle",width:90,maxWidth:90,onselect:function(c){av(a,c.control.rootControl)},values:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]}]}]};var b},ah=function(b,a){b.state.set("oldVal",b.value()),a.state.set("oldVal",a.value())},bu=function(f,c){var g=f.find("#width")[0],d=f.find("#height")[0],b=f.find("#constrain")[0];g&&d&&b&&c(g,d,b.checked())},bv=function(g,d,j){var f=g.state.get("oldVal"),b=d.state.get("oldVal"),h=g.value(),c=d.value();j&&f&&b&&h&&c&&(h!==f?(c=Math.round(h/f*c),isNaN(c)||d.value(c)):(h=Math.round(c/b*h),isNaN(h)||g.value(h))),ah(g,d)},bB=function(a){bu(a,bv)},aj=function(){var a=function(b){bB(b.control.rootControl)};return{type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:5,onchange:a,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:5,onchange:a,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}},a6=function(a){bu(a,ah)},ak=bB,a0=function(a){a.meta=a.control.rootControl.toJSON()},bz=function(b,c){var a=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:function(k){var s,g,d,p,f,j,h,q,m;g=b,j=(s=k).meta||{},h=s.control,q=h.rootControl,(m=q.find("#image-list")[0])&&m.value(g.convertURL(h.value(),"src")),ao.each(j,function(l,i){q.find("#"+i).value(l)}),j.width||j.height||(d=g.convertURL(h.value(),"src"),p=aJ(g),f=new RegExp("^(?:[a-z]+:)?//","i"),p&&!f.test(d)&&d.substring(0,p.length)!==p&&(d=p+d),h.value(d),a7(g.documentBaseURI.toAbsolute(h.value()),function(i){i.width&&i.height&&aM(g)&&(q.find("#width").value(i.width),q.find("#height").value(i.height),a6(q))}))},onbeforecall:a0},c];return au(b)&&a.push({name:"alt",type:"textbox",label:"Image description"}),aR(b)&&a.push({name:"title",type:"textbox",label:"Image Title"}),aM(b)&&a.push(aj()),az(b)&&a.push({name:"class",type:"listbox",label:"Class",values:aS(az(b),function(d){d.value&&(d.textStyle=function(){return b.formatter.getCssText({inline:"img",classes:[d.value]})})})}),ay(b)&&a.push({name:"caption",type:"checkbox",label:"Caption"}),a},bG=function(b,a){return{title:"General",type:"form",items:bz(b,a)}},af=bz,a8=function(){return ar.getOrDie("URL")},bH=function(a){return a8().createObjectURL(a)},bx=function(a){a8().revokeObjectURL(a)},aa=tinymce.util.Tools.resolve("tinymce.ui.Factory");function bC(){return new (ar.getOrDie("XMLHttpRequest"))}var bA=function(){};function ag(b){var a=function(g,f,c,d){var h,i;(h=new bC).open("POST",b.url),h.withCredentials=b.credentials,h.upload.onprogress=function(j){d(j.loaded/j.total*100)},h.onerror=function(){c("Image upload failed due to a XHR Transport error. Code: "+h.status)},h.onload=function(){var k,j,l;h.status<200||300<=h.status?c("HTTP Error: "+h.status):(k=JSON.parse(h.responseText))&&"string"==typeof k.location?f((j=b.basePath,l=k.location,j?j.replace(/\/$/,"")+"/"+l.replace(/^\//,""):l)):c("Invalid JSON: "+h.responseText)},(i=new FormData).append("file",g.blob(),g.filename()),h.send(i)};return b=ao.extend({credentials:!1,handler:a},b),{upload:function(f){return b.url||b.handler!==a?(d=f,c=b.handler,new an(function(h,g){try{c(d,h,g,bA)}catch(i){g(i.message)}})):an.reject("Upload url missing from the settings.");var d,c}}}var bg=function(a){return function(h){var f=aa.get("Throbber"),k=h.control.rootControl,g=new f(k.getEl()),c=h.control.value(),j=bH(c),d=ag({url:at(a),basePath:aK(a),credentials:ax(a),handler:aA(a)}),b=function(){g.hide(),bx(j)};return g.show(),ba(c).then(function(l){var i=a.editorUpload.blobCache.create({blob:c,blobUri:j,name:c.name?c.name.replace(/\.[^\.]+$/,""):null,base64:l.split(",")[1]});return d.upload(i).then(function(n){var m=k.find("#src");return m.value(n),k.find("tabpanel")[0].activateTab(0),m.fire("change"),b(),n})})["catch"](function(i){a.windowManager.alert(i),b()})}},bn=".jpg,.jpeg,.png,.gif",ad=function(a){return{title:"Upload",type:"form",layout:"flex",direction:"column",align:"stretch",padding:"20 20 20 20",items:[{type:"container",layout:"flex",direction:"column",align:"center",spacing:10,items:[{text:"Browse for an image",type:"browsebutton",accept:bn,onchange:bg(a)},{text:"OR",type:"label"}]},{text:"Drop an image here",type:"dropzone",accept:bn,height:100,onchange:bg(a)}]}},aP=function(d){for(var c=[],b=1;b<arguments.length;b++){c[b-1]=arguments[b]}for(var a=new Array(arguments.length-1),f=1;f<arguments.length;f++){a[f-1]=arguments[f]}return function(){for(var j=[],h=0;h<arguments.length;h++){j[h]=arguments[h]}for(var k=new Array(arguments.length),i=0;i<k.length;i++){k[i]=arguments[i]}var g=a.concat(k);return d.apply(null,g)}},bs=function(a,b){var c=b.control.getRoot();ak(c),a.undoManager.transact(function(){var d=bk(aB(a),c.toJSON());aO(a,d)}),a.editorUpload.uploadImagesAuto()};function ai(b){function a(g){var h,d,f=aB(b);if(g&&(d={type:"listbox",label:"Image list",name:"image-list",values:aS(g,function(i){i.value=b.convertURL(i.value||i.url,"src")},[{text:"None",value:""}]),value:f.src&&b.convertURL(f.src,"src"),onselect:function(j){var i=h.find("#alt");(!i.value()||j.lastControl&&i.value()===j.lastControl.text())&&i.value(j.control.text()),h.find("#src").value(j.control.value()).fire("change")},onPostRender:function(){d=this}}),aG(b)||aq(b)||aN(b)){var c=[bG(b,d)];aG(b)&&c.push(bw(b)),(aq(b)||aN(b))&&c.push(ad(b)),h=b.windowManager.open({title:"Insert/edit image",data:f,bodyType:"tabpanel",body:c,onSubmit:aP(bs,b)})}else{h=b.windowManager.open({title:"Insert/edit image",data:f,body:af(b,d),onSubmit:aP(bs,b)})}a6(h)}return{open:function(){bd(b,a)}}}var ac=function(a){a.addCommand("mceImage",ai(a).open)},bF=function(a){return function(f){for(var c,g,d=f.length,b=function(h){h.attr("contenteditable",a?"true":null)};d--;){c=f[d],(g=c.attr("class"))&&/\bimage\b/.test(g)&&(c.attr("contenteditable",a?"false":null),ao.each(c.getAll("figcaption"),b))}}},aC=function(a){a.on("preInit",function(){a.parser.addNodeFilter("figure",bF(!0)),a.serializer.addNodeFilter("figure",bF(!1))})},br=function(a){a.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:ai(a).open,stateSelector:"img:not([data-mce-object],[data-mce-placeholder]),figure.image"}),a.addMenuItem("image",{icon:"image",text:"Image",onclick:ai(a).open,context:"insert",prependToContext:!0})};aL.add("image",function(a){aC(a),br(a),ac(a)})}();