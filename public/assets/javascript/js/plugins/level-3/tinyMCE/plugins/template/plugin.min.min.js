(function(){var b=(function(){var au=tinymce.util.Tools.resolve("tinymce.PluginManager");var ai=function(d){var c=[];for(var e=1;e<arguments.length;e++){c[e-1]=arguments[e]}var g=new Array(arguments.length-1);for(var f=1;f<arguments.length;f++){g[f-1]=arguments[f]}return function(){var l=[];for(var h=0;h<arguments.length;h++){l[h]=arguments[h]}var k=new Array(arguments.length);for(var j=0;j<k.length;j++){k[j]=arguments[j]}var i=g.concat(k);return d.apply(null,i)}};var P=tinymce.util.Tools.resolve("tinymce.util.Tools");var Q=tinymce.util.Tools.resolve("tinymce.util.XHR");var R=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils");var Y=function(c){return c.getParam("template_cdate_classes","cdate")};var U=function(c){return c.getParam("template_mdate_classes","mdate")};var a=function(c){return c.getParam("template_selected_content_classes","selcontent")};var S=function(c){return c.getParam("template_preview_replace_values")};var at=function(c){return c.getParam("template_replace_values")};var ap=function(c){return c.templates};var ao=function(c){return c.getParam("template_cdate_format",c.getLang("template.cdate_format"))};var ac=function(c){return c.getParam("template_mdate_format",c.getLang("template.mdate_format"))};var N=function(c){return c.getParam("template_popup_width",600)};var aq=function(c){return Math.min(R.DOM.getViewPort().h,c.getParam("template_popup_height",500))};var aa={getCreationDateClasses:Y,getModificationDateClasses:U,getSelectedContentClasses:a,getPreviewReplaceValues:S,getTemplateReplaceValues:at,getTemplates:ap,getCdateFormat:ao,getMdateFormat:ac,getDialogWidth:N,getDialogHeight:aq};var X=function(d,c){d=""+d;if(d.length<c){for(var e=0;e<c-d.length;e++){d="0"+d}}return d};var O=function(e,i,g){var c="Sun Mon Tue Wed Thu Fri Sat Sun".split(" ");var d="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" ");var f="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");var h="January February March April May June July August September October November December".split(" ");g=g||new Date();i=i.replace("%D","%m/%d/%Y");i=i.replace("%r","%I:%M:%S %p");i=i.replace("%Y",""+g.getFullYear());i=i.replace("%y",""+g.getYear());i=i.replace("%m",X(g.getMonth()+1,2));i=i.replace("%d",X(g.getDate(),2));i=i.replace("%H",""+X(g.getHours(),2));i=i.replace("%M",""+X(g.getMinutes(),2));i=i.replace("%S",""+X(g.getSeconds(),2));i=i.replace("%I",""+((g.getHours()+11)%12+1));i=i.replace("%p",""+(g.getHours()<12?"AM":"PM"));i=i.replace("%B",""+e.translate(h[g.getMonth()]));i=i.replace("%b",""+e.translate(f[g.getMonth()]));i=i.replace("%A",""+e.translate(d[g.getDay()]));i=i.replace("%a",""+e.translate(c[g.getDay()]));i=i.replace("%%","%");return i};var am={getDateTime:O};var L=function(c,d){return function(){var e=aa.getTemplates(c);if(typeof e==="function"){e(d);return}if(typeof e==="string"){Q.send({url:e,success:function(f){d(JSON.parse(f))}})}else{d(e)}}};var ar=function(e,c,d){P.each(d,function(f,g){if(typeof f==="function"){f=f(g)}c=c.replace(new RegExp("\\{\\$"+g+"\\}","g"),f)});return c};var aj=function(c,e){var d=c.dom,f=aa.getTemplateReplaceValues(c);P.each(d.select("*",e),function(g){P.each(f,function(h,i){if(d.hasClass(g,i)){if(typeof f[i]==="function"){f[i](g)}}})})};var V=function(d,c){return new RegExp("\\b"+c+"\\b","g").test(d.className)};var ad=function(h,f,c){var i;var d;var e=h.dom;var g=h.selection.getContent();c=ar(h,c,aa.getTemplateReplaceValues(h));i=e.create("div",null,c);d=e.select(".mceTmpl",i);if(d&&d.length>0){i=e.create("div",null);i.appendChild(d[0].cloneNode(true))}P.each(e.select("*",i),function(j){if(V(j,aa.getCreationDateClasses(h).replace(/\s+/g,"|"))){j.innerHTML=am.getDateTime(h,aa.getCdateFormat(h))}if(V(j,aa.getModificationDateClasses(h).replace(/\s+/g,"|"))){j.innerHTML=am.getDateTime(h,aa.getMdateFormat(h))}if(V(j,aa.getSelectedContentClasses(h).replace(/\s+/g,"|"))){j.innerHTML=g}});aj(h,i);h.execCommand("mceInsertContent",false,i.innerHTML);h.addVisual()};var T={createTemplateList:L,replaceTemplateValues:ar,replaceVals:aj,insertTemplate:ad};var ak=function(c){c.addCommand("mceInsertTemplate",ai(T.insertTemplate,c))};var M={register:ak};var al=function(c){c.on("PreProcess",function(d){var e=c.dom,f=aa.getMdateFormat(c);P.each(e.select("div",d.node),function(g){if(e.hasClass(g,"mceTmpl")){P.each(e.select("*",g),function(h){if(e.hasClass(h,c.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))){h.innerHTML=am.getDateTime(c,f)}});T.replaceVals(c,g)}})})};var an={setup:al};var W=function(f,d,g){if(g.indexOf("<html>")===-1){var h="";P.each(f.contentCSS,function(i){h+='<link type="text/css" rel="stylesheet" href="'+f.documentBaseURI.toAbsolute(i)+'">'});var c=f.settings.body_class||"";if(c.indexOf("=")!==-1){c=f.getParam("body_class","","hash");c=c[f.id]||""}g="<!DOCTYPE html><html><head>"+h+'</head><body class="'+c+'">'+g+"</body></html>"}g=T.replaceTemplateValues(f,g,aa.getPreviewReplaceValues(f));var e=d.find("iframe")[0].getEl().contentWindow.document;e.open();e.write(g);e.close()};var ae=function(f,g){var d;var h=[];var i;if(!g||g.length===0){var e=f.translate("No templates defined.");f.notificationManager.open({text:e,type:"info"});return}P.each(g,function(j){h.push({selected:!h.length,text:j.title,value:{url:j.url,content:j.content,description:j.description}})});var c=function(j){var k=j.control.value();if(k.url){Q.send({url:k.url,success:function(l){i=l;W(f,d,i)}})}else{i=k.content;W(f,d,i)}d.find("#description")[0].text(j.control.value().description)};d=f.windowManager.open({title:"Insert template",layout:"flex",direction:"column",align:"stretch",padding:15,spacing:10,items:[{type:"form",flex:0,padding:0,items:[{type:"container",label:"Templates",items:{type:"listbox",label:"Templates",name:"template",values:h,onselect:c}}]},{type:"label",name:"description",label:"Description",text:"\xA0"},{type:"iframe",flex:1,border:1}],onsubmit:function(){T.insertTemplate(f,false,i)},minWidth:aa.getDialogWidth(f),minHeight:aa.getDialogHeight(f)});d.find("listbox")[0].fire("select")};var ah={open:ae};var ab=function(c){return function(d){ah.open(c,d)}};var Z=function(c){c.addButton("template",{title:"Insert template",onclick:T.createTemplateList(c.settings,ab(c))});c.addMenuItem("template",{text:"Template",onclick:T.createTemplateList(c.settings,ab(c)),icon:"template",context:"insert"})};var af={register:Z};au.add("template",function(c){af.register(c);M.register(c);an.setup(c)});function ag(){}return ag}())})();