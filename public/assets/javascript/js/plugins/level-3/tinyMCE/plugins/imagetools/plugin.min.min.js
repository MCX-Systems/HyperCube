!function(){var aJ=function(a){var b=a,c=function(){return b};return{get:c,set:function(d){b=d},clone:function(){return aJ(c())}}},aG=tinymce.util.Tools.resolve("tinymce.PluginManager"),b0=tinymce.util.Tools.resolve("tinymce.util.Tools");function aP(a,b){return aW(document.createElement("canvas"),a,b)}function aO(a){return a.getContext("2d")}function aW(a,b,c){return a.width=b,a.height=c,a}var a7,aF,a4,aT,aY={create:aP,clone:function(a){var b;return aO(b=aP(a.width,a.height)).drawImage(a,0,0),b},resize:aW,get2dContext:aO,get3dContext:function(a){var b=null;try{b=a.getContext("webgl")||a.getContext("experimental-webgl")}catch(c){}return b||(b=null),b}},aN={getWidth:function(a){return a.naturalWidth||a.width},getHeight:function(a){return a.naturalHeight||a.height}},aZ=window.Promise?window.Promise:function(){var q=function(a){if("object"!=typeof this){throw new TypeError("Promises must be constructed via new")}if("function"!=typeof a){throw new TypeError("not a function")}this._state=null,this._value=null,this._deferreds=[],g(a,b(d,this),b(m,this))},j=q.immediateFn||"function"==typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)};function b(a,c){return function(){a.apply(c,arguments)}}var f=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};function h(a){var c=this;null!==this._state?j(function(){var i=c._state?a.onFulfilled:a.onRejected;if(null!==i){var l;try{l=i(c._value)}catch(o){return void a.reject(o)}a.resolve(l)}else{(c._state?a.resolve:a.reject)(c._value)}}):this._deferreds.push(a)}function d(a){try{if(a===this){throw new TypeError("A promise cannot be resolved with itself.")}if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c){return void g(b(c,a),b(d,this),b(m,this))}}this._state=!0,this._value=a,p.call(this)}catch(i){m.call(this,i)}}function m(a){this._state=!1,this._value=a,p.call(this)}function p(){for(var a=0,c=this._deferreds.length;a<c;a++){h.call(this,this._deferreds[a])}this._deferreds=null}function k(a,i,l,c){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof i?i:null,this.resolve=l,this.reject=c}function g(a,i,s){var c=!1;try{a(function(e){c||(c=!0,i(e))},function(e){c||(c=!0,s(e))})}catch(l){if(c){return}c=!0,s(l)}}return q.prototype["catch"]=function(a){return this.then(null,a)},q.prototype.then=function(e,a){var c=this;return new q(function(i,l){h.call(c,new k(e,a,i,l))})},q.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&f(arguments[0])?arguments[0]:arguments);return new q(function(r,n){if(0===a.length){return r([])}var c=a.length;function e(s,i){try{if(i&&("object"==typeof i||"function"==typeof i)){var u=i.then;if("function"==typeof u){return void u.call(i,function(v){e(s,v)},n)}}a[s]=i,0==--c&&r(a)}catch(o){n(o)}}for(var l=0;l<a.length;l++){e(l,a[l])}})},q.resolve=function(a){return a&&"object"==typeof a&&a.constructor===q?a:new q(function(c){c(a)})},q.reject=function(a){return new q(function(c,i){i(a)})},q.race=function(a){return new q(function(c,l){for(var o=0,i=a.length;o<i;o++){a[o].then(c,l)}})},q}(),aH=function(a){return function(){return a}},a0=function(d){for(var c=[],f=1;f<arguments.length;f++){c[f-1]=arguments[f]}for(var b=new Array(arguments.length-1),g=1;g<arguments.length;g++){b[g-1]=arguments[g]}return function(){for(var a=[],i=0;i<arguments.length;i++){a[i]=arguments[i]}for(var k=new Array(arguments.length),h=0;h<k.length;h++){k[h]=arguments[h]}var j=b.concat(k);return d.apply(null,j)}},a2=aH(!1),aR=aH(!0),az=a2,aE=aR,a6=function(){return aB},aB=(aT={fold:function(a,b){return a()},is:az,isSome:az,isNone:aE,getOr:a4=function(a){return a},getOrThunk:aF=function(a){return a()},getOrDie:function(a){throw new Error(a||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){return undefined},or:a4,orThunk:aF,map:a6,ap:a6,each:function(){},bind:a6,flatten:a6,exists:az,forall:aE,filter:a6,equals:a7=function(a){return a.isNone()},equals_:a7,toArray:function(){return[]},toString:aH("none()")},Object.freeze&&Object.freeze(aT),aT),aA=function(f){var a=function(){return f},c=function(){return d},b=function(e){return e(f)},d={fold:function(g,h){return h(f)},is:function(e){return f===e},isSome:aE,isNone:az,getOr:a,getOrThunk:a,getOrDie:a,getOrNull:a,getOrUndefined:a,or:c,orThunk:c,map:function(e){return aA(e(f))},ap:function(e){return e.fold(a6,function(g){return aA(g(f))})},each:function(e){e(f)},bind:b,flatten:a,exists:b,forall:b,filter:function(e){return e(f)?d:aB},equals:function(e){return e.is(f)},equals_:function(g,h){return g.fold(az,function(e){return h(f,e)})},toArray:function(){return[f]},toString:function(){return"some("+f+")"}};return d},bC={some:aA,none:a6,from:function(a){return null===a||a===undefined?aB:aA(a)}},bk="undefined"!=typeof window?window:Function("return this;")(),bo=function(a,b){return function(c,f){for(var g=f!==undefined&&null!==f?f:bk,d=0;d<c.length&&g!==undefined&&null!==g;++d){g=g[c[d]]}return g}(a.split("."),b)},bm={getOrDie:function(a,b){var c=bo(a,b);if(c===undefined||null===c){throw a+" not available on this browser"}return c}};function br(){return new (bm.getOrDie("FileReader"))}var bF={atob:function(a){return bm.getOrDie("atob")(a)},requestAnimationFrame:function(a){bm.getOrDie("requestAnimationFrame")(a)}};function bJ(a){return new aZ(function(d,g){var j=URL.createObjectURL(a),f=new Image,h=function(){f.removeEventListener("load",c),f.removeEventListener("error",b)};function c(){h(),d(f)}function b(){h(),g("Unable to load data of type "+a.type+": "+j)}f.addEventListener("load",c),f.addEventListener("error",b),f.src=j,f.complete&&c()})}function bG(a){return new aZ(function(b,d){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="blob",c.onload=function(){200==this.status&&b(this.response)},c.onerror=function(){var f,g=this;d(0===this.status?((f=new Error("No access to download image")).code=18,f.name="SecurityError",f):new Error("Error "+g.status+" downloading image"))},c.send()})}function bI(k){var G=k.split(","),z=/data:([^;]+)/.exec(G[0]);if(!z){return bC.none()}for(var v,x,C,J=z[1],j=G[1],I=bF.atob(j),B=I.length,q=Math.ceil(B/1024),F=new Array(q),H=0;H<q;++H){for(var D=1024*H,w=Math.min(D+1024,B),E=new Array(w-D),A=D,b=0;A<w;++b,++A){E[b]=I[A].charCodeAt(0)}F[H]=(v=E,new (bm.getOrDie("Uint8Array"))(v))}return bC.some((x=F,C={type:J},new (bm.getOrDie("Blob"))(x,C)))}function bM(a){return new aZ(function(b,c){bI(a).fold(function(){c("uri is not base64: "+a)},b)})}function a8(a){return new aZ(function(b){var c=new br;c.onloadend=function(){b(c.result)},c.readAsDataURL(a)})}var aU={blobToImage:bJ,imageToBlob:function(a){var b=a.src;return 0===b.indexOf("data:")?bM(b):bG(b)},blobToArrayBuffer:function(a){return new aZ(function(b){var c=new br;c.onloadend=function(){b(c.result)},c.readAsArrayBuffer(a)})},blobToDataUri:a8,blobToBase64:function(a){return a8(a).then(function(b){return b.split(",")[1]})},dataUriToBlobSync:bI,canvasToBlob:function(a,c,b){return c=c||"image/png",HTMLCanvasElement.prototype.toBlob?new aZ(function(d){a.toBlob(function(e){d(e)},c,b)}):bM(a.toDataURL(c,b))},canvasToDataURL:function(a,b,c){return b=b||"image/png",a.then(function(d){return d.toDataURL(b,c)})},blobToCanvas:function(a){return bJ(a).then(function(b){var c,d;return c=b,URL.revokeObjectURL(c.src),d=aY.create(aN.getWidth(b),aN.getHeight(b)),aY.get2dContext(d).drawImage(b,0,0),d})},uriToBlob:function(a){return 0===a.indexOf("blob:")?bG(a):0===a.indexOf("data:")?bM(a):null}},by=function(a){return aU.blobToImage(a)},bq=function(a){return aU.imageToBlob(a)};function bL(a,c,f){var b=c.type;function d(g,h){return a.then(function(e){return aU.canvasToDataURL(e,g,h)})}return{getType:aH(b),toBlob:function(){return aZ.resolve(c)},toDataURL:function(){return f},toBase64:function(){return f.split(",")[1]},toAdjustedBlob:function(g,h){return a.then(function(e){return aU.canvasToBlob(e,g,h)})},toAdjustedDataURL:d,toAdjustedBase64:function(g,h){return d(g,h).then(function(e){return e.split(",")[1]})},toCanvas:function(){return a.then(aY.clone)}}}function bD(a){return aU.blobToDataUri(a).then(function(b){return bL(aU.blobToCanvas(a),a,b)})}var bx={fromBlob:bD,fromCanvas:function(b,a){return aU.canvasToBlob(b,a).then(function(c){return bL(aZ.resolve(b),c,b.toDataURL())})},fromImage:function(a){return aU.imageToBlob(a).then(function(b){return bD(b)})},fromBlobAndUrlSync:function(a,b){return bL(aU.blobToCanvas(a),a,b)}};function bv(a,b,c){return c<(a=parseFloat(a))?a=c:a<b&&(a=b),a}var bj=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];function aV(f,h){var k,g,j,d,b=[],c=new Array(10);for(k=0;k<5;k++){for(g=0;g<5;g++){b[g]=h[g+5*k]}for(g=0;g<5;g++){for(j=d=0;j<5;j++){d+=f[g+5*j]*b[j]}c[g+5*k]=d}}return c}function bE(a,b){return b=bv(b,0,1),a.map(function(c,d){return d%6==0?c=1-(1-c)*b:c*=b,bv(c,0,1)})}var ay={identity:function(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]},adjust:bE,multiply:aV,adjustContrast:function(a,b){var c;return b=bv(b,-1,1),aV(a,[(c=(b*=100)<0?127+b/100*127:127*(c=0==(c=b%1)?bj[b]:bj[Math.floor(b)]*(1-c)+bj[Math.floor(b)+1]*c)+127)/127,0,0,0,0.5*(127-c),0,c/127,0,0,0.5*(127-c),0,0,c/127,0,0.5*(127-c),0,0,0,1,0,0,0,0,0,1])},adjustBrightness:function(a,b){return aV(a,[1,0,0,0,b=bv(255*b,-255,255),0,1,0,0,b,0,0,1,0,b,0,0,0,1,0,0,0,0,0,1])},adjustSaturation:function(a,b){var c;return aV(a,[0.3086*(1-(c=1+(0<(b=bv(b,-1,1))?3*b:b)))+c,0.6094*(1-c),0.082*(1-c),0,0,0.3086*(1-c),0.6094*(1-c)+c,0.082*(1-c),0,0,0.3086*(1-c),0.6094*(1-c),0.082*(1-c)+c,0,0,0,0,0,1,0,0,0,0,0,1])},adjustHue:function(d,g){var j,f,h,c,b;return g=bv(g,-180,180)/180*Math.PI,aV(d,[(h=0.213)+0.787*(j=Math.cos(g))+(f=Math.sin(g))*-h,(c=0.715)+j*-c+f*-c,(b=0.072)+j*-b+0.928*f,0,0,h+j*-h+0.143*f,c+j*(1-c)+0.14*f,b+j*-b+-0.283*f,0,0,h+j*-h+-0.787*f,c+j*-c+f*c,b+0.928*j+f*b,0,0,0,0,0,1,0,0,0,0,0,1])},adjustColors:function(a,c,d,b){return aV(a,[c=bv(c,0,2),0,0,0,0,0,d=bv(d,0,2),0,0,0,0,0,b=bv(b,0,2),0,0,0,0,0,1,0,0,0,0,0,1])},adjustSepia:function(a,b){return aV(a,bE([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],b=bv(b,0,1)))},adjustGrayscale:function(a,b){return aV(a,bE([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],b=bv(b,0,1)))}};function bi(b,c){return b.toCanvas().then(function(d){return g=d,j=b.getType(),f=c,a=aY.get2dContext(g),h=function(K,ae){var Q,M,P,W,cg,J=K.data,bt=ae[0],V=ae[1],L=ae[2],Z=ae[3],at=ae[4],X=ae[5],N=ae[6],Y=ae[7],U=ae[8],B=ae[9],G=ae[10],ce=ae[11],E=ae[12],D=ae[13],C=ae[14],k=ae[15],z=ae[16],q=ae[17],A=ae[18],H=ae[19];for(cg=0;cg<J.length;cg+=4){Q=J[cg],M=J[cg+1],P=J[cg+2],W=J[cg+3],J[cg]=Q*bt+M*V+P*L+W*Z+at,J[cg+1]=Q*X+M*N+P*Y+W*U+B,J[cg+2]=Q*G+M*ce+P*E+W*D+C,J[cg+3]=Q*k+M*z+P*q+W*A+H}return K}(a.getImageData(0,0,g.width,g.height),f),a.putImageData(h,0,0),bx.fromCanvas(g,j);var g,j,f,h,a})}function bg(a,b){return a.toCanvas().then(function(f){return h=f,k=a.getType(),g=b,c=aY.get2dContext(h),j=c.getImageData(0,0,h.width,h.height),d=c.getImageData(0,0,h.width,h.height),d=function(B,N,G){var D,F,J,R,A,P,I,C,M,O,K,E,L,H,q,z,Q;function x(i,l,m){return m<i?i=m:i<l&&(i=l),i}for(J=Math.round(Math.sqrt(G.length)),R=Math.floor(J/2),D=B.data,F=N.data,z=B.width,Q=B.height,P=0;P<Q;P++){for(A=0;A<z;A++){for(I=C=M=0,K=0;K<J;K++){for(O=0;O<J;O++){E=x(A+O-R,0,z-1),L=x(P+K-R,0,Q-1),H=4*(L*z+E),q=G[K*J+O],I+=D[H]*q,C+=D[H+1]*q,M+=D[H+2]*q}}F[H=4*(P*z+A)]=x(I,0,255),F[H+1]=x(C,0,255),F[H+2]=x(M,0,255)}}return N}(j,d,g),c.putImageData(d,0,0),bx.fromCanvas(h,k);var h,k,g,j,d,c})}function aM(a){return function(b,c){return b.toCanvas().then(function(d){return function(h,k,m){var j,l,g=aY.get2dContext(h),f=new Array(256);for(l=0;l<f.length;l++){f[l]=a(l,m)}return j=function(i,p){var q,o=i.data;for(q=0;q<o.length;q+=4){o[q]=p[o[q]],o[q+1]=p[o[q+1]],o[q+2]=p[o[q+2]]}return i}(g.getImageData(0,0,h.width,h.height),f),g.putImageData(j,0,0),bx.fromCanvas(h,k)}(d,b.getType(),c)})}}function bc(a){return function(b,c){return bi(b,a(ay.identity(),c))}}function be(a){return function(b){return bg(b,a)}}var bA,bz={invert:(bA=[-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],function(a){return bi(a,bA)}),brightness:bc(ay.adjustBrightness),hue:bc(ay.adjustHue),saturate:bc(ay.adjustSaturation),contrast:bc(ay.adjustContrast),grayscale:bc(ay.adjustGrayscale),sepia:bc(ay.adjustSepia),colorize:function(a,c,d,b){return bi(a,ay.adjustColors(ay.identity(),c,d,b))},sharpen:be([0,-1,0,-1,5,-1,0,-1,0]),emboss:be([-2,-1,0,-1,1,1,0,1,2]),gamma:aM(function(a,b){return 255*Math.pow(a/255,1-b)}),exposure:aM(function(a,b){return 255*(1-Math.exp(-a/255*b))}),colorFilter:bi,convoluteFilter:bg},bb={scale:function a1(w,g,b){var e=aN.getWidth(w),j=aN.getHeight(w),q=g/e,v=b/j,p=!1;(q<0.5||2<q)&&(q=q<0.5?0.5:2,p=!0),(v<0.5||2<v)&&(v=v<0.5?0.5:2,p=!0);var h,x,k,m=(h=w,x=q,k=v,new aZ(function(f){var s=aN.getWidth(h),y=aN.getHeight(h),l=Math.floor(s*x),u=Math.floor(y*k),d=aY.create(l,u),c=aY.get2dContext(d);c.drawImage(h,0,0,s,y,0,0,l,u),f(d)}));return p?m.then(function(a){return a1(a,g,b)}):m}},bp={rotate:function(b,a){return b.toCanvas().then(function(g){return j=g,l=b.getType(),h=a,k=aY.create(j.width,j.height),f=aY.get2dContext(k),90!=(h=h<(d=c=0)?360+h:h)&&270!=h||aY.resize(k,k.height,k.width),90!=h&&180!=h||(c=k.width),270!=h&&180!=h||(d=k.height),f.translate(c,d),f.rotate(h*Math.PI/180),f.drawImage(j,0,0),bx.fromCanvas(k,l);var j,l,h,k,f,c,d})},flip:function(b,c){return b.toCanvas().then(function(d){return g=d,j=b.getType(),f=c,h=aY.create(g.width,g.height),a=aY.get2dContext(h),"v"==f?(a.scale(1,-1),a.drawImage(g,0,-h.height)):(a.scale(-1,1),a.drawImage(g,-h.width,0)),bx.fromCanvas(h,j);var g,j,f,h,a})},crop:function(h,a,b,e,g){return h.toCanvas().then(function(j){return l=j,p=h.getType(),k=a,m=b,f=e,c=g,d=aY.create(f,c),aY.get2dContext(d).drawImage(l,-k,-m),bx.fromCanvas(d,p);var l,p,k,m,f,c,d})},resize:function(b,c,a){return b.toCanvas().then(function(d){return bb.scale(d,c,a).then(function(e){return bx.fromCanvas(e,b.getType())})})}},bl=function(){function a(b){this.littleEndian=!1,this._dv=new DataView(b)}return a.prototype.readByteAt=function(b){return this._dv.getUint8(b)},a.prototype.read=function(b,d){if(b+d>this.length()){return null}for(var g=this.littleEndian?0:-8*(d-1),c=0,f=0;c<d;c++){f|=this.readByteAt(b+c)<<Math.abs(g+8*c)}return f},a.prototype.BYTE=function(b){return this.read(b,1)},a.prototype.SHORT=function(b){return this.read(b,2)},a.prototype.LONG=function(b){return this.read(b,4)},a.prototype.SLONG=function(b){var c=this.read(b,4);return 2147483647<c?c-4294967296:c},a.prototype.CHAR=function(b){return String.fromCharCode(this.read(b,1))},a.prototype.STRING=function(b,c){return this.asArray("CHAR",b,c).join("")},a.prototype.SEGMENT=function(b,c){var d=this._dv.buffer;switch(arguments.length){case 2:return d.slice(b,b+c);case 1:return d.slice(b);default:return d}},a.prototype.asArray=function(b,d,g){for(var c=[],f=0;f<g;f++){c[f]=this[b](d+f)}return c},a.prototype.length=function(){return this._dv?this._dv.byteLength:0},a}(),cf={274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},bd={36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},b5={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},aC={513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"},aw={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},bK=function(){function a(b){this._offsets={tiffHeader:10,IFD0:null,IFD1:null,exifIFD:null,gpsIFD:null},this._tiffTags={};var c=this;if(c._reader=new bl(b),c._idx=c._offsets.tiffHeader,65505!==c.SHORT(0)||"EXIF\0"!==c.STRING(4,5).toUpperCase()){throw new Error("Exif data cannot be read or not available.")}if(c._reader.littleEndian=18761==c.SHORT(c._idx),42!==c.SHORT(c._idx+=2)){throw new Error("Invalid Exif data.")}c._offsets.IFD0=c._offsets.tiffHeader+c.LONG(c._idx+=2),c._tiffTags=c.extractTags(c._offsets.IFD0,cf),"ExifIFDPointer" in c._tiffTags&&(c._offsets.exifIFD=c._offsets.tiffHeader+c._tiffTags.ExifIFDPointer,delete c._tiffTags.ExifIFDPointer),"GPSInfoIFDPointer" in c._tiffTags&&(c._offsets.gpsIFD=c._offsets.tiffHeader+c._tiffTags.GPSInfoIFDPointer,delete c._tiffTags.GPSInfoIFDPointer);var d=c.LONG(c._offsets.IFD0+12*c.SHORT(c._offsets.IFD0)+2);d&&(c._offsets.IFD1=c._offsets.tiffHeader+d)}return a.prototype.BYTE=function(b){return this._reader.BYTE(b)},a.prototype.SHORT=function(b){return this._reader.SHORT(b)},a.prototype.LONG=function(b){return this._reader.LONG(b)},a.prototype.SLONG=function(b){return this._reader.SLONG(b)},a.prototype.CHAR=function(b){return this._reader.CHAR(b)},a.prototype.STRING=function(b,c){return this._reader.STRING(b,c)},a.prototype.SEGMENT=function(b,c){return this._reader.SEGMENT(b,c)},a.prototype.asArray=function(b,d,g){for(var c=[],f=0;f<g;f++){c[f]=this[b](d+f)}return c},a.prototype.length=function(){return this._reader.length()},a.prototype.UNDEFINED=function(){return this.BYTE.apply(this,arguments)},a.prototype.RATIONAL=function(b){return this.LONG(b)/this.LONG(b+4)},a.prototype.SRATIONAL=function(b){return this.SLONG(b)/this.SLONG(b+4)},a.prototype.ASCII=function(b){return this.CHAR(b)},a.prototype.TIFF=function(){return this._tiffTags},a.prototype.EXIF=function(){var b=null;if(this._offsets.exifIFD){try{b=this.extractTags(this._offsets.exifIFD,bd)}catch(c){return null}if(b.ExifVersion&&Array.isArray(b.ExifVersion)){for(var d=0,f="";d<b.ExifVersion.length;d++){f+=String.fromCharCode(b.ExifVersion[d])}b.ExifVersion=f}}return b},a.prototype.GPS=function(){var b=null;if(this._offsets.gpsIFD){try{b=this.extractTags(this._offsets.gpsIFD,b5)}catch(c){return null}b.GPSVersionID&&Array.isArray(b.GPSVersionID)&&(b.GPSVersionID=b.GPSVersionID.join("."))}return b},a.prototype.thumb=function(){var b=this;if(b._offsets.IFD1){try{var c=b.extractTags(b._offsets.IFD1,aC);if("JPEGInterchangeFormat" in c){return b.SEGMENT(b._offsets.tiffHeader+c.JPEGInterchangeFormat,c.JPEGInterchangeFormatLength)}}catch(d){}}return null},a.prototype.extractTags=function(C,x){var k,b,j,q,A,B,z,m,D=this,w=[],y={},v={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"},g={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};for(k=D.SHORT(C),b=0;b<k;b++){if(w=[],z=C+2+12*b,(j=x[D.SHORT(z)])!==undefined){if(q=v[D.SHORT(z+=2)],A=D.LONG(z+=2),!(B=g[q])){throw new Error("Invalid Exif data.")}if(z+=4,4<B*A&&(z=D.LONG(z)+D._offsets.tiffHeader),z+B*A>=D.length()){throw new Error("Invalid Exif data.")}"ASCII"!==q?(w=D.asArray(q,z,A),m=1==A?w[0]:w,aw.hasOwnProperty(j)&&"object"!=typeof m?y[j]=aw[j][m]:y[j]=m):y[j]=D.STRING(z,A).replace(/\0$/,"").trim()}}return y},a}(),aK=function(a){var c,f,b=[],d=0;for(c=2;c<=a.length();){if(65488<=(f=a.SHORT(c))&&f<=65495){c+=2}else{if(65498===f||65497===f){break}d=a.SHORT(c+2)+2,65505<=f&&f<=65519&&b.push({hex:f,name:"APP"+(15&f),start:c,length:d,segment:a.SEGMENT(c,d)}),c+=d}}return b},av=function(a){return aU.blobToArrayBuffer(a).then(function(d){try{var g=new bl(d);if(65496===g.SHORT(0)){var j=aK(g),f=j.filter(function(e){return"APP1"===e.name}),h={};if(!f.length){return aZ.reject("Headers did not include required information")}var c=new bK(f[0].segment);return(h={tiff:c.TIFF(),exif:c.EXIF(),gps:c.GPS(),thumb:c.thumb()}).rawHeaders=j,h}return aZ.reject("Image was not a jpeg")}catch(b){return aZ.reject("Unsupported format or not an image: "+a.type+" (Exception: "+b.message+")")}})},b3=function(a,b){return bp.rotate(a,b)},bS={invert:function(a){return bz.invert(a)},sharpen:function(a){return bz.sharpen(a)},emboss:function(a){return bz.emboss(a)},brightness:function(a,b){return bz.brightness(a,b)},hue:function(a,b){return bz.hue(a,b)},saturate:function(a,b){return bz.saturate(a,b)},contrast:function(a,b){return bz.contrast(a,b)},grayscale:function(a,b){return bz.grayscale(a,b)},sepia:function(a,b){return bz.sepia(a,b)},colorize:function(a,c,d,b){return bz.colorize(a,c,d,b)},gamma:function(a,b){return bz.gamma(a,b)},exposure:function(a,b){return bz.exposure(a,b)},flip:function(a,b){return bp.flip(a,b)},crop:function(a,c,f,b,d){return bp.crop(a,c,f,b,d)},resize:function(a,b,c){return bp.resize(a,b,c)},rotate:b3,exifRotate:function(a){return a.toBlob().then(av).then(function(b){switch(b.tiff.Orientation){case 6:return b3(a,90);case 3:return b3(a,180);case 8:return b3(a,270);default:return a}},function(){return a})}},b1=function(a){return a.toBlob()},aj={blobToImageResult:function(a){return bx.fromBlob(a)},fromBlobAndUrlSync:function(a,b){return bx.fromBlobAndUrlSync(a,b)},imageToImageResult:function(a){return bx.fromImage(a)},imageResultToBlob:function(a,b,c){return b===undefined&&c===undefined?b1(a):a.toAdjustedBlob(b,c)},imageResultToOriginalBlob:b1,imageResultToDataURL:function(a){return a.toDataURL()}},a9=function(){return bm.getOrDie("URL")},am={createObjectURL:function(a){return a9().createObjectURL(a)},revokeObjectURL:function(a){a9().revokeObjectURL(a)}},bN=tinymce.util.Tools.resolve("tinymce.util.Delay"),bP=tinymce.util.Tools.resolve("tinymce.util.Promise"),bV=tinymce.util.Tools.resolve("tinymce.util.URI"),ap=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),a5=tinymce.util.Tools.resolve("tinymce.ui.Factory"),ag=tinymce.util.Tools.resolve("tinymce.geom.Rect"),b8=function(a){return new bP(function(b){var c=function(){a.removeEventListener("load",c),b(a)};a.complete?b(a):a.addEventListener("load",c)})},bf=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),bW=tinymce.util.Tools.resolve("tinymce.util.Observable"),ah=tinymce.util.Tools.resolve("tinymce.util.VK"),b9=0,bn={create:function(a){return new (a5.get("Control").extend({Defaults:{classes:"imagepanel"},selection:function(b){return arguments.length?(this.state.set("rect",b),this):this.state.get("rect")},imageSize:function(){var b=this.state.get("viewRect");return{w:b.w,h:b.h}},toggleCropRect:function(b){this.state.set("cropEnabled",b)},imageSrc:function(c){var d=this,b=new Image;b.src=c,b8(b).then(function(){var f,h,i=d.state.get("viewRect");if((h=d.$el.find("img"))[0]){h.replaceWith(b)}else{var g=document.createElement("div");g.className="mce-imagepanel-bg",d.getEl().appendChild(g),d.getEl().appendChild(b)}f={x:0,y:0,w:b.naturalWidth,h:b.naturalHeight},d.state.set("viewRect",f),d.state.set("rect",ag.inflate(f,-20,-20)),i&&i.w===f.w&&i.h===f.h||d.zoomFit(),d.repaintImage(),d.fire("load")})},zoom:function(b){return arguments.length?(this.state.set("zoom",b),this):this.state.get("zoom")},postRender:function(){return this.imageSrc(this.settings.imageSrc),this._super()},zoomFit:function(){var c,f,h,d,g,b;c=this.$el.find("img"),f=this.getEl().clientWidth,h=this.getEl().clientHeight,d=c[0].naturalWidth,g=c[0].naturalHeight,1<=(b=Math.min((f-10)/d,(h-10)/g))&&(b=1),this.zoom(b)},repaintImage:function(){var q,j,f,b,d,h,m,p,k,g,v;v=this.getEl(),k=this.zoom(),g=this.state.get("rect"),m=this.$el.find("img"),p=this.$el.find(".mce-imagepanel-bg"),d=v.offsetWidth,h=v.offsetHeight,f=m[0].naturalWidth*k,b=m[0].naturalHeight*k,q=Math.max(0,d/2-f/2),j=Math.max(0,h/2-b/2),m.css({left:q,top:j,width:f,height:b}),p.css({left:q,top:j,width:f,height:b}),this.cropRect&&(this.cropRect.setRect({x:g.x*k+q,y:g.y*k+j,w:g.w*k,h:g.h*k}),this.cropRect.setClampRect({x:q,y:j,w:f,h:b}),this.cropRect.setViewPortRect({x:0,y:0,w:d,h:h}))},bindStates:function(){var b=this;function c(d){b.cropRect=function(v,q,G,j,m){var z,D,F,w,A="mce-",E=A+"crid-"+b9++;function B(f,g){return{x:g.x-f.x,y:g.y-f.y,w:g.w,h:g.h}}function C(J,p,h,f){var g,l,H,I,s;g=p.x,l=p.y,H=p.w,I=p.h,g+=h*J.deltaX,l+=f*J.deltaY,(H+=h*J.deltaW)<20&&(H=20),(I+=f*J.deltaH)<20&&(I=20),s=v=ag.clamp({x:g,y:l,w:H,h:I},G,"move"===J.name),s=B(G,s),z.fire("updateRect",{rect:s}),y(s)}function x(g){function f(h,i){i.h<0&&(i.h=0),i.w<0&&(i.w=0),bf("#"+E+"-"+h,j).css({left:i.x,top:i.y,width:i.w,height:i.h})}b0.each(D,function(e){bf("#"+E+"-"+e.name,j).css({left:g.w*e.xMul+g.x,top:g.h*e.yMul+g.y})}),f("top",{x:q.x,y:q.y,w:q.w,h:g.y-q.y}),f("right",{x:g.x+g.w,y:g.y,w:q.w-g.x-g.w+q.x,h:g.h}),f("bottom",{x:q.x,y:g.y+g.h,w:q.w,h:q.h-g.y-g.h+q.y}),f("left",{x:q.x,y:g.y,w:g.x-q.x,h:g.h}),f("move",g)}function k(e){x(v=e)}function y(f){var g,h;k((g=G,{x:(h=f).x+g.x,y:h.y+g.y,w:h.w,h:h.h}))}return D=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}],w=["top","right","bottom","left"],bf('<div id="'+E+'" class="'+A+'croprect-container" role="grid" aria-dropeffect="execute">').appendTo(j),b0.each(w,function(e){bf("#"+E,j).append('<div id="'+E+"-"+e+'"class="'+A+'croprect-block" style="display: none" data-mce-bogus="all">')}),b0.each(D,function(e){bf("#"+E,j).append('<div id="'+E+"-"+e.name+'" class="'+A+"croprect-handle "+A+"croprect-handle-"+e.name+'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+e.label+'" aria-grabbed="false">')}),F=b0.map(D,function(f){var g;return new (a5.get("DragHelper"))(E,{document:j.ownerDocument,handle:E+"-"+f.name,start:function(){g=v},drag:function(e){C(f,g,e.deltaX,e.deltaY)}})}),x(v),bf(j).on("focusin focusout",function(e){bf(e.target).attr("aria-grabbed","focus"===e.type)}),bf(j).on("keydown",function(h){var g;function f(i,p,u,l,s){i.stopPropagation(),i.preventDefault(),C(g,u,l,s)}switch(b0.each(D,function(e){if(h.target.id===E+"-"+e.name){return g=e,!1}}),h.keyCode){case ah.LEFT:f(h,0,v,-10,0);break;case ah.RIGHT:f(h,0,v,10,0);break;case ah.UP:f(h,0,v,0,-10);break;case ah.DOWN:f(h,0,v,0,10);break;case ah.ENTER:case ah.SPACEBAR:h.preventDefault(),m()}}),z=b0.extend({toggleVisibility:function(f){var g;g=b0.map(D,function(e){return"#"+E+"-"+e.name}).concat(b0.map(w,function(e){return"#"+E+"-"+e})).join(","),f?bf(g,j).show():bf(g,j).hide()},setClampRect:function(e){G=e,x(v)},setRect:k,getInnerRect:function(){return B(G,v)},setInnerRect:y,setViewPortRect:function(e){q=e,x(v)},destroy:function(){b0.each(F,function(e){e.destroy()}),F=[]}},bW)}(d,b.state.get("viewRect"),b.state.get("viewRect"),b.getEl(),function(){b.fire("crop")}),b.cropRect.on("updateRect",function(f){var g=f.rect,h=b.zoom();g={x:Math.round(g.x/h),y:Math.round(g.y/h),w:Math.round(g.w/h),h:Math.round(g.h/h)},b.state.set("rect",g)}),b.on("remove",b.cropRect.destroy)}b.state.on("change:cropEnabled",function(d){b.cropRect.toggleVisibility(d.value),b.repaintImage()}),b.state.on("change:zoom",function(){b.repaintImage()}),b.state.on("change:rect",function(d){var f=d.value;b.cropRect||c(f),b.cropRect.setRect(f)})}}))(a)}};function ab(a){return{blob:a,url:am.createObjectURL(a)}}function ba(a){a&&am.revokeObjectURL(a.url)}function al(a){b0.each(a,ba)}function ax(cL,cT,cA,cP){var cz,cG,cC,cR,cF,cI,cB,cO,cQ,cM,cE,cN,cH,cv,cy,cS,cx,cw,cl,at,ce,bt,ch,co,cr,cp,cq,ct=function(){var d=[],b=-1;function a(){return 0<b}function c(){return -1!==b&&b<d.length-1}return{data:d,add:function(f){var g;return g=d.splice(++b),d.push(f),{state:f,removed:g}},undo:function(){if(a()){return d[--b]}},redo:function(){if(c()){return d[++b]}},canUndo:a,canRedo:c}}(),cU=function(a){return cL.rtl?a.reverse():a};function cJ(a){var c,f,b,d;c=cz.find("#w")[0],f=cz.find("#h")[0],b=parseInt(c.value(),10),d=parseInt(f.value(),10),cz.find("#constrain")[0].checked()&&co&&cr&&b&&d&&("w"===a.control.settings.name?(d=Math.round(b*cp),f.value(d)):(b=Math.round(d*cq),c.value(b))),co=b,cr=d}function ck(a){return Math.round(100*a)+"%"}function cg(){cz.find("#undo").disabled(!ct.canUndo()),cz.find("#redo").disabled(!ct.canRedo()),cz.statusbar.find("#save").disabled(!ct.canUndo())}function cs(){cz.find("#undo").disabled(!0),cz.find("#redo").disabled(!0)}function cm(a){a&&cO.imageSrc(a.url)}function cj(a){return function(){var b=b0.grep(ch,function(c){return c.settings.name!==a});b0.each(b,function(c){c.hide()}),a.show(),a.focus()}}function ci(a){cm(cR=ab(a))}function ae(a){cm(cT=ab(a)),al(ct.add(cT).removed),cg()}function cK(){var a=cO.selection();aj.blobToImageResult(cT.blob).then(function(b){bS.crop(b,a.x,a.y,a.w,a.h).then(cD).then(function(c){ae(c),cu()})})}var cn=function(a){var b=[].slice.call(arguments,1);return function(){var c=cR||cT;aj.blobToImageResult(c.blob).then(function(d){a.apply(this,[d].concat(b)).then(cD).then(ci)})}};function cu(){cm(cT),ba(cR),cj(cG)(),cg()}function Z(){cR?(ae(cR.blob),cu()):function a(b,c){cR?c():setTimeout(function(){0<b--?a(b,c):cL.windowManager.alert("Error: failed to apply image operation.")},10)}(100,Z)}function Q(a){return a5.create("Form",{layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:a})}var cD=function(a){return a.toBlob()};function J(a,b){return Q(cU([{text:"Back",onclick:cu},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:Z}])).hide().on("show",function(){cs(),aj.blobToImageResult(cT.blob).then(function(c){return b(c)}).then(cD).then(function(c){var d=ab(c);cm(d),ba(cR),cR=d})})}function K(a,f,c,b,d){return Q(cU([{text:"Back",onclick:cu},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(g){var h;h=g.value,aj.blobToImageResult(cT.blob).then(function(e){return f(e,h)}).then(cD).then(function(i){var j=ab(i);cm(j),ba(cR),cR=j})},minValue:cL.rtl?d:b,maxValue:cL.rtl?b:d,value:c,previewFilter:ck},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:Z}])).hide().on("show",function(){this.find("slider").value(c),cs()})}cF=Q(cU([{text:"Back",onclick:cu},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:cK}])).hide().on("show hide",function(a){cO.toggleCropRect("show"===a.type)}).on("show",cs),cI=Q(cU([{text:"Back",onclick:cu},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:cJ},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:cJ},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:function(a){!0===a.control.value()&&(cp=cr/co,cq=co/cr)}},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}])).hide().on("submit",function(a){var b=parseInt(cz.find("#w").value(),10),c=parseInt(cz.find("#h").value(),10);a.preventDefault(),function(g){for(var d=[],h=1;h<arguments.length;h++){d[h-1]=arguments[h]}var f=[].slice.call(arguments,1);return function(){aj.blobToImageResult(cT.blob).then(function(e){g.apply(this,[e].concat(f)).then(cD).then(ae)})}}(bS.resize,b,c)(),cu()}).on("show",cs),cB=Q(cU([{text:"Back",onclick:cu},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:cn(bS.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:cn(bS.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:cn(bS.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:cn(bS.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:Z}])).hide().on("show",cs),cE=J(0,bS.invert),cl=J(0,bS.sharpen),at=J(0,bS.emboss),cN=K(0,bS.brightness,0,-1,1),cH=K(0,bS.hue,180,0,360),cv=K(0,bS.saturate,0,-1,1),cy=K(0,bS.contrast,0,-1,1),cS=K(0,bS.grayscale,0,0,1),cx=K(0,bS.sepia,0,0,1),cw=function(a,d){function c(){var h,i,g;h=cz.find("#r")[0].value(),i=cz.find("#g")[0].value(),g=cz.find("#b")[0].value(),aj.blobToImageResult(cT.blob).then(function(e){return d(e,h,i,g)}).then(cD).then(function(j){var k=ab(j);cm(k),ba(cR),cR=k})}var f=cL.rtl?2:0,b=cL.rtl?0:2;return Q(cU([{text:"Back",onclick:cu},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:f,value:1,maxValue:b,ondragend:c,previewFilter:ck},{type:"slider",label:"G",name:"g",minValue:f,value:1,maxValue:b,ondragend:c,previewFilter:ck},{type:"slider",label:"B",name:"b",minValue:f,value:1,maxValue:b,ondragend:c,previewFilter:ck},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:Z}])).hide().on("show",function(){cz.find("#r,#g,#b").value(1),cs()})}(0,bS.colorize),ce=K(0,bS.gamma,0,-1,1),bt=K(0,bS.exposure,1,0,2),cC=Q(cU([{text:"Back",onclick:cu},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:cj(cH)},{text:"saturate",icon:"saturate",onclick:cj(cv)},{text:"sepia",icon:"sepia",onclick:cj(cx)},{text:"emboss",icon:"emboss",onclick:cj(at)},{text:"exposure",icon:"exposure",onclick:cj(bt)},{type:"spacer",flex:1}])).hide(),cG=Q(cU([{tooltip:"Crop",icon:"crop",onclick:cj(cF)},{tooltip:"Resize",icon:"resize2",onclick:cj(cI)},{tooltip:"Orientation",icon:"orientation",onclick:cj(cB)},{tooltip:"Brightness",icon:"sun",onclick:cj(cN)},{tooltip:"Sharpen",icon:"sharpen",onclick:cj(cl)},{tooltip:"Contrast",icon:"contrast",onclick:cj(cy)},{tooltip:"Color levels",icon:"drop",onclick:cj(cw)},{tooltip:"Gamma",icon:"gamma",onclick:cj(ce)},{tooltip:"Invert",icon:"invert",onclick:cj(cE)}])),cO=bn.create({flex:1,imageSrc:cT.url}),cQ=a5.create("Container",{layout:"flex",direction:"column",pack:"start",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:function(){cm(cT=ct.undo()),cg()}},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:function(){cm(cT=ct.redo()),cg()}},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:function(){var a=cO.zoom();a<2&&(a+=0.1),cO.zoom(a)}},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:function(){var a=cO.zoom();0.1<a&&(a-=0.1),cO.zoom(a)}}]}),cM=a5.create("Container",{type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:cU([cQ,cO])}),ch=[cG,cF,cI,cB,cC,cE,cN,cH,cv,cy,cS,cx,cw,cl,at,ce,bt],(cz=cL.windowManager.open({layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(ap.DOM.getViewPort().w,800),minHeight:Math.min(ap.DOM.getViewPort().h,650),title:"Edit image",items:ch.concat([cM]),buttons:cU([{text:"Save",name:"save",subtype:"primary",onclick:function(){cA(cT.blob),cz.close()}},{text:"Cancel",onclick:"close"}])})).on("close",function(){cP(),al(ct.data),cR=ct=null}),ct.add(cT),cg(),cO.on("load",function(){co=cO.imageSize().w,cr=cO.imageSize().h,cp=cr/co,cq=co/cr,cz.find("#w").value(co),cz.find("#h").value(cr)}),cO.on("crop",cK)}var b2,cd={edit:function(b,a){return new bP(function(c,d){return a.toBlob().then(function(e){ax(b,ab(e),c,d)})})}},aa={getImageSize:function(a){var c,d;function b(e){return/^[0-9\.]+px$/.test(e)}return c=a.style.width,d=a.style.height,c||d?b(c)&&b(d)?{w:parseInt(c,10),h:parseInt(d,10)}:null:(c=a.width,d=a.height,c&&d?{w:parseInt(c,10),h:parseInt(d,10)}:null)},setImageSize:function(a,c){var d,b;c&&(d=a.style.width,b=a.style.height,(d||b)&&(a.style.width=c.w+"px",a.style.height=c.h+"px",a.removeAttribute("data-mce-style")),d=a.width,b=a.height,(d||b)&&(a.setAttribute("width",c.w),a.setAttribute("height",c.h)))},getNaturalImageSize:function(a){return{w:a.naturalWidth,h:a.naturalHeight}}},ad=(b2="function",function(a){return function(b){if(null===b){return"null"}var c=typeof b;return"object"===c&&Array.prototype.isPrototypeOf(b)?"array":"object"===c&&String.prototype.isPrototypeOf(b)?"string":c}(a)===b2}),aL=function(a,c){for(var f=0,b=a.length;f<b;f++){var d=a[f];if(c(d,f,a)){return bC.some(d)}}return bC.none()};Array.prototype.slice;function bO(){return new (bm.getOrDie("XMLHttpRequest"))}ad(Array.from)&&Array.from;var bQ=function(a){return null!==a&&a!==undefined},b6=function(a,b){var c;return c=b.reduce(function(d,f){return bQ(d)?d[f]:undefined},a),bQ(c)?c:null},bT=function(a){return new bP(function(c){var b=new br;b.onload=function(d){var f=d.target;c(f.result)},b.readAsText(a)})},bw=function(b,a,c){return new bP(function(d){var e;(e=new bO).onreadystatechange=function(){4===e.readyState&&d({status:e.status,blob:this.response})},e.open("GET",b,!0),e.withCredentials=c,b0.each(a,function(f,g){e.setRequestHeader(g,f)}),e.responseType="blob",e.send()})},ak=function(a){var b;try{b=JSON.parse(a)}catch(c){}return b},b4=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],bu=[{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],aS=function(a){return"ImageProxy HTTP error: "+aL(b4,function(b){return a===b.code}).fold(aH("Unknown ImageProxy error"),function(b){return b.message})},ar=function(a){var b=aS(a);return bP.reject(b)},ac=function(a){return aL(bu,function(b){return b.type===a}).fold(aH("Unknown service error"),function(b){return b.message})},cb=function(a,b){return bT(b).then(function(c){var f,g,d=(f=ak(c),"ImageProxy Service error: "+((g=b6(f,["error","type"]))?ac(g):"Invalid JSON in service error message"));return bP.reject(d)})},ai=function(a,b){return 400===(c=a)||403===c||500===c?cb(0,b):ar(a);var c},bh=ar,aD=function(b,d){var g,c,f,a={"Content-Type":"application/json;charset=UTF-8","tiny-api-key":d};return bw((g=b,c=d,f=-1===g.indexOf("?")?"?":"&",/[?&]apiKey=/.test(g)||!c?g:g+f+"apiKey="+encodeURIComponent(c)),a,!1).then(function(e){return e.status<200||300<=e.status?ai(e.status,e.blob):bP.resolve(e.blob)})},an=function(a,b,c){return b?aD(a,b):bw(a,{},c).then(function(d){return d.status<200||300<=d.status?bh(d.status):bP.resolve(d.blob)})},bY=0,aq=function(a,b){a.notificationManager.open({text:b,type:"error"})},bH=function(a){return a.selection.getNode()},af=function(a,b){var c=b.src;return 0===c.indexOf("data:")||0===c.indexOf("blob:")||new bV(c).host===a.documentBaseURI.host},bB=function(a,b){return -1!==b0.inArray(a.getParam("imagetools_cors_hosts",[],"string[]"),new bV(b.src).host)},cc=function(d,g){var j,f,h,c,b=g.src;return bB(d,g)?an(g.src,null,(f=d,h=g,-1!==b0.inArray(f.getParam("imagetools_credentials_hosts",[],"string[]"),new bV(h.src).host))):af(d,g)?bq(g):(b=d.getParam("imagetools_proxy"),b+=(-1===b.indexOf("?")?"?":"&")+"url="+encodeURIComponent(g.src),j=(c=d).getParam("api_key",c.getParam("imagetools_api_key","","string"),"string"),an(b,j,!1))},aX=function(a){var b;return(b=a.editorUpload.blobCache.getByUri(bH(a).src))?bP.resolve(b.blob()):cc(a,bH(a))},aQ=function(a){clearTimeout(a.get())},bR=function(h,a,b,e,g){return a.toBlob().then(function(j){var l,p,k,m,f,c,d;return k=h.editorUpload.blobCache,l=(f=bH(h)).src,h.getParam("images_reuse_filename",!1,"boolean")&&((m=k.getByUri(l))?(l=m.uri(),p=m.name()):(c=h,p=(d=l.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i))?c.dom.encode(d[1]):null)),m=k.create({id:"imagetools"+bY++,blob:j,base64:a.toBase64(),uri:l,name:p}),k.add(m),h.undoManager.transact(function(){h.$(f).on("load",function i(){var q,s,o;h.$(f).off("load",i),h.nodeChanged(),b?h.editorUpload.uploadImagesAuto():(aQ(e),q=h,s=e,o=bN.setEditorTimeout(q,function(){q.editorUpload.uploadImagesAuto()},q.getParam("images_upload_timeout",30000,"number")),s.set(o))}),g&&h.$(f).attr({width:g.w,height:g.h}),h.$(f).attr({src:m.blobUri()}).removeAttr("data-mce-src")}),m})},a3=function(c,d,a,b){return function(){return c._scanForImages().then(a0(aX,c)).then(aj.blobToImageResult).then(a).then(function(e){return bR(c,e,!1,d,b)},function(e){aq(c,e)})}},aI=function(c,a,b){return function(){var d=aa.getImageSize(bH(c)),f=d?{w:d.h,h:d.w}:null;return a3(c,a,function(e){return bS.rotate(e,b)},f)()}},ca=function(a,b,c){return function(){return a3(a,b,function(d){return bS.flip(d,c)})()}},bZ=function(b,a){return function(){var d=bH(b),c=aa.getNaturalImageSize(d),e=function(f){return new bP(function(g){by(f).then(function(h){var i=aa.getNaturalImageSize(h);c.w===i.w&&c.h===i.h||aa.getImageSize(d)&&aa.setImageSize(d,i),am.revokeObjectURL(h.src),g(f)})})};aX(b).then(aj.blobToImageResult).then(a0(function(g,f){return cd.edit(g,f).then(e).then(aj.blobToImageResult).then(function(h){return bR(g,h,!0,a)},function(){})},b),function(f){aq(b,f)})}},b7=function(a,b){return a.dom.is(b,"img:not([data-mce-object],[data-mce-placeholder])")&&(af(a,b)||bB(a,b)||a.settings.imagetools_proxy)},ao=aQ,bs=function(b,a){b0.each({mceImageRotateLeft:aI(b,a,-90),mceImageRotateRight:aI(b,a,90),mceImageFlipVertical:ca(b,a,"v"),mceImageFlipHorizontal:ca(b,a,"h"),mceEditImage:bZ(b,a)},function(c,d){b.addCommand(d,c)})},au=function(c,a,b){c.on("NodeChange",function(d){var f=b.get();f&&f.src!==d.element.src&&(ao(a),c.editorUpload.uploadImagesAuto(),b.set(null)),b7(c,d.element)&&b.set(d.element)})},bU=function(a){a.addButton("rotateleft",{title:"Rotate counterclockwise",cmd:"mceImageRotateLeft"}),a.addButton("rotateright",{title:"Rotate clockwise",cmd:"mceImageRotateRight"}),a.addButton("flipv",{title:"Flip vertically",cmd:"mceImageFlipVertical"}),a.addButton("fliph",{title:"Flip horizontally",cmd:"mceImageFlipHorizontal"}),a.addButton("editimage",{title:"Edit image",cmd:"mceEditImage"}),a.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})},bX=function(a){a.addContextToolbar(a0(b7,a),a.getParam("imagetools_toolbar","rotateleft rotateright | flipv fliph | crop editimage imageoptions"))};aG.add("imagetools",function(a){var b=aJ(0),c=aJ(null);bs(a,b),bU(a),bX(a),au(a,b,c)})}();