(function(){var a=(function(){var k=function(K){var L=K;var J=function(){return L};var N=function(O){L=O};var M=function(){return k(J())};return{get:J,set:N,clone:M}};var B=tinymce.util.Tools.resolve("tinymce.PluginManager");var q=tinymce.util.Tools.resolve("tinymce.util.LocalStorage");var p=tinymce.util.Tools.resolve("tinymce.util.Tools");var D=function(J){return J.fire("RestoreDraft")};var l=function(J){return J.fire("StoreDraft")};var I=function(J){return J.fire("RemoveDraft")};var x={fireRestoreDraft:D,fireStoreDraft:l,fireRemoveDraft:I};var A=function(K,J){var L={s:1000,m:60000};K=/^(\d+)([ms]?)$/.exec(""+(K||J));return(K[2]?L[K[2]]:1)*parseInt(K,10)};var u={parse:A};var i=function(J){return J.getParam("autosave_ask_before_unload",true)};var G=function(J){var K=J.getParam("autosave_prefix","tinymce-autosave-{path}{query}{hash}-{id}-");K=K.replace(/\{path\}/g,document.location.pathname);K=K.replace(/\{query\}/g,document.location.search);K=K.replace(/\{hash\}/g,document.location.hash);K=K.replace(/\{id\}/g,J.id);return K};var g=function(J){return J.getParam("autosave_restore_when_empty",false)};var j=function(J){return u.parse(J.settings.autosave_interval,"30s")};var m=function(J){return u.parse(J.settings.autosave_retention,"20m")};var h={shouldAskBeforeUnload:i,getAutoSavePrefix:G,shouldRestoreWhenEmpty:g,getAutoSaveInterval:j,getAutoSaveRetention:m};var v=function(L,K){var J=L.settings.forced_root_block;K=p.trim(typeof K==="undefined"?L.getBody().innerHTML:K);return K===""||new RegExp("^<"+J+"[^>]*>((\xA0|&nbsp;|[ \t]|<br[^>]*>)+?|)</"+J+">|<br>$","i").test(K)};var f=function(J){var K=parseInt(q.getItem(h.getAutoSavePrefix(J)+"time"),10)||0;if(new Date().getTime()-K>h.getAutoSaveRetention(J)){z(J,false);return false}return true};var z=function(K,J){var L=h.getAutoSavePrefix(K);q.removeItem(L+"draft");q.removeItem(L+"time");if(J!==false){x.fireRemoveDraft(K)}};var d=function(J){var K=h.getAutoSavePrefix(J);if(!v(J)&&J.isDirty()){q.setItem(K+"draft",J.getContent({format:"raw",no_events:true}));q.setItem(K+"time",new Date().getTime().toString());x.fireStoreDraft(J)}};var e=function(J){var K=h.getAutoSavePrefix(J);if(f(J)){J.setContent(q.getItem(K+"draft"),{format:"raw"});x.fireRestoreDraft(J)}};var n=function(L,J){var K=h.getAutoSaveInterval(L);if(!J.get()){setInterval(function(){if(!L.removed){d(L)}},K);J.set(true)}};var r=function(J){J.undoManager.transact(function(){e(J);z(J)});J.focus()};var t={isEmpty:v,hasDraft:f,removeDraft:z,storeDraft:d,restoreDraft:e,startStoreDraft:n,restoreLastDraft:r};var E=function(K,J){return function(){var L=Array.prototype.slice.call(arguments);return K.apply(null,[J].concat(L))}};var H=function(J){return{hasDraft:E(t.hasDraft,J),storeDraft:E(t.storeDraft,J),restoreDraft:E(t.restoreDraft,J),removeDraft:E(t.removeDraft,J),isEmpty:E(t.isEmpty,J)}};var F={get:H};var o=tinymce.util.Tools.resolve("tinymce.EditorManager");o._beforeUnloadHandler=function(){var J;p.each(o.get(),function(K){if(K.plugins.autosave){K.plugins.autosave.storeDraft()}if(!J&&K.isDirty()&&h.shouldAskBeforeUnload(K)){J=K.translate("You have unsaved changes are you sure you want to navigate away?")}});return J};var y=function(J){window.onbeforeunload=o._beforeUnloadHandler};var C={setup:y};var w=function(K,J){return function(M){var L=M.control;L.disabled(!t.hasDraft(K));K.on("StoreDraft RestoreDraft RemoveDraft",function(){L.disabled(!t.hasDraft(K))});t.startStoreDraft(K,J)}};var b=function(K,J){K.addButton("restoredraft",{title:"Restore last draft",onclick:function(){t.restoreLastDraft(K)},onPostRender:w(K,J)});K.addMenuItem("restoredraft",{text:"Restore last draft",onclick:function(){t.restoreLastDraft(K)},onPostRender:w(K,J),context:"file"})};var s={register:b};B.add("autosave",function(K){var J=k(false);C.setup(K);s.register(K,J);return F.get(K)});function c(){}return c}())})();