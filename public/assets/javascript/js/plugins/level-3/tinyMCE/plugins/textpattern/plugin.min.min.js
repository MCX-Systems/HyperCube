(function(){var b=(function(){var ai=function(d){var c=d;var e=function(){return c};var f=function(h){c=h};var g=function(){return ai(e())};return{get:e,set:f,clone:g}};var aa=tinymce.util.Tools.resolve("tinymce.PluginManager");var P=function(d){var c=function(f){d.set(f)};var e=function(){return d.get()};return{setPatterns:c,getPatterns:e}};var V={get:P};var aj=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"***",end:"***",format:["bold","italic"]},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}];var ap=function(c){return c.textpattern_patterns!==undefined?c.textpattern_patterns:aj};var ak={getPatterns:ap};var X=tinymce.util.Tools.resolve("tinymce.util.Delay");var Z=tinymce.util.Tools.resolve("tinymce.util.VK");var ac=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker");var af=tinymce.util.Tools.resolve("tinymce.util.Tools");var T=function(c){return c.sort(function(d,e){if(d.start.length>e.start.length){return -1}if(d.start.length<e.start.length){return 1}return 0})};var S=function(d,c){for(var e=0;e<d.length;e++){if(c.indexOf(d[e].start)!==0){continue}if(d[e].end&&c.lastIndexOf(d[e].end)!==c.length-d[e].end.length){continue}return d[e]}};var ab=function(d,g,c,f){var e=g.substr(c-d.end.length-f,d.end.length);return e===d.end};var N=function(d,c,e){return d-c-e.end.length-e.start.length>0};var ae=function(d,g,h,f){var i,e;var c=T(d);for(e=0;e<c.length;e++){i=c[e];if(i.end!==undefined&&ab(i,g,h,f)&&N(h,f,i)){return i}}};var al={findPattern:S,findEndPattern:ae};var ag=function(d,f,c,e,g){d=e>0?d.splitText(e):d;d.splitText(c-e+f.end.length);d.deleteData(0,f.start.length);d.deleteData(d.data.length-f.end.length,f.end.length);return d};var ad=function(i,l,m){if(l.collapsed===false){return}var j=l.startContainer;var c=j.data;var d=m===true?1:0;if(j.nodeType!==3){return}var h=al.findEndPattern(i,c,l.startOffset,d);if(h===undefined){return}var e=c.lastIndexOf(h.end,l.startOffset-d);var f=c.lastIndexOf(h.start,e-h.end.length);e=c.indexOf(h.end,f+h.start.length);if(f===-1){return}var g=document.createRange();g.setStart(j,f);g.setEnd(j,e+h.end.length);var k=al.findPattern(i,g.toString());if(h===undefined||k!==h||j.data.length<=h.start.length+h.end.length){return}return{pattern:h,startOffset:f,endOffset:e}};var am=function(h,e,f,g){var d=af.isArray(f.pattern.format)?f.pattern.format:[f.pattern.format];var c=af.grep(d,function(j){var i=h.formatter.get(j);return i&&i[0].inline});if(c.length!==0){h.undoManager.transact(function(){e=ag(e,f.pattern,f.endOffset,f.startOffset,g);d.forEach(function(i){h.formatter.apply(i,{},e)})});return e}};var R=function(c,d,f){var e=c.selection.getRng(true);var g=ad(d,e,f);if(g){return am(c,e.startContainer,g,f)}};var Y=function(c,d){return R(c,d,true)};var a=function(c,d){return R(c,d,false)};var O=function(h,l){var c,i,m,e,k,d,f,g,n,o,j;c=h.selection;i=h.dom;if(!c.isCollapsed()){return}f=i.getParent(c.getStart(),"p");if(f){n=new ac(f,f);while(k=n.next()){if(k.nodeType===3){e=k;break}}if(e){g=al.findPattern(l,e.data);if(!g){return}o=c.getRng(true);m=o.startContainer;j=o.startOffset;if(e===m){j=Math.max(0,j-g.start.length)}if(af.trim(e.data).length===g.start.length){return}if(g.format){d=h.formatter.get(g.format);if(d&&d[0].block){e.deleteData(0,g.start.length);h.formatter.apply(g.format,{},e);o.setStart(m,j);o.collapse(true);c.setRng(o)}}if(g.cmd){h.undoManager.transact(function(){e.deleteData(0,g.start.length);h.execCommand(g.cmd)})}}}};var L={patternFromRng:ad,applyInlineFormatSpace:Y,applyInlineFormatEnter:a,applyBlockFormat:O};function U(c,d){var f,e;f=L.applyInlineFormatEnter(c,d);if(f){e=c.dom.createRng();e.setStart(f,f.data.length);e.setEnd(f,f.data.length);c.selection.setRng(e)}L.applyBlockFormat(c,d)}function K(h,i){var g,c,d,e,f;g=L.applyInlineFormatSpace(h,i);if(g){f=h.dom;c=g.data.slice(-1);if(/[\u00a0 ]/.test(c)){g.deleteData(g.data.length-1,1);d=f.doc.createTextNode(c);f.insertAfter(d,g.parentNode);e=f.createRng();e.setStart(d,1);e.setEnd(d,1);h.selection.setRng(e)}}}var M=function(d,f,e){for(var c=0;c<d.length;c++){if(e(d[c],f)){return true}}};var ah=function(d,c){return M(d,c,function(f,e){return f===e.keyCode&&Z.modifierPressed(e)===false})};var ao=function(c,d){return M(c,d,function(e,f){return e.charCodeAt(0)===f.charCode})};var J={handleEnter:U,handleInlineKey:K,checkCharCode:ao,checkKeyCode:ah};var Q=function(d,c){var f=[",",".",";",":","!","?"];var e=[32];d.on("keydown",function(g){if(g.keyCode===13&&!Z.modifierPressed(g)){J.handleEnter(d,c.get())}},true);d.on("keyup",function(g){if(J.checkKeyCode(e,g)){J.handleInlineKey(d,c.get())}});d.on("keypress",function(g){if(J.checkCharCode(f,g)){X.setEditorTimeout(d,function(){J.handleInlineKey(d,c.get())})}})};var W={setup:Q};aa.add("textpattern",function(d){var c=ai(ak.getPatterns(d.settings));W.setup(d,c);return V.get(c)});function an(){}return an}())})();