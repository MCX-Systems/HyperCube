(function(){var a=(function(){var S=function(){var r=[];for(var eq=0;eq<arguments.length;eq++){r[eq]=arguments[eq]}};var kP=function(eq,r){return function(){var ie=[];for(var nu=0;nu<arguments.length;nu++){ie[nu]=arguments[nu]}return eq(r.apply(null,arguments))}};var fY=function(r){return function(){return r}};var iC=function(r){return r};var mX=function(on){var r=[];for(var nu=1;nu<arguments.length;nu++){r[nu-1]=arguments[nu]}var eq=new Array(arguments.length-1);for(var ie=1;ie<arguments.length;ie++){eq[ie-1]=arguments[ie]}return function(){var ui=[];for(var yM=0;yM<arguments.length;yM++){ui[yM]=arguments[yM]}var yJ=new Array(arguments.length);for(var yK=0;yK<yJ.length;yK++){yJ[yK]=arguments[yK]}var yL=eq.concat(yJ);return on.apply(null,yL)}};var jT=function(r){return function(){var eq=[];for(var ie=0;ie<arguments.length;ie++){eq[ie]=arguments[ie]}return !r.apply(null,arguments)}};var oy=function(r){return function(){throw new Error(r)}};var eu=function(r){return r()};var qf=fY(false);var lo=fY(true);var d5=function(r){if(r===null){return"null"}var eq=typeof r;if(eq==="object"&&Array.prototype.isPrototypeOf(r)){return"array"}if(eq==="object"&&String.prototype.isPrototypeOf(r)){return"string"}return eq};var dP=function(r){return function(eq){return d5(eq)===r}};var pq=dP("string");var hh=dP("object");var w9=dP("array");var hE=dP("boolean");var kA=dP("function");var s4=dP("number");var qv=Object.prototype.hasOwnProperty;var kk=function(r,eq){return eq};var gd=function(r,eq){var ie=hh(r)&&hh(eq);return ie?eH(r,eq):eq};var q2=function(r){return function(){var yJ=new Array(arguments.length);for(var ui=0;ui<yJ.length;ui++){yJ[ui]=arguments[ui]}if(yJ.length===0){throw new Error("Can't merge zero objects")}var nu={};for(var ie=0;ie<yJ.length;ie++){var eq=yJ[ie];for(var on in eq){if(qv.call(eq,on)){nu[on]=r(nu[on],eq[on])}}}return nu}};var eH=q2(gd);var pi=q2(kk);var sn=qf;var vm=lo;var al=function(){return s5};var s5=function(){var r=function(yK){return yK.isNone()};var ie=function(yK){return yK()};var yJ=function(yK){return yK};var eq=function(){};var nu=function(){return null};var on=function(){return undefined};var ui={fold:function(yL,yK){return yL()},is:sn,isSome:sn,isNone:vm,getOr:yJ,getOrThunk:ie,getOrDie:function(yK){throw new Error(yK||"error: getOrDie called on none.")},getOrNull:nu,getOrUndefined:on,or:yJ,orThunk:ie,map:al,ap:al,each:eq,bind:al,flatten:al,exists:sn,forall:vm,filter:al,equals:r,equals_:r,toArray:function(){return[]},toString:fY("none()")};if(Object.freeze){Object.freeze(ui)}return ui}();var mM=function(r){var ui=function(){return r};var eq=function(){return ie};var nu=function(yJ){return mM(yJ(r))};var on=function(yJ){return yJ(r)};var ie={fold:function(yK,yJ){return yJ(r)},is:function(yJ){return r===yJ},isSome:vm,isNone:sn,getOr:ui,getOrThunk:ui,getOrDie:ui,getOrNull:ui,getOrUndefined:ui,or:eq,orThunk:eq,map:nu,ap:function(yJ){return yJ.fold(al,function(yK){return mM(yK(r))})},each:function(yJ){yJ(r)},bind:on,flatten:ui,exists:on,forall:on,filter:function(yJ){return yJ(r)?ie:s5},equals:function(yJ){return yJ.is(r)},equals_:function(yK,yJ){return yK.fold(sn,function(yL){return yJ(r,yL)})},toArray:function(){return[r]},toString:function(){return"some("+r+")"}};return ie};var qo=function(r){return r===null||r===undefined?s5:mM(r)};var tP={some:mM,none:al,from:qo};var ds=Object.keys;var tS=function(yJ,ui){var on=ds(yJ);for(var ie=0,eq=on.length;ie<eq;ie++){var nu=on[ie];var r=yJ[nu];ui(r,nu,yJ)}};var u5=function(eq,r){return oG(eq,function(ie,nu,on){return{k:nu,v:r(ie,nu,on)}})};var oG=function(nu,ie){var eq={};tS(nu,function(on,ui){var r=ie(on,ui,nu);eq[r.k]=r.v});return eq};var jl=function(nu,ie){var eq=[];tS(nu,function(on,r){eq.push(ie(on,r))});return eq};var ye=fY("touchstart");var bk=fY("touchmove");var lk=fY("touchend");var vx=fY("mousedown");var oc=fY("mousemove");var rg=fY("mouseup");var d8=fY("mouseover");var cS=fY("keydown");var qL=fY("input");var bh=fY("change");var tF=fY("click");var i3=fY("transitionend");var cR=fY("selectstart");var oJ=function(nu){var ie=false;var eq;return function(){var r=[];for(var on=0;on<arguments.length;on++){r[on]=arguments[on]}if(!ie){ie=true;eq=nu.apply(null,r)}return eq}};var dw=function(eq,nu){for(var ie=0;ie<eq.length;ie++){var r=eq[ie];if(r.test(nu)){return r}}return undefined};var sz=function(eq,ie){var nu=dw(eq,ie);if(!nu){return{major:0,minor:0}}var on=function(r){return Number(ie.replace(nu,"$"+r))};return uh(on(1),on(2))};var h8=function(r,eq){var ie=String(eq).toLowerCase();if(r.length===0){return mD()}return sz(r,ie)};var mD=function(){return uh(0,0)};var uh=function(r,eq){return{major:r,minor:eq}};var fL={nu:uh,detect:h8,unknown:mD};var uA="Edge";var sc="Chrome";var vQ="IE";var kL="Opera";var d0="Firefox";var uB="Safari";var wQ=function(r,eq){return function(){return eq===r}};var id=function(){return wv({current:undefined,version:fL.unknown()})};var wv=function(ie){var eq=ie.current;var r=ie.version;return{current:eq,version:r,isEdge:wQ(uA,eq),isChrome:wQ(sc,eq),isIE:wQ(vQ,eq),isOpera:wQ(kL,eq),isFirefox:wQ(d0,eq),isSafari:wQ(uB,eq)}};var dO={unknown:id,nu:wv,edge:fY(uA),chrome:fY(sc),ie:fY(vQ),opera:fY(kL),firefox:fY(d0),safari:fY(uB)};var rA="Windows";var ya="iOS";var s1="Android";var pN="Linux";var bm="OSX";var q8="Solaris";var C="FreeBSD";var ot=function(r,eq){return function(){return eq===r}};var ic=function(){return wt({current:undefined,version:fL.unknown()})};var wt=function(ie){var eq=ie.current;var r=ie.version;return{current:eq,version:r,isWindows:ot(rA,eq),isiOS:ot(ya,eq),isAndroid:ot(s1,eq),isOSX:ot(bm,eq),isLinux:ot(pN,eq),isSolaris:ot(q8,eq),isFreeBSD:ot(C,eq)}};var bJ={unknown:ic,nu:wt,windows:fY(rA),ios:fY(ya),android:fY(s1),linux:fY(pN),osx:fY(bm),solaris:fY(q8),freebsd:fY(C)};function xd(on,ui,yN){var eq=on.isiOS()&&/ipad/i.test(yN)===true;var ie=on.isiOS()&&!eq;var yM=on.isAndroid()&&on.version.major===3;var yL=on.isAndroid()&&on.version.major===4;var yJ=eq||yM||yL&&/mobile/i.test(yN)===true;var nu=on.isiOS()||on.isAndroid();var yK=nu&&!yJ;var r=ui.isSafari()&&on.isiOS()&&/safari/i.test(yN)===false;return{isiPad:fY(eq),isiPhone:fY(ie),isTablet:fY(yJ),isPhone:fY(yK),isTouch:fY(nu),isAndroid:on.isAndroid,isiOS:on.isiOS,isWebView:fY(r)}}var aI=function(){var eq=Array.prototype.indexOf;var r=function(on,nu){return eq.call(on,nu)};var ie=function(on,nu){return km(on,nu)};return eq===undefined?ie:r}();var hZ=function(eq,r){return aI(eq,r)>-1};var h5=function(eq,r){return qx(eq,r).isSome()};var r5=function(nu,yJ){var ie=nu.length;var ui=new Array(ie);for(var on=0;on<ie;on++){var eq=nu[on];ui[on]=yJ(eq,on,nu)}return ui};var kV=function(ie,on){for(var nu=0,eq=ie.length;nu<eq;nu++){var r=ie[nu];on(r,nu,ie)}};var v7=function(eq,nu){for(var ie=eq.length-1;ie>=0;ie--){var r=eq[ie];nu(r,ie,eq)}};var l9=function(on,nu){var yJ=[];for(var ui=0,ie=on.length;ui<ie;ui++){var eq=on[ui];if(nu(eq,ui,on)){yJ.push(eq)}}return yJ};var oi=function(r,ie,eq){v7(r,function(nu){eq=ie(eq,nu)});return eq};var ok=function(r,ie,eq){kV(r,function(nu){eq=ie(eq,nu)});return eq};var sy=function(nu,ie){for(var on=0,eq=nu.length;on<eq;on++){var r=nu[on];if(ie(r,on,nu)){return tP.some(r)}}return tP.none()};var qx=function(nu,ie){for(var on=0,eq=nu.length;on<eq;on++){var r=nu[on];if(ie(r,on,nu)){return tP.some(on)}}return tP.none()};var km=function(ie,eq){for(var nu=0,r=ie.length;nu<r;++nu){if(ie[nu]===eq){return nu}}return -1};var qG=Array.prototype.push;var jW=function(ie){var on=[];for(var nu=0,eq=ie.length;nu<eq;++nu){if(!Array.prototype.isPrototypeOf(ie[nu])){throw new Error("Arr.flatten item "+nu+" was not an array, input: "+ie)}qG.apply(on,ie[nu])}return on};var hw=function(eq,ie){var r=r5(eq,ie);return jW(r)};var t0=function(nu,ie){for(var on=0,eq=nu.length;on<eq;++on){var r=nu[on];if(ie(r,on,nu)!==true){return false}}return true};var f7=Array.prototype.slice;var mb=function(eq){var ie=f7.call(eq,0);ie.reverse();return ie};var V=function(eq,r){return l9(eq,function(ie){return !hZ(r,ie)})};var qT=function(r){return[r]};var rZ=kA(Array.from)?Array.from:function(r){return f7.call(r)};var I=function(ie,eq){var r=String(eq).toLowerCase();return sy(ie,function(nu){return nu.search(r)})};var uW=function(r,eq){return I(r,eq).map(function(nu){var ie=fL.detect(nu.versionRegexes,eq);return{current:nu.name,version:ie}})};var m7=function(eq,r){return I(eq,r).map(function(nu){var ie=fL.detect(nu.versionRegexes,r);return{current:nu.name,version:ie}})};var i9={detectBrowser:uW,detectOs:m7};var ff=function(ie,eq,nu){if(eq===""){return true}if(ie.length<eq.length){return false}var r=ie.substr(nu,nu+eq.length);return r===eq};var wO=function(ie,r){var eq=function(nu){var on=typeof nu;return on==="string"||on==="number"};return ie.replace(/\$\{([^{}]*)\}/g,function(ui,nu){var on=r[nu];return eq(on)?on.toString():ui})};var qn=function(eq,r){return eq.indexOf(r)!==-1};var vO=function(eq,r){return ff(eq,r,eq.length-r.length)};var wW=function(r){return r.replace(/^\s+|\s+$/g,"")};var wm=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/;var f5=function(r){return function(eq){return qn(eq,r)}};var jR=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(eq){var r=qn(eq,"edge/")&&qn(eq,"chrome")&&qn(eq,"safari")&&qn(eq,"applewebkit");return r}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,wm],search:function(r){return qn(r,"chrome")&&!qn(r,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(r){return qn(r,"msie")||qn(r,"trident")}},{name:"Opera",versionRegexes:[wm,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:f5("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:f5("firefox")},{name:"Safari",versionRegexes:[wm,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(r){return(qn(r,"safari")||qn(r,"mobile/"))&&qn(r,"applewebkit")}}];var dY=[{name:"Windows",search:f5("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(r){return qn(r,"iphone")||qn(r,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:f5("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:f5("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:f5("linux"),versionRegexes:[]},{name:"Solaris",search:f5("sunos"),versionRegexes:[]},{name:"FreeBSD",search:f5("freebsd"),versionRegexes:[]}];var qC={browsers:fY(jR),oses:fY(dY)};var G=function(on){var r=qC.browsers();var ui=qC.oses();var eq=i9.detectBrowser(r,on).fold(dO.unknown,dO.nu);var nu=i9.detectOs(ui,on).fold(bJ.unknown,bJ.nu);var ie=xd(nu,eq,on);return{browser:eq,os:nu,deviceType:ie}};var nK={detect:G};var F=oJ(function(){var r=navigator.userAgent;return nK.detect(r)});var jz={detect:F};var e2={tap:fY("alloy.tap")};var j=fY("alloy.focus");var qQ=fY("alloy.blur.post");var ai=fY("alloy.receive");var xi=fY("alloy.execute");var jm=fY("alloy.focus.item");var p5=e2.tap;var ip=jz.detect().deviceType.isTouch()?e2.tap:tF;var du=fY("alloy.longpress");var vD=fY("alloy.system.init");var xv=fY("alloy.system.scroll");var o4=fY("alloy.system.attached");var ry=fY("alloy.system.detached");var J=function(r,eq){cu(r,r.element(),eq,{})};var b8=function(r,ie,eq){cu(r,r.element(),ie,eq)};var r1=function(r){J(r,xi())};var sg=function(r,ie,eq){cu(r,ie,eq,{})};var cu=function(r,on,ie,eq){var nu=eH({target:on},eq);r.getSystem().triggerEvent(ie,on,u5(nu,fY))};var kO=function(r,nu,ie,eq){r.getSystem().triggerEvent(ie,nu,eq.event())};var ew=function(r,eq){r.getSystem().triggerFocus(eq,r.element())};var sT=function(r,eq){var ie=eq||document;var nu=ie.createElement("div");nu.innerHTML=r;if(!nu.hasChildNodes()||nu.childNodes.length>1){console.error("HTML does not have a single root node",r);throw"HTML must have a single root node"}return ob(nu.childNodes[0])};var rn=function(r,eq){var nu=eq||document;var ie=nu.createElement(r);return ob(ie)};var xQ=function(nu,r){var ie=r||document;var eq=ie.createTextNode(nu);return ob(eq)};var ob=function(r){if(r===null||r===undefined){throw new Error("Node cannot be null or undefined")}return{dom:fY(r)}};var n0=function(eq,r,nu){var ie=eq.dom();return tP.from(ie.elementFromPoint(r,nu)).map(ob)};var pO={fromHtml:sT,fromTag:rn,fromText:xQ,fromDom:ob,fromPoint:n0};var us={ATTRIBUTE:Node.ATTRIBUTE_NODE,CDATA_SECTION:Node.CDATA_SECTION_NODE,COMMENT:Node.COMMENT_NODE,DOCUMENT:Node.DOCUMENT_NODE,DOCUMENT_TYPE:Node.DOCUMENT_TYPE_NODE,DOCUMENT_FRAGMENT:Node.DOCUMENT_FRAGMENT_NODE,ELEMENT:Node.ELEMENT_NODE,TEXT:Node.TEXT_NODE,PROCESSING_INSTRUCTION:Node.PROCESSING_INSTRUCTION_NODE,ENTITY_REFERENCE:Node.ENTITY_REFERENCE_NODE,ENTITY:Node.ENTITY_NODE,NOTATION:Node.NOTATION_NODE};var ke=function(eq){var ie=eq.dom().nodeName;return ie.toLowerCase()};var p6=function(r){return r.dom().nodeType};var pV=function(r){return r.dom().nodeValue};var ac=function(r){return function(eq){return p6(eq)===r}};var fm=function(r){return p6(r)===us.COMMENT||ke(r)==="#comment"};var fS=ac(us.ELEMENT);var hQ=ac(us.TEXT);var qI=ac(us.DOCUMENT);var iI={name:ke,type:p6,value:pV,isElement:fS,isText:hQ,isDocument:qI,isComment:fm};var o1=function(r){var eq=iI.isText(r)?r.dom().parentNode:r.dom();return eq!==undefined&&eq!==null&&eq.ownerDocument.body.contains(eq)};var mF=oJ(function(){return e7(pO.fromDom(document))});var e7=function(eq){var r=eq.dom().body;if(r===null||r===undefined){throw"Body is not available yet"}return pO.fromDom(r)};var r8={body:mF,getBody:e7,inBody:o1};var lG=function(){var r=[];for(var eq=0;eq<arguments.length;eq++){r[eq]=arguments[eq]}return function(){var ie=[];for(var nu=0;nu<arguments.length;nu++){ie[nu]=arguments[nu]}if(r.length!==ie.length){throw new Error('Wrong number of arguments to struct. Expected "['+r.length+']", got '+ie.length+" arguments")}var on={};kV(r,function(ui,yJ){on[ui]=fY(ie[yJ])});return on}};var es=function(r){return r.slice(0).sort()};var mt=function(eq,r){throw new Error("All required keys ("+es(eq).join(", ")+") were not specified. Specified keys were: "+es(r).join(", ")+".")};var o2=function(r){throw new Error("Unsupported keys for object: "+es(r).join(", "))};var rD=function(r,eq){if(!w9(eq)){throw new Error("The "+r+" fields must be an array. Was: "+eq+".")}kV(eq,function(ie){if(!pq(ie)){throw new Error("The value "+ie+" in the "+r+" fields was not a string.")}})};var cc=function(r,eq){throw new Error("All values need to be of type: "+eq+". Keys ("+es(r).join(", ")+") were not.")};var qU=function(ie){var r=es(ie);var eq=sy(r,function(on,nu){return nu<r.length-1&&on===r[nu+1]});eq.each(function(nu){throw new Error("The field: "+nu+" occurs more than once in the combined fields: ["+r.join(", ")+"].")})};var c9=function(ie,r){var eq=ie.concat(r);if(eq.length===0){throw new Error("You must specify at least one required or optional field.")}rD("required",ie);rD("optional",r);qU(eq);return function(yK){var nu=ds(yK);var on=t0(ie,function(yL){return hZ(nu,yL)});if(!on){mt(ie,nu)}var yJ=l9(nu,function(yL){return !hZ(eq,yL)});if(yJ.length>0){o2(yJ)}var ui={};kV(ie,function(yL){ui[yL]=fY(yK[yL])});kV(r,function(yL){ui[yL]=fY(Object.prototype.hasOwnProperty.call(yK,yL)?tP.some(yK[yL]):tP.none())});return ui}};var x5=function(on,nu){var ie=[];var eq=function(r){ie.push(r);return nu(r)};var ui=nu(on);do{ui=ui.bind(eq)}while(ui.isSome());return ie};var dn={toArray:x5};var oO=typeof window!=="undefined"?window:Function("return this;")();var xq=function(ie,eq){var nu=eq!==undefined&&eq!==null?eq:oO;for(var r=0;r<ie.length&&nu!==undefined&&nu!==null;++r){nu=nu[ie[r]]}return nu};var mh=function(ie,r){var eq=ie.split(".");return xq(eq,r)};var oU=function(r,eq){return mh(r,eq)};var vo=function(r,eq){var ie=oU(r,eq);if(ie===undefined||ie===null){throw r+" not available on this browser"}return ie};var bY={getOrDie:vo};var da=function(){var r=bY.getOrDie("Node");return r};var t2=function(eq,r,ie){return(eq.compareDocumentPosition(r)&ie)!==0};var tJ=function(eq,r){return t2(eq,r,da().DOCUMENT_POSITION_PRECEDING)};var k2=function(eq,r){return t2(eq,r,da().DOCUMENT_POSITION_CONTAINED_BY)};var g8={documentPositionPreceding:tJ,documentPositionContainedBy:k2};var oI=us.ELEMENT;var gs=us.DOCUMENT;var vH=function(eq,r){var ie=eq.dom();if(ie.nodeType!==oI){return false}else{if(ie.matches!==undefined){return ie.matches(r)}else{if(ie.msMatchesSelector!==undefined){return ie.msMatchesSelector(r)}else{if(ie.webkitMatchesSelector!==undefined){return ie.webkitMatchesSelector(r)}else{if(ie.mozMatchesSelector!==undefined){return ie.mozMatchesSelector(r)}else{throw new Error("Browser lacks native selectors")}}}}}};var vz=function(r){return r.nodeType!==oI&&r.nodeType!==gs||r.childElementCount===0};var mi=function(r,eq){var ie=eq===undefined?document:eq.dom();return vz(ie)?[]:r5(ie.querySelectorAll(r),pO.fromDom)};var cG=function(r,eq){var ie=eq===undefined?document:eq.dom();return vz(ie)?tP.none():tP.from(ie.querySelector(r)).map(pO.fromDom)};var iV={all:mi,is:vH,one:cG};var wU=function(eq,r){return eq.dom()===r.dom()};var hu=function(eq,r){return eq.dom().isEqualNode(r.dom())};var jh=function(r,eq){return h5(eq,mX(wU,r))};var sE=function(nu,ie){var eq=nu.dom(),r=ie.dom();return eq===r?false:eq.contains(r)};var pB=function(eq,r){return g8.documentPositionContainedBy(eq.dom(),r.dom())};var ri=jz.detect().browser;var qk=ri.isIE()?pB:sE;var gb={eq:wU,isEqualNode:hu,member:jh,contains:qk,is:iV.is};var uq=function(r){return pO.fromDom(r.dom().ownerDocument)};var qK=function(r){return pO.fromDom(r.dom().ownerDocument.documentElement)};var xN=function(r){var eq=r.dom();var ie=eq.ownerDocument.defaultView;return pO.fromDom(ie)};var lR=function(r){var eq=r.dom();return tP.from(eq.parentNode).map(pO.fromDom)};var xh=function(r){return lR(r).bind(function(ie){var eq=nW(ie);return qx(eq,function(nu){return gb.eq(r,nu)})})};var aG=function(nu,r){var ie=kA(r)?r:fY(false);var yJ=nu.dom();var eq=[];while(yJ.parentNode!==null&&yJ.parentNode!==undefined){var ui=yJ.parentNode;var on=pO.fromDom(ui);eq.push(on);if(ie(on)===true){break}else{yJ=ui}}return eq};var lp=function(eq){var r=function(ie){return l9(ie,function(nu){return !gb.eq(eq,nu)})};return lR(eq).map(nW).map(r).getOr([])};var i7=function(r){var eq=r.dom();return tP.from(eq.offsetParent).map(pO.fromDom)};var gE=function(r){var eq=r.dom();return tP.from(eq.previousSibling).map(pO.fromDom)};var cE=function(r){var eq=r.dom();return tP.from(eq.nextSibling).map(pO.fromDom)};var qu=function(r){return mb(dn.toArray(r,gE))};var Z=function(r){return dn.toArray(r,cE)};var nW=function(r){var eq=r.dom();return r5(eq.childNodes,pO.fromDom)};var mI=function(ie,r){var eq=ie.dom().childNodes;return tP.from(eq[r]).map(pO.fromDom)};var tO=function(r){return mI(r,0)};var iw=function(r){return mI(r,r.dom().childNodes.length-1)};var qr=function(r){return r.dom().childNodes.length};var mo=function(r){return r.dom().hasChildNodes()};var eX=lG("element","offset");var qy=function(r,ie){var eq=nW(r);return eq.length>0&&ie<eq.length?eX(eq[ie],0):eX(r,ie)};var yb={owner:uq,defaultView:xN,documentElement:qK,parent:lR,findIndex:xh,parents:aG,siblings:lp,prevSibling:gE,offsetParent:i7,prevSiblings:qu,nextSibling:cE,nextSiblings:Z,children:nW,child:mI,firstChild:tO,lastChild:iw,childNodesCount:qr,hasChildNodes:mo,leaf:qy};var qY=function(r,eq){var ie=yb.parent(r);ie.each(function(nu){nu.dom().insertBefore(eq.dom(),r.dom())})};var B=function(r,eq){var ie=yb.nextSibling(r);ie.fold(function(){var nu=yb.parent(r);nu.each(function(on){ia(on,eq)})},function(nu){qY(nu,eq)})};var lH=function(eq,r){var ie=yb.firstChild(eq);ie.fold(function(){ia(eq,r)},function(nu){eq.dom().insertBefore(r.dom(),nu.dom())})};var ia=function(eq,r){eq.dom().appendChild(r.dom())};var ng=function(ie,eq,r){yb.child(ie,r).fold(function(){ia(ie,eq)},function(nu){qY(nu,eq)})};var wb=function(r,eq){qY(r,eq);ia(eq,r)};var vA={before:qY,after:B,prepend:lH,append:ia,appendAt:ng,wrap:wb};var uQ=function(r,eq){kV(eq,function(ie){vA.before(r,ie)})};var lv=function(r,eq){kV(eq,function(ie,nu){var on=nu===0?r:eq[nu-1];vA.after(on,ie)})};var dj=function(r,eq){kV(eq.slice().reverse(),function(ie){vA.prepend(r,ie)})};var ve=function(r,eq){kV(eq,function(ie){vA.append(r,ie)})};var nU={before:uQ,after:lv,prepend:dj,append:ve};var hn=function(r){r.dom().textContent="";kV(yb.children(r),function(eq){bj(eq)})};var bj=function(r){var eq=r.dom();if(eq.parentNode!==null){eq.parentNode.removeChild(eq)}};var m2=function(eq){var r=yb.children(eq);if(r.length>0){nU.before(eq,r)}bj(eq)};var q0={empty:hn,remove:bj,unwrap:m2};var cb=function(r){J(r,ry());var eq=r.components();kV(eq,cb)};var jQ=function(r){var eq=r.components();kV(eq,jQ);J(r,o4())};var A=function(r,eq){mc(r,eq,vA.append)};var mc=function(r,ie,eq){r.getSystem().addToWorld(ie);eq(r.element(),ie.element());if(r8.inBody(r.element())){jQ(ie)}r.syncComponents()};var hm=function(r){cb(r);q0.remove(r.element());r.getSystem().removeFromWorld(r)};var od=function(r){var eq=yb.parent(r.element()).bind(function(ie){return r.getSystem().getByDom(ie).fold(tP.none,tP.some)});hm(r);eq.each(function(ie){ie.syncComponents()})};var qw=function(r){var eq=r.components();kV(eq,hm);q0.empty(r.element());r.syncComponents()};var oq=function(eq,ie){vA.append(eq,ie.element());var r=yb.children(ie.element());kV(r,function(nu){ie.getByDom(nu).each(jQ)})};var o7=function(ie){var ui=function(yO){return ie===yO};var on=function(yO){return o7(ie)};var nu=function(yO){return o7(ie)};var r=function(yO){return o7(yO(ie))};var yM=function(yO){yO(ie)};var yK=function(yO){return yO(ie)};var yJ=function(yO,yP){return yP(ie)};var yN=function(yO){return yO(ie)};var yL=function(yO){return yO(ie)};var eq=function(){return tP.some(ie)};return{is:ui,isValue:lo,isError:qf,getOr:fY(ie),getOrThunk:fY(ie),getOrDie:fY(ie),or:on,orThunk:nu,fold:yJ,map:r,each:yM,bind:yK,exists:yN,forall:yL,toOption:eq}};var fE=function(on){var nu=function(yL){return yL()};var r=function(){return oy(String(on))()};var yJ=function(yL){return yL};var ie=function(yL){return yL()};var ui=function(yL){return fE(on)};var yK=function(yL){return fE(on)};var eq=function(yM,yL){return yM(on)};return{is:qf,isValue:qf,isError:lo,getOr:iC,getOrThunk:nu,getOrDie:r,or:yJ,orThunk:ie,fold:eq,map:ui,each:S,bind:yK,exists:qf,forall:lo,toOption:tP.none}};var l7={value:o7,error:fE};var ho=function(eq){if(!w9(eq)){throw new Error("cases must be an array")}if(eq.length===0){throw new Error("there must be at least one case")}var ie=[];var r={};kV(eq,function(on,yJ){var nu=ds(on);if(nu.length!==1){throw new Error("one and only one name per case")}var ui=nu[0];var yK=on[ui];if(r[ui]!==undefined){throw new Error("duplicate key detected:"+ui)}else{if(ui==="cata"){throw new Error("cannot have a case named cata (sorry)")}else{if(!w9(yK)){throw new Error("case arguments must be an array")}}}ie.push(ui);r[ui]=function(){var yO=arguments.length;if(yO!==yK.length){throw new Error("Wrong number of arguments to case "+ui+". Expected "+yK.length+" ("+yK+"), got "+yO)}var yM=new Array(yO);for(var yN=0;yN<yM.length;yN++){yM[yN]=arguments[yN]}var yL=function(yP){var yQ=ds(yP);if(ie.length!==yQ.length){throw new Error("Wrong number of arguments to match. Expected: "+ie.join(",")+"\nActual: "+yQ.join(","))}var yR=t0(ie,function(yS){return hZ(yQ,yS)});if(!yR){throw new Error("Not all branches were specified when using match. Specified: "+yQ.join(", ")+"\nRequired: "+ie.join(", "))}return yP[ui].apply(null,yM)};return{fold:function(){if(arguments.length!==eq.length){throw new Error("Wrong number of arguments to fold. Expected "+eq.length+", got "+arguments.length)}var yP=arguments[yJ];return yP.apply(null,yM)},match:yL,log:function(yP){console.log(yP,{constructors:ie,constructor:ui,params:yM})}}}});return r};var ox={generate:ho};var n3=ox.generate([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]);var aq=function(r){return n3.defaultedThunk(fY(r))};var cn=function(r){return n3.mergeWithThunk(fY(r))};var il=n3.strict;var lO=n3.asOption;var pD=n3.defaultedThunk;var hL=n3.asDefaultedOptionThunk;var ky=n3.mergeWithThunk;var u8=ox.generate([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);var yd=function(eq){var ie=[];var r=[];kV(eq,function(nu){nu.fold(function(on){ie.push(on)},function(on){r.push(on)})});return{errors:ie,values:r}};var q6=function(r,eq){return l7.value(eH.apply(undefined,[eq].concat(r)))};var tg=function(r){return kP(l7.error,jW)(r)};var kC=function(ie,eq){var r=yd(ie);return r.errors.length>0?tg(r.errors):q6(r.values,eq)};var pE=function(eq){var r=yd(eq);return r.errors.length>0?tg(r.errors):l7.value(r.values)};var iD={consolidateObj:kC,consolidateArr:pE};var f1=function(nu,eq){var ie={};kV(eq,function(r){if(nu[r]!==undefined&&nu.hasOwnProperty(r)){ie[r]=nu[r]}});return ie};var f2=function(nu,eq){var ie={};tS(nu,function(on,r){if(!hZ(eq,r)){ie[r]=on}});return ie};var iU=function(r){return function(eq){return eq.hasOwnProperty(r)?tP.from(eq[r]):tP.none()}};var g6=function(r,eq){return function(ie){return iU(r)(ie).getOr(eq)}};var jX=function(eq,r){return iU(r)(eq)};var iT=function(eq,r){return eq.hasOwnProperty(r)&&eq[r]!==undefined&&eq[r]!==null};var lY=function(eq,nu){var ie={};ie[eq]=nu;return ie};var lj=function(eq){var ie={};kV(eq,function(r){ie[r.key]=r.value});return ie};var uu=function(eq,r){return f1(eq,r)};var ov=function(eq,r){return f2(eq,r)};var j1=function(r){return iU(r)};var hc=function(r,eq){return g6(r,eq)};var fr=function(eq,r){return jX(eq,r)};var lX=function(r,eq){return lY(r,eq)};var kN=function(r){return lj(r)};var gj=function(eq,r){return iD.consolidateObj(eq,r)};var p3=function(eq,r){return iT(eq,r)};var e0=ox.generate([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]);var br=ox.generate([{field:["name","presence","type"]},{state:["name"]}]);var nD=function(){return bY.getOrDie("JSON")};var dE=function(r){return nD().parse(r)};var px=function(ie,r,eq){return nD().stringify(ie,r,eq)};var sI={parse:dE,stringify:px};var ul=function(r){return hh(r)&&ds(r).length>100?" removed due to size":sI.stringify(r,null,2)};var nT=function(eq){var r=eq.length>10?eq.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):eq;return r5(r,function(ie){return"Failed path: ("+ie.path.join(" > ")+")\n"+ie.getErrorInfo()})};var ws=function(eq,r){return l7.error([{path:eq,getErrorInfo:r}])};var sd=function(ie,r,eq){return ws(ie,function(){return'Could not find valid *strict* value for "'+r+'" in '+ul(eq)})};var ex=function(eq,r){return ws(eq,function(){return'Choice schema did not contain choice key: "'+r+'"'})};var qF=function(ie,r,eq){return ws(ie,function(){return'The chosen schema: "'+eq+'" did not exist in branches: '+ul(r)})};var kW=function(eq,r){return ws(eq,function(){return"There are unsupported fields: ["+r.join(", ")+"] specified"})};var bS=function(eq,r){return ws(eq,function(){return r})};var b6=ox.generate([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]);var ny=function(ie,eq,r){return jX(eq,r).fold(function(){return sd(ie,r,eq)},l7.value)};var uY=function(nu,ie,r){var eq=jX(nu,ie).fold(function(){return r(nu)},iC);return l7.value(eq)};var wI=function(eq,r){return l7.value(jX(eq,r))};var ir=function(ie,eq,nu){var r=jX(ie,eq).map(function(on){return on===true?nu(ie):on});return l7.value(r)};var rf=function(ie,eq,r,nu){return r.fold(function(yL,ui,yK,yM){var on=function(yN){return yM.extract(ie.concat([yL]),nu,yN).map(function(yO){return lY(ui,nu(yO))})};var yJ=function(yN){return yN.fold(function(){var yO=lY(ui,nu(tP.none()));return l7.value(yO)},function(yO){return yM.extract(ie.concat([yL]),nu,yO).map(function(yP){return lY(ui,nu(tP.some(yP)))})})};return function(){return yK.fold(function(){return ny(ie,eq,yL).bind(on)},function(yN){return uY(eq,yL,yN).bind(on)},function(){return wI(eq,yL).bind(yJ)},function(yN){return ir(eq,yL,yN).bind(yJ)},function(yN){var yO=yN(eq);return uY(eq,yL,fY({})).map(function(yP){return eH(yO,yP)}).bind(on)})}()},function(on,yJ){var ui=yJ(eq);return l7.value(lY(on,nu(ui)))})};var g3=function(nu,ie,r,on){var eq=r5(r,function(ui){return rf(nu,ie,ui,on)});return iD.consolidateObj(eq,{})};var o5=function(eq){var ie=function(on,yJ,ui){return eq(ui,yJ).fold(function(yK){return bS(on,yK)},l7.value)};var nu=function(){return"val"};var r=function(){return e0.itemOf(eq)};return{extract:ie,toString:nu,toDsl:r}};var vT=function(eq){var r=ds(eq);return l9(r,function(ie){return p3(eq,ie)})};var ih=function(r){var eq=aL(r);var nu=oi(r,function(ui,on){return on.fold(function(yJ){return eH(ui,lX(yJ,true))},fY(ui))},{});var ie=function(yJ,yL,yK){var ui=hE(yK)?[]:vT(yK);var on=l9(ui,function(yM){return !p3(nu,yM)});return on.length===0?eq.extract(yJ,yL,yK):kW(yJ,on)};return{extract:ie,toString:eq.toString,toDsl:eq.toDsl}};var aL=function(r){var ie=function(on,yJ,ui){return g3(on,ui,r,yJ)};var nu=function(){var on=r5(r,function(ui){return ui.fold(function(yL,yJ,yK,yM){return yL+" -> "+yM.toString()},function(yJ,yK){return"state("+yJ+")"})});return"obj{\n"+on.join("\n")+"}"};var eq=function(){return e0.objOf(r5(r,function(on){return on.fold(function(yK,ui,yJ,yL){return br.field(yK,yJ,yL)},function(ui,yJ){return br.state(ui)})}))};return{extract:ie,toString:nu,toDsl:eq}};var k1=function(nu){var eq=function(ui,yJ,yK){var on=r5(yK,function(yL,yM){return nu.extract(ui.concat(["["+yM+"]"]),yJ,yL)});return iD.consolidateArr(on)};var ie=function(){return"array("+nu.toString()+")"};var r=function(){return e0.arrOf(nu)};return{extract:eq,toString:ie,toDsl:r}};var wi=function(eq,ui){var nu=function(yK,yJ){return k1(o5(eq)).extract(yK,iC,yJ)};var ie=function(yK,yM,yL){var yJ=ds(yL);return nu(yK,yJ).bind(function(yO){var yN=r5(yO,function(yP){return b6.field(yP,yP,il(),ui)});return aL(yN).extract(yK,yM,yL)})};var on=function(){return"setOf("+ui.toString()+")"};var r=function(){return e0.setOf(eq,ui)};return{extract:ie,toString:on,toDsl:r}};var kK=fY(o5(l7.value));var yc=b6.state;var wq=b6.field;var h1=function(on,ui,ie,eq,nu){var r=fr(eq,nu);return r.fold(function(){return qF(on,eq,nu)},function(yJ){return aL(yJ).extract(on.concat(["branch: "+nu]),ui,ie)})};var ti=function(ie,r){var nu=function(yK,yL,yJ){var ui=fr(yJ,ie);return ui.fold(function(){return ex(yK,ie)},function(yM){return h1(yK,yL,yJ,r,yM)})};var on=function(){return"chooseOn("+ie+"). Possible values: "+ds(r)};var eq=function(){return e0.choiceOf(ie,r)};return{extract:nu,toString:on,toDsl:eq}};var jy=o5(l7.value);var ev=function(r){return o5(function(eq){return r(eq)})};var N=function(r,nu,ie,eq){return nu.extract([r],ie,eq).fold(function(on){return l7.error({input:eq,errors:on})},l7.value)};var p7=function(r,ie,eq){return N(r,ie,fY,eq)};var nL=function(r,ie,eq){return N(r,ie,iC,eq)};var lx=function(r){return r.fold(function(eq){throw new Error(fP(eq))},iC)};var rF=function(r,ie,eq){return lx(nL(r,ie,eq))};var fX=function(r,ie,eq){return lx(p7(r,ie,eq))};var fP=function(r){return"Errors: \n"+nT(r.errors)+"\n\nInput object: "+ul(r.input)};var c5=function(eq,r){return ti(eq,r)};var r2=fY(jy);var pj=function(eq,r){return o5(function(ie){var nu=typeof ie;return eq(ie)?l7.value(ie):l7.error("Expected type: "+r+" but got: "+nu)})};var n7=pj(kA,"function");var o=function(r){return wq(r,r,il(),kK())};var m4=function(r,eq){return wq(r,r,il(),eq)};var hs=function(r){return m4(r,n7)};var m8=function(r,eq){return wq(r,r,lO(),o5(function(ie){return l7.error("The field: "+r+" is forbidden. "+eq)}))};var xY=function(r,eq){return wq(r,r,il(),aL(eq))};var jr=function(r){return wq(r,r,lO(),kK())};var x4=function(r,eq){return wq(r,r,lO(),eq)};var d6=function(r,eq){return wq(r,r,lO(),aL(eq))};var rH=function(r,eq){return wq(r,r,lO(),ih(eq))};var qA=function(r,eq){return wq(r,r,aq(eq),kK())};var fV=function(r,ie,eq){return wq(r,r,aq(ie),eq)};var fI=function(r,ie,eq){return wq(r,r,aq(ie),aL(eq))};var bf=function(r,eq){return yc(r,eq)};var k6=function(r,eq){return gb.eq(r.element(),eq.event().target())};var wr=function(r){if(!p3(r,"can")&&!p3(r,"abort")&&!p3(r,"run")){throw new Error("EventHandler defined by: "+sI.stringify(r,null,2)+" does not have can, abort, or run!")}return rF("Extracting event.handler",ih([qA("can",fY(true)),qA("abort",fY(false)),qA("run",S)]),r)};var yo=function(r,eq){return function(){var ie=[];for(var nu=0;nu<arguments.length;nu++){ie[nu]=arguments[nu]}return ok(r,function(ui,on){return ui&&eq(on).apply(undefined,ie)},true)}};var lS=function(r,eq){return function(){var ie=[];for(var nu=0;nu<arguments.length;nu++){ie[nu]=arguments[nu]}return ok(r,function(ui,on){return ui||eq(on).apply(undefined,ie)},false)}};var lV=function(r){return kA(r)?{can:fY(true),abort:fY(false),run:r}:r};var qO=function(r){var eq=yo(r,function(on){return on.can});var nu=lS(r,function(on){return on.abort});var ie=function(){var on=[];for(var ui=0;ui<arguments.length;ui++){on[ui]=arguments[ui]}kV(r,function(yJ){yJ.run.apply(undefined,on)})};return wr({can:eq,abort:nu,run:ie})};var hf=function(r){return kN(r)};var fT=function(eq,r){return{key:eq,value:wr({abort:r})}};var n=function(eq,r){return{key:eq,value:wr({can:r})}};var cv=function(r,eq){return{key:r,value:wr({run:eq})}};var m0=function(eq,ie,r){return{key:eq,value:wr({run:function(nu){ie.apply(undefined,[nu].concat(r))}})}};var ce=function(r){return function(eq){return cv(r,eq)}};var nH=function(r){return function(eq){return{key:r,value:wr({run:function(ie,nu){if(k6(ie,nu)){eq(ie,nu)}}})}}};var tb=function(r,eq){return cv(r,function(ie,nu){ie.getSystem().getByUid(eq).each(function(on){kO(on,on.element(),r,nu)})})};var mG=function(eq,nu,r){var ie=nu.partUids()[r];return tb(eq,ie)};var kD=function(r,eq){return cv(r,function(ie,on){var nu=on.event();ie.getSystem().getByDom(nu.target()).each(function(ui){eq(ie,ui,on)})})};var lD=function(r){return cv(r,function(eq,ie){ie.cut()})};var oD=function(r){return cv(r,function(eq,ie){ie.stop()})};var eQ=nH(o4());var bo=nH(ry());var nt=nH(vD());var oS=ce(xi());var p9=function(yJ,eq,r){var nu=r.toString();var ui=nu.indexOf(")")+1;var ie=nu.indexOf("(");var on=nu.substring(ie+1,ui-1).split(/,\s*/);yJ.toFunctionAnnotation=function(){return{name:eq,parameters:wF(on.slice(0,1).concat(on.slice(3)))}};return yJ};var wF=function(r){return r5(r,function(eq){return vO(eq,"/*")?eq.substring(0,eq.length-"/*".length):eq})};var r7=function(ui,r){var ie=ui.toString();var on=ie.indexOf(")")+1;var eq=ie.indexOf("(");var nu=ie.substring(eq+1,on-1).split(/,\s*/);ui.toFunctionAnnotation=function(){return{name:r,parameters:wF(nu)}};return ui};var bE=function(ui,r){var ie=r.toString();var on=ie.indexOf(")")+1;var eq=ie.indexOf("(");var nu=ie.substring(eq+1,on-1).split(/,\s*/);ui.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:wF(nu.slice(1))}};return ui};var wo=c9(["tag"],["classes","attributes","styles","value","innerHtml","domChildren","defChildren"]);var gv=function(eq){var r=so(eq);return sI.stringify(r,null,2)};var so=function(r){return{tag:r.tag(),classes:r.classes().getOr([]),attributes:r.attributes().getOr({}),styles:r.styles().getOr({}),value:r.value().getOr("<none>"),innerHtml:r.innerHtml().getOr("<none>"),defChildren:r.defChildren().fold(function(){return"<none>"},function(eq){return sI.stringify(eq,null,2)}),domChildren:r.domChildren().fold(function(){return"<none>"},function(eq){return eq.length===0?"0 children, but still specified":String(eq.length)})}};var wA=["classes","attributes","styles","value","innerHtml","defChildren","domChildren"];var wk=c9([],wA);var rX=function(r,ie,eq){return ie.fold(function(){return eq.fold(function(){return{}},function(nu){return lX(r,nu)})},function(nu){return eq.fold(function(){return lX(r,nu)},function(on){return lX(r,on)})})};var ij=function(ie,eq){var r=eH({tag:ie.tag(),classes:eq.classes().getOr([]).concat(ie.classes().getOr([])),attributes:pi(ie.attributes().getOr({}),eq.attributes().getOr({})),styles:pi(ie.styles().getOr({}),eq.styles().getOr({}))},eq.innerHtml().or(ie.innerHtml()).map(function(nu){return lX("innerHtml",nu)}).getOr({}),rX("domChildren",eq.domChildren(),ie.domChildren()),rX("defChildren",eq.defChildren(),ie.defChildren()),eq.value().or(ie.value()).map(function(nu){return lX("value",nu)}).getOr({}));return wo(r)};var wG=function(r,eq,ie){return oS(function(nu){ie(nu,r,eq)})};var cU=function(r,eq,ie){return nt(function(nu,on){ie(nu,r,eq)})};var xu=function(on,ie,yJ,nu,r,ui){var yK=ih(on);var eq=d6(ie,[rH("config",on)]);return pQ(yK,eq,ie,yJ,nu,r,ui)};var tM=function(ui,ie,yJ,nu,r,on){var yK=ui;var eq=d6(ie,[x4("config",ui)]);return pQ(yK,eq,ie,yJ,nu,r,on)};var kc=function(ie,eq,r){var nu=function(ui){var yJ=[];for(var yK=1;yK<arguments.length;yK++){yJ[yK-1]=arguments[yK]}var on=[ui].concat(yJ);return ui.config({name:fY(ie)}).fold(function(){throw new Error("We could not find any behaviour configuration for: "+ie+". Using API: "+r)},function(yM){var yL=Array.prototype.slice.call(on,1);return eq.apply(undefined,[ui,yM.config,yM.state].concat(yL))})};return p9(nu,r,eq)};var fC=function(r){return{key:r,value:undefined}};var pQ=function(yK,yN,eq,on,yJ,nu,r){var yM=function(yO){return p3(yO,eq)?yO[eq]():tP.none()};var ui=u5(yJ,function(yP,yO){return kc(eq,yP,yO)});var ie=u5(nu,function(yP,yO){return r7(yP,yO)});var yL=eH(ie,ui,{revoke:mX(fC,eq),config:function(yO){var yP=fX(eq+"-config",yK,yO);return{key:eq,value:{config:yP,me:yL,configAsRaw:oJ(function(){return rF(eq+"-config",yK,yO)}),initialConfig:yO,state:r}}},schema:function(){return yN},exhibit:function(yP,yO){return yM(yP).bind(function(yQ){return fr(on,"exhibit").map(function(yR){return yR(yO,yQ.config,yQ.state)})}).getOr(wk({}))},name:function(){return eq},handlers:function(yO){return yM(yO).bind(function(yP){return fr(on,"events").map(function(yQ){return yQ(yP.config,yP.state)})}).getOr({})}});return yL};var sm=function(r,eq){return fB(r,eq,{validate:kA,label:"function"})};var fB=function(eq,ie,r){if(ie.length===0){throw new Error("You must specify at least one required field.")}rD("required",ie);qU(ie);return function(yJ){var nu=ds(yJ);var ui=t0(ie,function(yK){return hZ(nu,yK)});if(!ui){mt(ie,nu)}eq(ie,nu);var on=l9(ie,function(yK){return !r.validate(yJ[yK],yK)});if(on.length>0){cc(on,r.label)}return yJ}};var jK=function(ie,r){var eq=l9(r,function(nu){return !hZ(ie,nu)});if(eq.length>0){o2(eq)}};var n2=S;var fy=function(r){return sm(jK,r)};var xD=function(r){return sm(n2,r)};var jp={init:function(){return wh({readState:function(){return"No State required"}})}};var wh=function(r){xD(["readState"])(r);return r};var h4=function(r){return kN(r)};var xr=ih([o("fields"),o("name"),qA("active",{}),qA("apis",{}),qA("state",jp),qA("extra",{})]);var tE=function(eq){var r=rF("Creating behaviour: "+eq.name,xr,eq);return xu(r.fields,r.name,r.active,r.apis,r.extra,r.state)};var xa=ih([o("branchKey"),o("branches"),o("name"),qA("active",{}),qA("apis",{}),qA("state",jp),qA("extra",{})]);var et=function(eq){var r=rF("Creating behaviour: "+eq.name,xa,eq);return tM(c5(r.branchKey,r.branches),r.name,r.active,r.apis,r.extra,r.state)};var uK=fY(undefined);function nv(eq,ui,nu){var yJ=nu||false;var ie=function(){ui();yJ=true};var yL=function(){eq();yJ=false};var r=function(){var on=yJ?yL:ie;on()};var yK=function(){return yJ};return{on:ie,off:yL,toggle:r,isOn:yK}}var u6=function(ie,r,eq){if(pq(eq)||hE(eq)||s4(eq)){ie.setAttribute(r,eq+"")}else{console.error("Invalid call to Attr.set. Key ",r,":: Value ",eq,":: Element ",ie);throw new Error("Attribute value was not simple")}};var xn=function(eq,r,ie){u6(eq.dom(),r,ie)};var fp=function(eq,r){var ie=eq.dom();tS(r,function(on,nu){u6(ie,nu,on)})};var qH=function(ie,eq){var r=ie.dom().getAttribute(eq);return r===null?undefined:r};var kq=function(eq,r){var ie=eq.dom();return ie&&ie.hasAttribute?ie.hasAttribute(r):false};var bd=function(eq,r){eq.dom().removeAttribute(r)};var jn=function(eq){var r=eq.dom().attributes;return r===undefined||r===null||r.length===0};var t1=function(r){return ok(r.dom().attributes,function(ie,eq){ie[eq.name]=eq.value;return ie},{})};var b7=function(ie,eq,r){if(kq(ie,r)&&!kq(eq,r)){xn(eq,r,qH(ie,r))}};var fA=function(ie,r,eq){if(!iI.isElement(ie)||!iI.isElement(r)){return}kV(eq,function(nu){b7(ie,r,nu)})};var kh={clone:t1,set:xn,setAll:fp,get:qH,has:kq,remove:bd,hasNone:jn,transfer:fA};var rM=function(eq,r){var ie=kh.get(eq,r);return ie===undefined||ie===""?[]:ie.split(" ")};var oe=function(on,r,ui){var eq=rM(on,r);var ie=eq.concat([ui]);kh.set(on,r,ie.join(" "));return true};var bb=function(ie,r,on){var eq=l9(rM(ie,r),function(nu){return nu!==on});if(eq.length>0){kh.set(ie,r,eq.join(" "))}else{kh.remove(ie,r)}return false};var fJ={read:rM,add:oe,remove:bb};var k0=function(r){return r.dom().classList!==undefined};var a4=function(r){return fJ.read(r,"class")};var cm=function(eq,r){return fJ.add(eq,"class",r)};var ba=function(eq,r){return fJ.remove(eq,"class",r)};var sH=function(eq,r){if(hZ(a4(eq),r)){return ba(eq,r)}else{return cm(eq,r)}};var nO={get:a4,add:cm,remove:ba,toggle:sH,supports:k0};var cl=function(eq,r){if(nO.supports(eq)){eq.dom().classList.add(r)}else{nO.add(eq,r)}};var m9=function(r){var eq=nO.supports(r)?r.dom().classList:nO.get(r);if(eq.length===0){kh.remove(r,"class")}};var a9=function(eq,r){if(nO.supports(eq)){var ie=eq.dom().classList;ie.remove(r)}else{nO.remove(eq,r)}m9(eq)};var jJ=function(eq,r){return nO.supports(eq)?eq.dom().classList.toggle(r):nO.toggle(eq,r)};var aK=function(nu,ie){var r=nO.supports(nu);var yJ=nu.dom().classList;var ui=function(){if(r){yJ.remove(ie)}else{nO.remove(nu,ie)}};var eq=function(){if(r){yJ.add(ie)}else{nO.add(nu,ie)}};return nv(ui,eq,kz(nu,ie))};var kz=function(eq,r){return nO.supports(eq)&&eq.dom().classList.contains(r)};var rG={add:cl,remove:a9,toggle:jJ,toggler:aK,has:kz};var dG=function(ie,eq,r){rG.remove(ie,r);rG.add(ie,eq)};var rE=function(r,eq,ie){dG(r.element(),eq.alpha(),eq.omega())};var iS=function(r,eq,ie){dG(r.element(),eq.omega(),eq.alpha())};var cf=function(r,eq,ie){rG.remove(r.element(),eq.alpha());rG.remove(r.element(),eq.omega())};var qR=function(r,eq,ie){return rG.has(r.element(),eq.alpha())};var h6=function(r,eq,ie){return rG.has(r.element(),eq.omega())};var tX=Object.freeze({toAlpha:rE,toOmega:iS,isAlpha:qR,isOmega:h6,clear:cf});var eB=[o("alpha"),o("omega")];var aJ=tE({fields:eB,name:"swapping",apis:tX});var hr=function(eq){var ie=eq;var r=function(){return ie};var on=function(ui){ie=ui};var nu=function(){return hr(r())};return{get:r,set:on,clone:nu}};function nw(on,ie,nu,r,eq){return on(nu,r)?tP.some(nu):kA(eq)&&eq(nu)?tP.none():ie(nu,r,eq)}var rT=function(r){return gC(r8.body(),r)};var si=function(ui,r,eq){var nu=ui.dom();var ie=kA(eq)?eq:fY(false);while(nu.parentNode){nu=nu.parentNode;var on=pO.fromDom(nu);if(r(on)){return tP.some(on)}else{if(ie(on)){break}}}return tP.none()};var gH=function(ie,r,eq){var nu=function(on){return r(on)};return nw(nu,si,ie,r,eq)};var fM=function(ie,r){var eq=ie.dom();if(!eq.parentNode){return tP.none()}return h0(pO.fromDom(eq.parentNode),function(nu){return !gb.eq(ie,nu)&&r(nu)})};var h0=function(ie,eq){var r=sy(ie.dom().childNodes,kP(eq,pO.fromDom));return r.map(pO.fromDom)};var gC=function(ie,r){var eq=function(ui){for(var on=0;on<ui.childNodes.length;on++){if(r(pO.fromDom(ui.childNodes[on]))){return tP.some(pO.fromDom(ui.childNodes[on]))}var nu=eq(ui.childNodes[on]);if(nu.isSome()){return nu}}return tP.none()};return eq(ie.dom())};var gO={first:rT,ancestor:si,closest:gH,sibling:fM,child:h0,descendant:gC};var ml=function(r){return gO.first(r).isSome()};var vr=function(ie,r,eq){return gO.ancestor(ie,r,eq).isSome()};var iz=function(ie,r,eq){return gO.closest(ie,r,eq).isSome()};var aR=function(eq,r){return gO.sibling(eq,r).isSome()};var hY=function(eq,r){return gO.child(eq,r).isSome()};var gB=function(eq,r){return gO.descendant(eq,r).isSome()};var rU={any:ml,ancestor:vr,closest:iz,sibling:aR,child:hY,descendant:gB};var i=function(r){r.dom().focus()};var mn=function(r){r.dom().blur()};var hS=function(r){var eq=yb.owner(r).dom();return r.dom()===eq.activeElement};var oA=function(eq){var r=eq!==undefined?eq.dom():document;return tP.from(r.activeElement).map(pO.fromDom)};var uv=function(eq){var ie=yb.owner(eq);var r=oA(ie).filter(function(nu){return rU.closest(nu,mX(gb.eq,eq))});r.fold(function(){i(eq)},S)};var g7=function(r){return oA(yb.owner(r)).filter(function(eq){return r.dom().contains(eq.dom())})};var xI={hasFocus:hS,focus:i,blur:mn,active:oA,search:g7,focusInside:uv};var lN=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils");var dT=tinymce.util.Tools.resolve("tinymce.ThemeManager");var kl=function(eq){var r=document.createElement("a");r.target="_blank";r.href=eq.href;r.rel="noreferrer noopener";var ie=document.createEvent("MouseEvents");ie.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);document.body.appendChild(r);r.dispatchEvent(ie);document.body.removeChild(r)};var rz={openLink:kl};var t9=function(r){return r.settings.skin===false};var qN=function(r){return false};var z="formatChanged";var pI="orientationChanged";var v4="dropupDismissed";var hl={formatChanged:fY(z),orientationChanged:fY(pI),dropupDismissed:fY(v4)};var tW=function(r,eq){var ie=eq||document;var nu=ie.createElement("div");nu.innerHTML=r;return yb.children(pO.fromDom(nu))};var jk=function(r,eq){return r5(r,function(ie){return pO.fromTag(ie,eq)})};var rd=function(eq,r){return r5(eq,function(ie){return pO.fromText(ie,r)})};var sB=function(r){return r5(r,pO.fromDom)};var ah={fromHtml:tW,fromTags:jk,fromText:rd,fromDom:sB};var a2=function(r){return r.dom().innerHTML};var iR=function(on,ui){var eq=yb.owner(on);var ie=eq.dom();var nu=pO.fromDom(ie.createDocumentFragment());var r=ah.fromHtml(ui,ie);nU.append(nu,r);q0.empty(on);vA.append(on,nu)};var s2=function(eq){var r=pO.fromTag("div");var ie=pO.fromDom(eq.dom().cloneNode(true));vA.append(r,ie);return a2(r)};var k9={get:a2,set:iR,getOuter:s2};var or=function(eq,r){return pO.fromDom(eq.dom().cloneNode(r))};var qs=function(r){return or(r,false)};var by=function(r){return or(r,true)};var i1=function(on,r){var ie=pO.fromTag(r);var eq=kh.clone(on);kh.setAll(ie,eq);return ie};var qV=function(ie,r){var eq=i1(ie,r);var on=yb.children(by(ie));nU.append(eq,on);return eq};var bR=function(on,r){var eq=i1(on,r);vA.before(on,eq);var ie=yb.children(on);nU.append(eq,ie);q0.remove(on);return eq};var e9={shallow:qs,shallowAs:i1,deep:by,copy:qV,mutate:bR};var ix=function(r){var eq=e9.shallow(r);return k9.getOuter(eq)};var aE=function(r){return ix(r)};var ru=function(r,eq){return eq.universal()?r:l9(r,function(ie){return hZ(eq.channels(),ie)})};var dB=function(r){return hf([cv(ai(),function(nu,ui){var ie=r.channels();var eq=ds(ie);var on=ru(eq,ui);kV(on,function(yJ){var yK=ie[yJ]();var yM=yK.schema();var yL=fX("channel["+yJ+"] data\nReceiver: "+aE(nu.element()),yM,ui.data());yK.onReceive()(nu,yL)})})])};var lw=Object.freeze({events:dB});var h=function(eq){var on=[];var ie=function(r){on.push(r)};for(var nu=0;nu<eq.length;nu++){eq[nu].each(ie)}return on};var ra=function(eq,on){for(var ie=0;ie<eq.length;ie++){var nu=on(eq[ie],ie);if(nu.isSome()){return nu}}return tP.none()};var ib="unknown";var bH=true;var v2=[];var wg=["alloy/data/Fields","alloy/debugging/Debugging"];var ge=function(){if(bH===false){return ib}var eq=new Error();if(eq.stack!==undefined){var r=eq.stack.split("\n");return sy(r,function(ie){return ie.indexOf("alloy")>0&&!h5(wg,function(nu){return ie.indexOf(nu)>-1})}).getOr(ib)}else{return ib}};var k5={logEventCut:S,logEventStopped:S,logNoParent:S,logEventNoHandlers:S,logEventResponse:S,write:S};var cI=function(ie,eq,on){var nu=bH&&(v2==="*"||hZ(v2,ie))?function(){var ui=[];return{logEventCut:function(yK,yL,yJ){ui.push({outcome:"cut",target:yL,purpose:yJ})},logEventStopped:function(yK,yL,yJ){ui.push({outcome:"stopped",target:yL,purpose:yJ})},logNoParent:function(yK,yL,yJ){ui.push({outcome:"no-parent",target:yL,purpose:yJ})},logEventNoHandlers:function(yJ,yK){ui.push({outcome:"no-handlers-left",target:yK})},logEventResponse:function(yK,yL,yJ){ui.push({outcome:"response",purpose:yJ,target:yL})},write:function(){if(hZ(["mousemove","mouseover","mouseout",vD()],ie)){return}console.log(ie,{event:ie,target:eq.dom(),sequence:r5(ui,function(yJ){if(!hZ(["cut","stopped","response"],yJ.outcome)){return yJ.outcome}else{return"{"+yJ.purpose+"} "+yJ.outcome+" at ("+aE(yJ.target)+")"}})})}}}():k5;var r=on(nu);nu.write();return r};var v8=fY([o("menu"),o("selectedMenu")]);var fz=fY([o("item"),o("selectedItem")]);var te=fY(ih(fz().concat(v8())));var cF=fY(ih(fz()));var ro=xY("initSize",[o("numColumns"),o("numRows")]);var fl=function(){return m4("markers",cF())};var cg=function(){return xY("markers",[o("backgroundMenu")].concat(v8()).concat(fz()))};var jO=function(r){return xY("markers",r5(r,o))};var ft=function(r,nu,eq){var ie=ge();return wq(nu,nu,eq,ev(function(on){return l7.value(function(){var ui=[];for(var yJ=0;yJ<arguments.length;yJ++){ui[yJ]=arguments[yJ]}return on.apply(undefined,ui)})}))};var fc=function(r){return ft("onHandler",r,aq(S))};var oT=function(r){return ft("onKeyboardHandler",r,aq(tP.none))};var ch=function(r){return ft("onHandler",r,il())};var cV=function(r){return ft("onKeyboardHandler",r,il())};var cC=function(r,eq){return bf(r,fY(eq))};var yg=function(r){return bf(r,iC)};var sq=fY(ro);var gT=[m4("channels",wi(l7.value,ih([ch("onReceive"),qA("schema",r2())])))];var l4=tE({fields:gT,name:"receiving",active:lw});var dU=function(eq,nu){var ie=n8(eq,nu);var r=nu.aria();r.update()(eq,r,ie)};var jI=function(eq,ie,r){rG.toggle(eq.element(),ie.toggleClass());dU(eq,ie)};var t4=function(eq,ie,r){rG.add(eq.element(),ie.toggleClass());dU(eq,ie)};var eP=function(eq,ie,r){rG.remove(eq.element(),ie.toggleClass());dU(eq,ie)};var n8=function(r,eq){return rG.has(r.element(),eq.toggleClass())};var dh=function(eq,nu,r){var ie=nu.selected()?t4:eP;ie(eq,nu,r)};var me=Object.freeze({onLoad:dh,toggle:jI,isOn:n8,on:t4,off:eP});var oW=function(ie,eq,r){return wk({})};var no=function(nu,r){var ie=wG(nu,r,jI);var eq=cU(nu,r,dh);return hf(jW([nu.toggleOnExecute()?[ie]:[],[eq]]))};var lI=Object.freeze({exhibit:oW,events:no});var rC=function(ie,r,eq){kh.set(ie.element(),"aria-pressed",eq);if(r.syncWithExpanded()){oK(ie,r,eq)}};var v6=function(ie,r,eq){kh.set(ie.element(),"aria-selected",eq)};var af=function(ie,r,eq){kh.set(ie.element(),"aria-checked",eq)};var oK=function(ie,r,eq){kh.set(ie.element(),"aria-expanded",eq)};var xP=[qA("selected",false),o("toggleClass"),qA("toggleOnExecute",true),fV("aria",{mode:"none"},c5("mode",{pressed:[qA("syncWithExpanded",false),cC("update",rC)],checked:[cC("update",af)],expanded:[cC("update",oK)],selected:[cC("update",v6)],none:[cC("update",S)]}))];var my=tE({fields:xP,name:"toggling",active:lI,apis:me});var eF=function(r,eq){return l4.config({channels:lX(hl.formatChanged(),{onReceive:function(ie,nu){if(nu.command===r){eq(ie,nu.state)}}})})};var sX=function(r){return l4.config({channels:lX(hl.orientationChanged(),{onReceive:r})})};var xz=function(r,eq){return{key:r,value:{onReceive:eq}}};var dx={format:eF,orientation:sX,receive:xz};var aD="tinymce-mobile";var lE=function(r){return aD+"-"+r};var eL={resolve:lE,prefix:fY(aD)};var nm=function(ie){var eq=function(ui){return cv(xi(),function(yJ,yK){ui(yJ);yK.stop()})};var on=function(ui,yJ){yJ.stop();r1(ui)};var r=function(ui,yJ){yJ.cut()};var nu=jz.detect().deviceType.isTouch()?[cv(p5(),on)]:[cv(tF(),on),cv(vx(),r)];return hf(jW([ie.map(eq).toArray(),nu]))};var f=function(r,eq){if(!eq.ignore()){xI.focus(r.element());eq.onFocus()(r)}};var x=function(r,eq){if(!eq.ignore()){xI.blur(r.element())}};var tI=function(r){return xI.hasFocus(r.element())};var r4=Object.freeze({focus:f,blur:x,isFocused:tI});var w2=function(eq,r){if(r.ignore()){return wk({})}else{return wk({attributes:{tabindex:"-1"}})}};var nl=function(r){return hf([cv(j(),function(eq,ie){f(eq,r);ie.stop()})])};var hN=Object.freeze({exhibit:w2,events:nl});var b=[fc("onFocus"),qA("ignore",false)];var fq=tE({fields:b,name:"focusing",active:hN,apis:r4});var g5=function(r){return r.style!==undefined};var ad={isSupported:g5};var vy=function(ie,eq,r){if(!pq(r)){console.error("Invalid call to CSS.set. Property ",eq,":: Value ",r,":: Element ",ie);throw new Error("CSS value must be a string: "+r)}if(ad.isSupported(ie)){ie.style.setProperty(eq,r)}};var j3=function(eq,r){if(ad.isSupported(eq)){eq.style.removeProperty(r)}};var iQ=function(r,ie,eq){var nu=r.dom();vy(nu,ie,eq)};var qj=function(eq,r){var ie=eq.dom();tS(r,function(on,nu){vy(ie,nu,on)})};var fR=function(eq,r){var ie=eq.dom();tS(r,function(on,nu){on.fold(function(){j3(ie,nu)},function(ui){vy(ie,nu,ui)})})};var a0=function(ie,ui){var yJ=ie.dom();var on=window.getComputedStyle(yJ);var nu=on.getPropertyValue(ui);var eq=nu===""&&!r8.inBody(ie)?o9(yJ,ui):nu;return eq===null?undefined:eq};var o9=function(eq,r){return ad.isSupported(eq)?eq.style.getPropertyValue(r):""};var a3=function(eq,ie){var nu=eq.dom();var r=o9(nu,ie);return tP.from(r).filter(function(on){return on.length>0})};var jb=function(ie){var eq={};var on=ie.dom();if(ad.isSupported(on)){for(var r=0;r<on.style.length;r++){var nu=on.style.item(r);eq[nu]=on.style[nu]}}return eq};var xE=function(r,on,nu){var eq=pO.fromTag(r);iQ(eq,on,nu);var ie=a3(eq,on);return ie.isSome()};var a8=function(r,eq){var ie=r.dom();j3(ie,eq);if(kh.has(r,"style")&&wW(kh.get(r,"style"))===""){kh.remove(r,"style")}};var dV=function(eq,on){var nu=kh.get(eq,"style");var r=on(eq);var ie=nu===undefined?kh.remove:kh.set;ie(eq,"style",nu);return r};var rl=function(eq,ie){var nu=eq.dom();var r=ie.dom();if(ad.isSupported(nu)&&ad.isSupported(r)){r.style.cssText=nu.style.cssText}};var xM=function(r){return r.dom().offsetWidth};var rs=function(ie,r,eq){a3(ie,eq).each(function(nu){if(a3(r,eq).isNone()){iQ(r,eq,nu)}})};var py=function(ie,r,eq){if(!iI.isElement(ie)||!iI.isElement(r)){return}kV(eq,function(nu){rs(ie,r,nu)})};var cL={copy:rl,set:iQ,preserve:dV,setAll:qj,setOptions:fR,remove:a8,get:a0,getRaw:a3,getAllRaw:jb,isValidValue:xE,reflow:xM,transfer:py};function va(ie,on){var yJ=function(yK,yL){if(!s4(yL)&&!yL.match(/^[0-9]+$/)){throw ie+".set accepts only positive integer values. Value was "+yL}var yM=yK.dom();if(ad.isSupported(yM)){yM.style[ie]=yL+"px"}};var eq=function(yL){var yM=on(yL);if(yM<=0||yM===null){var yK=cL.get(yL,ie);return parseFloat(yK)||0}return yM};var ui=eq;var nu=function(yL,yK){return ok(yK,function(yO,yN){var yP=cL.get(yL,yN);var yM=yP===undefined?0:parseInt(yP,10);return isNaN(yM)?yO:yO+yM},0)};var r=function(yN,yO,yM){var yL=nu(yN,yM);var yK=yO>yL?yO-yL:0;return yK};return{set:yJ,get:eq,getOuter:ui,aggregate:nu,max:r}}var lA=va("height",function(r){var eq=r.dom();return r8.inBody(r)?eq.getBoundingClientRect().height:eq.offsetHeight});var iP=function(r,eq){lA.set(r,eq)};var aY=function(r){return lA.get(r)};var fH=function(r){return lA.getOuter(r)};var nF=function(ie,nu){var eq=["margin-top","border-top-width","padding-top","padding-bottom","border-bottom-width","margin-bottom"];var r=lA.max(ie,nu,eq);cL.set(ie,"max-height",r+"px")};var uF={set:iP,get:aY,getOuter:fH,setMax:nF};var yn=function(r){return tv(r8.body(),r)};var rP=function(ie,r,eq){return l9(yb.parents(ie,eq),r)};var mL=function(eq,r){return l9(yb.siblings(eq),r)};var pc=function(eq,r){return l9(yb.children(eq),r)};var tv=function(ie,eq){var r=[];kV(yb.children(ie),function(nu){if(eq(nu)){r=r.concat([nu])}r=r.concat(tv(nu,eq))});return r};var nq={all:yn,ancestors:rP,siblings:mL,children:pc,descendants:tv};var yl=function(r){return iV.all(r)};var vY=function(ie,r,eq){return nq.ancestors(ie,function(nu){return iV.is(nu,r)},eq)};var mK=function(eq,r){return nq.siblings(eq,function(ie){return iV.is(ie,r)})};var pb=function(eq,r){return nq.children(eq,function(ie){return iV.is(ie,r)})};var fK=function(eq,r){return iV.all(r,eq)};var kR={all:yl,ancestors:vY,siblings:mK,children:pb,descendants:fK};var rS=function(r){return iV.one(r)};var vq=function(ie,r,eq){return gO.ancestor(ie,function(nu){return iV.is(nu,r)},eq)};var aP=function(eq,r){return gO.sibling(eq,function(ie){return iV.is(ie,r)})};var hX=function(eq,r){return gO.child(eq,function(ie){return iV.is(ie,r)})};var gz=function(eq,r){return iV.one(r,eq)};var iy=function(ie,r,eq){return nw(iV.is,vq,ie,r,eq)};var yz={first:rS,ancestor:vq,sibling:aP,child:hX,descendant:gz,closest:iy};var rI=function(){return[8]};var ag=function(){return[9]};var kb=function(){return[13]};var vn=function(){return[27]};var u1=function(){return[32]};var jN=function(){return[37]};var cz=function(){return[38]};var ns=function(){return[39]};var q1=function(){return[40]};var ez=function(eq,ie,r){var nu=mb(eq.slice(0,ie));var on=mb(eq.slice(ie+1));return sy(nu.concat(on),r)};var p=function(eq,ie,r){var nu=mb(eq.slice(0,ie));return sy(nu,r)};var lm=function(eq,ie,r){var nu=eq.slice(0,ie);var on=eq.slice(ie+1);return sy(on.concat(nu),r)};var gN=function(eq,ie,r){var nu=eq.slice(ie+1);return sy(nu,r)};var w4=function(r){return function(ie){var eq=ie.raw();return hZ(r,eq.which)}};var l3=function(r){return function(eq){return t0(r,function(ie){return ie(eq)})}};var qE=function(eq){var r=eq.raw();return r.shiftKey===true};var ms=function(eq){var r=eq.raw();return r.ctrlKey===true};var sD=jT(qE);var iY=function(eq,r){return{matches:eq,classification:r}};var c4=function(eq,r){var ie=sy(eq,function(nu){return nu.matches(r)});return ie.map(function(nu){return nu.classification})};var vP=function(on,ui,ie,eq){var nu=on+ui;if(nu>eq){return ie}else{return nu<ie?eq:nu}};var l=function(ie,eq,r){if(ie<=eq){return eq}else{return ie>=r?r:ie}};var mv=function(r,ie,nu){var eq=kR.descendants(r.element(),"."+ie.highlightClass());kV(eq,function(on){rG.remove(on,ie.highlightClass());r.getSystem().getByDom(on).each(function(ui){ie.onDehighlight()(r,ui)})})};var lc=function(eq,nu,on,ie){var r=tG(eq,nu,on,ie);rG.remove(ie.element(),nu.highlightClass());if(r){nu.onDehighlight()(eq,ie)}};var er=function(eq,nu,on,ie){var r=tG(eq,nu,on,ie);mv(eq,nu,on);rG.add(ie.element(),nu.highlightClass());if(!r){nu.onHighlight()(eq,ie)}};var uo=function(r,eq,ie){e1(r,eq,ie).each(function(nu){er(r,eq,ie,nu)})};var g2=function(r,eq,ie){ko(r,eq,ie).each(function(nu){er(r,eq,ie,nu)})};var bi=function(eq,ie,nu,r){q4(eq,ie,nu,r).fold(function(on){throw new Error(on)},function(on){er(eq,ie,nu,on)})};var aM=function(nu,ui,yJ,r){var ie=kR.descendants(nu.element(),"."+ui.itemClass());var eq=h(r5(ie,function(yK){return nu.getSystem().getByDom(yK).toOption()}));var on=sy(eq,r);on.each(function(yK){er(nu,ui,yJ,yK)})};var tG=function(r,ie,nu,eq){return rG.has(eq.element(),ie.highlightClass())};var ap=function(r,eq,ie){return yz.descendant(r.element(),"."+eq.highlightClass()).bind(function(nu){return r.getSystem().getByDom(nu).toOption()})};var q4=function(ie,nu,on,eq){var r=kR.descendants(ie.element(),"."+nu.itemClass());return tP.from(r[eq]).fold(function(){return l7.error("No element found with index "+eq)},ie.getSystem().getByDom)};var e1=function(r,eq,ie){return yz.descendant(r.element(),"."+eq.itemClass()).bind(function(nu){return r.getSystem().getByDom(nu).toOption()})};var ko=function(ie,nu,on){var eq=kR.descendants(ie.element(),"."+nu.itemClass());var r=eq.length>0?tP.some(eq[eq.length-1]):tP.none();return r.bind(function(ui){return ie.getSystem().getByDom(ui).toOption()})};var hF=function(eq,nu,ui,on){var r=kR.descendants(eq.element(),"."+nu.itemClass());var ie=qx(r,function(yJ){return rG.has(yJ,nu.highlightClass())});return ie.bind(function(yK){var yJ=vP(yK,on,0,r.length-1);return eq.getSystem().getByDom(r[yJ]).toOption()})};var ji=function(r,eq,ie){return hF(r,eq,ie,-1)};var rb=function(r,eq,ie){return hF(r,eq,ie,+1)};var iG=Object.freeze({dehighlightAll:mv,dehighlight:lc,highlight:er,highlightFirst:uo,highlightLast:g2,highlightAt:bi,highlightBy:aM,isHighlighted:tG,getHighlighted:ap,getFirst:e1,getLast:ko,getPrevious:ji,getNext:rb});var gy=[o("highlightClass"),o("itemClass"),fc("onHighlight"),fc("onDehighlight")];var lK=tE({fields:gy,name:"highlighting",apis:iG});var mZ=function(){var r=function(ie){return xI.search(ie.element())};var eq=function(ie,nu){ie.getSystem().triggerFocus(nu,ie.element())};return{get:r,set:eq}};var wL=function(){var r=function(ie){return lK.getHighlighted(ie).map(function(nu){return nu.element()})};var eq=function(ie,nu){ie.getSystem().getByDom(nu).fold(S,function(on){lK.highlight(ie,on)})};return{get:r,set:eq}};var sL=function(ie,yM,ui,yK,yJ,r){var on=function(){return ie.concat([qA("focusManager",mZ()),cC("handler",yL),cC("state",yM)])};var eq=function(yO,yP,yR,yN){var yQ=ui(yO,yP,yR,yN);return c4(yQ,yP.event()).bind(function(yS){return yS(yO,yP,yR,yN)})};var nu=function(yQ,yN){var yP=yK(yQ,yN);var yO=hf(r.map(function(yR){return cv(j(),function(yS,yT){yR(yS,yQ,yN,yT);yT.stop()})}).toArray().concat([cv(cS(),function(yR,yS){eq(yR,yS,yQ,yN).each(function(yT){yS.stop()})})]));return eH(yP,yO)};var yL={schema:on,processKey:eq,toEvents:nu,toApis:yJ};return yL};var tD=function(nu){var yK=[jr("onEscape"),jr("onEnter"),qA("selector",'[data-alloy-tabstop="true"]'),qA("firstTabstop",0),qA("useTabstopAt",fY(true)),jr("visibilitySelector")].concat([nu]);var yO=function(yU,yT){var yV=yU.visibilitySelector().bind(function(yW){return yz.closest(yT,yW)}).getOr(yT);return uF.get(yV)>0};var yN=function(yT,yU){var yW=kR.descendants(yT.element(),yU.selector());var yV=l9(yW,function(yX){return yO(yU,yX)});return tP.from(yV[yU.firstTabstop()])};var ie=function(yT,yU){return yU.focusManager().get(yT).bind(function(yV){return yz.closest(yV,yU.selector())})};var yL=function(yU,yT){return yO(yU,yT)&&yU.useTabstopAt()(yT)};var r=function(yT,yU){yN(yT,yU).each(function(yV){yU.focusManager().set(yT,yV)})};var on=function(yU,yX,yT,yW,yV){return yV(yX,yT,function(yY){return yL(yW,yY)}).fold(function(){return yW.cyclic()?tP.some(true):tP.none()},function(yY){yW.focusManager().set(yU,yY);return tP.some(true)})};var yJ=function(yT,yW,yV,yU){var yX=kR.descendants(yT.element(),yV.selector());return ie(yT,yV).bind(function(yY){var yZ=qx(yX,mX(gb.eq,yY));return yZ.bind(function(y0){return on(yT,yX,y0,yV,yU)})})};var yS=function(yU,yW,yV,yX){var yT=yV.cyclic()?ez:p;return yJ(yU,yW,yV,yT)};var ui=function(yU,yW,yV,yX){var yT=yV.cyclic()?lm:gN;return yJ(yU,yW,yV,yT)};var yR=function(yT,yV,yU,yW){return yU.onEnter().bind(function(yX){return yX(yT,yV)})};var eq=function(yT,yV,yU,yW){return yU.onEscape().bind(function(yX){return yX(yT,yV)})};var yM=fY([iY(l3([qE,w4(ag())]),yS),iY(w4(ag()),ui),iY(w4(vn()),eq),iY(l3([sD,w4(kb())]),yR)]);var yQ=fY({});var yP=fY({});return sL(yK,jp.init,yM,yQ,yP,tP.some(r))};var fx=tD(bf("cyclic",fY(false)));var hO=tD(bf("cyclic",fY(true)));var en=function(r){return iI.name(r)==="input"&&kh.get(r,"type")!=="radio"||iI.name(r)==="textarea"};var ak=function(r,eq,ie){sg(r,ie,xi());return tP.some(true)};var wT=function(r,eq,ie){return en(ie)&&w4(u1())(eq.event())?tP.none():ak(r,eq,ie)};var dN=[qA("execute",wT),qA("useSpace",false),qA("useEnter",true),qA("useControlEnter",false),qA("useDown",false)];var kI=function(r,ie,eq){return eq.execute()(r,ie,r.element())};var db=function(ie,yJ,on,nu){var r=on.useSpace()&&!en(ie.element())?u1():[];var yK=on.useEnter()?kb():[];var eq=on.useDown()?q1():[];var ui=r.concat(yK).concat(eq);return[iY(w4(ui),kI)].concat(on.useControlEnter()?[iY(l3([ms,w4(kb())]),kI)]:[])};var ki=fY({});var m1=fY({});var aF=sL(dN,jp.init,db,ki,m1,tP.none());var rt=function(r){var ie=hr(tP.none());var eq=function(yJ,ui){ie.set(tP.some({numRows:fY(yJ),numColumns:fY(ui)}))};var on=function(){return ie.get().map(function(ui){return ui.numRows()})};var nu=function(){return ie.get().map(function(ui){return ui.numColumns()})};return wh({readState:fY({}),setGridSize:eq,getNumRows:on,getNumColumns:nu})};var vF=function(r){return r.state()(r)};var ud=Object.freeze({flatgrid:rt,init:vF});var xH=function(eq,r){return function(ie){return qh(ie)==="rtl"?r:eq}};var qh=function(r){return cL.get(r,"direction")==="rtl"?"rtl":"ltr"};var gX={onDirection:xH,getDirection:qh};var x6=function(r){return function(nu,on,ie,ui){var eq=r(nu.element());return eD(eq,nu,on,ie,ui)}};var s0=function(ie,eq){var r=gX.onDirection(ie,eq);return x6(r)};var pM=function(ie,eq){var r=gX.onDirection(eq,ie);return x6(r)};var x0=function(r){return function(ie,nu,eq,on){return eD(r,ie,nu,eq,on)}};var eD=function(r,ie,on,eq,ui){var nu=eq.focusManager().get(ie).bind(function(yJ){return r(ie.element(),yJ,eq,ui)});return nu.map(function(yJ){eq.focusManager().set(ie,yJ);return true})};var ss=x0;var fo=x0;var pz=x0;var kX=function(ie,ui,yK,nu){var eq=cL.get(ie,ui);if(eq===undefined){eq=""}var on=eq===yK?nu:yK;var yJ=mX(cL.set,ie,ui,eq);var r=mX(cL.set,ie,ui,on);return nv(yJ,r,false)};var i8=function(r){return kX(r,"visibility","hidden","visible")};var k8=function(r,eq){return kX(r,"display","none",eq)};var qd=function(r){return r.offsetWidth<=0&&r.offsetHeight<=0};var U=function(r){var eq=r.dom();return !qd(eq)};var dR={toggler:i8,displayToggler:k8,isVisible:U};var gD=c9(["index","candidates"],[]);var rK=function(eq,r){return qx(eq,r).map(function(ie){return gD({index:ie,candidates:eq})})};var xF=function(eq,nu,r){var ie=dR.isVisible;return to(eq,nu,r,ie)};var to=function(ie,ui,eq,nu){var r=mX(gb.eq,ui);var on=kR.descendants(ie,eq);var yJ=l9(on,dR.isVisible);return rK(yJ,r)};var xg=function(r,eq){return qx(r,function(ie){return gb.eq(eq,ie)})};var W=function(eq,ie,ui,on){var r=Math.floor(ie/ui);var nu=ie%ui;return on(r,nu).bind(function(yJ){var yK=yJ.row()*ui+yJ.column();return yK>=0&&yK<eq.length?tP.some(eq[yK]):tP.none()})};var eZ=function(r,eq,ie,nu,on){return W(r,eq,nu,function(ui,yJ){var yM=ui===ie-1;var yL=yM?r.length-ui*nu:nu;var yK=vP(yJ,on,0,yL-1);return tP.some({row:fY(ui),column:fY(yK)})})};var gZ=function(r,eq,ie,nu,on){return W(r,eq,nu,function(ui,yK){var yJ=vP(ui,on,0,ie-1);var yN=yJ===ie-1;var yM=yN?r.length-yJ*nu:nu;var yL=l(yK,0,yM-1);return tP.some({row:fY(yJ),column:fY(yL)})})};var pv=function(r,eq,ie,nu){return eZ(r,eq,ie,nu,+1)};var aZ=function(r,eq,ie,nu){return eZ(r,eq,ie,nu,-1)};var qP=function(r,eq,ie,nu){return gZ(r,eq,ie,nu,-1)};var iA=function(r,eq,ie,nu){return gZ(r,eq,ie,nu,+1)};var dM=[o("selector"),qA("execute",wT),oT("onEscape"),qA("captureTab",false),sq()];var ou=function(r,eq,ie){yz.descendant(r.element(),eq.selector()).each(function(nu){eq.focusManager().set(r,nu)})};var c7=function(r,eq){return eq.focusManager().get(r).bind(function(ie){return yz.closest(ie,eq.selector())})};var kG=function(r,eq,ie,nu){return c7(r,ie).bind(function(on){return ie.execute()(r,eq,on)})};var cQ=function(r){return function(eq,ie,nu,on){return xF(eq,ie,nu.selector()).bind(function(ui){return r(ui.candidates(),ui.index(),on.getNumRows().getOr(nu.initSize().numRows()),on.getNumColumns().getOr(nu.initSize().numColumns()))})}};var d9=function(r,eq,ie,nu){return ie.captureTab()?tP.some(true):tP.none()};var ub=function(r,eq,ie,nu){return ie.onEscape()(r,eq)};var d4=cQ(aZ);var ps=cQ(pv);var sp=cQ(qP);var fk=cQ(iA);var gp=fY([iY(w4(jN()),s0(d4,ps)),iY(w4(ns()),pM(d4,ps)),iY(w4(cz()),ss(sp)),iY(w4(q1()),fo(fk)),iY(l3([qE,w4(ag())]),d9),iY(l3([sD,w4(ag())]),d9),iY(w4(vn()),ub),iY(w4(u1().concat(kb())),kG)]);var tu=fY({});var v0={};var gf=sL(dM,rt,gp,tu,v0,tP.some(ou));var np=function(eq,r,ie,nu){return xF(eq,ie,r).bind(function(yJ){var on=yJ.index();var yK=yJ.candidates();var ui=vP(on,nu,0,yK.length-1);return tP.from(yK[ui])})};var dK=[o("selector"),qA("getInitial",tP.none),qA("execute",wT),qA("executeOnMove",false),qA("allowVertical",true)];var qZ=function(r,eq){return eq.focusManager().get(r).bind(function(ie){return yz.closest(ie,eq.selector())})};var kF=function(r,eq,ie){return qZ(r,ie).bind(function(nu){return ie.execute()(r,eq,nu)})};var w8=function(r,eq){eq.getInitial()(r).or(yz.descendant(r.element(),eq.selector())).each(function(ie){eq.focusManager().set(r,ie)})};var ta=function(r,ie,eq){return np(r,eq.selector(),ie,-1)};var gx=function(r,ie,eq){return np(r,eq.selector(),ie,+1)};var oa=function(r){return function(eq,ie,nu){return r(eq,ie,nu).bind(function(){return nu.executeOnMove()?kF(eq,ie,nu):tP.some(true)})}};var go=function(nu,eq,ui,r){var on=jN().concat(ui.allowVertical()?cz():[]);var ie=ns().concat(ui.allowVertical()?q1():[]);return[iY(w4(on),oa(s0(ta,gx))),iY(w4(ie),oa(pM(ta,gx))),iY(w4(kb()),kF),iY(w4(u1()),kF)]};var tt=fY({});var vZ=fY({});var vj=sL(dK,jp.init,go,tt,vZ,tP.some(w8));var iZ=c9(["rowIndex","columnIndex","cell"],[]);var pk=function(r,ie,eq){return tP.from(r[ie]).bind(function(nu){return tP.from(nu[eq]).map(function(on){return iZ({rowIndex:ie,columnIndex:eq,cell:on})})})};var uw=function(r,yJ,ie,eq){var ui=r[yJ];var nu=ui.length;var on=vP(ie,eq,0,nu-1);return pk(r,yJ,on)};var pY=function(ie,on,eq,r){var ui=vP(eq,r,0,ie.length-1);var nu=ie[ui].length;var yJ=l(on,0,nu-1);return pk(ie,ui,yJ)};var wS=function(r,yJ,ie,eq){var ui=r[yJ];var nu=ui.length;var on=l(ie+eq,0,nu-1);return pk(r,yJ,on)};var mj=function(ie,on,eq,r){var ui=l(eq+r,0,ie.length-1);var nu=ie[ui].length;var yJ=l(on,0,nu-1);return pk(ie,ui,yJ)};var m6=function(eq,r,ie){return uw(eq,r,ie,+1)};var nB=function(eq,r,ie){return uw(eq,r,ie,-1)};var yr=function(eq,r,ie){return pY(eq,ie,r,-1)};var pG=function(eq,r,ie){return pY(eq,ie,r,+1)};var s9=function(eq,r,ie){return wS(eq,r,ie,-1)};var gw=function(eq,r,ie){return wS(eq,r,ie,+1)};var bG=function(eq,r,ie){return mj(eq,ie,r,-1)};var lB=function(eq,r,ie){return mj(eq,ie,r,+1)};var dJ=[xY("selectors",[o("row"),o("cell")]),qA("cycles",true),qA("previousSelector",tP.none),qA("execute",wT)];var w7=function(eq,r){var ie=r.previousSelector()(eq).orThunk(function(){var nu=r.selectors();return yz.descendant(eq.element(),nu.cell())});ie.each(function(nu){r.focusManager().set(eq,nu)})};var kE=function(eq,ie,r){return xI.search(eq.element()).bind(function(nu){return r.execute()(eq,ie,nu)})};var gq=function(eq,r){return r5(eq,function(ie){return kR.descendants(ie,r.selectors().cell())})};var n9=function(eq,r){return function(nu,on,ie){var ui=ie.cycles()?eq:r;return yz.closest(on,ie.selectors().row()).bind(function(yK){var yJ=kR.descendants(yK,ie.selectors().cell());return xg(yJ,on).bind(function(yL){var yM=kR.descendants(nu,ie.selectors().row());return xg(yM,yK).bind(function(yO){var yN=gq(yM,ie);return ui(yN,yO,yL).map(function(yP){return yP.cell()})})})})}};var s8=n9(nB,s9);var gu=n9(m6,gw);var vB=n9(yr,bG);var gh=n9(pG,lB);var gn=fY([iY(w4(jN()),s0(s8,gu)),iY(w4(ns()),pM(s8,gu)),iY(w4(cz()),ss(vB)),iY(w4(q1()),fo(gh)),iY(w4(u1().concat(kb())),kE)]);var ts=fY({});var vX=fY({});var oZ=sL(dJ,jp.init,gn,ts,vX,tP.some(w7));var dI=[o("selector"),qA("execute",wT),qA("moveOnTab",false)];var kB=function(eq,ie,r){return r.focusManager().get(eq).bind(function(nu){return r.execute()(eq,ie,nu)})};var w6=function(eq,r){yz.descendant(eq.element(),r.selector()).each(function(ie){r.focusManager().set(eq,ie)})};var cy=function(r,ie,eq){return np(r,eq.selector(),ie,-1)};var vI=function(r,ie,eq){return np(r,eq.selector(),ie,+1)};var tm=function(eq,ie,r){return r.moveOnTab()?pz(cy)(eq,ie,r):tP.none()};var xj=function(eq,ie,r){return r.moveOnTab()?pz(vI)(eq,ie,r):tP.none()};var gm=fY([iY(w4(cz()),pz(cy)),iY(w4(q1()),pz(vI)),iY(l3([qE,w4(ag())]),tm),iY(l3([sD,w4(ag())]),xj),iY(w4(kb()),kB),iY(w4(u1()),kB)]);var tr=fY({});var vW=fY({});var bu=sL(dI,jp.init,gm,tr,vW,tP.some(w6));var dH=[oT("onSpace"),oT("onEnter"),oT("onShiftEnter"),oT("onLeft"),oT("onRight"),oT("onTab"),oT("onShiftTab"),oT("onUp"),oT("onDown"),oT("onEscape"),jr("focusIn")];var gk=function(eq,ie,r){return[iY(w4(u1()),r.onSpace()),iY(l3([sD,w4(kb())]),r.onEnter()),iY(l3([qE,w4(kb())]),r.onShiftEnter()),iY(l3([qE,w4(ag())]),r.onShiftTab()),iY(l3([sD,w4(ag())]),r.onTab()),iY(w4(cz()),r.onUp()),iY(w4(q1()),r.onDown()),iY(w4(jN()),r.onLeft()),iY(w4(ns()),r.onRight()),iY(w4(u1()),r.onSpace()),iY(w4(vn()),r.onEscape())]};var w5=function(eq,r){return r.focusIn().bind(function(ie){return ie(eq,r)})};var tq=function(){return{}};var vU=function(){return{}};var q5=sL(dH,jp.init,gk,tq,vU,tP.some(w5));var p8=fx.schema();var xO=hO.schema();var nn=vj.schema();var vp=gf.schema();var hM=oZ.schema();var jV=aF.schema();var uH=bu.schema();var uX=q5.schema();var bW=Object.freeze({acyclic:p8,cyclic:xO,flow:nn,flatgrid:vp,matrix:hM,execution:jV,menu:uH,special:uX});var x2=et({branchKey:"mode",branches:bW,name:"keying",active:{events:function(ie,r){var eq=ie.handler();return eq.toEvents(ie,r)}},apis:{focusIn:function(r){r.getSystem().triggerFocus(r.element(),r.element())},setGridSize:function(eq,r,on,nu,ie){if(!p3(on,"setGridSize")){console.error("Layout does not support setGridSize")}else{on.setGridSize(nu,ie)}}},state:ud});var bA=function(eq,r){return fI(eq,{},r5(r,function(ie){return m8(ie.name(),"Cannot configure "+ie.name()+" for "+eq)}).concat([bf("dump",iC)]))};var aW=function(r){return r.dump()};var nM="placeholder";var b5=ox.generate([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]);var ju=function(r,nu,ie,eq){if(r.exists(function(on){return on!==ie.owner})){return b5.single(true,fY(ie))}return fr(eq,ie.name).fold(function(){throw new Error("Unknown placeholder component: "+ie.name+"\nKnown: ["+ds(eq)+"]\nNamespace: "+r.getOr("none")+"\nSpec: "+sI.stringify(ie,null,2))},function(on){return on.replace()})};var jS=function(r,nu,ie,eq){if(ie.uiType===nM){return ju(r,nu,ie,eq)}else{return b5.single(false,fY(ie))}};var uV=function(r,nu,ie,eq){var on=jS(r,nu,ie,eq);return on.fold(function(yL,ui){var yM=ui(nu,ie.config,ie.validated);var yK=fr(yM,"components").getOr([]);var yJ=hw(yK,function(yN){return uV(r,nu,yN,eq)});return[eH(yM,{components:yJ})]},function(yJ,yK){var ui=yK(nu,ie.config,ie.validated);return ui})};var ay=function(r,ie,nu,eq){return hw(nu,function(on){return uV(r,ie,on,eq)})};var pp=function(r,nu){var on=false;var ie=function(){return on};var eq=function(){if(on===true){throw new Error("Trying to use the same placeholder more than once: "+r)}on=true;return nu};var ui=function(){return nu.fold(function(yK,yJ){return yK},function(yK,yJ){return yK})};return{name:fY(r),required:ui,used:ie,replace:eq}};var vs=function(r,ie,on,eq){var ui=u5(eq,function(yK,yJ){return pp(yJ,yK)});var nu=ay(r,ie,on,ui);tS(ui,function(yJ){if(yJ.used()===false&&yJ.required()){throw new Error("Placeholder: "+yJ.name()+" was not found in components list\nNamespace: "+r.getOr("none")+"\nComponents: "+sI.stringify(ie.components(),null,2))}});return nu};var pt=b5.single;var mp=b5.multiple;var sN=fY(nM);var ly=0;var uS=function(ie){var r=new Date();var nu=r.getTime();var eq=Math.floor(Math.random()*1000000000);ly++;return ie+"_"+eq+ly+String(nu)};var b4=ox.generate([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]);var r3=qA("factory",{sketch:iC});var lQ=qA("schema",[]);var bV=o("name");var bc=wq("pname","pname",pD(function(r){return"<alloy."+uS(r.name)+">"}),r2());var ur=qA("defaults",fY({}));var aN=qA("overrides",fY({}));var v=aL([r3,lQ,bV,bc,ur,aN]);var ck=aL([r3,lQ,bV,ur,aN]);var vV=aL([r3,lQ,bV,bc,ur,aN]);var yA=aL([r3,lQ,bV,o("unit"),bc,ur,aN]);var pl=function(r){return r.fold(tP.some,tP.none,tP.some,tP.some)};var oj=function(eq){var r=function(ie){return ie.name()};return eq.fold(r,r,r,r)};var pw=function(r,eq){return function(ie){var nu=fX("Converting part type",eq,ie);return r(nu)}};var jv=pw(b4.required,v);var i4=pw(b4.external,ck);var sG=pw(b4.optional,vV);var pK=pw(b4.group,yA);var hV=fY("entirety");var ey=function(ie,on,r,nu){var eq=r;return eH(on.defaults()(ie,r,nu),r,{uid:ie.partUids()[on.name()]},on.overrides()(ie,r,nu),{"debug.sketcher":lX("part-"+on.name(),eq)})};var sb=function(r,ie,on){var nu={};var eq={};kV(on,function(ui){ui.fold(function(yJ){nu[yJ.pname()]=pt(true,function(yL,yK,yM){return yJ.factory().sketch(ey(yL,yJ,yK,yM))})},function(yK){var yJ=ie.parts()[yK.name()]();eq[yK.name()]=fY(ey(ie,yK,yJ[hV()]()))},function(yJ){nu[yJ.pname()]=pt(false,function(yL,yK,yM){return yJ.factory().sketch(ey(yL,yJ,yK,yM))})},function(yJ){nu[yJ.pname()]=mp(true,function(yM,yL,yN){var yK=yM[yJ.name()]();return r5(yK,function(yO){return yJ.factory().sketch(eH(yJ.defaults()(yM,yO),yO,yJ.overrides()(yM,yO)))})})})});return{internals:fY(nu),externals:fY(eq)}};var uO=function(eq,nu){var ie={};kV(nu,function(r){pl(r).each(function(ui){var on=co(eq,ui.pname());ie[ui.name()]=function(yJ){var yK=rF("Part: "+ui.name()+" in "+eq,aL(ui.schema()),yJ);return eH(on,{config:yJ,validated:yK})}})});return ie};var co=function(r,eq){return{uiType:sN(),owner:r,name:eq}};var xc=function(r,ie,eq){return{uiType:sN(),owner:r,name:ie,config:eq,validated:{}}};var eT=function(r){return hw(r,function(eq){return eq.fold(tP.none,tP.some,tP.none,tP.none).map(function(ie){return xY(ie.name(),ie.schema().concat([yg(hV())]))}).toArray()})};var ha=function(r){return r5(r,oj)};var tH=function(r,eq,ie){return sb(r,eq,ie)};var eY=function(r,eq,ie){return vs(tP.some(r),eq,eq.components(),ie)};var ph=function(r,ie,nu){var eq=ie.partUids()[nu];return r.getSystem().getByUid(eq).toOption()};var pC=function(r,eq,ie){return ph(r,eq,ie).getOrDie("Could not find part: "+ie)};var im=function(r,eq){var ie=r.getSystem();return u5(eq.partUids(),function(on,nu){return fY(ie.getByUid(on))})};var p0=function(ie,eq){var r=ha(eq);return kN(r5(r,function(nu){return{key:nu,value:ie+"-"+nu}}))};var i0=function(r){return wq("partUids","partUids",ky(function(eq){return p0(eq.uid,r)}),r2())};var sZ=uS("alloy-premade");var mk=uS("api");var wP=function(r){return lX(sZ,r)};var p1=function(r){return fr(r,sZ)};var xU=function(r){return bE(function(eq){var ie=[];for(var nu=1;nu<arguments.length;nu++){ie[nu-1]=arguments[nu]}var on=eq.config(mk);return r.apply(undefined,[on].concat([eq].concat(ie)))},r)};var mB=fY(mk);var re=fY("alloy-id-");var t6=fY("data-alloy-id");var rc=re();var dm=t6();var yi=function(r,eq){var ie=uS(rc+r);kh.set(eq,dm,ie);return ie};var sa=function(eq,r){kh.set(eq,dm,r)};var rL=function(r){var eq=iI.isElement(r)?kh.get(r,dm):null;return tP.from(eq)};var uN=function(r){return uS(r)};var ks=function(ie,eq,on,r){var nu=eq.length>0?[xY("parts",eq)]:[];return nu.concat([o("uid"),qA("dom",{}),qA("components",[]),yg("originalSpec"),qA("debug.sketcher",{})]).concat(on)};var mu=function(ie,nu,eq,r,ui){var on=ks(ie,r,ui,eq);return fX(ie+" [SpecSchema]",ih(on.concat(nu)),eq)};var lb=function(r,ui,ie,eq){var nu=k(eq);var on=mu(r,ui,nu,[],[]);return eH(ie(on,nu),{"debug.sketcher":lX(r,eq)})};var eJ=function(eq,nu,yM,ui,yN){var yL=k(yN);var r=eT(yM);var yJ=i0(yM);var yK=mu(eq,nu,yL,r,[yJ]);var ie=tH(eq,yK,yM);var on=eY(eq,yK,ie.internals());return eH(ui(yK,on,yL,ie.externals()),{"debug.sketcher":lX(eq,yN)})};var k=function(r){return eH({uid:uN("uid")},r)};function kr(r){return r.uid!==undefined}var bw=ih([o("name"),o("factory"),o("configFields"),qA("apis",{}),qA("extraApis",{})]);var io=ih([o("name"),o("factory"),o("configFields"),o("partFields"),qA("apis",{}),qA("extraApis",{})]);var la=function(eq){var ie=rF("Sketcher for "+eq.name,bw,eq);var on=function(ui){return lb(ie.name,ie.configFields,ie.factory,ui)};var nu=u5(ie.apis,xU);var r=u5(ie.extraApis,function(yJ,ui){return r7(yJ,ui)});return eH({name:fY(ie.name),partFields:fY([]),configFields:fY(ie.configFields),sketch:on},nu,r)};var uk=function(eq){var ie=rF("Sketcher for "+eq.name,io,eq);var ui=function(yJ){return eJ(ie.name,ie.configFields,ie.partFields,ie.factory,yJ)};var on=uO(ie.name,ie.partFields);var nu=u5(ie.apis,xU);var r=u5(ie.extraApis,function(yK,yJ){return r7(yK,yJ)});return eH({name:fY(ie.name),partFields:fY(ie.partFields),configFields:fY(ie.configFields),sketch:ui,parts:fY(on)},nu,r)};var O=function(nu){var ie=nm(nu.action());var r=fr(nu.dom(),"attributes").bind(j1("type"));var eq=fr(nu.dom(),"tag");return{uid:nu.uid(),dom:nu.dom(),components:nu.components(),events:ie,behaviours:eH(h4([fq.config({}),x2.config({mode:"execution",useSpace:true,useEnter:true})]),aW(nu.buttonBehaviours())),domModification:{attributes:eH(r.fold(function(){return eq.is("button")?{type:"button"}:{}},function(on){return{}}),{role:nu.role().getOr("button")})},eventOrder:nu.eventOrder()}};var wK=la({name:"Button",factory:O,configFields:[qA("uid",undefined),o("dom"),qA("components",[]),bA("buttonBehaviours",[fq,x2]),jr("action"),jr("role"),qA("eventOrder",{})]});var w1=function(eq,r){return wk({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})};var nj=function(r){return hf([fT(cR(),fY(true))])};var m5=Object.freeze({events:nj,exhibit:w1});var wV=tE({fields:[],name:"unselecting",active:m5});var lZ=function(eq){var r=eq.dom().attributes!==undefined?eq.dom().attributes:[];return ok(r,function(nu,ie){if(ie.name==="class"){return nu}else{return eH(nu,lX(ie.name,ie.value))}},{})};var oE=function(r){return Array.prototype.slice.call(r.dom().classList,0)};var tV=function(nu){var ui=pO.fromHtml(nu);var ie=yb.children(ui);var r=lZ(ui);var eq=oE(ui);var on=ie.length===0?{}:{innerHtml:k9.get(ui)};return eH({tag:iI.name(ui),classes:eq,attributes:r},on)};var jt=function(eq){var r=wO(eq,{prefix:eL.prefix()});return tV(r)};var hk=function(eq){var r=jt(eq);return{dom:r}};var xA=function(r,eq){return xf(eq,function(){r.execCommand(eq)},{})};var mr=function(r){return h4([my.config({toggleClass:eL.resolve("toolbar-button-selected"),toggleOnExecute:false,aria:{mode:"pressed"}}),dx.format(r,function(nu,ie){var eq=ie?my.on:my.off;eq(nu)})])};var ar=function(r,eq){var ie=mr(eq);return xf(eq,function(){r.execCommand(eq)},ie)};var K=function(eq,r,nu,ie){var on=mr(nu);return xf(r,ie,on)};var xf=function(r,eq,ie){return wK.sketch({dom:jt('<span class="${prefix}-toolbar-button ${prefix}-icon-'+r+' ${prefix}-icon"></span>'),action:eq,buttonBehaviours:eH(h4([wV.config({})]),ie)})};var eV={forToolbar:xf,forToolbarCommand:xA,forToolbarStateAction:K,forToolbarStateCommand:ar};var xw=function(eq,r){var ie=function(nu,on){return xw(eq+nu,r+on)};return{left:fY(eq),top:fY(r),translate:ie}};var se=xw;var lC=function(nu,eq,r,ie){if(nu<eq){return nu}else{if(nu>r){return r}else{if(nu===eq){return eq-1}else{return Math.max(eq,nu-ie)}}}};var av=function(nu,eq,r,ie){if(nu>r){return nu}else{if(nu<eq){return eq}else{if(nu===r){return r+1}else{return Math.min(r,nu+ie)}}}};var nE=function(ie,eq,r){return Math.max(eq,Math.min(r,ie))};var ue=function(on,ui,eq,r,nu,ie){return ie.fold(function(){var yJ=ui-eq;var yK=Math.round(yJ/nu)*nu;return nE(eq+yK,eq-1,r+1)},function(yP){var yO=(ui-yP)%nu;var yL=Math.round(yO/nu);var yJ=Math.floor((ui-yP)/nu);var yK=Math.floor((r-yP)/nu);var yM=Math.min(yK,yJ+yL);var yN=yP+yM*nu;return Math.max(yP,yN)})};var rx=function(r,on,yL,nu,ie,yM,yN){var ui=yL-on;if(nu<r.left){return on-1}else{if(nu>r.right){return yL+1}else{var yK=Math.min(r.right,Math.max(nu,r.left))-r.left;var eq=nE(yK/r.width*ui+on,on-1,yL+1);var yJ=Math.round(eq);return yM&&eq>=on&&eq<=yL?ue(r,eq,on,yL,ie,yN):yJ}}};var hI="slider.change.value";var iu=jz.detect().deviceType.isTouch();var ef=function(ie){var eq=ie.event().raw();if(iu){var r=eq;return r.touches!==undefined&&r.touches.length===1?tP.some(r.touches[0]).map(function(on){return se(on.clientX,on.clientY)}):tP.none()}else{var nu=eq;return nu.clientX!==undefined?tP.some(nu).map(function(on){return se(on.clientX,on.clientY)}):tP.none()}};var ku=function(eq){var r=ef(eq);return r.map(function(ie){return ie.left()})};var jU=function(r,eq){b8(r,hI,{value:eq})};var cx=function(eq,r){jU(eq,r.max()+1)};var kU=function(eq,r){jU(eq,r.min()-1)};var f9=function(r,eq,nu,ie){var on=rx(eq,nu.min(),nu.max(),ie,nu.stepSize(),nu.snapToGrid(),nu.snapStart());jU(r,on)};var n4=function(r,ie,eq,nu){return ku(nu).map(function(on){f9(r,eq,ie,on);return on})};var s6=function(r,eq){var ie=lC(eq.value().get(),eq.min(),eq.max(),eq.stepSize());jU(r,ie)};var gt=function(r,eq){var ie=av(eq.value().get(),eq.min(),eq.max(),eq.stepSize());jU(r,ie)};var mR=function(){return hI};var nG=jz.detect();var dv=nG.deviceType.isTouch();var cO=function(r,eq){return sG({name:""+r+"-edge",overrides:function(nu){var on=hf([m0(ye(),eq,[nu])]);var ie=hf([m0(vx(),eq,[nu]),m0(oc(),function(ui,yJ){if(yJ.mouseIsDown().get()){eq(ui,yJ)}},[nu])]);return{events:dv?on:ie}}})};var mC=cO("left",kU);var bD=cO("right",cx);var tl=jv({name:"thumb",defaults:fY({dom:{styles:{position:"absolute"}}}),overrides:function(r){return{events:hf([mG(ye(),r,"spectrum"),mG(bk(),r,"spectrum"),mG(lk(),r,"spectrum")])}}});var xt=jv({schema:[bf("mouseIsDown",function(){return hr(false)})],name:"spectrum",overrides:function(ie){var eq=function(on,yK){var yJ=on.element().dom();var ui=yJ.getBoundingClientRect();n4(on,ie,ui,yK)};var nu=hf([cv(ye(),eq),cv(bk(),eq)]);var r=hf([cv(vx(),eq),cv(oc(),function(on,ui){if(ie.mouseIsDown().get()){eq(on,ui)}})]);return{behaviours:h4(dv?[]:[x2.config({mode:"special",onLeft:function(on){s6(on,ie);return tP.some(true)},onRight:function(on){gt(on,ie);return tP.some(true)}}),fq.config({})]),events:dv?nu:r}}});var hG=[mC,bD,tl,xt];var mY=function(eq,ie,r){ie.store().manager().onLoad(eq,ie,r)};var qJ=function(eq,ie,r){ie.store().manager().onUnload(eq,ie,r)};var iW=function(eq,ie,r,nu){ie.store().manager().setValue(eq,ie,r,nu)};var cp=function(eq,ie,r){return ie.store().manager().getValue(eq,ie,r)};var yF=Object.freeze({onLoad:mY,onUnload:qJ,setValue:iW,getValue:cp});var ni=function(eq,r){var ie=eq.resetOnDom()?[eQ(function(nu,on){mY(nu,eq,r)}),bo(function(nu,on){qJ(nu,eq,r)})]:[cU(eq,r,mY)];return hf(ie)};var k3=Object.freeze({events:ni});var eC=function(){var nu=hr(null);var ie=function(){return{mode:"memory",value:nu.get()}};var eq=function(){return nu.get()===null};var r=function(){nu.set(null)};return wh({set:nu.set,get:nu.get,isNotSet:eq,clear:r,readState:ie})};var p4=function(){var r=function(){};return wh({readState:r})};var pn=function(){var eq=hr({});var r=function(){return{mode:"dataset",dataset:eq.get()}};return wh({readState:r,set:eq.set,get:eq.get})};var jF=function(r){return r.store().manager().state(r)};var e8=Object.freeze({memory:eC,dataset:pn,manual:p4,init:jF});var oQ=function(eq,ie,r,nu){var on=ie.store().getDataKey();r.set({});ie.store().setData()(eq,nu);ie.onSetValue()(eq,nu)};var bQ=function(eq,nu,r){var ie=nu.store().getDataKey()(eq);var on=r.get();return fr(on,ie).fold(function(){return nu.store().getFallbackEntry()(ie)},function(ui){return ui})};var mW=function(eq,ie,r){ie.store().initialValue().each(function(nu){oQ(eq,ie,r,nu)})};var dq=function(eq,ie,r){r.set({})};var fg=[jr("initialValue"),o("getFallbackEntry"),o("getDataKey"),o("setData"),cC("manager",{setValue:oQ,getValue:bQ,onLoad:mW,onUnload:dq,state:pn})];var bO=function(eq,ie,r){return ie.store().getValue()(eq)};var oP=function(eq,ie,r,nu){ie.store().setValue()(eq,nu);ie.onSetValue()(eq,nu)};var mU=function(eq,ie,r){ie.store().initialValue().each(function(nu){ie.store().setValue()(eq,nu)})};var v1=[o("getValue"),qA("setValue",S),jr("initialValue"),cC("manager",{setValue:oP,getValue:bO,onLoad:mU,onUnload:S,state:jp.init})];var oN=function(eq,ie,r,nu){r.set(nu);ie.onSetValue()(eq,nu)};var bN=function(eq,ie,r){return r.get()};var mT=function(eq,ie,r){ie.store().initialValue().each(function(nu){if(r.isNotSet()){r.set(nu)}})};var dp=function(eq,ie,r){r.clear()};var n6=[jr("initialValue"),cC("manager",{setValue:oN,getValue:bN,onLoad:mT,onUnload:dp,state:eC})];var kg=[fV("store",{mode:"memory"},c5("mode",{memory:n6,manual:v1,dataset:fg})),fc("onSetValue"),qA("resetOnDom",false)];var sJ=tE({fields:kg,name:"representing",active:k3,apis:yF,extra:{setValueFrom:function(r,ie){var eq=sJ.getValue(ie);sJ.setValue(r,eq)}},state:e8});var dt=jz.detect().deviceType.isTouch();var dg=[o("min"),o("max"),qA("stepSize",1),qA("onChange",S),qA("onInit",S),qA("onDragStart",S),qA("onDragEnd",S),qA("snapToGrid",false),jr("snapStart"),o("getInitialValue"),bA("sliderBehaviours",[x2,sJ]),bf("value",function(r){return hr(r.min)})].concat(!dt?[bf("mouseIsDown",function(){return hr(false)})]:[]);var cN=va("width",function(r){return r.dom().offsetWidth});var iO=function(r,eq){cN.set(r,eq)};var aV=function(r){return cN.get(r)};var fG=function(r){return cN.getOuter(r)};var xC=function(ie,nu){var eq=["margin-left","border-left-width","padding-left","padding-right","border-right-width","margin-right"];var r=cN.max(ie,nu,eq);cL.set(ie,"max-width",r+"px")};var rr={set:iO,get:aV,getOuter:fG,setMax:xC};var dr=jz.detect().deviceType.isTouch();var ep=function(ui,ie,yQ,yP){var yO=ui.max()-ui.min();var eq=function(yR){var yS=yR.element().dom().getBoundingClientRect();return(yS.left+yS.right)/2};var yL=function(yR){return pC(yR,ui,"thumb")};var yK=function(yU,yS,yT){var yR=yT.value().get();if(yR<yT.min()){return ph(yU,yT,"left-edge").fold(function(){return 0},function(yV){return eq(yV)-yS.left})}else{if(yR>yT.max()){return ph(yU,yT,"right-edge").fold(function(){return yS.width},function(yV){return eq(yV)-yS.left})}else{return(yT.value().get()-yT.min())/yO*yS.width}}};var nu=function(yV){var yR=pC(yV,ui,"spectrum");var yS=yR.element().dom().getBoundingClientRect();var yU=yV.element().dom().getBoundingClientRect();var yT=yK(yV,yS,ui);return yS.left-yU.left+yT};var yM=function(yS){var yU=nu(yS);var yR=yL(yS);var yT=rr.get(yR.element())/2;cL.set(yR.element(),"left",yU-yT+"px")};var yJ=function(yT,yU){var yS=ui.value().get();var yR=yL(yT);if(yS!==yU||cL.getRaw(yR.element(),"left").isNone()){ui.value().set(yU);yM(yT);ui.onChange()(yT,yR,yU);return tP.some(true)}else{return tP.none()}};var on=function(yR){yJ(yR,ui.min())};var yN=function(yR){yJ(yR,ui.max())};var r=dr?[cv(ye(),function(yS,yR){ui.onDragStart()(yS,yL(yS))}),cv(lk(),function(yS,yR){ui.onDragEnd()(yS,yL(yS))})]:[cv(vx(),function(yS,yR){yR.stop();ui.onDragStart()(yS,yL(yS));ui.mouseIsDown().set(true)}),cv(rg(),function(yS,yR){ui.onDragEnd()(yS,yL(yS));ui.mouseIsDown().set(false)})];return{uid:ui.uid(),dom:ui.dom(),components:ie,behaviours:eH(h4(jW([!dr?[x2.config({mode:"special",focusIn:function(yR){return ph(yR,ui,"spectrum").map(x2.focusIn).map(fY(true))}})]:[],[sJ.config({store:{mode:"manual",getValue:function(yR){return ui.value().get()}}})]])),aW(ui.sliderBehaviours())),events:hf([cv(mR(),function(yS,yR){yJ(yS,yR.event().value())}),eQ(function(yT,yS){ui.value().set(ui.getInitialValue()());var yR=yL(yT);yM(yT);ui.onInit()(yT,yR,ui.value().get())})].concat(r)),apis:{resetToMin:on,resetToMax:yN,refresh:yM},domModification:{styles:{position:"relative"}}}};var jY=uk({name:"Slider",configFields:dg,partFields:hG,factory:ep,apis:{resetToMin:function(r,eq){r.resetToMin(eq)},resetToMax:function(r,eq){r.resetToMax(eq)},refresh:function(r,eq){r.refresh(eq)}}});var sW=function(r,ie,eq){return eV.forToolbar(ie,function(){var nu=eq();r.setContextToolbar([{label:ie+" group",items:nu}])},{})};var xK=-1;var ka=function(ie){var nu=function(on){if(on<0){return"black"}else{if(on>360){return"white"}else{return"hsl("+on+", 100%, 50%)"}}};var eq=function(yJ,ui,yK){var on=nu(yK);cL.set(ui.element(),"background-color",on)};var r=function(yJ,ui,yK){var on=nu(yK);cL.set(ui.element(),"background-color",on);ie.onChange(yJ,ui,on)};return jY.sketch({dom:jt('<div class="${prefix}-slider ${prefix}-hue-slider-container"></div>'),components:[jY.parts()["left-edge"](hk('<div class="${prefix}-hue-slider-black"></div>')),jY.parts().spectrum({dom:jt('<div class="${prefix}-slider-gradient-container"></div>'),components:[hk('<div class="${prefix}-slider-gradient"></div>')],behaviours:h4([my.config({toggleClass:eL.resolve("thumb-active")})])}),jY.parts()["right-edge"](hk('<div class="${prefix}-hue-slider-white"></div>')),jY.parts().thumb({dom:jt('<div class="${prefix}-slider-thumb"></div>'),behaviours:h4([my.config({toggleClass:eL.resolve("thumb-active")})])})],onChange:r,onDragStart:function(ui,on){my.on(on)},onDragEnd:function(ui,on){my.off(on)},onInit:eq,stepSize:10,min:0,max:360,getInitialValue:ie.getInitialValue,sliderBehaviours:h4([dx.orientation(jY.refresh)])})};var qX=function(r){return[ka(r)]};var eo=function(r,eq){var ie={onChange:function(ui,on,nu){eq.undoManager.transact(function(){eq.formatter.apply("forecolor",{value:nu});eq.nodeChanged()})},getInitialValue:function(){return xK}};return sW(r,"color",function(){return qX(ie)})};var oV={makeItems:qX,sketch:eo};var dF=ih([o("getInitialValue"),o("onChange"),o("category"),o("sizes")]);var em=function(eq){var ie=rF("SizeSlider",dF,eq);var nu=function(on){return on>=0&&on<ie.sizes.length};var r=function(ui,on,yJ){if(nu(yJ)){ie.onChange(yJ)}};return jY.sketch({dom:{tag:"div",classes:[eL.resolve("slider-"+ie.category+"-size-container"),eL.resolve("slider"),eL.resolve("slider-size-container")]},onChange:r,onDragStart:function(ui,on){my.on(on)},onDragEnd:function(ui,on){my.off(on)},min:0,max:ie.sizes.length-1,stepSize:1,getInitialValue:ie.getInitialValue,snapToGrid:true,sliderBehaviours:h4([dx.orientation(jY.refresh)]),components:[jY.parts().spectrum({dom:jt('<div class="${prefix}-slider-size-container"></div>'),components:[hk('<div class="${prefix}-slider-size-line"></div>')]}),jY.parts().thumb({dom:jt('<div class="${prefix}-slider-thumb"></div>'),behaviours:h4([my.config({toggleClass:eL.resolve("thumb-active")})])})]})};var fn={sketch:em};var iq=["9px","10px","11px","12px","14px","16px","18px","20px","24px","32px","36px"];var uP="medium";var mN=2;var rY=function(r){return tP.from(iq[r])};var eW=function(r){return qx(iq,function(eq){return eq===r})};var sA=function(eq,ie){var r=iI.isElement(ie)?tP.some(ie):yb.parent(ie);return r.map(function(on){var nu=gO.closest(on,function(ui){return cL.getRaw(ui,"font-size").isSome()},eq).bind(function(ui){return cL.getRaw(ui,"font-size")});return nu.getOrThunk(function(){return cL.get(on,"font-size")})}).getOr("")};var xy=function(ie){var on=ie.selection.getStart();var nu=pO.fromDom(on);var r=pO.fromDom(ie.getBody());var eq=function(yJ){return gb.eq(r,yJ)};var ui=sA(eq,nu);return sy(iq,function(yJ){return ui===yJ}).getOr(uP)};var t=function(eq,ie){var r=xy(eq);if(r!==ie){eq.execCommand("fontSize",false,ie)}};var aU=function(eq){var r=xy(eq);return eW(r).getOr(mN)};var bC=function(eq,r){rY(r).each(function(ie){t(eq,ie)})};var c6={candidates:fY(iq),get:aU,apply:bC};var H=c6.candidates();var fN=function(r){return fn.sketch({onChange:r.onChange,sizes:H,category:"font",getInitialValue:r.getInitialValue})};var rw=function(r){return[hk('<span class="${prefix}-toolbar-button ${prefix}-icon-small-font ${prefix}-icon"></span>'),fN(r),hk('<span class="${prefix}-toolbar-button ${prefix}-icon-large-font ${prefix}-icon"></span>')]};var el=function(r,eq){var ie={onChange:function(nu){c6.apply(eq,nu)},getInitialValue:function(){return c6.get(eq)}};return sW(r,"font-size",function(){return rw(ie)})};var ct=function(eq){var on=kr(eq)&&p3(eq,"uid")?eq.uid:uN("memento");var nu=function(ui){return ui.getSystem().getByUid(on).getOrDie()};var ie=function(ui){return ui.getSystem().getByUid(on).fold(tP.none,tP.some)};var r=function(){return eH(eq,{uid:on})};return{get:nu,getOpt:ie,asSpec:r}};function tC(eq,r){return qp(document.createElement("canvas"),eq,r)}function op(eq){var ie,r;ie=tC(eq.width,eq.height);r=uf(ie);r.drawImage(eq,0,0);return ie}function uf(r){return r.getContext("2d")}function fi(r){var ie=null;try{ie=r.getContext("webgl")||r.getContext("experimental-webgl")}catch(eq){}if(!ie){ie=null}return ie}function qp(eq,ie,r){eq.width=ie;eq.height=r;return eq}var sU={create:tC,clone:op,resize:qp,get2dContext:uf,get3dContext:fi};function gR(r){return r.naturalWidth||r.width}function xX(r){return r.naturalHeight||r.height}var hU={getWidth:gR,getHeight:xX};var a6=function(){var yJ=function(yN){if(typeof this!=="object"){throw new TypeError("Promises must be constructed via new")}if(typeof yN!=="function"){throw new TypeError("not a function")}this._state=null;this._value=null;this._deferreds=[];yL(yN,ui(yK,this),ui(yM,this))};var r=yJ.immediateFn||typeof setImmediate==="function"&&setImmediate||function(yN){setTimeout(yN,1)};function ui(yO,yN){return function(){yO.apply(yN,arguments)}}var eq=Array.isArray||function(yN){return Object.prototype.toString.call(yN)==="[object Array]"};function ie(yN){var yO=this;if(this._state===null){this._deferreds.push(yN);return}r(function(){var yP=yO._state?yN.onFulfilled:yN.onRejected;if(yP===null){(yO._state?yN.resolve:yN.reject)(yO._value);return}var yQ;try{yQ=yP(yO._value)}catch(yR){yN.reject(yR);return}yN.resolve(yQ)})}function yK(yO){try{if(yO===this){throw new TypeError("A promise cannot be resolved with itself.")}if(yO&&(typeof yO==="object"||typeof yO==="function")){var yP=yO.then;if(typeof yP==="function"){yL(ui(yP,yO),ui(yK,this),ui(yM,this));return}}this._state=true;this._value=yO;nu.call(this)}catch(yN){yM.call(this,yN)}}function yM(yN){this._state=false;this._value=yN;nu.call(this)}function nu(){for(var yO=0,yN=this._deferreds.length;yO<yN;yO++){ie.call(this,this._deferreds[yO])}this._deferreds=null}function on(yQ,yN,yP,yO){this.onFulfilled=typeof yQ==="function"?yQ:null;this.onRejected=typeof yN==="function"?yN:null;this.resolve=yP;this.reject=yO}function yL(yQ,yR,yO){var yN=false;try{yQ(function(yS){if(yN){return}yN=true;yR(yS)},function(yS){if(yN){return}yN=true;yO(yS)})}catch(yP){if(yN){return}yN=true;yO(yP)}}yJ.prototype["catch"]=function(yN){return this.then(null,yN)};yJ.prototype.then=function(yP,yN){var yO=this;return new yJ(function(yR,yQ){ie.call(yO,new on(yP,yN,yR,yQ))})};yJ.all=function(){var yN=Array.prototype.slice.call(arguments.length===1&&eq(arguments[0])?arguments[0]:arguments);return new yJ(function(yS,yR){if(yN.length===0){return yS([])}var yQ=yN.length;function yP(yU,yW){try{if(yW&&(typeof yW==="object"||typeof yW==="function")){var yV=yW.then;if(typeof yV==="function"){yV.call(yW,function(yX){yP(yU,yX)},yR);return}}yN[yU]=yW;if(--yQ===0){yS(yN)}}catch(yT){yR(yT)}}for(var yO=0;yO<yN.length;yO++){yP(yO,yN[yO])}})};yJ.resolve=function(yN){if(yN&&typeof yN==="object"&&yN.constructor===yJ){return yN}return new yJ(function(yO){yO(yN)})};yJ.reject=function(yN){return new yJ(function(yP,yO){yO(yN)})};yJ.race=function(yN){return new yJ(function(yR,yQ){for(var yP=0,yO=yN.length;yP<yO;yP++){yN[yP].then(yR,yQ)}})};return yJ};var nC=window.Promise?window.Promise:a6();function sV(ie,r){var eq=bY.getOrDie("Blob");return new eq(ie,r)}function kQ(){var r=bY.getOrDie("FileReader");return new r()}function ec(r){var eq=bY.getOrDie("Uint8Array");return new eq(r)}var jx=function(eq){var r=bY.getOrDie("requestAnimationFrame");r(eq)};var nz=function(r){var eq=bY.getOrDie("atob");return eq(r)};var P={atob:nz,requestAnimationFrame:jx};function lL(r){var eq=r.src;if(eq.indexOf("data:")===0){return bM(eq)}return d7(eq)}function lT(r){return new nC(function(yJ,ui){var eq=URL.createObjectURL(r);var yK=new Image();var on=function(){yK.removeEventListener("load",nu);yK.removeEventListener("error",ie)};function nu(){on();yJ(yK)}function ie(){on();ui("Unable to load data of type "+r.type+": "+eq)}yK.addEventListener("load",nu);yK.addEventListener("error",ie);yK.src=eq;if(yK.complete){nu()}})}function d7(r){return new nC(function(ie,eq){var nu=new XMLHttpRequest();nu.open("GET",r,true);nu.responseType="blob";nu.onload=function(){if(this.status==200){ie(this.response)}};nu.onerror=function(){var yJ=this;var ui=function(){var yK=new Error("No access to download image");yK.code=18;yK.name="SecurityError";return yK};var on=function(){return new Error("Error "+yJ.status+" downloading image")};eq(this.status===0?ui():on())};nu.send()})}function qa(eq){var yL=eq.split(",");var yM=/data:([^;]+)/.exec(yL[0]);if(!yM){return tP.none()}var yR=yM[1];var yN=yL[1];var ie=1024;var yO=P.atob(yN);var yQ=yO.length;var yK=Math.ceil(yQ/ie);var yP=new Array(yK);for(var nu=0;nu<yK;++nu){var r=nu*ie;var on=Math.min(r+ie,yQ);var yS=new Array(on-r);for(var ui=r,yJ=0;ui<on;++yJ,++ui){yS[yJ]=yO[ui].charCodeAt(0)}yP[nu]=ec(yS)}return tP.some(sV(yP,{type:yR}))}function bM(r){return new nC(function(ie,eq){qa(r).fold(function(){eq("uri is not base64: "+r)},ie)})}function o8(r){if(r.indexOf("blob:")===0){return d7(r)}if(r.indexOf("data:")===0){return bM(r)}return null}function hy(r,eq,ie){eq=eq||"image/png";if(HTMLCanvasElement.prototype.toBlob){return new nC(function(nu){r.toBlob(function(on){nu(on)},eq,ie)})}else{return bM(r.toDataURL(eq,ie))}}function uj(r,eq,ie){eq=eq||"image/png";return r.then(function(nu){return nu.toDataURL(eq,ie)})}function pa(r){return lT(r).then(function(nu){oM(nu);var ie,eq;eq=sU.create(hU.getWidth(nu),hU.getHeight(nu));ie=sU.get2dContext(eq);ie.drawImage(nu,0,0);return eq})}function u(r){return new nC(function(ie){var eq=new kQ();eq.onloadend=function(){ie(eq.result)};eq.readAsDataURL(r)})}function tn(r){return new nC(function(ie){var eq=new kQ();eq.onloadend=function(){ie(eq.result)};eq.readAsArrayBuffer(r)})}function hH(r){return u(r).then(function(eq){return eq.split(",")[1]})}function oM(r){URL.revokeObjectURL(r.src)}var qD={blobToImage:lT,imageToBlob:lL,blobToArrayBuffer:tn,blobToDataUri:u,blobToBase64:hH,dataUriToBlobSync:qa,canvasToBlob:hy,canvasToDataURL:uj,blobToCanvas:pa,uriToBlob:o8};var t5=function(r){return qD.blobToImage(r)};var lh=function(r){return qD.imageToBlob(r)};var mw=function(r){return qD.blobToDataUri(r)};var hW=function(r){return qD.blobToBase64(r)};var nV=function(r){return qD.dataUriToBlobSync(r)};var uy=function(r){return tP.from(qD.uriToBlob(r))};var i2={blobToImage:t5,imageToBlob:lh,blobToDataUri:mw,blobToBase64:hW,dataUriToBlobSync:nV,uriToBlob:uy};var r9=function(eq,r){i2.blobToBase64(r).then(function(ie){eq.undoManager.transact(function(){var on=eq.editorUpload.blobCache;var ui=on.create(uS("mceu"),r,ie);on.add(ui);var nu=eq.dom.createHTML("img",{src:ui.blobUri()});eq.insertContent(nu)})})};var uz=function(ie){var eq=ie.event();var r=eq.raw().target.files||eq.raw().dataTransfer.files;return tP.from(r[0])};var ei=function(r){var eq={tag:"input",attributes:{accept:"image/*",type:"file",title:""},styles:{visibility:"hidden",position:"absolute"}};var ie=ct({dom:eq,events:hf([lD(tF()),cv(bh(),function(nu,on){uz(on).each(function(ui){r9(r,ui)})})])});return wK.sketch({dom:jt('<span class="${prefix}-toolbar-button ${prefix}-icon-image ${prefix}-icon"></span>'),components:[ie.asSpec()],action:function(on){var nu=ie.get(on);nu.element().dom().click()}})};var aT=function(r){return r.dom().textContent};var iN=function(r,eq){r.dom().textContent=eq};var oo={get:aT,set:iN};var bI=function(r){return r.length>0};var E=function(r){return r===undefined||r===null?"":r};var nQ=function(r){var eq=r.selection.getContent({format:"text"});return{url:"",text:eq,title:"",target:"",link:tP.none()}};var kd=function(eq){var on=oo.get(eq);var r=kh.get(eq,"href");var nu=kh.get(eq,"title");var ie=kh.get(eq,"target");return{url:E(r),text:on!==r?E(on):"",title:E(nu),target:E(ie),link:tP.some(eq)}};var og=function(r){return lP(r).fold(function(){return nQ(r)},function(eq){return kd(eq)})};var rk=function(eq){var ie=kh.get(eq,"href");var r=oo.get(eq);return ie===r};var b9=function(eq,r,ie){return ie.text.filter(bI).fold(function(){return rk(eq)?tP.some(r):tP.none()},tP.some)};var aw=function(r,eq){var ie=eq.link.bind(iC);ie.each(function(nu){r.execCommand("unlink")})};var wa=function(eq,ie){var r={};r.href=eq;ie.title.filter(bI).each(function(nu){r.title=nu});ie.target.filter(bI).each(function(nu){r.target=nu});return r};var pr=function(r,eq){eq.url.filter(bI).fold(function(){aw(r,eq)},function(nu){var ie=wa(nu,eq);var on=eq.link.bind(iC);on.fold(function(){var ui=eq.text.filter(bI).getOr(nu);r.insertContent(r.dom.createHTML("a",ie,r.dom.encode(ui)))},function(ui){var yJ=b9(ui,nu,eq);kh.setAll(ui,ie);yJ.each(function(yK){oo.set(ui,yK)})})})};var lP=function(r){var eq=pO.fromDom(r.selection.getStart());return yz.closest(eq,"a")};var nx={getInfo:og,applyInfo:pr,query:lP};var rV=jz.detect();var wn=function(ie,eq){var r=eq.selection.getRng();ie();eq.selection.setRng(r)};var tK=function(r,eq){var ie=rV.os.isAndroid()?wn:eu;ie(eq,r)};var yH={forAndroid:tK};var nh=function(r,ie){var eq=hf(ie);return tE({fields:[o("enabled")],name:r,active:{events:fY(eq)}})};var iJ=function(r,ie){var eq=nh(r,ie);return{key:r,value:{config:{},me:eq,configAsRaw:fY({}),initialConfig:{},state:jp}}};var tL=function(r,ie,eq){return ie.find()(r)};var tU=Object.freeze({getCurrent:tL});var m=[o("find")];var tf=tE({fields:m,name:"composing",apis:tU});var c3=function(r){return{uid:r.uid(),dom:eH({tag:"div",attributes:{role:"presentation"}},r.dom()),components:r.components(),behaviours:aW(r.containerBehaviours()),events:r.events(),domModification:r.domModification(),eventOrder:r.eventOrder()}};var sl=la({name:"Container",factory:c3,configFields:[qA("components",[]),bA("containerBehaviours",[]),qA("events",{}),qA("domModification",{}),qA("eventOrder",{})]});var c1=function(r){return{uid:r.uid(),dom:r.dom(),behaviours:eH(h4([sJ.config({store:{mode:"memory",initialValue:r.getInitialValue()()}}),tf.config({find:tP.some})]),aW(r.dataBehaviours())),events:hf([eQ(function(eq,ie){sJ.setValue(eq,r.getInitialValue()())})])}};var xR=la({name:"DataField",factory:c1,configFields:[o("uid"),o("dom"),o("getInitialValue"),bA("dataBehaviours",[sJ,tf])]});var aQ=function(r){return r.dom().value};var iM=function(r,eq){if(eq===undefined){throw new Error("Value.set was undefined")}r.dom().value=eq};var tk={set:iM,get:aQ};var dD=fY([jr("data"),qA("inputAttributes",{}),qA("inputStyles",{}),qA("type","input"),qA("tag","input"),qA("inputClasses",[]),fc("onSetValue"),qA("styles",{}),jr("placeholder"),qA("eventOrder",{}),bA("inputBehaviours",[sJ,fq]),qA("selectOnFocus",true)]);var mV=function(r){return h4([fq.config({onFocus:r.selectOnFocus()===false?S:function(ie){var eq=ie.element();var nu=tk.get(eq);eq.dom().setSelectionRange(0,nu.length)}})])};var un=function(r){return eH(h4([sJ.config({store:{mode:"manual",initialValue:r.data().getOr(undefined),getValue:function(eq){return tk.get(eq.element())},setValue:function(eq,ie){var nu=tk.get(eq.element());if(nu!==ie){tk.set(eq.element(),ie)}}},onSetValue:r.onSetValue()})]),mV(r),aW(r.inputBehaviours()))};var js=function(r){return{tag:r.tag(),attributes:eH(kN([{key:"type",value:r.type()}].concat(r.placeholder().map(function(eq){return{key:"placeholder",value:eq}}).toArray())),r.inputAttributes()),styles:r.inputStyles(),classes:r.inputClasses()}};var c0=function(eq,r){return{uid:eq.uid(),dom:js(eq),components:[],behaviours:un(eq),eventOrder:eq.eventOrder()}};var ut=la({name:"Input",configFields:dD(),factory:c0});var w0=function(r,eq){return wk({attributes:kN([{key:eq.tabAttr(),value:"true"}])})};var pH=Object.freeze({exhibit:w0});var md=[qA("tabAttr","data-alloy-tabstop")];var a1=tE({fields:md,name:"tabstopping",active:pH});var aS="input-clearing";var bz=function(eq,ie){var r=ct(ut.sketch({placeholder:ie,onSetValue:function(ui,on){J(ui,qL())},inputBehaviours:h4([tf.config({find:tP.some}),a1.config({}),x2.config({mode:"execution"})]),selectOnFocus:false}));var nu=ct(wK.sketch({dom:jt('<button class="${prefix}-input-container-x ${prefix}-icon-cancel-circle ${prefix}-icon"></button>'),action:function(on){var ui=r.get(on);sJ.setValue(ui,"")}}));return{name:eq,spec:sl.sketch({dom:jt('<div class="${prefix}-input-container"></div>'),components:[r.asSpec(),nu.asSpec()],containerBehaviours:h4([my.config({toggleClass:eL.resolve("input-container-empty")}),tf.config({find:function(on){return tP.some(r.get(on))}}),iJ(aS,[cv(qL(),function(on){var yK=r.get(on);var yJ=sJ.getValue(yK);var ui=yJ.length>0?my.off:my.on;ui(on)})])])})}};var gF=function(r){return{name:r,spec:xR.sketch({dom:{tag:"span",styles:{display:"none"}},getInitialValue:function(){return tP.none()}})}};var aO=["input","button","textarea"];var mS=function(eq,ie,r){if(ie.disabled()){gi(eq,ie,r)}};var hd=function(r){return hZ(aO,iI.name(r.element()))};var na=function(r){return kh.has(r.element(),"disabled")};var ae=function(r){kh.set(r.element(),"disabled","disabled")};var kH=function(r){kh.remove(r.element(),"disabled")};var jg=function(r){return kh.get(r.element(),"aria-disabled")==="true"};var vS=function(r){kh.set(r.element(),"aria-disabled","true")};var eN=function(r){kh.set(r.element(),"aria-disabled","false")};var gi=function(eq,nu,r){nu.disableClass().each(function(on){rG.add(eq.element(),on)});var ie=hd(eq)?ae:vS;ie(eq)};var nN=function(eq,nu,r){nu.disableClass().each(function(on){rG.remove(eq.element(),on)});var ie=hd(eq)?kH:eN;ie(eq)};var f0=function(r){return hd(r)?na(r):jg(r)};var jq=Object.freeze({enable:nN,disable:gi,isDisabled:f0,onLoad:mS});var wZ=function(eq,ie,r){return wk({classes:ie.disabled()?ie.disableClass().map(qT).getOr([]):[]})};var nf=function(eq,r){return hf([fT(xi(),function(ie,nu){return f0(ie)}),cU(eq,r,mS)])};var ci=Object.freeze({exhibit:wZ,events:nf});var hC=[qA("disabled",false),jr("disableClass")];var pU=tE({fields:hC,name:"disabling",active:ci,apis:jq});var gV="form";var dC=[bA("formBehaviours",[sJ])];var vv=function(r){return"<alloy.field."+r+">"};var eh=function(ie){var on=function(){var ui=[];var yJ=function(yL,yK){ui.push(yL);return xc(gV,vv(yL),yK)};return{field:yJ,record:function(){return ui}}}();var eq=ie(on);var r=on.record();var nu=r5(r,function(ui){return jv({name:ui,pname:vv(ui)})});return eJ(gV,dC,nu,dl,eq)};var dl=function(eq,ie,r){return eH({"debug.sketcher":{Form:r},uid:eq.uid(),dom:eq.dom(),components:ie,behaviours:eH(h4([sJ.config({store:{mode:"manual",getValue:function(nu){var on=im(nu,eq);return u5(on,function(ui,yJ){return ui().bind(tf.getCurrent).map(sJ.getValue)})},setValue:function(on,nu){tS(nu,function(yJ,ui){ph(on,eq,ui).each(function(yK){tf.getCurrent(yK).each(function(yL){sJ.setValue(yL,yJ)})})})}}})]),aW(eq.formBehaviours())),apis:{getField:function(on,nu){return ph(on,eq,nu).bind(tf.getCurrent)}}})};var T={getField:xU(function(ie,r,eq){return ie.getField(r,eq)}),sketch:eh};var cM=function(){var eq=hr(tP.none());var nu=function(){eq.get().each(function(yJ){yJ.destroy()})};var r=function(){nu();eq.set(tP.none())};var ui=function(yJ){nu();eq.set(tP.some(yJ))};var on=function(yJ){eq.get().each(yJ)};var ie=function(){return eq.get().isSome()};return{clear:r,isSet:ie,set:ui,run:on}};var o3=function(){var ie=hr(tP.none());var r=function(){ie.set(tP.none())};var ui=function(on){ie.set(tP.some(on))};var eq=function(on){ie.get().each(on)};var nu=function(){return ie.get().isSome()};return{clear:r,set:ui,isSet:nu,on:eq}};var bv=1;var lW=-1;var ld=0;var jE=function(r){return{xValue:r,points:[]}};var nY=function(eq,ie){if(ie===eq.xValue){return eq}var on=ie-eq.xValue>0?bv:lW;var r={direction:on,xValue:ie};var nu=function(){if(eq.points.length===0){return[]}else{var ui=eq.points[eq.points.length-1];return ui.direction===on?eq.points.slice(0,eq.points.length-1):eq.points}}();return{xValue:ie,points:nu.concat([r])}};var dc=function(r){if(r.points.length===0){return ld}else{var ie=r.points[0].direction;var eq=r.points[r.points.length-1].direction;return ie===lW&&eq===lW?lW:ie===bv&&eq===bv?bv:ld}};var hz={init:jE,move:nY,complete:dc};var eg=function(yK){var yL="navigateEvent";var yN="serializer-wrapper-events";var on="form-events";var nu=aL([o("fields"),qA("maxFieldIndex",yK.fields.length-1),o("onExecute"),o("getInitialValue"),bf("state",function(){return{dialogSwipeState:o3(),currentScreen:hr(0)}})]);var ui=rF("SerialisedDialog",nu,yK);var yP=function(yS,yR,yQ){return wK.sketch({dom:jt('<span class="${prefix}-icon-'+yR+' ${prefix}-icon"></span>'),action:function(yT){b8(yT,yL,{direction:yS})},buttonBehaviours:h4([pU.config({disableClass:eL.resolve("toolbar-navigation-disabled"),disabled:!yQ})])})};var yO=function(yQ,yR){yz.descendant(yQ.element(),"."+eL.resolve("serialised-dialog-chain")).each(function(yS){cL.set(yS,"left",-ui.state.currentScreen.get()*yR.width+"px")})};var ie=function(yR,yS){var yQ=kR.descendants(yR.element(),"."+eL.resolve("serialised-dialog-screen"));yz.descendant(yR.element(),"."+eL.resolve("serialised-dialog-chain")).each(function(yT){if(ui.state.currentScreen.get()+yS>=0&&ui.state.currentScreen.get()+yS<yQ.length){cL.getRaw(yT,"left").each(function(yW){var yV=parseInt(yW,10);var yU=rr.get(yQ[0]);cL.set(yT,"left",yV-yS*yU+"px")});ui.state.currentScreen.set(ui.state.currentScreen.get()+yS)}})};var yJ=function(yS){var yQ=kR.descendants(yS.element(),"input");var yR=tP.from(yQ[ui.state.currentScreen.get()]);yR.each(function(yU){yS.getSystem().getByDom(yU).each(function(yV){ew(yS,yV.element())})});var yT=yM.get(yS);lK.highlightAt(yT,ui.state.currentScreen.get())};var eq=function(){ui.state.currentScreen.set(0);ui.state.dialogSwipeState.clear()};var r=ct(T.sketch(function(yQ){return{dom:jt('<div class="${prefix}-serialised-dialog"></div>'),components:[sl.sketch({dom:jt('<div class="${prefix}-serialised-dialog-chain" style="left: 0px; position: absolute;"></div>'),components:r5(ui.fields,function(yR,yS){return yS<=ui.maxFieldIndex?sl.sketch({dom:jt('<div class="${prefix}-serialised-dialog-screen"></div>'),components:jW([[yP(-1,"previous",yS>0)],[yQ.field(yR.name,yR.spec)],[yP(+1,"next",yS<ui.maxFieldIndex)]])}):yQ.field(yR.name,yR.spec)})})],formBehaviours:h4([dx.orientation(function(yR,yS){yO(yR,yS)}),x2.config({mode:"special",focusIn:function(yR){yJ(yR)},onTab:function(yR){ie(yR,+1);return tP.some(true)},onShiftTab:function(yR){ie(yR,-1);return tP.some(true)}}),iJ(on,[eQ(function(yR,yS){eq();var yT=yM.get(yR);lK.highlightFirst(yT);ui.getInitialValue(yR).each(function(yU){sJ.setValue(yR,yU)})}),oS(ui.onExecute),cv(i3(),function(yR,yT){var yS=yT.event();if(yS.raw().propertyName==="left"){yJ(yR)}}),cv(yL,function(yR,yT){var yS=yT.event();var yU=yS.direction();ie(yR,yU)})])])}}));var yM=ct({dom:jt('<div class="${prefix}-dot-container"></div>'),behaviours:h4([lK.config({highlightClass:eL.resolve("dot-active"),itemClass:eL.resolve("dot-item")})]),components:hw(ui.fields,function(yR,yQ){return yQ<=ui.maxFieldIndex?[hk('<div class="${prefix}-dot-item ${prefix}-icon-full-dot ${prefix}-icon"></div>')]:[]})});return{dom:jt('<div class="${prefix}-serializer-wrapper"></div>'),components:[r.asSpec(),yM.asSpec()],behaviours:h4([x2.config({mode:"special",focusIn:function(yR){var yQ=r.get(yR);x2.focusIn(yQ)}}),iJ(yN,[cv(ye(),function(yS,yR){var yQ=yR.event();ui.state.dialogSwipeState.set(hz.init(yQ.touches[0].clientX))}),cv(bk(),function(yS,yR){var yQ=yR.event();ui.state.dialogSwipeState.on(function(yT){yR.event().prevent();ui.state.dialogSwipeState.set(hz.move(yT,yQ.raw().touches[0].clientX))})}),cv(lk(),function(yQ){ui.state.dialogSwipeState.on(function(yS){var yR=r.get(yQ);var yT=-1*hz.complete(yS);ie(yR,yT)})})])])}};var hA=oJ(function(r,eq){return[{label:"the link group",items:[eg({fields:[bz("url","Type or paste URL"),bz("text","Link text"),bz("title","Link title"),bz("target","Link target"),gF("link")],maxFieldIndex:["url","text","title","target"].length-1,getInitialValue:function(){return tP.some(nx.getInfo(eq))},onExecute:function(ie){var nu=sJ.getValue(ie);nx.applyInfo(eq,nu);r.restoreToolbar();eq.focus()}})]}]});var ee=function(r,eq){return eV.forToolbarStateAction(eq,"link","link",function(){var ie=hA(r,eq);r.setContextToolbar(ie);yH.forAndroid(eq,function(){r.focusToolbar()});nx.query(eq).each(function(nu){eq.selection.select(nu.dom())})})};var pL=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}];var xG=function(r,ie,eq){return gb.eq(ie,r.element())&&!gb.eq(ie,eq)};var nd=hf([n(j(),function(r,eq){var nu=eq.event().originator();var ie=eq.event().target();if(xG(r,nu,ie)){console.warn(j()+" did not get interpreted by the desired target. \nOriginator: "+aE(nu)+"\nTarget: "+aE(ie)+"\nCheck the "+j()+" event handlers");return false}else{return true}})]);var eS=Object.freeze({events:nd});var j7=iC;var rJ=fy(["debugInfo","triggerFocus","triggerEvent","triggerEscape","addToWorld","removeFromWorld","addToGui","removeFromGui","build","getByUid","getByDom","broadcast","broadcastOn","isConnected"]);var bq=function(eq){var r=function(ie){return function(){throw new Error("The component must be in a context to send: "+ie+"\n"+aE(eq().element())+" is not in context.")}};return rJ({debugInfo:fY("fake"),triggerEvent:r("triggerEvent"),triggerFocus:r("triggerFocus"),triggerEscape:r("triggerEscape"),build:r("build"),addToWorld:r("addToWorld"),removeFromWorld:r("removeFromWorld"),addToGui:r("addToGui"),removeFromGui:r("removeFromGui"),getByUid:r("getByUid"),getByDom:r("getByDom"),broadcast:r("broadcast"),broadcastOn:r("broadcastOn"),isConnected:fY(false)})};var yj=function(r,eq){var ie=r5(eq,function(on){return d6(on.name(),[o("config"),qA("state",jp)])});var nu=p7("component.behaviours",aL(ie),r.behaviours).fold(function(on){throw new Error(fP(on)+"\nComplete spec:\n"+sI.stringify(r,null,2))},function(on){return on});return{list:eq,data:u5(nu,function(on){var yJ=on();var ui=yJ.map(function(yK){return{config:yK.config(),state:yK.state().init(yK.config())}});return function(){return ui}})}};var kY=function(r){return r.list};var an=function(r){return r.data};var nZ=function(nu,eq){var ie={};tS(nu,function(on,r){tS(on,function(yK,ui){var yJ=hc(ui,[])(ie);ie[ui]=yJ.concat([eq(r,yK)])})});return ie};var i5=function(ie,r){var eq=hw(ie,function(nu){return nu.modification().getOr([])});return l7.value(lX(r,eq))};var ql=function(eq,r){if(eq.length>1){return l7.error('Multiple behaviours have tried to change DOM "'+r+'". The guilty behaviours are: '+sI.stringify(r5(eq,function(ie){return ie.name()}))+". At this stage, this is not supported. Future releases might provide strategies for resolving this.")}else{if(eq.length===0){return l7.value({})}else{return l7.value(eq[0].modification().fold(function(){return{}},function(ie){return lX(r,ie)}))}}};var eR=function(eq,r,nu,ie){return l7.error("Mulitple behaviours have tried to change the _"+r+'_ "'+eq+'". The guilty behaviours are: '+sI.stringify(hw(ie,function(on){return on.modification().getOr({})[r]!==undefined?[on.name()]:[]}),null,2)+". This is not currently supported.")};var g1=function(eq,r){var ie=ok(eq,function(nu,ui){var on=ui.modification().getOr({});return nu.bind(function(yJ){var yK=jl(on,function(yM,yL){return yJ[yL]!==undefined?eR(r,yL,on,eq):l7.value(lX(yL,yM))});return gj(yK,yJ)})},l7.value({}));return ie.map(function(nu){return lX(r,nu)})};var dz={classes:i5,attributes:g1,styles:g1,domChildren:ql,defChildren:ql,innerHtml:ql,value:ql};var yu=function(nu,ui,yL,eq){var yM=eH({},ui);kV(yL,function(yN){yM[yN.name()]=yN.exhibit(nu,eq)});var yJ=function(yO,yN){return{name:function(){return yO},modification:yN}};var on=nZ(yM,yJ);var r=u5(on,function(yO,yN){return hw(yO,function(yP){return yP.modification().fold(function(){return[]},function(yQ){return[yP]})})});var yK=jl(r,function(yO,yN){return fr(dz,yN).fold(function(){return l7.error("Unknown field type: "+yN)},function(yP){return yP(yO,yN)})});var ie=gj(yK,{});return ie.map(wk)};var dk=function(nu,on,yJ,r){var ie=yJ.slice(0);try{var eq=ie.sort(function(yM,yK){var yP=yM[on]();var yO=yK[on]();var yN=r.indexOf(yP);var yL=r.indexOf(yO);if(yN===-1){throw new Error("The ordering for "+nu+" does not have an entry for "+yP+".\nOrder specified: "+sI.stringify(r,null,2))}if(yL===-1){throw new Error("The ordering for "+nu+" does not have an entry for "+yO+".\nOrder specified: "+sI.stringify(r,null,2))}if(yN<yL){return -1}else{if(yL<yN){return 1}else{return 0}}});return l7.value(eq)}catch(ui){return l7.error([ui])}};var t3=function(eq,r){return{handler:eq,purpose:fY(r)}};var wH=function(eq,r){return{cHandler:eq,purpose:fY(r)}};var pe=function(eq,r){return wH(mX.apply(undefined,[eq.handler].concat(r)),eq.purpose())};var pT=function(r){return r.cHandler};var kT=function(r,eq){return{name:fY(r),handler:fY(eq)}};var nR=function(ie,nu){var eq={};kV(ie,function(r){eq[r.name()]=r.handlers(nu)});return eq};var s=function(nu,eq,ie){var r=eH(ie,nR(eq,nu));return nZ(r,kT)};var yt=function(on,r,eq,nu){var ie=s(on,eq,nu);return fd(ie,r)};var le=function(eq){var r=lV(eq);return function(nu,ui){var on=[];for(var yJ=2;yJ<arguments.length;yJ++){on[yJ-2]=arguments[yJ]}var ie=[nu,ui].concat(on);if(r.abort.apply(undefined,ie)){ui.stop()}else{if(r.can.apply(undefined,ie)){r.run.apply(undefined,ie)}}}};var u9=function(r,eq){return l7.error(["The event ("+r+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+sI.stringify(r5(eq,function(ie){return ie.name()}),null,2)])};var gY=function(nu,ie,eq){var r=ie[eq];if(!r){return u9(eq,nu)}else{return dk("Event: "+eq,"name",nu,r).map(function(ui){var on=r5(ui,function(yJ){return yJ.handler()});return qO(on)})}};var fd=function(nu,eq){var ie=jl(nu,function(ui,r){var on=ui.length===1?l7.value(ui[0].handler()):gY(ui,eq,r);return on.map(function(yL){var yK=le(yL);var yJ=ui.length>1?l9(eq,function(yM){return hZ(ui,function(yN){return yN.name()===yM})}).join(" > "):ui[0].name();return lX(r,t3(yK,yJ))})});return gj(ie,{})};var qc=function(r){return p7("custom.definition",ih([wq("dom","dom",il(),ih([o("tag"),qA("styles",{}),qA("classes",[]),qA("attributes",{}),jr("value"),jr("innerHtml")])),o("components"),o("uid"),qA("events",{}),qA("apis",fY({})),wq("eventOrder","eventOrder",cn({"alloy.execute":["disabling","alloy.base.behaviour","toggling"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing"]}),r2()),jr("domModification"),yg("originalSpec"),qA("debug.sketcher","unknown")]),r)};var ao=function(r){return lX(t6(),r.uid())};var hb=function(r){var eq={tag:r.dom().tag(),classes:r.dom().classes(),attributes:eH(ao(r),r.dom().attributes()),styles:r.dom().styles(),domChildren:r5(r.components(),function(ie){return ie.element()})};return wo(eH(eq,r.dom().innerHtml().map(function(ie){return lX("innerHtml",ie)}).getOr({}),r.dom().value().map(function(ie){return lX("value",ie)}).getOr({})))};var c8=function(r){return r.domModification().fold(function(){return wk({})},wk)};var sQ=function(r){return r.events()};var cj=function(eq,r){kV(r,function(ie){rG.add(eq,ie)})};var a7=function(eq,r){kV(r,function(ie){rG.remove(eq,ie)})};var jG=function(eq,r){kV(r,function(ie){rG.toggle(eq,ie)})};var kt=function(eq,r){return t0(r,function(ie){return rG.has(eq,ie)})};var jM=function(eq,r){return h5(r,function(ie){return rG.has(eq,ie)})};var vb=function(ie){var on=ie.dom().classList;var nu=new Array(on.length);for(var eq=0;eq<on.length;eq++){nu[eq]=on.item(eq)}return nu};var xo=function(r){return nO.supports(r)?vb(r):nO.get(r)};var mq={add:cj,remove:a7,toggle:jG,hasAll:kt,hasAny:jM,get:xo};var t8=function(r){if(r.domChildren().isSome()&&r.defChildren().isSome()){throw new Error("Cannot specify children and child specs! Must be one or the other.\nDef: "+gv(r))}else{return r.domChildren().fold(function(){var eq=r.defChildren().getOr([]);return r5(eq,sw)},function(eq){return eq})}};var fU=function(ie){var eq=pO.fromTag(ie.tag());kh.setAll(eq,ie.attributes().getOr({}));mq.add(eq,ie.classes().getOr([]));cL.setAll(eq,ie.styles().getOr({}));k9.set(eq,ie.innerHtml().getOr(""));var r=t8(ie);nU.append(eq,r);ie.value().each(function(nu){tk.set(eq,nu)});return eq};var sw=function(r){var eq=wo(r);return fU(eq)};var qg=function(eq){var ie=fr(eq,"behaviours").getOr({});var r=l9(ds(ie),function(nu){return ie[nu]!==undefined});return r5(r,function(nu){return ie[nu].me})};var cD=function(r,eq){return yj(r,eq)};var uL=function(r){var eq=qg(r);return cD(r,eq)};var uG=fy(["getSystem","config","hasConfigured","spec","connect","disconnect","element","syncComponents","readState","components","events"]);var vJ=function(nu,ui,on){var ie=hb(nu);var eq={"alloy.base.modification":c8(nu)};var r=yu(on,eq,ui,ie).getOrDie();return ij(ie,r)};var tp=function(eq,nu,ie){var r={"alloy.base.behaviour":sQ(eq)};return yt(ie,eq.eventOrder(),nu,r).getOrDie()};var dy=function(on){var yP=function(){return yU};var yJ=hr(bq(yP));var yQ=lx(qc(eH(on,{behaviours:undefined})));var yN=uL(on);var yL=kY(yN);var yM=an(yN);var yO=vJ(yQ,yL,yM);var yR=fU(yO);var eq=tp(yQ,yL,yM);var ui=hr(yQ.components());var r=function(yV){yJ.set(yV)};var yS=function(){yJ.set(bq(yP))};var ie=function(){var yW=yb.children(yR);var yV=hw(yW,function(yX){return yJ.get().getByDom(yX).fold(function(){return[]},function(yY){return[yY]})});ui.set(yV)};var yT=function(yX){if(yX===mB()){return yQ.apis()}else{if(pq(yX)){throw new Error("Invalid input: only API constant is allowed")}}var yV=yM;var yW=kA(yV[yX.name()])?yV[yX.name()]:function(){throw new Error("Could not find "+yX.name()+" in "+sI.stringify(on,null,2))};return yW()};var yK=function(yV){return kA(yM[yV.name()])};var nu=function(yV){return yM[yV]().map(function(yW){return yW.state.readState()}).getOr("not enabled")};var yU=uG({getSystem:yJ.get,config:yT,hasConfigured:yK,spec:fY(on),readState:nu,connect:r,disconnect:yS,element:fY(yR),syncComponents:ie,components:ui.get,events:fY(eq)});return yU};var kf=function(r){var eq=hc("components",[])(r);return r5(eq,vw)};var fw=function(ie){var r=j7(ie);var eq=kf(r);var nu=eH(eS,r,lX("components",eq));return l7.value(dy(nu))};var ux=function(eq){var r=pO.fromText(eq);return bB({element:r})};var bB=function(ie){var on=fX("external.component",ih([o("element"),jr("uid")]),ie);var nu=hr(bq());var eq=function(yJ){nu.set(yJ)};var r=function(){nu.set(bq(function(){return ui}))};on.uid().each(function(yJ){sa(on.element(),yJ)});var ui=uG({getSystem:nu.get,config:tP.none,hasConfigured:fY(false),connect:eq,disconnect:r,element:fY(on.element()),spec:fY(ie),readState:fY("No state"),syncComponents:S,components:fY([]),events:fY({})});return wP(ui)};var vw=function(r){return p1(r).fold(function(){var eq=eH({uid:uN("")},r);return fw(eq).getOrDie()},function(eq){return eq})};var yD=wP;var pF="alloy.item-hover";var nX="alloy.item-focus";var oH=function(r){if(xI.search(r.element()).isNone()||fq.isFocused(r)){if(!fq.isFocused(r)){fq.focus(r)}b8(r,pF,{item:r})}};var ua=function(r){b8(r,nX,{item:r})};var M=fY(pF);var e=fY(nX);var fe=function(r){return{dom:eH(r.dom(),{attributes:{role:r.toggling().isSome()?"menuitemcheckbox":"menuitem"}}),behaviours:eH(h4([r.toggling().fold(my.revoke,function(eq){return my.config(eH({aria:{mode:"checked"}},eq))}),fq.config({ignore:r.ignoreFocus(),onFocus:function(eq){ua(eq)}}),x2.config({mode:"execution"}),sJ.config({store:{mode:"memory",initialValue:r.data()}})]),r.itemBehaviours()),events:hf([kD(ip(),r1),lD(vx()),cv(d8(),oH),cv(jm(),fq.focus)]),components:r.components(),domModification:r.domModification(),eventOrder:r.eventOrder()}};var wC=[o("data"),o("components"),o("dom"),jr("toggling"),qA("itemBehaviours",{}),qA("ignoreFocus",false),qA("domModification",{}),cC("builder",fe),qA("eventOrder",{})];var iF=function(r){return{dom:r.dom(),components:r.components(),events:hf([oD(jm())])}};var wB=[o("dom"),o("components"),cC("builder",iF)];var gU=function(){return"item-widget"};var de=fY([jv({name:"widget",overrides:function(r){return{behaviours:h4([sJ.config({store:{mode:"manual",getValue:function(eq){return r.data()},setValue:function(){}}})])}}})]);var iE=function(ie){var eq=tH(gU(),ie,de());var nu=eY(gU(),ie,eq.internals());var on=function(ui){return ph(ui,ie,"widget").map(function(yJ){x2.focusIn(yJ);return yJ})};var r=function(ui,yJ){return en(yJ.event().target())?tP.none():function(){if(ie.autofocus()){yJ.setSource(ui.element());return tP.none()}else{return tP.none()}}()};return eH({dom:ie.dom(),components:nu,domModification:ie.domModification(),events:hf([oS(function(ui,yJ){on(ui).each(function(yK){yJ.stop()})}),cv(d8(),oH),cv(jm(),function(ui,yJ){if(ie.autofocus()){on(ui)}else{fq.focus(ui)}})]),behaviours:h4([sJ.config({store:{mode:"memory",initialValue:ie.data()}}),fq.config({onFocus:function(ui){ua(ui)}}),x2.config({mode:"special",focusIn:ie.autofocus()?function(ui){on(ui)}:uK(),onLeft:r,onRight:r,onEscape:function(ui,yJ){if(!fq.isFocused(ui)&&!ie.autofocus()){fq.focus(ui);return tP.some(true)}else{if(ie.autofocus()){yJ.setSource(ui.element());return tP.none()}else{return tP.none()}}}})])})};var wz=[o("uid"),o("data"),o("components"),o("dom"),qA("autofocus",false),qA("domModification",{}),i0(de()),cC("builder",iE)];var uM=c5("type",{widget:wz,item:wC,separator:wB});var wN=function(eq,r){return{mode:"flatgrid",selector:"."+eq.markers().item(),initSize:{numColumns:r.initSize().numColumns(),numRows:r.initSize().numRows()},focusManager:eq.focusManager()}};var rB=function(eq,r){return{mode:"menu",selector:"."+eq.markers().item(),moveOnTab:r.moveOnTab(),focusManager:eq.focusManager()}};var sS=fY([pK({factory:{sketch:function(eq){var r=fX("menu.spec item",uM,eq);return r.builder()(r)}},name:"items",unit:"item",defaults:function(ie,eq){var r=uN("");return eH({uid:r},eq)},overrides:function(eq,r){return{type:r.type,ignoreFocus:eq.fakeFocus(),domModification:{classes:[eq.markers().item()]}}}})]);var wy=fY([o("value"),o("items"),o("dom"),o("components"),qA("eventOrder",{}),bA("menuBehaviours",[lK,sJ,tf,x2]),fV("movement",{mode:"menu",moveOnTab:true},c5("mode",{grid:[sq(),cC("config",wN)],menu:[qA("moveOnTab",true),cC("config",rB)]})),fl(),qA("fakeFocus",false),qA("focusManager",mZ()),fc("onHighlight")]);var d=fY("alloy.menu-focus");var j5=function(ie,nu,r,eq){return eH({dom:eH(ie.dom(),{attributes:{role:"menu"}}),uid:ie.uid(),behaviours:eH(h4([lK.config({highlightClass:ie.markers().selectedItem(),itemClass:ie.markers().item(),onHighlight:ie.onHighlight()}),sJ.config({store:{mode:"memory",initialValue:ie.value()}}),tf.config({find:tP.some}),x2.config(ie.movement().config()(ie,ie.movement()))]),aW(ie.menuBehaviours())),events:hf([cv(e(),function(yJ,ui){var on=ui.event();yJ.getSystem().getByDom(on.target()).each(function(yK){lK.highlight(yJ,yK);ui.stop();b8(yJ,d(),{menu:yJ,item:yK})})}),cv(M(),function(yJ,ui){var on=ui.event().item();lK.highlight(yJ,on)})]),components:nu,eventOrder:ie.eventOrder()})};var gP=uk({name:"Menu",configFields:wy(),partFields:sS(),factory:j5});var wj=function(on,eq){var ie=yb.owner(eq);var nu=xI.active(ie).bind(function(ui){var yJ=function(yK){return gb.eq(ui,yK)};return yJ(eq)?tP.some(eq):gO.descendant(eq,yJ)});var r=on(eq);nu.each(function(ui){xI.active(ie).filter(function(yJ){return gb.eq(yJ,ui)}).fold(function(){xI.focus(ui)},S)});return r};var iL=function(ie,r,eq,nu){qw(ie);wj(function(){var on=r5(nu,ie.getSystem().build);kV(on,function(ui){A(ie,ui)})},ie.element())};var gS=function(ie,eq,nu,r){var on=ie.getSystem().build(r);mc(ie,on,nu)};var vd=function(nu,r,eq,ie){gS(nu,r,vA.append,ie)};var di=function(ie,r,eq,nu){gS(ie,r,vA.prepend,nu)};var a5=function(ie,r,eq,ui){var nu=v3(ie,r);var on=sy(nu,function(yJ){return gb.eq(ui.element(),yJ.element())});on.each(od)};var v3=function(eq,r){return eq.components()};var s7=Object.freeze({append:vd,prepend:di,remove:a5,set:iL,contents:v3});var yy=tE({fields:[],name:"replacing",apis:s7});var kS=function(r){return oG(r,function(ie,eq){return{k:ie,v:eq}})};var tN=function(r,ie,nu,eq){return fr(nu,eq).bind(function(on){return fr(r,on).bind(function(yJ){var ui=tN(r,ie,nu,yJ);return tP.some([yJ].concat(ui))})}).getOr([])};var uJ=function(on,nu){var eq={};tS(on,function(yJ,yK){kV(yJ,function(yL){eq[yL]=yK})});var ie=nu;var ui=kS(nu);var r=u5(ui,function(yJ,yK){return[yK].concat(tN(eq,ie,ui,yK))});return u5(eq,function(yJ){return fr(r,yJ).getOr([yJ])})};var jD=function(){var ie=hr({});var on=hr({});var yR=hr({});var nu=hr(tP.none());var yK=hr({});var yJ=function(){ie.set({});on.set({});yR.set({});nu.set(tP.none())};var ui=function(){return nu.get().isNone()};var yL=function(yU,yW,yV,yT){nu.set(tP.some(yU));ie.set(yV);on.set(yW);yK.set(yT);var yS=uJ(yT,yV);yR.set(yS)};var yO=function(yS){return fr(ie.get(),yS).map(function(yU){var yT=fr(yR.get(),yS).getOr([]);return[yU].concat(yT)})};var yN=function(yS){return fr(yR.get(),yS).bind(function(yT){return yT.length>1?tP.some(yT.slice(1)):tP.none()})};var yM=function(yS){return fr(yR.get(),yS)};var r=function(yS){return fr(on.get(),yS)};var yQ=function(yT){var yS=yK.get();return V(ds(yS),yT)};var eq=function(){return nu.get().bind(r)};var yP=function(){return on.get()};return{setContents:yL,expand:yO,refresh:yM,collapse:yN,lookupMenu:r,otherMenus:yQ,getPrimary:eq,getMenus:yP,clear:yJ,isClear:ui}};var gA={init:jD};var j4=function(yR,yP){var yQ=function(yW,yX){return u5(yX,function(yY,yZ){var y0=gP.sketch(eH(yY,{value:yZ,items:yY.items,markers:uu(yP.markers,["item","selectedItem"]),fakeFocus:yR.fakeFocus(),onHighlight:yR.onHighlight(),focusManager:yR.fakeFocus()?wL():mZ()}));return yW.getSystem().build(y0)})};var yJ=gA.init();var yN=function(yX){var yY=yQ(yX,yR.data().menus());var yW=ie(yX);yJ.setContents(yR.data().primary(),yY,yR.data().expansions(),yW);return yJ.getPrimary()};var on=function(yW){return sJ.getValue(yW).value};var ie=function(yW){return u5(yR.data().menus(),function(yY,yX){return hw(yY.items,function(yZ){return yZ.type==="separator"?[]:[yZ.data.value]})})};var nu=function(yW,yX){lK.highlight(yW,yX);lK.getHighlighted(yX).orThunk(function(){return lK.getFirst(yX)}).each(function(yY){sg(yW,yY.element(),jm())})};var yU=function(yX,yW){return h(r5(yW,yX.lookupMenu))};var yK=function(yW,yX,yY){return tP.from(yY[0]).bind(yX.lookupMenu).map(function(yZ){var y1=yU(yX,yY.slice(1));kV(y1,function(y2){rG.add(y2.element(),yR.markers().backgroundMenu())});if(!r8.inBody(yZ.element())){yy.append(yW,yD(yZ))}mq.remove(yZ.element(),[yR.markers().backgroundMenu()]);nu(yW,yZ);var y0=yU(yX,yX.otherMenus(yY));kV(y0,function(y2){mq.remove(y2.element(),[yR.markers().backgroundMenu()]);if(!yR.stayInDom()){yy.remove(yW,y2)}});return yZ})};var eq=function(yW,yX){var yY=on(yX);return yJ.expand(yY).bind(function(yZ){tP.from(yZ[0]).bind(yJ.lookupMenu).each(function(y0){if(!r8.inBody(y0.element())){yy.append(yW,yD(y0))}yR.onOpenSubmenu()(yW,yX,y0);lK.highlightFirst(y0)});return yK(yW,yJ,yZ)})};var yL=function(yW,yX){var yY=on(yX);return yJ.collapse(yY).bind(function(yZ){return yK(yW,yJ,yZ).map(function(y0){yR.onCollapseMenu()(yW,yX,y0);return y0})})};var yO=function(yW,yX){var yY=on(yX);return yJ.refresh(yY).bind(function(yZ){return yK(yW,yJ,yZ)})};var ui=function(yW,yX){return en(yX.element())?tP.none():eq(yW,yX)};var yS=function(yW,yX){return en(yX.element())?tP.none():yL(yW,yX)};var yT=function(yW,yX){return yL(yW,yX).orThunk(function(){return yR.onEscape()(yW,yX).map(function(){return yW})})};var yM=function(yW){return function(yX,yY){return yz.closest(yY.getSource(),"."+yR.markers().item()).bind(function(yZ){return yX.getSystem().getByDom(yZ).toOption().bind(function(y0){return yW(yX,y0).map(function(){return true})})})}};var r=hf([cv(d(),function(yW,yX){var yY=yX.event().menu();lK.highlight(yW,yY)}),oS(function(yW,yX){var yY=yX.event().target();yW.getSystem().getByDom(yY).each(function(yZ){var y0=on(yZ);if(y0.indexOf("collapse-item")===0){yL(yW,yZ)}eq(yW,yZ).fold(function(){yR.onExecute()(yW,yZ)},function(){})})}),eQ(function(yW,yX){yN(yW).each(function(yY){yy.append(yW,yD(yY));if(yR.openImmediately()){nu(yW,yY);yR.onOpenMenu()(yW,yY)}})})].concat(yR.navigateOnHover()?[cv(M(),function(yW,yY){var yX=yY.event().item();yO(yW,yX);eq(yW,yX);yR.onHover()(yW,yX)})]:[]));var yV=function(yW){lK.getHighlighted(yW).each(function(yX){lK.getHighlighted(yX).each(function(yY){yL(yW,yY)})})};return{uid:yR.uid(),dom:yR.dom(),behaviours:eH(h4([x2.config({mode:"special",onRight:yM(ui),onLeft:yM(yS),onEscape:yM(yT),focusIn:function(yW,yX){yJ.getPrimary().each(function(yY){sg(yW,yY.element(),jm())})}}),lK.config({highlightClass:yR.markers().selectedMenu(),itemClass:yR.markers().menu()}),tf.config({find:function(yW){return lK.getHighlighted(yW)}}),yy.config({})]),aW(yR.tmenuBehaviours())),eventOrder:yR.eventOrder(),apis:{collapseMenu:yV},events:r}};var hD=fY("collapse-item");var uc=function(r,ie,eq){return{primary:r,menus:ie,expansions:eq}};var uU=function(r,eq){return{primary:r,menus:lX(r,eq),expansions:{}}};var lU=function(r){return{value:uS(hD()),text:r}};var h7=la({name:"TieredMenu",configFields:[cV("onExecute"),cV("onEscape"),ch("onOpenMenu"),ch("onOpenSubmenu"),fc("onCollapseMenu"),qA("openImmediately",true),xY("data",[o("primary"),o("menus"),o("expansions")]),qA("fakeFocus",false),fc("onHighlight"),fc("onHover"),cg(),o("dom"),qA("navigateOnHover",true),qA("stayInDom",false),bA("tmenuBehaviours",[x2,lK,tf,yy]),qA("eventOrder",{})],apis:{collapseMenu:function(eq,r){eq.collapseMenu(r)}},factory:j4,extraApis:{tieredData:uc,singleData:uU,collapseItem:lU}});var R=function(eq,ie,nu,r){return fr(ie.routes(),r.start()).map(eu).bind(function(on){return fr(on,r.destination()).map(eu)})};var v5=function(eq,ie,nu){var r=vR(eq,ie,nu);return r.bind(function(on){return sk(eq,ie,nu,on)})};var sk=function(eq,ie,nu,r){return R(eq,ie,nu,r).bind(function(on){return on.transition().map(function(ui){return{transition:fY(ui),route:fY(on)}})})};var pW=function(r,eq,ie){v5(r,eq,ie).each(function(on){var nu=on.transition();rG.remove(r.element(),nu.transitionClass());kh.remove(r.element(),eq.destinationAttr())})};var l1=function(eq,ie,nu,r){return{start:fY(kh.get(eq.element(),ie.stateAttr())),destination:fY(r)}};var vR=function(r,eq,nu){var ie=r.element();return kh.has(ie,eq.destinationAttr())?tP.some({start:fY(kh.get(r.element(),eq.stateAttr())),destination:fY(kh.get(r.element(),eq.destinationAttr()))}):tP.none()};var u4=function(eq,ie,nu,r){pW(eq,ie,nu);if(kh.has(eq.element(),ie.stateAttr())&&kh.get(eq.element(),ie.stateAttr())!==r){ie.onFinish()(eq,r)}kh.set(eq.element(),ie.stateAttr(),r)};var xB=function(eq,ie,nu,r){if(kh.has(eq.element(),ie.destinationAttr())){kh.set(eq.element(),ie.stateAttr(),kh.get(eq.element(),ie.destinationAttr()));kh.remove(eq.element(),ie.destinationAttr())}};var hP=function(ie,nu,on,r){xB(ie,nu,on,r);var eq=l1(ie,nu,on,r);sk(ie,nu,on,eq).fold(function(){u4(ie,nu,on,r)},function(yJ){pW(ie,nu,on);var ui=yJ.transition();rG.add(ie.element(),ui.transitionClass());kh.set(ie.element(),nu.destinationAttr(),r)})};var jH=function(r,eq,ie){var nu=r.element();return kh.has(nu,eq.stateAttr())?tP.some(kh.get(nu,eq.stateAttr())):tP.none()};var hT=Object.freeze({findRoute:R,disableTransition:pW,getCurrentRoute:vR,jumpTo:u4,progressTo:hP,getState:jH});var nb=function(r,eq){return hf([cv(i3(),function(nu,on){var ie=on.event().raw();vR(nu,r,eq).each(function(ui){R(nu,r,eq,ui).each(function(yJ){yJ.transition().each(function(yK){if(ie.propertyName===yK.property()){u4(nu,r,eq,ui.destination());r.onTransition()(nu,ui)}})})})}),eQ(function(ie,nu){u4(ie,r,eq,r.initialState())})])};var ja=Object.freeze({events:nb});var gW=[qA("destinationAttr","data-transitioning-destination"),qA("stateAttr","data-transitioning-state"),o("initialState"),fc("onTransition"),fc("onFinish"),m4("routes",wi(l7.value,wi(l7.value,ih([rH("transition",[o("property"),o("transitionClass")])]))))];var cr=function(eq){var ie={};tS(eq,function(nu,r){var on=r.split("<->");ie[on[0]]=lX(on[1],nu);ie[on[1]]=lX(on[0],nu)});return ie};var sR=function(ie,r,eq){return kN([{key:ie,value:lX(r,eq)},{key:r,value:lX(ie,eq)}])};var be=function(nu,eq,r,ie){return kN([{key:nu,value:kN([{key:eq,value:ie},{key:r,value:ie}])},{key:eq,value:kN([{key:nu,value:ie},{key:r,value:ie}])},{key:r,value:kN([{key:nu,value:ie},{key:eq,value:ie}])}])};var su=tE({fields:gW,name:"transitioning",active:ja,apis:hT,extra:{createRoutes:cr,createBistate:sR,createTristate:be}});var k7=eL.resolve("scrollable");var pf=function(r){rG.add(r,k7)};var lt=function(r){rG.remove(r,k7)};var nA={register:pf,deregister:lt,scrollable:fY(k7)};var bK=function(r){return fr(r,"format").getOr(r.title)};var x7=function(r,nu){var on=qm("Styles",[].concat(r5(r.items,function(yJ){return vt(bK(yJ),yJ.title,yJ.isSelected(),yJ.getPreview(),p3(r.expansions,bK(yJ)))})),nu,false);var ie=u5(r.menus,function(yL,yK){var yJ=r5(yL,function(yM){return vt(bK(yM),yM.title,yM.isSelected!==undefined?yM.isSelected():false,yM.getPreview!==undefined?yM.getPreview():"",p3(r.expansions,bK(yM)))});return qm(yK,yJ,nu,true)});var ui=eH(ie,lX("styles",on));var eq=h7.tieredData("styles",ui,r.expansions);return{tmenu:eq}};var vt=function(ie,eq,r,nu,on){return{data:{value:ie,text:eq},type:"item",dom:{tag:"div",classes:on?[eL.resolve("styles-item-is-menu")]:[]},toggling:{toggleOnExecute:false,toggleClass:eL.resolve("format-matches"),selected:r},itemBehaviours:h4(on?[]:[dx.format(ie,function(yK,yJ){var ui=yJ?my.on:my.off;ui(yK)})]),components:[{dom:{tag:"div",attributes:{style:nu},innerHtml:eq}}]}};var qm=function(ie,eq,r,nu){return{value:ie,dom:{tag:"div"},components:[wK.sketch({dom:{tag:"div",classes:[eL.resolve("styles-collapser")]},components:nu?[{dom:{tag:"span",classes:[eL.resolve("styles-collapse-icon")]}},ux(ie)]:[ux(ie)],action:function(ui){if(nu){var on=r().get(ui);h7.collapseMenu(on)}}}),{dom:{tag:"div",classes:[eL.resolve("styles-menu-items-container")]},components:[gP.parts().items({})],behaviours:h4([iJ("adhoc-scrollable-menu",[eQ(function(on,ui){cL.set(on.element(),"overflow-y","auto");cL.set(on.element(),"-webkit-overflow-scrolling","touch");nA.register(on.element())}),bo(function(on){cL.remove(on.element(),"overflow-y");cL.remove(on.element(),"-webkit-overflow-scrolling");nA.deregister(on.element())})])])}],items:eq,menuBehaviours:h4([su.config({initialState:"after",routes:su.createTristate("before","current","after",{transition:{property:"transform",transitionClass:"transitioning"}})})])}};var ed=function(eq){var ie=x7(eq.formats,function(){return r});var r=ct(h7.sketch({dom:{tag:"div",classes:[eL.resolve("styles-menu")]},components:[],fakeFocus:true,stayInDom:true,onExecute:function(nu,ui){var on=sJ.getValue(ui);eq.handle(ui,on.value);return tP.none()},onEscape:function(){return tP.none()},onOpenMenu:function(on,ui){var nu=rr.get(on.element());rr.set(ui.element(),nu);su.jumpTo(ui,"current")},onOpenSubmenu:function(ui,yK,yJ){var on=rr.get(ui.element());var yL=yz.ancestor(yK.element(),'[role="menu"]').getOrDie("hacky");var nu=ui.getSystem().getByDom(yL).getOrDie();rr.set(yJ.element(),on);su.progressTo(nu,"before");su.jumpTo(yJ,"after");su.progressTo(yJ,"current")},onCollapseMenu:function(nu,yJ,yK){var on=yz.ancestor(yJ.element(),'[role="menu"]').getOrDie("hacky");var ui=nu.getSystem().getByDom(on).getOrDie();su.progressTo(ui,"after");su.progressTo(yK,"current")},navigateOnHover:false,openImmediately:true,data:ie.tmenu,markers:{backgroundMenu:eL.resolve("styles-background-menu"),menu:eL.resolve("styles-menu"),selectedMenu:eL.resolve("styles-selected-menu"),item:eL.resolve("styles-item"),selectedItem:eL.resolve("styles-selected-item")}}));return r.asSpec()};var vg={sketch:ed};var pA=function(nu){var eq=eH(ov(nu,["items"]),{menu:true});var ie=cZ(nu.items);var on=eH(ie.menus,lX(nu.title,ie.items));var r=eH(ie.expansions,lX(nu.title,nu.title));return{item:eq,menus:on,expansions:r}};var kj=function(r){return p3(r,"items")?pA(r):{item:r,menus:{},expansions:{}}};var cZ=function(r){return oi(r,function(nu,ie){var eq=kj(ie);return{menus:eH(nu.menus,eq.menus),items:[eq.item].concat(nu.items),expansions:eH(nu.expansions,eq.expansions)}},{menus:{},expansions:{},items:[]})};var uT={expand:cZ};var au=function(nu,eq){var ui=function(yM){return function(){return nu.formatter.match(yM)}};var on=function(yM){return function(){var yN=nu.formatter.getCssText(yM);return yN}};var r=function(yM){return eH(yM,{isSelected:ui(yM.format),getPreview:on(yM.format)})};var ie=function(yM){return eH(yM,{isSelected:fY(false),getPreview:fY("")})};var yJ=function(yO){var yN=uS(yO.title);var yM=eH(yO,{format:yN,isSelected:ui(yN),getPreview:on(yN)});nu.formatter.register(yN,yM);return yM};var yK=fr(eq,"style_formats").getOr(pL);var yL=function(yM){return r5(yM,function(yO){if(p3(yO,"items")){var yN=yL(yO.items);return eH(ie(yO),{items:yN})}else{if(p3(yO,"format")){return r(yO)}else{return yJ(yO)}}})};return yL(yK)};var it=function(nu,eq){var ie=function(on){return hw(on,function(yK){if(yK.items!==undefined){var yJ=ie(yK.items);return yJ.length>0?[yK]:[]}else{var ui=p3(yK,"format")?nu.formatter.canApply(yK.format):true;return ui?[yK]:[]}})};var r=ie(eq);return uT.expand(r)};var st=function(ie,r,nu){var eq=it(ie,r);return vg.sketch({formats:eq,handle:function(on,ui){ie.undoManager.transact(function(){if(my.isOn(on)){ie.formatter.remove(ui)}else{ie.formatter.apply(ui)}});nu()}})};var xT={register:au,ui:st};var t7=["undo","bold","italic","link","image","bullist","styleselect"];var kn=function(eq){var r=eq.replace(/\|/g," ").trim();return r.length>0?r.split(/\s+/):[]};var iX=function(r){return hw(r,function(eq){return w9(eq)?iX(eq):kn(eq)})};var l8=function(r){var eq=r.toolbar!==undefined?r.toolbar:t7;return w9(eq)?iX(eq):kn(eq)};var mA=function(yP,on){var r=function(yZ){return function(){return eV.forToolbarCommand(on,yZ)}};var yO=function(yZ){return function(){return eV.forToolbarStateCommand(on,yZ)}};var yM=function(yZ,y1,y0){return function(){return eV.forToolbarStateAction(on,yZ,y1,y0)}};var yY=r("undo");var yQ=r("redo");var yU=yO("bold");var ui=yO("italic");var yN=yO("underline");var yW=r("removeformat");var yK=function(){return ee(yP,on)};var yT=yM("unlink","link",function(){on.execCommand("unlink",null,false)});var yS=function(){return ei(on)};var eq=yM("unordered-list","ul",function(){on.execCommand("InsertUnorderedList",null,false)});var yL=yM("ordered-list","ol",function(){on.execCommand("InsertOrderedList",null,false)});var yR=function(){return el(yP,on)};var nu=function(){return oV.sketch(yP,on)};var yV=xT.register(on,on.settings);var yX=function(){return xT.ui(on,yV,function(){on.fire("scrollIntoView")})};var ie=function(){return eV.forToolbar("style-formats",function(yZ){on.fire("toReading");yP.dropup().appear(yX,my.on,yZ)},h4([my.config({toggleClass:eL.resolve("toolbar-button-selected"),toggleOnExecute:false,aria:{mode:"pressed"}}),l4.config({channels:kN([dx.receive(hl.orientationChanged(),my.off),dx.receive(hl.dropupDismissed(),my.off)])})]))};var yJ=function(yZ,y0){return{isSupported:function(){return yZ.forall(function(y1){return p3(on.buttons,y1)})},sketch:y0}};return{undo:yJ(tP.none(),yY),redo:yJ(tP.none(),yQ),bold:yJ(tP.none(),yU),italic:yJ(tP.none(),ui),underline:yJ(tP.none(),yN),removeformat:yJ(tP.none(),yW),link:yJ(tP.none(),yK),unlink:yJ(tP.none(),yT),image:yJ(tP.none(),yS),bullist:yJ(tP.some("bullist"),eq),numlist:yJ(tP.some("numlist"),yL),fontsizeselect:yJ(tP.none(),yR),forecolor:yJ(tP.none(),nu),styleselect:yJ(tP.none(),ie)}};var D=function(eq,r){var nu=l8(eq);var ie={};return hw(nu,function(on){var ui=!p3(ie,on)&&p3(r,on)&&r[on].isSupported()?[r[on].sketch()]:[];ie[on]=true;return ui})};var aC={identify:l8,setup:mA,detect:D};var ca=function(ui,r,yJ,on,eq,nu,ie){return{target:fY(ui),x:fY(r),y:fY(yJ),stop:on,prevent:eq,kill:nu,raw:fY(ie)}};var yv=function(eq,r){return function(yJ){if(!eq(yJ)){return}var yK=pO.fromDom(yJ.target);var ui=function(){yJ.stopPropagation()};var nu=function(){yJ.preventDefault()};var on=kP(nu,ui);var ie=ca(yK,yJ.clientX,yJ.clientY,ui,nu,on,yJ);r(ie)}};var sC=function(ie,ui,on,nu,r){var eq=yv(on,nu);ie.dom().addEventListener(ui,eq,r);return{unbind:mX(xs,ie,ui,eq,r)}};var ll=function(r,nu,ie,eq){return sC(r,nu,ie,eq,false)};var lJ=function(r,nu,ie,eq){return sC(r,nu,ie,eq,true)};var xs=function(eq,nu,ie,r){eq.dom().removeEventListener(nu,ie,r)};var wM={bind:ll,capture:lJ};var xZ=fY(true);var li=function(r,ie,eq){return wM.bind(r,ie,xZ,eq)};var gg=function(r,ie,eq){return wM.capture(r,ie,xZ,eq)};var f3={bind:li,capture:gg};var eb=50;var gG=1000/eb;var xm=function(r){var eq=r.matchMedia("(orientation: portrait)").matches;return{isPortrait:fY(eq)}};var x1=function(eq){var r=jz.detect().os.isiOS();var ie=xm(eq).isPortrait();return r&&!ie?eq.screen.height:eq.screen.width};var nk=function(eq,ie){var ui=pO.fromDom(eq);var on=null;var yK=function(){clearInterval(on);var yL=xm(eq);ie.onChange(yL);yJ(function(){ie.onReady(yL)})};var nu=f3.bind(ui,"orientationchange",yK);var yJ=function(yN){clearInterval(on);var yL=eq.innerHeight;var yM=0;on=setInterval(function(){if(yL!==eq.innerHeight){clearInterval(on);yN(tP.some(eq.innerHeight))}else{if(yM>gG){clearInterval(on);yN(tP.none())}}yM++},eb)};var r=function(){nu.unbind()};return{onAdjustment:yJ,destroy:r}};var xp={get:xm,onChange:nk,getActualWidth:x1};function k4(r,eq){var nu=null;var on=function(){var ui=[];for(var yJ=0;yJ<arguments.length;yJ++){ui[yJ]=arguments[yJ]}nu=setTimeout(function(){r.apply(null,ui);nu=null},eq)};var ie=function(){if(nu!==null){clearTimeout(nu);nu=null}};return{cancel:ie,schedule:on}}var r6=5;var fW=400;var cq=function(eq){var r=eq.raw();if(r.touches===undefined||r.touches.length!==1){return tP.none()}return tP.some(r.touches[0])};var sh=function(nu,ie){var eq=Math.abs(nu.clientX-ie.x());var r=Math.abs(nu.clientY-ie.y());return eq>r6||r>r6};var dX=function(nu){var ie=hr(tP.none());var on=k4(function(yL){ie.set(tP.none());nu.triggerEvent(du(),yL)},fW);var r=function(yL){cq(yL).each(function(yN){on.cancel();var yM={x:fY(yN.clientX),y:fY(yN.clientY),target:yL.target};on.schedule(yL);ie.set(tP.some(yM))});return tP.none()};var yJ=function(yL){on.cancel();cq(yL).each(function(yM){ie.get().each(function(yN){if(sh(yM,yN)){ie.set(tP.none())}})});return tP.none()};var yK=function(yM){on.cancel();var yL=function(yN){return gb.eq(yN.target(),yM.target())};return ie.get().filter(yL).map(function(yN){return nu.triggerEvent(p5(),yM)})};var eq=kN([{key:ye(),value:r},{key:bk(),value:yJ},{key:lk(),value:yK}]);var ui=function(yM,yL){return fr(eq,yL).bind(function(yN){return yN(yM)})};return{fireIfReady:ui}};var po=function(nu){var r=dX({triggerEvent:function(yJ,ui){nu.onTapContent(ui)}});var eq=function(){return f3.bind(nu.body(),"touchend",function(ui){r.fireIfReady(ui,"touchend")})};var on=function(){return f3.bind(nu.body(),"touchmove",function(ui){r.fireIfReady(ui,"touchmove")})};var ie=function(ui){r.fireIfReady(ui,"touchstart")};return{fireTouchstart:ie,onTouchend:eq,onTouchmove:on}};var aH={monitor:po};var lr=jz.detect().os.version.major>=6;var jc=function(ie,on,yM){var yL=aH.monitor(ie);var nu=yb.owner(on);var eq=function(yN){return !gb.eq(yN.start(),yN.finish())||yN.soffset()!==yN.foffset()};var r=function(){return xI.active(nu).filter(function(yN){return iI.name(yN)==="input"}).exists(function(yN){return yN.dom().selectionStart!==yN.dom().selectionEnd})};var yJ=function(){var yN=ie.doc().dom().hasFocus()&&ie.getSelection().exists(eq);yM.getByDom(on).each((yN||r())===true?my.on:my.off)};var ui=[f3.bind(ie.body(),"touchstart",function(yN){ie.onTouchContent();yL.fireTouchstart(yN)}),yL.onTouchmove(),yL.onTouchend(),f3.bind(on,"touchstart",function(yN){ie.onTouchToolstrip()}),ie.onToReading(function(){xI.blur(ie.body())}),ie.onToEditing(S),ie.onScrollToCursor(function(yN){yN.preventDefault();ie.getCursorBox().each(function(yR){var yQ=ie.win();var yP=yR.top()>yQ.innerHeight||yR.bottom()>yQ.innerHeight;var yO=yP?yR.bottom()-yQ.innerHeight+50:0;if(yO!==0){yQ.scrollTo(yQ.pageXOffset,yQ.pageYOffset+yO)}})})].concat(lr===true?[]:[f3.bind(pO.fromDom(ie.win()),"blur",function(){yM.getByDom(on).each(my.off)}),f3.bind(nu,"select",yJ),f3.bind(ie.doc(),"selectionchange",yJ)]);var yK=function(){kV(ui,function(yN){yN.unbind()})};return{destroy:yK}};var eI={initEvents:jc};var up=function(eq,ie){var r=parseInt(kh.get(eq,ie),10);return isNaN(r)?0:r};var n5={safeParse:up};function rq(yJ,on){var nu=function(yL){if(!yJ(yL)){throw new Error("Can only get "+on+" value of a "+on+" node")}return r(yL).getOr("")};var ui=function(yL){try{return ie(yL)}catch(yM){return tP.none()}};var ie=function(yL){return yJ(yL)?tP.from(yL.dom().nodeValue):tP.none()};var eq=jz.detect().browser;var r=eq.isIE()&&eq.version.major===10?ui:ie;var yK=function(yL,yM){if(!yJ(yL)){throw new Error("Can only set raw "+on+" value of a "+on+" node")}yL.dom().nodeValue=yM};return{get:nu,getOption:r,set:yK}}var cK=rq(iI.isText,"text");var xl=function(r){return cK.get(r)};var pX=function(r){return cK.getOption(r)};var iK=function(r,eq){cK.set(r,eq)};var q7={get:xl,getOption:pX,set:iK};var yE=function(r){return iI.name(r)==="img"?1:q7.getOption(r).fold(function(){return yb.children(r).length},function(eq){return eq.length})};var rp=function(r,eq){return yE(r)===eq};var pZ=function(r,eq){return eq===0};var tx="\xA0";var s3=function(r){return q7.getOption(r).filter(function(eq){return eq.trim().length!==0||eq.indexOf(tx)>-1}).isSome()};var hv=["img","br"];var hR=function(eq){var r=s3(eq);return r||hZ(hv,iI.name(eq))};var f6={getEnd:yE,isEnd:rp,isStart:pZ,isCursorPosition:hR};var b3=ox.generate([{before:["element"]},{on:["element","offset"]},{after:["element"]}]);var bs=function(ie,nu,r,eq){return ie.fold(nu,r,eq)};var j8=function(r){return r.fold(iC,iC,iC)};var qt={before:b3.before,on:b3.on,after:b3.after,cata:bs,getStart:j8};var oR=ox.generate([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]);var kZ=lG("start","soffset","finish","foffset");var vi=function(r){return oR.exact(r.start(),r.soffset(),r.finish(),r.foffset())};var e3=function(r){return r.match({domRange:function(eq){return pO.fromDom(eq.startContainer)},relative:function(ie,eq){return qt.getStart(ie)},exact:function(on,nu,ie,eq){return on}})};var jB=function(r){var eq=e3(r);return yb.defaultView(eq)};var o0={domRange:oR.domRange,relative:oR.relative,exact:oR.exact,exactFromRange:vi,range:kZ,getWin:jB};var sj=function(ui,nu,ie,r){var on=yb.owner(ui);var eq=on.dom().createRange();eq.setStart(ui.dom(),nu);eq.setEnd(ie.dom(),r);return eq};var qi=function(ui,nu,ie,eq){var on=sj(ui,nu,ie,eq);return pO.fromDom(on.commonAncestorContainer)};var lu=function(yJ,nu,ie,eq){var on=sj(yJ,nu,ie,eq);var ui=gb.eq(yJ,ie)&&nu===eq;return on.collapsed&&!ui};var x9={after:lu,commonAncestorContainer:qi};var cs=function(ie,eq){var nu=eq||document;var r=nu.createDocumentFragment();kV(ie,function(on){r.appendChild(on.dom())});return pO.fromDom(r)};var je={fromElements:cs};var eM=function(ie,eq){var r=ie.document.createRange();hq(r,eq);return r};var hq=function(r,eq){r.selectNodeContents(eq.dom())};var vl=function(r,eq){return eq.compareBoundaryPoints(r.END_TO_START,r)<1&&eq.compareBoundaryPoints(r.START_TO_END,r)>-1};var tB=function(r){return r.document.createRange()};var qz=function(r,eq){eq.fold(function(ie){r.setStartBefore(ie.dom())},function(ie,nu){r.setStart(ie.dom(),nu)},function(ie){r.setStartAfter(ie.dom())})};var rW=function(r,eq){eq.fold(function(ie){r.setEndBefore(ie.dom())},function(ie,nu){r.setEnd(ie.dom(),nu)},function(ie){r.setEndAfter(ie.dom())})};var f4=function(r,eq){yC(r);r.insertNode(eq.dom())};var ma=function(nu,ie,eq){var r=nu.document.createRange();qz(r,ie);rW(r,eq);return r};var Y=function(on,ui,nu,ie,r){var eq=on.document.createRange();eq.setStart(ui.dom(),nu);eq.setEnd(ie.dom(),r);return eq};var yC=function(r){r.deleteContents()};var tY=function(r){var eq=r.cloneContents();return pO.fromDom(eq)};var fj=function(r){return{left:fY(r.left),top:fY(r.top),right:fY(r.right),bottom:fY(r.bottom),width:fY(r.width),height:fY(r.height)}};var rO=function(r){var eq=r.getClientRects();var ie=eq.length>0?eq[0]:r.getBoundingClientRect();return ie.width>0||ie.height>0?tP.some(ie).map(fj):tP.none()};var qB=function(r){var eq=r.getBoundingClientRect();return eq.width>0||eq.height>0?tP.some(eq).map(fj):tP.none()};var eE=function(r){return r.toString()};var ab={create:tB,replaceWith:f4,selectNodeContents:eM,selectNodeContentsUsing:hq,relativeToNative:ma,exactToNative:Y,deleteContents:yC,cloneFragment:tY,getFirstRect:rO,getBounds:qB,isWithin:vl,toString:eE};var b1=ox.generate([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]);var ln=function(ie,eq,r){return eq(pO.fromDom(r.startContainer),r.startOffset,pO.fromDom(r.endContainer),r.endOffset)};var eK=function(eq,r){return r.match({domRange:function(ie){return{ltr:fY(ie),rtl:tP.none}},relative:function(nu,ie){return{ltr:oJ(function(){return ab.relativeToNative(eq,nu,ie)}),rtl:oJ(function(){return tP.some(ab.relativeToNative(eq,ie,nu))})}},exact:function(ui,on,nu,ie){return{ltr:oJ(function(){return ab.exactToNative(eq,ui,on,nu,ie)}),rtl:oJ(function(){return tP.some(ab.exactToNative(eq,nu,ie,ui,on))})}}})};var cY=function(ie,eq){var r=eq.ltr();if(r.collapsed){var nu=eq.rtl().filter(function(on){return on.collapsed===false});return nu.map(function(on){return b1.rtl(pO.fromDom(on.endContainer),on.endOffset,pO.fromDom(on.startContainer),on.startOffset)}).getOrThunk(function(){return ln(ie,b1.ltr,r)})}else{return ln(ie,b1.ltr,r)}};var tR=function(ie,eq){var r=eK(ie,eq);return cY(ie,r)};var x8=function(ie,eq){var r=tR(ie,eq);return r.match({ltr:function(yK,yJ,ui,nu){var on=ie.document.createRange();on.setStart(yK.dom(),yJ);on.setEnd(ui.dom(),nu);return on},rtl:function(yK,yJ,ui,nu){var on=ie.document.createRange();on.setStart(ui.dom(),nu);on.setEnd(yK.dom(),yJ);return on}})};var lq={ltr:b1.ltr,rtl:b1.rtl,diagnose:tR,asLtrRange:x8};var nS=function(nu,yL,yJ,r,ie){if(ie===0){return 0}else{if(yL===r){return ie-1}}var on=r;for(var ui=1;ui<ie;ui++){var yK=nu(ui);var eq=Math.abs(yL-yK.left);if(yJ<=yK.bottom){if(yJ<yK.top||eq>on){return ui-1}else{on=eq}}}return 0};var ne=function(eq,r,ie){return r>=eq.left&&r<=eq.right&&ie>=eq.top&&ie<=eq.bottom};var sF={inRect:ne,searchForPoint:nS};var mE=function(yJ,yL,ui,nu,on){var yK=function(yN){var yM=yJ.dom().createRange();yM.setStart(yL.dom(),yN);yM.collapse(true);return yM};var ie=function(yN){var yM=yK(yN);return yM.getBoundingClientRect()};var r=q7.get(yL).length;var eq=sF.searchForPoint(ie,ui,nu,on.right,r);return yK(eq)};var e5=function(yJ,ui,ie,yK){var on=yJ.dom().createRange();on.selectNode(ui.dom());var nu=on.getClientRects();var eq=ra(nu,function(r){return sF.inRect(r,ie,yK)?tP.some(r):tP.none()});return eq.map(function(r){return mE(yJ,ui,ie,yK,r)})};var f8={locate:e5};var hp=function(ui,on,eq,yJ){var nu=ui.dom().createRange();var ie=yb.children(on);return ra(ie,function(r){nu.selectNode(r.dom());return sF.inRect(nu.getBoundingClientRect(),eq,yJ)?Q(ui,r,eq,yJ):tP.none()})};var Q=function(nu,ie,eq,on){var r=iI.isText(ie)?f8.locate:hp;return r(nu,ie,eq,on)};var e4=function(ui,on,eq,yL){var nu=ui.dom().createRange();nu.selectNode(on.dom());var ie=nu.getBoundingClientRect();var yK=Math.max(ie.left,Math.min(ie.right,eq));var yJ=Math.max(ie.top,Math.min(ie.bottom,yL));return Q(ui,on,yK,yJ)};var cJ={locate:e4};var rR=function(r){return gO.descendant(r,f6.isCursorPosition)};var mP=function(r){return rv(r,f6.isCursorPosition)};var rv=function(ie,r){var eq=function(yJ){var ui=yb.children(yJ);for(var on=ui.length-1;on>=0;on--){var yK=ui[on];if(r(yK)){return tP.some(yK)}var nu=eq(yK);if(nu.isSome()){return nu}}return tP.none()};return eq(ie)};var kJ={first:rR,last:mP};var td=true;var ys=false;var ug=function(eq,r){return r-eq.left<eq.right-r?td:ys};var yx=function(on,nu,ie){var eq=on.dom().createRange();eq.selectNode(nu.dom());eq.collapse(ie);return eq};var n1=function(yJ,ie,r){var ui=yJ.dom().createRange();ui.selectNode(ie.dom());var eq=ui.getBoundingClientRect();var on=ug(eq,r);var nu=on===td?kJ.first:kJ.last;return nu(ie).map(function(yK){return yx(yJ,yK,on)})};var mz=function(on,ie,r){var eq=ie.dom().getBoundingClientRect();var nu=ug(eq,r);return tP.some(yx(on,ie,nu))};var sv=function(nu,eq,r){var ie=yb.children(eq).length===0?mz:n1;return ie(nu,eq,r)};var pu={search:sv};var yk=function(eq,r,ie){return tP.from(eq.dom().caretPositionFromPoint(r,ie)).bind(function(on){if(on.offsetNode===null){return tP.none()}var nu=eq.dom().createRange();nu.setStart(on.offsetNode,on.offset);nu.collapse();return tP.some(nu)})};var uE=function(eq,r,ie){return tP.from(eq.dom().caretRangeFromPoint(r,ie))};var e6=function(ui,on,eq,yL){var nu=ui.dom().createRange();nu.selectNode(on.dom());var ie=nu.getBoundingClientRect();var yK=Math.max(ie.left,Math.min(ie.right,eq));var yJ=Math.max(ie.top,Math.min(ie.bottom,yL));return cJ.locate(ui,on,yK,yJ)};var vK=function(eq,r,ie){return pO.fromPoint(eq,r,ie).bind(function(nu){var on=function(){return pu.search(eq,nu,r)};return yb.children(nu).length===0?on():e6(eq,nu,r,ie).orThunk(on)})};var vL=document.caretPositionFromPoint?yk:document.caretRangeFromPoint?uE:vK;var ek=function(ie,r,nu){var eq=pO.fromDom(ie.document);return vL(eq,r,nu).map(function(on){return o0.range(pO.fromDom(on.startContainer),on.startOffset,pO.fromDom(on.endContainer),on.endOffset)})};var g4={fromPoint:ek};var bL=function(yJ,ie,nu,r){var ui=ab.create(yJ);var eq=iV.is(ie,r)?[ie]:[];var on=eq.concat(kR.descendants(ie,r));return l9(on,function(yK){ab.selectNodeContentsUsing(ui,yK);return ab.isWithin(nu,ui)})};var sx=function(on,nu,r){var ie=lq.asLtrRange(on,nu);var eq=pO.fromDom(ie.commonAncestorContainer);return iI.isElement(eq)?bL(on,eq,ie,r):[]};var m3={find:sx};var df=function(eq,ie){var r=iI.name(eq);if("input"===r){return qt.after(eq)}else{if(!hZ(["br","img"],r)){return qt.on(eq,ie)}else{return ie===0?qt.before(eq):qt.after(eq)}}};var mH=function(ie,r){var nu=ie.fold(qt.before,df,qt.after);var eq=r.fold(qt.before,df,qt.after);return o0.relative(nu,eq)};var yw=function(ui,nu,ie,r){var on=df(ui,nu);var eq=df(ie,r);return o0.relative(on,eq)};var u0=function(r){return r.match({domRange:function(eq){var nu=pO.fromDom(eq.startContainer);var ie=pO.fromDom(eq.endContainer);return yw(nu,eq.startOffset,ie,eq.endOffset)},relative:mH,exact:yw})};var ii={beforeSpecial:df,preprocess:u0,preprocessRelative:mH,preprocessExact:yw};var aB=function(eq,r){tP.from(eq.getSelection()).each(function(ie){ie.removeAllRanges();ie.addRange(r)})};var bU=function(on,ui,nu,ie,r){var eq=ab.exactToNative(on,ui,nu,ie,r);aB(on,eq)};var eG=function(ie,eq,r){return m3.find(ie,eq,r)};var fs=function(on,nu,ui,ie,eq,r){nu.collapse(ui.dom(),ie);nu.extend(eq.dom(),r)};var dL=function(eq,r){return lq.diagnose(eq,r).match({ltr:function(ui,on,nu,ie){bU(eq,ui,on,nu,ie)},rtl:function(yK,ui,nu,ie){var on=eq.getSelection();if(on.setBaseAndExtent){on.setBaseAndExtent(yK.dom(),ui,nu.dom(),ie)}else{if(on.extend){try{fs(eq,on,yK,ui,nu,ie)}catch(yJ){bU(eq,nu,ie,yK,ui)}}else{bU(eq,nu,ie,yK,ui)}}}})};var d3=function(on,ui,ie,eq,r){var nu=ii.preprocessExact(ui,ie,eq,r);dL(on,nu)};var cP=function(nu,eq,r){var ie=ii.preprocessRelative(eq,r);dL(nu,ie)};var mJ=function(eq){var nu=o0.getWin(eq).dom();var ie=function(yK,yJ,ui,on){return ab.exactToNative(nu,yK,yJ,ui,on)};var r=ii.preprocess(eq);return lq.diagnose(nu,r).match({ltr:ie,rtl:ie})};var xb=function(eq){if(eq.rangeCount>0){var r=eq.getRangeAt(0);var ie=eq.getRangeAt(eq.rangeCount-1);return tP.some(o0.range(pO.fromDom(r.startContainer),r.startOffset,pO.fromDom(ie.endContainer),ie.endOffset))}else{return tP.none()}};var eO=function(eq){var r=pO.fromDom(eq.anchorNode);var ie=pO.fromDom(eq.focusNode);return x9.after(r,eq.anchorOffset,ie,eq.focusOffset)?tP.some(o0.range(pO.fromDom(eq.anchorNode),eq.anchorOffset,pO.fromDom(eq.focusNode),eq.focusOffset)):xb(eq)};var ol=function(ie,eq){var r=ab.selectNodeContents(ie,eq);aB(ie,r)};var sf=function(ie,eq){var r=ab.selectNodeContents(ie,eq);return o0.range(pO.fromDom(r.startContainer),r.startOffset,pO.fromDom(r.endContainer),r.endOffset)};var vG=function(r){return tP.from(r.getSelection()).filter(function(eq){return eq.rangeCount>0}).bind(eO)};var xk=function(r){return vG(r).map(function(eq){return o0.exact(eq.start(),eq.soffset(),eq.finish(),eq.foffset())})};var aj=function(ie,eq){var r=lq.asLtrRange(ie,eq);return ab.getFirstRect(r)};var aA=function(ie,eq){var r=lq.asLtrRange(ie,eq);return ab.getBounds(r)};var jP=function(eq,r,ie){return g4.fromPoint(eq,r,ie)};var nP=function(ie,eq){var r=lq.asLtrRange(ie,eq);return ab.toString(r)};var vf=function(eq){var r=eq.getSelection();r.removeAllRanges()};var om=function(ie,eq){var r=lq.asLtrRange(ie,eq);return ab.cloneFragment(r)};var j2=function(on,ie,nu){var r=lq.asLtrRange(on,ie);var eq=je.fromElements(nu,on.document);ab.replaceWith(r,eq)};var tZ=function(ie,eq){var r=lq.asLtrRange(ie,eq);ab.deleteContents(r)};var bl=function(nu,ie,eq,r){return gb.eq(nu,eq)&&ie===r};var w3={setExact:d3,getExact:vG,get:xk,setRelative:cP,toNative:mJ,setToElement:ol,clear:vf,clone:om,replace:j2,deleteAt:tZ,forElement:sf,getFirstRect:aj,getBounds:aA,getAtPoint:jP,findWithin:eG,getAsString:nP,isCollapsed:bl};var pJ=2;var o6=function(r){return{left:r.left,top:r.top,right:r.right,bottom:r.bottom,width:fY(pJ),height:r.height}};var gL=function(r){return{left:fY(r.left),top:fY(r.top),right:fY(r.right),bottom:fY(r.bottom),width:fY(r.width),height:fY(r.height)}};var b2=function(eq){if(!eq.collapsed){return r5(eq.getClientRects(),gL)}else{var r=pO.fromDom(eq.startContainer);return yb.parent(r).bind(function(on){var nu=o0.exact(r,eq.startOffset,on,f6.getEnd(on));var ie=w3.getFirstRect(eq.startContainer.ownerDocument.defaultView,nu);return ie.map(o6).map(qT)}).getOr([])}};var aa=function(r){var eq=r.getSelection();return eq!==undefined&&eq.rangeCount>0?b2(eq.getRangeAt(0)):[]};var lM={getRectangles:aa};var vk=function(){return function(r){setTimeout(function(){r()},0)}};var bt=function(eq){eq.focus();var r=pO.fromDom(eq.document.body);var nu=xI.active().exists(function(on){return hZ(["input","textarea"],iI.name(on))});var ie=nu?vk():eu;ie(function(){xI.active().each(xI.blur);xI.focus(r)})};var fh={resume:bt};var wE=50;var iH="data-"+eL.resolve("last-outer-height");var yp=function(eq,r){kh.set(eq,iH,r)};var vh=function(r){return n5.safeParse(r,iH)};var vE=function(r){return{top:fY(r.top()),bottom:fY(r.top()+r.height())}};var az=function(eq){var r=lM.getRectangles(eq);return r.length>0?tP.some(r[0]).map(vE):tP.none()};var xW=function(r,nu){var eq=vh(nu);var ie=r.innerHeight;return eq>ie?tP.some(eq-ie):tP.none()};var lF=function(eq,ie,nu){var r=ie.top()>eq.innerHeight||ie.bottom()>eq.innerHeight;return r?Math.min(nu,ie.bottom()-eq.innerHeight+wE):0};var d2=function(ie,eq){var on=pO.fromDom(eq.document.body);var ui=function(){fh.resume(eq)};var nu=f3.bind(pO.fromDom(ie),"resize",function(){xW(ie,on).each(function(yJ){az(eq).each(function(yL){var yK=lF(eq,yL,yJ);if(yK!==0){eq.scrollTo(eq.pageXOffset,eq.pageYOffset+yK)}})});yp(on,ie.innerHeight)});yp(on,ie.innerHeight);var r=function(){nu.unbind()};return{toEditing:ui,destroy:r}};var gJ={setup:d2};var vN=function(r){return tP.some(pO.fromDom(r.dom().contentWindow.document.body))};var kx=function(r){return tP.some(pO.fromDom(r.dom().contentWindow.document))};var bZ=function(r){return tP.from(r.dom().contentWindow)};var ax=function(r){var eq=bZ(r);return eq.bind(w3.getExact)};var gK=function(r){return r.getFrame()};var oF=function(r,eq){return function(ie){var nu=ie[r].getOrThunk(function(){var on=gK(ie);return function(){return eq(on)}});return nu()}};var jd=function(ie,nu,r,eq){return ie[r].getOrThunk(function(){return function(on){return f3.bind(nu,eq,on)}})};var gI=function(r){return{left:fY(r.left),top:fY(r.top),right:fY(r.right),bottom:fY(r.bottom),width:fY(r.width),height:fY(r.height)}};var sY=function(r){var ie=gK(r);var eq=function(ui){var nu=function(yJ){return gb.eq(yJ.start(),yJ.finish())&&yJ.soffset()===yJ.foffset()};var on=function(yK){var yJ=yK.start().dom().getBoundingClientRect();return yJ.width>0||yJ.height>0?tP.some(yJ).map(gI):tP.none()};return w3.getExact(ui).filter(nu).bind(on)};return vN(ie).bind(function(nu){return kx(ie).bind(function(on){return bZ(ie).map(function(yL){var yJ=pO.fromDom(on.dom().documentElement);var ui=r.getCursorBox.getOrThunk(function(){return function(){return w3.get(yL).bind(function(yN){return w3.getFirstRect(yL,yN).orThunk(function(){return eq(yL)})})}});var yK=r.setSelection.getOrThunk(function(){return function(yQ,yP,yO,yN){w3.setExact(yL,yQ,yP,yO,yN)}});var yM=r.clearSelection.getOrThunk(function(){return function(){w3.clear(yL)}});return{body:fY(nu),doc:fY(on),win:fY(yL),html:fY(yJ),getSelection:mX(ax,ie),setSelection:yK,clearSelection:yM,frame:fY(ie),onKeyup:jd(r,on,"onKeyup","keyup"),onNodeChanged:jd(r,on,"onNodeChanged","selectionchange"),onDomChanged:r.onDomChanged,onScrollToCursor:r.onScrollToCursor,onScrollToElement:r.onScrollToElement,onToReading:r.onToReading,onToEditing:r.onToEditing,onToolbarScrollStart:r.onToolbarScrollStart,onTouchContent:r.onTouchContent,onTapContent:r.onTapContent,onTouchToolstrip:r.onTouchToolstrip,getCursorBox:ui}})})})};var bn={getBody:oF("getBody",vN),getDoc:oF("getDoc",kx),getWin:oF("getWin",bZ),getSelection:oF("getSelection",ax),getFrame:gK,getActiveApi:sY};var mg="data-ephox-mobile-fullscreen-style";var cd="display:none!important;";var uR="position:absolute!important;";var dA="top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;";var hg="background-color:rgb(255,255,255)!important;";var g9=jz.detect().os.isAndroid();var ym=function(eq){var r=cL.get(eq,"background-color");return r!==undefined&&r!==""?"background-color:"+r+"!important":hg};var fa=function(r,nu){var ui=function(yL){var yM=kR.siblings(yL,"*");return yM};var yK=function(yL){return function(yN){var yO=kh.get(yN,"style");var yM=yO===undefined?"no-styles":yO.trim();if(yM===yL){return}else{kh.set(yN,mg,yM);kh.set(yN,"style",yL)}}};var ie=kR.ancestors(r,"*");var yJ=hw(ie,ui);var on=ym(nu);kV(yJ,yK(cd));kV(ie,yK(uR+dA+on));var eq=g9===true?"":uR;yK(eq+dA+on)(r)};var fZ=function(){var r=kR.all("["+mg+"]");kV(r,function(eq){var ie=kh.get(eq,mg);if(ie!=="no-styles"){kh.set(eq,"style",ie)}else{kh.remove(eq,"style")}kh.remove(eq,mg)})};var wR={clobberStyles:fa,restoreStyles:fZ};var qb=function(){var on=yz.first("head").getOrDie();var eq=function(){var nu=pO.fromTag("meta");kh.set(nu,"name","viewport");vA.append(on,nu);return nu};var ie=yz.first('meta[name="viewport"]').getOrThunk(eq);var r=kh.get(ie,"content");var yJ=function(){kh.set(ie,"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")};var ui=function(){if(r!==undefined&&r!==null&&r.length>0){kh.set(ie,"content",r)}else{kh.set(ie,"content","user-scalable=yes")}};return{maximize:yJ,restore:ui}};var j6={tag:qb};var tA=function(r,eq){var ui=j6.tag();var nu=cM();var on=cM();var yJ=function(){eq.hide();rG.add(r.container,eL.resolve("fullscreen-maximized"));rG.add(r.container,eL.resolve("android-maximized"));ui.maximize();rG.add(r.body,eL.resolve("android-scroll-reload"));nu.set(gJ.setup(r.win,bn.getWin(r.editor).getOrDie("no")));bn.getActiveApi(r.editor).each(function(yK){wR.clobberStyles(r.container,yK.body());on.set(eI.initEvents(yK,r.toolstrip,r.alloy))})};var ie=function(){ui.restore();eq.show();rG.remove(r.container,eL.resolve("fullscreen-maximized"));rG.remove(r.container,eL.resolve("android-maximized"));wR.restoreStyles();rG.remove(r.body,eL.resolve("android-scroll-reload"));on.clear();nu.clear()};return{enter:yJ,exit:ie}};var yh={create:tA};var rQ=function(eq,r){var on=null;var ie=function(){if(on!==null){clearTimeout(on);on=null}};var nu=function(){var ui=[];for(var yJ=0;yJ<arguments.length;yJ++){ui[yJ]=arguments[yJ]}if(on===null){on=setTimeout(function(){eq.apply(null,ui);on=null},r)}};return{cancel:ie,throttle:nu}};var mO=function(eq,r){var on=null;var ie=function(){if(on!==null){clearTimeout(on);on=null}};var nu=function(){var ui=[];for(var yJ=0;yJ<arguments.length;yJ++){ui[yJ]=arguments[yJ]}if(on!==null){clearTimeout(on)}on=setTimeout(function(){eq.apply(null,ui);on=null},r)};return{cancel:ie,throttle:nu}};var he=function(nu,ie){var eq=ct(sl.sketch({dom:jt('<div aria-hidden="true" class="${prefix}-mask-tap-icon"></div>'),containerBehaviours:h4([my.config({toggleClass:eL.resolve("mask-tap-icon-selected"),toggleOnExecute:false})])}));var r=rQ(nu,200);return sl.sketch({dom:jt('<div class="${prefix}-disabled-mask"></div>'),components:[sl.sketch({dom:jt('<div class="${prefix}-content-container"></div>'),components:[wK.sketch({dom:jt('<div class="${prefix}-content-tap-section"></div>'),components:[eq.asSpec()],action:function(on){r.throttle()},buttonBehaviours:h4([my.config({toggleClass:eL.resolve("mask-tap-icon-selected")})])})]})]})};var pP={sketch:he};var wY=aL([xY("editor",[o("getFrame"),jr("getBody"),jr("getDoc"),jr("getWin"),jr("getSelection"),jr("setSelection"),jr("clearSelection"),jr("cursorSaver"),jr("onKeyup"),jr("onNodeChanged"),jr("getCursorBox"),o("onDomChanged"),qA("onTouchContent",S),qA("onTapContent",S),qA("onTouchToolstrip",S),qA("onScrollToCursor",fY({unbind:S})),qA("onScrollToElement",fY({unbind:S})),qA("onToEditing",fY({unbind:S})),qA("onToReading",fY({unbind:S})),qA("onToolbarScrollStart",iC)]),o("socket"),o("toolstrip"),o("dropup"),o("toolbar"),o("container"),o("alloy"),bf("win",function(r){return yb.owner(r.socket).dom().defaultView}),bf("body",function(r){return pO.fromDom(r.socket.dom().ownerDocument.body)}),qA("translate",iC),qA("setReadOnly",S),qA("readOnlyOnInit",fY(true))]);var r0=function(nu){var ie=rF("Getting AndroidWebapp schema",wY,nu);cL.set(ie.toolstrip,"width","100%");var on=function(){ie.setReadOnly(ie.readOnlyOnInit());ui.enter()};var eq=vw(pP.sketch(on,ie.translate));ie.alloy.add(eq);var r={show:function(){ie.alloy.add(eq)},hide:function(){ie.alloy.remove(eq)}};vA.append(ie.container,eq.element());var ui=yh.create(ie,r);return{setReadOnly:ie.setReadOnly,refreshStructure:S,enter:ui.enter,exit:ui.exit,destroy:S}};var uI={produce:r0};var wx=fY([qA("shell",true),bA("toolbarBehaviours",[yy])]);var jw=function(r){return{behaviours:h4([yy.config({})])}};var sP=fY([sG({name:"groups",overrides:jw})]);var cX=function(on,yJ,ie,ui){var eq=function(yL,yK){nu(yL).fold(function(){console.error("Toolbar was defined to not be a shell, but no groups container was specified in components");throw new Error("Toolbar was defined to not be a shell, but no groups container was specified in components")},function(yM){yy.set(yM,yK)})};var nu=function(yK){return on.shell()?tP.some(yK):ph(yK,on,"groups")};var r=on.shell()?{behaviours:[yy.config({})],components:[]}:{behaviours:[],components:yJ};return{uid:on.uid(),dom:on.dom(),components:r.components,behaviours:eH(h4(r.behaviours),aW(on.toolbarBehaviours())),apis:{setGroups:eq},domModification:{attributes:{role:"group"}}}};var kM=uk({name:"Toolbar",configFields:wx(),partFields:sP(),factory:cX,apis:{setGroups:function(eq,ie,r){eq.setGroups(ie,r)}}});var ww=fY([o("items"),jO(["itemClass"]),bA("tgroupBehaviours",[x2])]);var sO=fY([pK({name:"items",unit:"item",overrides:function(r){return{domModification:{classes:[r.markers().itemClass()]}}}})]);var cW=function(eq,nu,r,ie){return eH({dom:{attributes:{role:"toolbar"}}},{uid:eq.uid(),dom:eq.dom(),components:nu,behaviours:eH(h4([x2.config({mode:"flow",selector:"."+eq.markers().itemClass()})]),aW(eq.tgroupBehaviours())),"debug.sketcher":r["debug.sketcher"]})};var uZ=uk({name:"ToolbarGroup",configFields:ww(),partFields:sO(),factory:cW});var rj="data-"+eL.resolve("horizontal-scroll");var c2=function(eq){eq.dom().scrollTop=1;var r=eq.dom().scrollTop!==0;eq.dom().scrollTop=0;return r};var mQ=function(eq){eq.dom().scrollLeft=1;var r=eq.dom().scrollLeft!==0;eq.dom().scrollLeft=0;return r};var jj=function(r){return r.dom().scrollTop>0||c2(r)};var cB=function(r){return r.dom().scrollLeft>0||mQ(r)};var yI=function(r){kh.set(r,rj,"true")};var i6=function(r){return kh.get(r,rj)==="true"?cB(r):jj(r)};var g=function(eq,r){return f3.bind(eq,"touchmove",function(ie){yz.closest(ie.target(),r).filter(i6).fold(function(){ie.raw().preventDefault()},S)})};var dd={exclusive:g,markAsHorizontal:yI};function nc(){var ie=function(yO){var yP=yO.scrollable===true?"${prefix}-toolbar-scrollable-group":"";return{dom:jt('<div aria-label="'+yO.label+'" class="${prefix}-toolbar-group '+yP+'"></div>'),tgroupBehaviours:h4([iJ("adhoc-scrollable-toolbar",yO.scrollable===true?[nt(function(yQ,yR){cL.set(yQ.element(),"overflow-x","auto");dd.markAsHorizontal(yQ.element());nA.register(yQ.element())})]:[])]),components:[sl.sketch({components:[uZ.parts().items({})]})],markers:{itemClass:eL.resolve("toolbar-group-item")},items:yO.items}};var yL=vw(kM.sketch({dom:jt('<div class="${prefix}-toolbar"></div>'),components:[kM.parts().groups({})],toolbarBehaviours:h4([my.config({toggleClass:eL.resolve("context-toolbar"),toggleOnExecute:false,aria:{mode:"none"}}),x2.config({mode:"cyclic"})]),shell:true}));var eq=vw(sl.sketch({dom:{classes:[eL.resolve("toolstrip")]},components:[yD(yL)],containerBehaviours:h4([my.config({toggleClass:eL.resolve("android-selection-context-toolbar"),toggleOnExecute:false})])}));var on=function(){kM.setGroups(yL,r.get());my.off(yL)};var r=hr([]);var yN=function(yO){r.set(yO);on()};var nu=function(yO){return r5(yO,kP(uZ.sketch,ie))};var yK=function(){};var yJ=function(yO){my.on(yL);kM.setGroups(yL,yO)};var ui=function(){if(my.isOn(yL)){on()}};var yM=function(){x2.focusIn(yL)};return{wrapper:fY(eq),toolbar:fY(yL),createGroups:nu,setGroups:yN,setContextToolbar:yJ,restoreToolbar:ui,refresh:yK,focus:yM}}var wu=function(r){return vw(wK.sketch({dom:jt('<div class="${prefix}-mask-edit-icon ${prefix}-icon"></div>'),action:function(){r.run(function(eq){eq.setReadOnly(false)})}}))};var gr=function(){return vw(sl.sketch({dom:jt('<div class="${prefix}-editor-socket"></div>'),components:[],containerBehaviours:h4([yy.config({})])}))};var cw=function(r,eq){yy.append(r,yD(eq))};var fO=function(r,eq){yy.remove(r,eq)};var wd=function(eq,ie,ui,r){var on=ui===true?aJ.toAlpha:aJ.toOmega;on(r);var nu=ui?cw:fO;nu(eq,ie)};var hi={makeEditSwitch:wu,makeSocket:gr,updateMode:wd};var xe=function(r,eq){return eq.getAnimationRoot().fold(function(){return r.element()},function(ie){return ie(r)})};var tj=function(r){return r.dimension().property()};var vC=function(eq,r){return eq.dimension().getDimension()(r)};var vM=function(eq,ie){var r=xe(eq,ie);mq.remove(r,[ie.shrinkingClass(),ie.growingClass()])};var mm=function(r,eq){rG.remove(r.element(),eq.openClass());rG.add(r.element(),eq.closedClass());cL.set(r.element(),tj(eq),"0px");cL.reflow(r.element())};var kw=function(eq,ie){ik(eq,ie);var r=vC(ie,eq.element());mm(eq,ie);return r};var ik=function(r,eq){rG.remove(r.element(),eq.closedClass());rG.add(r.element(),eq.openClass());cL.remove(r.element(),tj(eq))};var fv=function(eq,ie,r){r.setCollapsed();cL.set(eq.element(),tj(ie),vC(ie,eq.element()));cL.reflow(eq.element());vM(eq,ie);mm(eq,ie);ie.onStartShrink()(eq);ie.onShrunk()(eq)};var cH=function(ie,nu,eq){eq.setCollapsed();cL.set(ie.element(),tj(nu),vC(nu,ie.element()));cL.reflow(ie.element());var r=xe(ie,nu);rG.add(r,nu.shrinkingClass());mm(ie,nu);nu.onStartShrink()(ie)};var qS=function(ie,on,eq){var nu=kw(ie,on);var r=xe(ie,on);rG.add(r,on.growingClass());ik(ie,on);cL.set(ie.element(),tj(on),nu);eq.setExpanded();on.onStartGrow()(ie)};var yf=function(eq,ie,r){if(!r.isExpanded()){qS(eq,ie,r)}};var wl=function(eq,ie,r){if(r.isExpanded()){cH(eq,ie,r)}};var fb=function(eq,ie,r){if(r.isExpanded()){fv(eq,ie,r)}};var rm=function(eq,ie,r){return r.isExpanded()};var u3=function(eq,ie,r){return r.isCollapsed()};var mf=function(ie,nu,eq){var r=xe(ie,nu);return rG.has(r,nu.growingClass())===true};var q9=function(ie,nu,eq){var r=xe(ie,nu);return rG.has(r,nu.shrinkingClass())===true};var hK=function(eq,ie,r){return mf(eq,ie,r)===true||q9(eq,ie,r)===true};var xV=function(eq,nu,r){var ie=r.isExpanded()?cH:qS;ie(eq,nu,r)};var bP=Object.freeze({grow:yf,shrink:wl,immediateShrink:fb,hasGrown:rm,hasShrunk:u3,isGrowing:mf,isShrinking:q9,isTransitioning:hK,toggleGrow:xV,disableTransitions:vM});var wX=function(eq,ie){var r=ie.expanded();return r?wk({classes:[ie.openClass()],styles:{}}):wk({classes:[ie.closedClass()],styles:lX(ie.dimension().property(),"0px")})};var sr=function(eq,r){return hf([cv(i3(),function(nu,ui){var ie=ui.event().raw();if(ie.propertyName===eq.dimension().property()){vM(nu,eq);if(r.isExpanded()){cL.remove(nu.element(),eq.dimension().property())}var on=r.isExpanded()?eq.onGrown():eq.onShrunk();on(nu)}})])};var iB=Object.freeze({exhibit:wX,events:sr});var qe=[o("closedClass"),o("openClass"),o("shrinkingClass"),o("growingClass"),jr("getAnimationRoot"),fc("onShrunk"),fc("onStartShrink"),fc("onGrown"),fc("onStartGrow"),qA("expanded",false),m4("dimension",c5("property",{width:[cC("property","width"),cC("getDimension",function(r){return rr.get(r)+"px"})],height:[cC("property","height"),cC("getDimension",function(r){return uF.get(r)+"px"})]}))];var jC=function(r){var ie=hr(r.expanded());var eq=function(){return"expanded: "+ie.get()};return wh({isExpanded:function(){return ie.get()===true},isCollapsed:function(){return ie.get()===false},setCollapsed:mX(ie.set,false),setExpanded:mX(ie.set,true),readState:eq})};var eU=Object.freeze({init:jC});var aX=tE({fields:qe,name:"sliding",active:iB,apis:bP,state:eU});var vu=function(nu,on){var eq=vw(sl.sketch({dom:{tag:"div",classes:[eL.resolve("dropup")]},components:[],containerBehaviours:h4([yy.config({}),aX.config({closedClass:eL.resolve("dropup-closed"),openClass:eL.resolve("dropup-open"),shrinkingClass:eL.resolve("dropup-shrinking"),growingClass:eL.resolve("dropup-growing"),dimension:{property:"height"},onShrunk:function(ui){nu();on();yy.set(ui,[])},onGrown:function(ui){nu();on()}}),dx.orientation(function(ui,yJ){r(S)})])}));var ie=function(yJ,yK,ui){if(aX.hasShrunk(eq)===true&&aX.isTransitioning(eq)===false){window.requestAnimationFrame(function(){yK(ui);yy.set(eq,[yJ()]);aX.grow(eq)})}};var r=function(ui){window.requestAnimationFrame(function(){ui();aX.shrink(eq)})};return{appear:ie,disappear:r,component:fY(eq),element:eq.element}};var ig=function(r){var eq=r.raw();return eq.which===rI()[0]&&!hZ(["input","textarea"],iI.name(r.target()))};var pR=jz.detect().browser.isFirefox();var hj=ih([hs("triggerEvent"),hs("broadcastEvent"),qA("stopBackspace",true)]);var mx=function(r,eq){if(pR){return f3.capture(r,"focus",eq)}else{return f3.bind(r,"focusin",eq)}};var oC=function(r,eq){if(pR){return f3.capture(r,"blur",eq)}else{return f3.bind(r,"focusout",eq)}};var d1=function(eq,yM){var nu=rF("Getting GUI events settings",hj,yM);var yJ=jz.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"];var yO=dX(nu);var ie=r5(yJ.concat(["selectstart","input","contextmenu","change","transitionend","drag","dragstart","dragend","dragenter","dragleave","dragover","drop"]),function(yP){return f3.bind(eq,yP,function(yQ){yO.fireIfReady(yQ,yP).each(function(yS){if(yS){yQ.kill()}});var yR=nu.triggerEvent(yP,yQ);if(yR){yQ.kill()}})});var ui=f3.bind(eq,"keydown",function(yP){var yQ=nu.triggerEvent("keydown",yP);if(yQ){yP.kill()}else{if(nu.stopBackspace===true&&ig(yP)){yP.prevent()}}});var r=mx(eq,function(yP){var yQ=nu.triggerEvent("focusin",yP);if(yQ){yP.kill()}});var yK=oC(eq,function(yP){var yQ=nu.triggerEvent("focusout",yP);if(yQ){yP.kill()}setTimeout(function(){nu.triggerEvent(qQ(),yP)},0)});var yL=yb.defaultView(eq);var on=f3.bind(yL,"scroll",function(yP){var yQ=nu.broadcastEvent(xv(),yP);if(yQ){yP.kill()}});var yN=function(){kV(ie,function(yP){yP.unbind()});ui.unbind();r.unbind();yK.unbind();on.unbind()};return{unbind:yN}};var h3=function(r,ie){var eq=fr(r,"target").map(function(nu){return nu()}).getOr(ie);return hr(eq)};var yG=function(nu,ui){var ie=hr(false);var r=hr(false);var eq=function(){ie.set(true)};var on=function(){r.set(true)};return{stop:eq,cut:on,isStopped:ie.get,isCut:r.get,event:fY(nu),setSource:ui.set,getSource:ui.get}};var ht=function(ie){var eq=hr(false);var r=function(){eq.set(true)};return{stop:r,cut:S,isStopped:eq.get,isCut:fY(false),event:fY(ie),setSource:oy("Cannot set source of a broadcasted event"),getSource:oy("Cannot get source of a broadcasted event")}};var b0=ox.generate([{stopped:[]},{resume:["element"]},{complete:[]}]);var bX=function(yK,eq,on,yJ,ui,r){var ie=yK(eq,yJ);var nu=yG(on,ui);return ie.fold(function(){r.logEventNoHandlers(eq,yJ);return b0.complete()},function(yN){var yM=yN.descHandler();var yL=pT(yM);yL(nu);if(nu.isStopped()){r.logEventStopped(eq,yN.element(),yM.purpose());return b0.stopped()}else{if(nu.isCut()){r.logEventCut(eq,yN.element(),yM.purpose());return b0.complete()}else{return yb.parent(yN.element()).fold(function(){r.logNoParent(eq,yN.element(),yM.purpose());return b0.complete()},function(yO){r.logEventResponse(eq,yN.element(),yM.purpose());return b0.resume(yO)})}}})};var jo=function(on,eq,ie,ui,nu,r){return bX(on,eq,ie,ui,nu,r).fold(function(){return true},function(yJ){return jo(on,eq,ie,yJ,nu,r)},function(){return false})};var yq=function(ui,eq,ie,on,r){var nu=h3(ie,on);return bX(ui,eq,ie,on,nu,r)};var fF=function(eq,nu,r){var ie=ht(nu);kV(eq,function(yJ){var on=yJ.descHandler();var ui=pT(on);ui(ie)});return ie.isStopped()};var p2=function(nu,eq,ie,r){var on=ie.target();return u7(nu,eq,ie,on,r)};var u7=function(on,eq,ie,ui,r){var nu=h3(ie,ui);return jo(on,eq,ie,ui,nu,r)};var iv=function(nu,eq,r){var ie=gO.closest(nu,function(on){return eq(on).isSome()},r);return ie.bind(eq)};var w=lG("element","descHandler");var os=function(eq,r){return{id:fY(eq),descHandler:fY(r)}};function kp(){var r={};var on=function(yJ,yL,yK){tS(yK,function(yO,yN){var yM=r[yN]!==undefined?r[yN]:{};yM[yL]=pe(yO,yJ);r[yN]=yM})};var ie=function(yJ,yK){return rL(yK).fold(function(){return tP.none()},function(yM){var yL=j1(yM);return yJ.bind(yL).map(function(yN){return w(yK,yN)})})};var nu=function(yJ){return fr(r,yJ).map(function(yK){return jl(yK,function(yL,yM){return os(yM,yL)})}).getOr([])};var eq=function(yN,yL,yM){var yJ=j1(yL);var yK=yJ(r);return iv(yM,function(yO){return ie(yK,yO)},yN)};var ui=function(yJ){tS(r,function(yK,yL){if(yK.hasOwnProperty(yJ)){delete yK[yJ]}})};return{registerId:on,unregisterId:ui,filterByType:nu,find:eq}}function pm(){var yK=kp();var eq={};var yJ=function(yM){var yN=yM.element();return rL(yN).fold(function(){return yi("uid-",yM.element())},function(yO){return yO})};var on=function(yM,yN){var yO=eq[yN];if(yO===yM){nu(yM)}else{throw new Error('The tagId "'+yN+'" is already used by: '+aE(yO.element())+"\nCannot use it for: "+aE(yM.element())+"\nThe conflicting element is"+(r8.inBody(yO.element())?" ":" not ")+"already in the DOM")}};var ui=function(yN){var yO=yJ(yN);if(p3(eq,yO)){on(yN,yO)}var yM=[yN];yK.registerId(yM,yO,yN.events());eq[yO]=yN};var nu=function(yM){rL(yM.element()).each(function(yN){eq[yN]=undefined;yK.unregisterId(yN)})};var r=function(yM){return yK.filterByType(yM)};var ie=function(yO,yM,yN){return yK.find(yO,yM,yN)};var yL=function(yM){return j1(yM)(eq)};return{find:ie,filter:r,register:ui,unregister:nu,getById:yL}}var lg=function(yM){var yQ=function(yT){return yb.parent(yM.element()).fold(function(){return true},function(yU){return gb.eq(yT,yU)})};var r=pm();var on=function(yT,yU){return r.find(yQ,yT,yU)};var yK=d1(yM.element(),{triggerEvent:function(yT,yU){return cI(yT,yU.target(),function(yV){return p2(on,yT,yU,yV)})},broadcastEvent:function(yT,yV){var yU=r.filter(yT);return fF(yU,yV)}});var ui=rJ({debugInfo:fY("real"),triggerEvent:function(yT,yV,yU){cI(yT,yV,function(yW){u7(on,yT,yU,yV,yW)})},triggerFocus:function(yT,yU){rL(yT).fold(function(){xI.focus(yT)},function(yV){cI(j(),yT,function(yW){yq(on,j(),{originator:fY(yU),kill:S,prevent:S,target:fY(yT)},yT,yW)})})},triggerEscape:function(yT,yU){ui.triggerEvent("keydown",yT.element(),yU.event())},getByUid:function(yT){return eq(yT)},getByDom:function(yT){return yO(yT)},build:vw,addToGui:function(yT){yR(yT)},removeFromGui:function(yT){yJ(yT)},addToWorld:function(yT){nu(yT)},removeFromWorld:function(yT){yL(yT)},broadcast:function(yT){yS(yT)},broadcastOn:function(yT,yU){yP(yT,yU)},isConnected:fY(true)});var nu=function(yT){yT.connect(ui);if(!iI.isText(yT.element())){r.register(yT);kV(yT.components(),nu);ui.triggerEvent(vD(),yT.element(),{target:fY(yT.element())})}};var yL=function(yT){if(!iI.isText(yT.element())){kV(yT.components(),yL);r.unregister(yT)}yT.disconnect()};var yR=function(yT){A(yM,yT)};var yJ=function(yT){od(yT)};var yN=function(){yK.unbind();q0.remove(yM.element())};var ie=function(yU){var yT=r.filter(ai());kV(yT,function(yX){var yV=yX.descHandler();var yW=pT(yV);yW(yU)})};var yS=function(yT){ie({universal:fY(true),data:fY(yT)})};var yP=function(yT,yU){ie({universal:fY(false),channels:fY(yT),data:fY(yU)})};var eq=function(yT){return r.getById(yT).fold(function(){return l7.error(new Error('Could not find component with uid: "'+yT+'" in system.'))},l7.value)};var yO=function(yU){var yT=rL(yU).getOr("not found");return eq(yT)};nu(yM);return{root:fY(yM),element:yM.element,destroy:yN,add:yR,remove:yJ,getByUid:eq,getByDom:yO,addToWorld:nu,removeFromWorld:yL,broadcast:yS,broadcastOn:yP}};var bg=fY(eL.resolve("readonly-mode"));var l0=fY(eL.resolve("edit-mode"));function pd(eq){var r=vw(sl.sketch({dom:{classes:[eL.resolve("outer-container")].concat(eq.classes)},containerBehaviours:h4([aJ.config({alpha:bg(),omega:l0()})])}));return lg(r)}function ga(eq){var yQ=pd({classes:[eL.resolve("android-container")]});var yM=nc();var nu=cM();var yN=hi.makeEditSwitch(nu);var yO=hi.makeSocket();var ui=vu(S,eq);yQ.add(yM.wrapper());yQ.add(yO);yQ.add(ui.component());var yK=function(yS){var yR=yM.createGroups(yS);yM.setGroups(yR)};var yJ=function(yS){var yR=yM.createGroups(yS);yM.setContextToolbar(yR)};var ie=function(){yM.focus()};var on=function(){yM.restoreToolbar()};var yP=function(yR){nu.set(uI.produce(yR))};var r=function(){nu.run(function(yR){yR.exit();yy.remove(yO,yN)})};var yL=function(yR){hi.updateMode(yO,yN,yR,yQ.root())};return{system:fY(yQ),element:yQ.element,init:yP,exit:r,setToolbarGroups:yK,setContextToolbar:yJ,focusToolbar:ie,restoreToolbar:on,updateMode:yL,socket:fY(yO),dropup:fY(ui)}}var xJ=function(ie,eq){var r=pO.fromTag("input");cL.setAll(r,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"});vA.append(ie,r);xI.focus(r);eq(r);q0.remove(r)};var ls={input:xJ};var oX=function(eq){var nu=eq.dom().selectionStart;var r=eq.dom().selectionEnd;var ie=eq.dom().selectionDirection;setTimeout(function(){eq.dom().setSelectionRange(nu,r,ie);xI.focus(eq)},50)};var am=function(eq){var on=eq.getSelection();if(on.rangeCount>0){var ie=on.getRangeAt(0);var nu=eq.document.createRange();nu.setStart(ie.startContainer,ie.startOffset);nu.setEnd(ie.endContainer,ie.endOffset);on.removeAllRanges();on.addRange(nu)}};var jf={refreshInput:oX,refresh:am};var l6=function(r,eq){xI.active().each(function(ie){if(!gb.eq(ie,eq)){xI.blur(ie)}});r.focus();xI.focus(pO.fromDom(r.document.body));jf.refresh(r)};var pg={resume:l6};var gl=function(ui,yJ,nu,eq){var r=function(){pg.resume(yJ,eq)};var ie=function(){ls.input(ui,xI.blur)};var yL=f3.bind(nu,"keydown",function(yM){if(!hZ(["input","textarea"],iI.name(yM.target()))){r()}});var on=function(){};var yK=function(){yL.unbind()};return{toReading:ie,toEditing:r,onToolbarTouch:on,destroy:yK}};var hx=function(ui,nu,on,yK){var ie=function(){xI.blur(yK)};var eq=function(){ie()};var r=function(){ie()};var yJ=function(){pg.resume(nu,yK)};return{toReading:r,toEditing:yJ,onToolbarTouch:eq,destroy:S}};var tw={stubborn:gl,timid:hx};var lz=function(yU,on,yM,yL,yN){var ui=function(){on.run(function(yY){yY.highlightSelection()})};var yV=function(){on.run(function(yY){yY.refreshSelection()})};var yO=function(yZ,yY){var y0=yZ-yL.dom().scrollTop;on.run(function(y1){y1.scrollIntoView(y0,y0+yY)})};var r=function(yY){yO(on,yL)};var ie=function(){yU.getCursorBox().each(function(yY){yO(yY.top(),yY.height())})};var yS=function(){on.run(function(yY){yY.clearSelection()})};var eq=function(){yS();nu.throttle()};var yR=function(){ie();on.run(function(yY){yY.syncHeight()})};var yT=function(){var yY=uF.get(yM);on.run(function(yZ){yZ.setViewportOffset(yY)});yV();yR()};var yJ=function(){on.run(function(yY){yY.toEditing()})};var yW=function(){on.run(function(yY){yY.toReading()})};var yQ=function(yY){on.run(function(yZ){yZ.onToolbarTouch(yY)})};var yK=aH.monitor(yU);var nu=mO(yR,300);var yP=[yU.onKeyup(eq),yU.onNodeChanged(yV),yU.onDomChanged(nu.throttle),yU.onDomChanged(yV),yU.onScrollToCursor(function(yY){yY.preventDefault();nu.throttle()}),yU.onScrollToElement(function(yY){r(yY.element())}),yU.onToEditing(yJ),yU.onToReading(yW),f3.bind(yU.doc(),"touchend",function(yY){if(gb.eq(yU.html(),yY.target())||gb.eq(yU.body(),yY.target())){}}),f3.bind(yM,"transitionend",function(yY){if(yY.raw().propertyName==="height"){yT()}}),f3.capture(yM,"touchstart",function(yY){ui();yQ(yY);yU.onTouchToolstrip()}),f3.bind(yU.body(),"touchstart",function(yY){yS();yU.onTouchContent();yK.fireTouchstart(yY)}),yK.onTouchmove(),yK.onTouchend(),f3.bind(yU.body(),"click",function(yY){yY.kill()}),f3.bind(yM,"touchmove",function(){yU.onToolbarScrollStart()})];var yX=function(){kV(yP,function(yY){yY.unbind()})};return{destroy:yX}};var fD={initEvents:lz};function dQ(yJ,ie){var yL=yJ.document;var eq=pO.fromTag("div");rG.add(eq,eL.resolve("unfocused-selections"));vA.append(pO.fromDom(yL.documentElement),eq);var nu=f3.bind(eq,"touchstart",function(yN){yN.prevent();pg.resume(yJ,ie);ui()});var r=function(yN){var yO=pO.fromTag("span");mq.add(yO,[eL.resolve("layer-editor"),eL.resolve("unfocused-selection")]);cL.setAll(yO,{left:yN.left()+"px",top:yN.top()+"px",width:yN.width()+"px",height:yN.height()+"px"});return yO};var on=function(){ui();var yO=lM.getRectangles(yJ);var yN=r5(yO,r);nU.append(eq,yN)};var ui=function(){q0.empty(eq)};var yK=function(){nu.unbind();q0.remove(eq)};var yM=function(){return yb.children(eq).length>0};return{update:on,isActive:yM,destroy:yK,clear:ui}}var wf=function(on){var nu=tP.none();var ui=[];var r=function(yM){return wf(function(yN){eq(function(yO){yN(yM(yO))})})};var eq=function(yM){if(yJ()){yL(yM)}else{ui.push(yM)}};var yK=function(yM){nu=tP.some(yM);ie(ui);ui=[]};var yJ=function(){return nu.isSome()};var ie=function(yM){kV(yM,yL)};var yL=function(yM){nu.each(function(yN){setTimeout(function(){yM(yN)},0)})};on(yK);return{get:eq,map:r,isReady:yJ}};var sM=function(r){return wf(function(eq){eq(r)})};var rN={nu:wf,pure:sM};var kv=function(r){return function(){var eq=[];for(var nu=0;nu<arguments.length;nu++){eq[nu]=arguments[nu]}var ie=this;setTimeout(function(){r.apply(ie,eq)},0)}};var we=function(on){var eq=function(yJ){on(kv(yJ))};var nu=function(yJ){return we(function(yK){eq(function(yL){var yM=yJ(yL);yK(yM)})})};var ui=function(yJ){return we(function(yK){eq(function(yL){yJ(yL).get(yK)})})};var ie=function(yJ){return we(function(yK){eq(function(yL){yJ.get(yK)})})};var r=function(){return rN.nu(eq)};return{map:nu,bind:ui,anonBind:ie,toLazy:r,get:eq}};var sK=function(r){return we(function(eq){eq(r)})};var v9={nu:we,pure:sK};var dW=function(ie,r,eq){if(Math.abs(ie-r)<=eq){return tP.none()}else{if(ie<r){return tP.some(ie+eq)}else{return tP.some(ie-eq)}}};var tz=function(){var eq=null;var r=function(yJ,yL,ui,yN,ie,yK){var nu=false;var yM=function(yO){nu=true;ie(yO)};clearInterval(eq);var on=function(yO){clearInterval(eq);yM(yO)};eq=setInterval(function(){var yO=yJ();dW(yO,yL,ui).fold(function(){clearInterval(eq);yM(yL)},function(yP){yN(yP,on);if(!nu){var yQ=yJ();if(yQ!==yP||Math.abs(yQ-yL)>Math.abs(yO-yL)){clearInterval(eq);yM(yL)}}})},yK)};return{animate:r}};var oz={create:tz,adjust:dW};var cA=function(eq,ie){var r=[{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}];return ra(r,function(nu){return eq<=nu.width&&ie<=nu.height?tP.some(nu.keyboard):tP.none()}).getOr({portrait:ie/5,landscape:eq/4})};var tQ={findDevice:cA};var tc=function(r){return tQ.findDevice(r.screen.width,r.screen.height)};var nJ=function(ie){var on=xp.get(ie).isPortrait();var eq=tc(ie);var r=on?eq.portrait:eq.landscape;var nu=on?ie.screen.height:ie.screen.width;return nu-ie.innerHeight>r?0:r};var gc=function(r,ie){var nu=yb.owner(r).dom().defaultView;var eq=uF.get(r)+uF.get(ie);var on=nJ(nu);return eq-on};var uC=function(ie,r,eq){var nu=gc(r,eq);var on=uF.get(r)+uF.get(eq)-nu;cL.set(ie,"padding-bottom",on+"px")};var X={getGreenzone:gc,updatePadding:uC};var of=ox.generate([{fixed:["element","property","offsetY"]},{scroller:["element","offsetY"]}]);var th="data-"+eL.resolve("position-y-fixed");var oB="data-"+eL.resolve("y-property");var oh="data-"+eL.resolve("scrolling");var l5="data-"+eL.resolve("last-window-height");var qM=function(r){return n5.safeParse(r,th)};var uD=function(r){return kh.get(r,oB)};var y=function(r){return n5.safeParse(r,l5)};var wc=function(r,ie){var eq=uD(r);return of.fixed(r,eq,ie)};var g0=function(r,eq){return of.scroller(r,eq)};var q3=function(r){var ie=qM(r);var eq=kh.get(r,oh)==="true"?g0:wc;return eq(r,ie)};var cT=function(r){var eq=kR.descendants(r,"["+th+"]");return r5(eq,q3)};var qq=function(ie){var r=kh.get(ie,"style");cL.setAll(ie,{position:"absolute",top:"0px"});kh.set(ie,th,"0px");kh.set(ie,oB,"top");var eq=function(){kh.set(ie,"style",r||"");kh.remove(ie,th);kh.remove(ie,oB)};return{restore:eq}};var ow=function(on,ie,eq){var r=kh.get(eq,"style");nA.register(eq);cL.setAll(eq,{position:"absolute",height:ie+"px",width:"100%",top:on+"px"});kh.set(eq,th,on+"px");kh.set(eq,oh,"true");kh.set(eq,oB,"top");var nu=function(){nA.deregister(eq);kh.set(eq,"style",r||"");kh.remove(eq,th);kh.remove(eq,oh);kh.remove(eq,oB)};return{restore:nu}};var qW=function(ie,on,eq){var r=kh.get(ie,"style");cL.setAll(ie,{position:"absolute",bottom:"0px"});kh.set(ie,th,"0px");kh.set(ie,oB,"bottom");var nu=function(){kh.set(ie,"style",r||"");kh.remove(ie,th);kh.remove(ie,oB)};return{restore:nu}};var pS=function(r,on,nu){var eq=yb.owner(r).dom().defaultView;var ie=eq.innerHeight;kh.set(r,l5,ie+"px");return ie-on-nu};var rh=function(ui,yL,yN,on){var yP=yb.owner(ui).dom().defaultView;var r=qq(yN);var yO=uF.get(yN);var nu=uF.get(on);var eq=pS(ui,yO,nu);var yM=ow(yO,eq,ui);var ie=qW(on,yO,eq);var yQ=true;var yK=function(){yQ=false;r.restore();yM.restore();ie.restore()};var yS=function(){var yT=yP.innerHeight;var yU=y(ui);return yT>yU};var yJ=function(){if(yQ){var yV=uF.get(yN);var yU=uF.get(on);var yT=pS(ui,yV,yU);kh.set(ui,th,yV+"px");cL.set(ui,"height",yT+"px");cL.set(on,"bottom",-(yV+yT+yU)+"px");X.updatePadding(yL,ui,on)}};var yR=function(yT){var yU=yT+"px";kh.set(ui,th,yU);yJ()};X.updatePadding(yL,ui,on);return{setViewportOffset:yR,isExpanding:yS,isShrinking:jT(yS),refresh:yJ,restore:yK}};var u2={findFixtures:cT,takeover:rh,getYFixedData:qM};var bT=oz.create();var wp=15;var eA=10;var jZ=10;var xL="data-"+eL.resolve("last-scroll-top");var gQ=function(eq){var r=cL.getRaw(eq,"top").getOr("0");return parseInt(r,10)};var L=function(r){return parseInt(r.dom().scrollTop,10)};var j9=function(eq,r,ie){return v9.nu(function(yJ){var nu=mX(L,eq);var ui=function(yK){eq.dom().scrollTop=yK;cL.set(eq,"top",gQ(eq)+wp+"px")};var on=function(){eq.dom().scrollTop=r;cL.set(eq,"top",ie+"px");yJ(r)};bT.animate(nu,r,wp,ui,on,jZ)})};var jL=function(eq,r){return v9.nu(function(yK){var ie=mX(L,eq);kh.set(eq,xL,ie());var yJ=function(yL,yN){var yM=n5.safeParse(eq,xL);if(yM!==eq.dom().scrollTop){yN(eq.dom().scrollTop)}else{eq.dom().scrollTop=yL;kh.set(eq,xL,yL)}};var nu=function(){eq.dom().scrollTop=r;kh.set(eq,xL,r);yK(r)};var ui=Math.abs(r-ie());var on=Math.ceil(ui/eA);bT.animate(ie,r,on,yJ,nu,jZ)})};var oL=function(eq,r){return v9.nu(function(yK){var ie=mX(gQ,eq);var yJ=function(yL){cL.set(eq,"top",yL+"px")};var nu=function(){yJ(r);yK(r)};var ui=Math.abs(r-ie());var on=Math.ceil(ui/eA);bT.animate(ie,r,on,yJ,nu,jZ)})};var hJ=function(ie,eq){var r=eq+u2.getYFixedData(ie)+"px";cL.set(ie,"top",r)};var fu=function(nu,r,eq){var ie=yb.owner(nu).dom().defaultView;return v9.nu(function(on){hJ(nu,eq);hJ(r,eq);ie.scrollTo(0,eq);on(eq)})};var c={moveScrollAndTop:j9,moveOnlyScroll:jL,moveOnlyTop:oL,moveWindowScroll:fu};function l2(eq){var ie=hr(rN.pure({}));var nu=function(ui){var on=rN.nu(function(yJ){return eq(ui).get(yJ)});ie.set(on)};var r=function(on){ie.get().get(function(){on()})};return{start:nu,idle:r}}var bx=function(nu,r,ie,ui,eq){var on=X.getGreenzone(r,ie);var yJ=mX(jf.refresh,nu);if(ui>on||eq>on){c.moveOnlyScroll(r,r.dom().scrollTop-on+eq).get(yJ)}else{if(ui<0){c.moveOnlyScroll(r,r.dom().scrollTop+ui).get(yJ)}else{}}};var nI={scrollIntoView:bx};var wJ=function(r,eq){return eq(function(ui){var on=[];var nu=0;var ie=function(yJ){return function(yK){on[yJ]=yK;nu++;if(nu>=r.length){ui(on)}}};if(r.length===0){ui([])}else{kV(r,function(yK,yJ){yK.get(ie(yJ))})}})};var xS=function(r){return wJ(r,v9.nu)};var gM=function(ie,nu,eq,on){var r=eq+on;cL.set(ie,nu,r+"px");return v9.pure(on)};var ea=function(nu,ie,yJ){var eq=ie+yJ;var r=cL.getRaw(nu,"top").getOr(yJ);var ui=eq-parseInt(r,10);var on=nu.dom().scrollTop+ui;return c.moveScrollAndTop(nu,on,eq)};var xx=function(eq,r){return eq.fold(function(ie,nu,on){return gM(ie,nu,r,on)},function(ie,nu){return ea(ie,r,nu)})};var j0=function(r,eq){var ie=u2.findFixtures(r);var nu=r5(ie,function(on){return xx(on,eq)});return xS(nu)};var nr={updatePositions:j0};var ej=5;var at=function(yJ,yM,r,yL,ie,yK){var on=l2(function(yN){return c.moveWindowScroll(yJ,yM,yN)});var eq=function(){var yN=lM.getRectangles(yK);return tP.from(yN[0]).bind(function(yP){var yO=yP.top()-yM.dom().scrollTop;var yQ=yO>yL.innerHeight+ej||yO<-ej;return yQ?tP.some({top:fY(yO),bottom:fY(yO+yP.height())}):tP.none()})};var nu=mO(function(){on.idle(function(){nr.updatePositions(r,yL.pageYOffset).get(function(){var yN=eq();yN.each(function(yO){yM.dom().scrollTop=yM.dom().scrollTop+yO.top()});on.start(0);ie.refresh()})})},1000);var ui=f3.bind(pO.fromDom(yL),"scroll",function(){if(yL.pageYOffset<0){return}nu.throttle()});nr.updatePositions(r,yL.pageYOffset).get(iC);return{unbind:ui.unbind}};var dZ=function(r){var on=r.cWin();var ie=r.ceBody();var yR=r.socket();var yS=r.toolstrip();var yU=r.toolbar();var yJ=r.contentElement();var yY=r.keyboardType();var yL=r.outerWindow();var yT=r.dropup();var y2=u2.takeover(yR,ie,yS,yT);var yW=yY(r.outerBody(),on,r8.body(),yJ,yS,yU);var yO=function(){yW.toEditing();yX()};var yZ=function(){yW.toReading()};var yV=function(y3){yW.onToolbarTouch(y3)};var yP=xp.onChange(yL,{onChange:S,onReady:y2.refresh});yP.onAdjustment(function(){y2.refresh()});var nu=f3.bind(pO.fromDom(yL),"resize",function(){if(y2.isExpanding()){y2.refresh()}});var yN=at(yS,yR,r.outerBody(),yL,y2,on);var y0=dQ(on,yJ);var ui=function(){if(y0.isActive()){y0.update()}};var yK=function(){y0.update()};var yX=function(){y0.clear()};var eq=function(y4,y3){nI.scrollIntoView(on,yR,yT,y4,y3)};var yM=function(){cL.set(yJ,"height",yJ.dom().contentWindow.document.body.scrollHeight+"px")};var yQ=function(y3){y2.setViewportOffset(y3);c.moveOnlyTop(yR,y3).get(iC)};var y1=function(){y2.restore();yP.destroy();yN.unbind();nu.unbind();yW.destroy();y0.destroy();ls.input(r8.body(),xI.blur)};return{toEditing:yO,toReading:yZ,onToolbarTouch:yV,refreshSelection:ui,clearSelection:yX,highlightSelection:yK,scrollIntoView:eq,updateToolbarPadding:S,setViewportOffset:yQ,syncHeight:yM,refreshStructure:y2.refresh,destroy:y1}};var x3={setup:dZ};var ty=function(on,yM){var yL=j6.tag();var yJ=o3();var r=o3();var nu=cM();var eq=cM();var yK=function(){yM.hide();var yN=pO.fromDom(document);bn.getActiveApi(on.editor).each(function(yP){yJ.set({socketHeight:cL.getRaw(on.socket,"height"),iframeHeight:cL.getRaw(yP.frame(),"height"),outerScroll:document.body.scrollTop});r.set({exclusives:dd.exclusive(yN,"."+nA.scrollable())});rG.add(on.container,eL.resolve("fullscreen-maximized"));wR.clobberStyles(on.container,yP.body());yL.maximize();cL.set(on.socket,"overflow","scroll");cL.set(on.socket,"-webkit-overflow-scrolling","touch");xI.focus(yP.body());var yO=c9(["cWin","ceBody","socket","toolstrip","toolbar","dropup","contentElement","cursor","keyboardType","isScrolling","outerWindow","outerBody"],[]);nu.set(x3.setup(yO({cWin:yP.win(),ceBody:yP.body(),socket:on.socket,toolstrip:on.toolstrip,toolbar:on.toolbar,dropup:on.dropup.element(),contentElement:yP.frame(),cursor:S,outerBody:on.body,outerWindow:on.win,keyboardType:tw.stubborn,isScrolling:function(){var yQ=r;return yQ.get().exists(function(yR){return yR.socket.isScrolling()})}})));nu.run(function(yQ){yQ.syncHeight()});eq.set(fD.initEvents(yP,nu,on.toolstrip,on.socket,on.dropup))})};var ie=function(){yL.restore();eq.clear();nu.clear();yM.show();yJ.on(function(yN){yN.socketHeight.each(function(yO){cL.set(on.socket,"height",yO)});yN.iframeHeight.each(function(yO){cL.set(on.editor.getFrame(),"height",yO)});document.body.scrollTop=yN.scrollTop});yJ.clear();r.on(function(yN){yN.exclusives.unbind()});r.clear();rG.remove(on.container,eL.resolve("fullscreen-maximized"));wR.restoreStyles();nA.deregister(on.toolbar);cL.remove(on.socket,"overflow");cL.remove(on.socket,"-webkit-overflow-scrolling");xI.blur(on.editor.getFrame());bn.getActiveApi(on.editor).each(function(yN){yN.clearSelection()})};var ui=function(){nu.run(function(yN){yN.refreshStructure()})};return{enter:yK,refreshStructure:ui,exit:ie}};var bp={create:ty};var bF=function(nu){var ie=rF("Getting IosWebapp schema",wY,nu);cL.set(ie.toolstrip,"width","100%");cL.set(ie.container,"position","relative");var ui=function(){ie.setReadOnly(ie.readOnlyOnInit());on.enter()};var eq=vw(pP.sketch(ui,ie.translate));ie.alloy.add(eq);var r={show:function(){ie.alloy.add(eq)},hide:function(){ie.alloy.remove(eq)}};var on=bp.create(ie,r);return{setReadOnly:ie.setReadOnly,refreshStructure:on.refreshStructure,enter:on.enter,exit:on.exit,destroy:S}};var lf={produce:bF};function hB(eq){var yQ=pd({classes:[eL.resolve("ios-container")]});var yM=nc();var nu=cM();var yN=hi.makeEditSwitch(nu);var yO=hi.makeSocket();var ui=vu(function(){nu.run(function(yR){yR.refreshStructure()})},eq);yQ.add(yM.wrapper());yQ.add(yO);yQ.add(ui.component());var yK=function(yS){var yR=yM.createGroups(yS);yM.setGroups(yR)};var yJ=function(yS){var yR=yM.createGroups(yS);yM.setContextToolbar(yR)};var ie=function(){yM.focus()};var on=function(){yM.restoreToolbar()};var yP=function(yR){nu.set(lf.produce(yR))};var r=function(){nu.run(function(yR){yy.remove(yO,yN);yR.exit()})};var yL=function(yR){hi.updateMode(yO,yN,yR,yQ.root())};return{system:fY(yQ),element:yQ.element,init:yP,exit:r,setToolbarGroups:yK,setContextToolbar:yJ,focusToolbar:ie,restoreToolbar:on,updateMode:yL,socket:fY(yO),dropup:fY(ui)}}var dS=tinymce.util.Tools.resolve("tinymce.EditorManager");var h2=function(r){var eq=fr(r.settings,"skin_url").fold(function(){return dS.baseURL+"/skins/lightgray"},function(ie){return ie});return{content:eq+"/content.mobile.min.css",ui:eq+"/skin.mobile.min.css"}};var um={derive:h2};var q=["x-small","small","medium","large","x-large"];var vc=function(r,ie,eq){r.system().broadcastOn([hl.formatChanged()],{command:ie,state:eq})};var jA=function(r,eq){var ie=ds(eq.formatter.get());kV(ie,function(nu){eq.formatter.formatChanged(nu,function(on){vc(r,nu,on)})});kV(["ul","ol"],function(nu){eq.selection.selectorChanged(nu,function(ui,on){vc(r,nu,ui)})})};var fQ={init:jA,fontSizes:fY(q)};var yB=function(eq){var r=function(){eq._skinLoaded=true;eq.fire("SkinLoaded")};return function(){if(eq.initialized){r()}else{eq.on("init",r)}}};var h9={fireSkinLoaded:yB};var tT=fY("toReading");var wD=fY("toEditing");dT.add("mobile",function(eq){var r=function(yM){var ie=um.derive(eq);if(t9(eq)===false){eq.contentCSS.push(ie.content);lN.DOM.styleSheetLoader.load(ie.ui,h9.fireSkinLoaded(eq))}else{h9.fireSkinLoaded(eq)()}var yN=function(){eq.fire("scrollIntoView")};var nu=pO.fromTag("div");var yK=jz.detect().os.isAndroid()?ga(yN):hB(yN);var yJ=pO.fromDom(yM.targetNode);vA.after(yJ,nu);oq(nu,yK.system());var yQ=function(yR){return xI.search(yR).bind(function(yS){return yK.system().getByDom(yS).toOption()})};var yP=yM.targetNode.ownerDocument.defaultView;var on=xp.onChange(yP,{onChange:function(){var yR=yK.system();yR.broadcastOn([hl.orientationChanged()],{width:xp.getActualWidth(yP)})},onReady:S});var ui=function(yV,yU,yS,yR){if(yR===false){eq.selection.collapse()}var yT=yL(yV,yU,yS);yK.setToolbarGroups(yR===true?yT.readOnly:yT.main);eq.setMode(yR===true?"readonly":"design");eq.fire(yR===true?tT():wD());yK.updateMode(yR)};var yL=function(yV,yU,yR){var yT=yV.get();var yS={readOnly:yT.backToMask.concat(yU.get()),main:yT.backToMask.concat(yR.get())};if(qN(eq)){yS.readOnly=yT.backToMask.concat(yU.get());yS.main=yT.backToReadOnly.concat(yR.get())}return yS};var yO=function(yR,yS){eq.on(yR,yS);return{unbind:function(){eq.off(yR)}}};eq.on("init",function(){yK.init({editor:{getFrame:function(){return pO.fromDom(eq.contentAreaContainer.querySelector("iframe"))},onDomChanged:function(){return{unbind:S}},onToReading:function(y2){return yO(tT(),y2)},onToEditing:function(y2){return yO(wD(),y2)},onScrollToCursor:function(y3){eq.on("scrollIntoView",function(y4){y3(y4)});var y2=function(){eq.off("scrollIntoView");on.destroy()};return{unbind:y2}},onTouchToolstrip:function(){yX()},onTouchContent:function(){var y2=pO.fromDom(eq.editorContainer.querySelector("."+eL.resolve("toolbar")));yQ(y2).each(r1);yK.restoreToolbar();yX()},onTapContent:function(y2){var y4=y2.target();if(iI.name(y4)==="img"){eq.selection.select(y4.dom());y2.kill()}else{if(iI.name(y4)==="a"){var y3=yK.system().getByDom(pO.fromDom(eq.editorContainer));y3.each(function(y5){if(aJ.isAlpha(y5)){rz.openLink(y4.dom())}})}}}},container:pO.fromDom(eq.editorContainer),socket:pO.fromDom(eq.contentAreaContainer),toolstrip:pO.fromDom(eq.editorContainer.querySelector("."+eL.resolve("toolstrip"))),toolbar:pO.fromDom(eq.editorContainer.querySelector("."+eL.resolve("toolbar"))),dropup:yK.dropup(),alloy:yK.system(),translate:S,setReadOnly:function(y2){ui(yW,yU,yR,y2)},readOnlyOnInit:function(){return qN(eq)}});var yX=function(){yK.dropup().disappear(function(){yK.system().broadcastOn([hl.dropupDismissed()],{})})};var y1={label:"The first group",scrollable:false,items:[eV.forToolbar("back",function(){eq.selection.collapse();yK.exit()},{})]};var yZ={label:"Back to read only",scrollable:false,items:[eV.forToolbar("readonly-back",function(){ui(yW,yU,yR,true)},{})]};var yV={label:"The read only mode group",scrollable:true,items:[]};var yT=aC.setup(yK,eq);var yY=aC.detect(eq.settings,yT);var yS={label:"the action group",scrollable:true,items:yY};var y0={label:"The extra group",scrollable:false,items:[]};var yR=hr([yS,y0]);var yU=hr([yV,y0]);var yW=hr({backToMask:[y1],backToReadOnly:[yZ]});fQ.init(yK,eq)});return{iframeContainer:yK.socket().element().dom(),editorContainer:yK.element().dom()}};return{getNotificationManagerImpl:function(){return{open:iC,close:S,reposition:S,getArgs:iC}},renderUI:r}});function oY(){}return oY}())})();