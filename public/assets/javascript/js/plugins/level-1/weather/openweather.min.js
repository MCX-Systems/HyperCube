/*!

Name: Open Weather
Dependencies: jQuery, OpenWeatherMap API
Author: Michael Lynch
Author URL: http://michaelynch.com
Date Created: August 28, 2013
Licensed under the MIT license

*/
(function(a){a.fn.openWeather=function(m){if(!this.length){return this}const f={descriptionTarget:null,maxTemperatureTarget:null,minTemperatureTarget:null,windSpeedTarget:null,humidityTarget:null,sunriseTarget:null,sunsetTarget:null,placeTarget:null,iconTarget:null,customIcons:null,units:"c",city:null,lat:null,lng:null,key:null,lang:"en",success:function(){},error:function(n){}};const h=this;const c=a(this);h.settings={};h.settings=a.extend({},f,m);const l=h.settings;const k=function(s){const p=s*1000;const o=new Date(p);var n=o.getHours();if(n>12){var r=24-n;n=12-r}var q=o.getMinutes();q=q.toString();if(q.length<2){q=q}return n+":"+q};var e="https://api.openweathermap.org/data/2.5/weather?lang="+l.lang;var b;var i;var g;var j;if(l.city!=null){e+="&q="+l.city}else{if(l.lat!=null&&l.lng!=null){e+="&lat="+l.lat+"&lon="+l.lng}}if(l.key!=null){e+="&appid="+l.key}var d=new Skycons();d.add("weatherIcon",Skycons.WIND);d.play();a.ajax({type:"GET",url:e,dataType:"jsonp",success:function(q){if(q){if(l.units==="f"){i=Math.round(((q.main.temp-273.15)*1.8)+32)+"°F";g=Math.round(((q.main.temp_min-273.15)*1.8)+32)+"°F";j=Math.round(((q.main.temp_max-273.15)*1.8)+32)+"°F"}else{i=Math.round(q.main.temp-273.15)+"°C";g=Math.round(q.main.temp_min-273.15)+"°C";j=Math.round(q.main.temp_max-273.15)+"°C"}b={city:q.name+","+q.sys.country,temperature:{current:i,min:g,max:j,units:l.units},description:q.weather[0].description,humidity:q.main.humidity+"%",windspeed:Math.round(q.wind.speed)+"mps",sunrise:k(q.sys.sunrise)+"am",sunset:k(q.sys.sunset)+"pm"};c.html(i);if(l.minTemperatureTarget!=null){a(l.minTemperatureTarget).text(g)}if(l.maxTemperatureTarget!=null){a(l.maxTemperatureTarget).text(j)}a(l.descriptionTarget).text(b.description);if(l.iconTarget!=null&&q.weather[0].icon!=null){var p;if(l.customIcons!=null){const o=q.weather[0].icon;var n;var r;if(o.indexOf("d")!==-1){n="day"}else{n="night"}if(o==="01d"||o==="01n"){if(n==="night"){r=Skycons.CLEAR_NIGHT}else{r=Skycons.CLEAR_DAY}}if(o==="02d"||o==="02n"||o==="03d"||o==="03n"||o==="04d"||o==="04n"){if(n==="night"){r=Skycons.PARTLY_CLOUDY_NIGHT}else{r=Skycons.PARTLY_CLOUDY_DAY}}if(o==="09d"||o==="09n"||o==="10d"||o==="10n"){r=Skycons.RAIN}if(o==="11d"||o==="11n"){r=Skycons.SLEET}if(o==="13d"||o==="13n"){r=Skycons.SNOW}if(o==="50d"||o==="50n"){r=Skycons.FOG}d.set("weatherIcon",r)}else{p="http://openweathermap.org/img/w/"+q.weather[0].icon+".png";a(l.iconTarget).prop("src",p)}}if(l.placeTarget!=null){a(l.placeTarget).text(b.city)}if(l.windSpeedTarget!=null){a(l.windSpeedTarget).text(b.windspeed)}if(l.humidityTarget!=null){a(l.humidityTarget).text(b.humidity)}if(l.sunriseTarget!=null){a(l.sunriseTarget).text(b.sunrise)}if(l.sunsetTarget!=null){a(l.sunsetTarget).text(b.sunset)}l.success.call(this,b)}},error:function(n,p,o){l.error.call(this,{error:p})}})}})(jQuery);