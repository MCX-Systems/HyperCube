(function(e,a,c,f){var g={};function b(h){return c.translate(h)||h}function d(h){h.id=h.attr("id");h.html('<div class="plupload_wrapper"><div class="ui-widget-content plupload_container"><div class="ui-state-default ui-widget-header plupload_header"><div class="plupload_header_content"><div class="plupload_logo"> </div><div class="plupload_header_title">'+b("Select files")+'</div><div class="plupload_header_text">'+b("Add files to the upload queue and click the start button.")+'</div><div class="plupload_view_switch"><input type="radio" id="'+h.id+'_view_list" name="view_mode_'+h.id+'" checked="checked" /><label class="plupload_button" for="'+h.id+'_view_list" data-view="list">'+b("List")+'</label><input type="radio" id="'+h.id+'_view_thumbs" name="view_mode_'+h.id+'" /><label class="plupload_button"  for="'+h.id+'_view_thumbs" data-view="thumbs">'+b("Thumbnails")+'</label></div></div></div><table class="plupload_filelist plupload_filelist_header ui-widget-header"><tr><td class="plupload_cell plupload_file_name">'+b("Filename")+'</td><td class="plupload_cell plupload_file_status">'+b("Status")+'</td><td class="plupload_cell plupload_file_size">'+b("Size")+'</td><td class="plupload_cell plupload_file_action">&nbsp;</td></tr></table><div class="plupload_content"><div class="plupload_droptext">'+b("Drag files here.")+'</div><ul class="plupload_filelist_content"> </ul><div class="plupload_clearer">&nbsp;</div></div><table class="plupload_filelist plupload_filelist_footer ui-widget-header"><tr><td class="plupload_cell plupload_file_name"><div class="plupload_buttons"><!-- Visible --><a class="plupload_button plupload_add">'+b("Add Files")+'</a>&nbsp;<a class="plupload_button plupload_start">'+b("Start Upload")+'</a>&nbsp;<a class="plupload_button plupload_stop plupload_hidden">'+b("Stop Upload")+'</a>&nbsp;</div><div class="plupload_started plupload_hidden"><!-- Hidden --><div class="plupload_progress plupload_right"><div class="plupload_progress_container"></div></div><div class="plupload_cell plupload_upload_status"></div><div class="plupload_clearer">&nbsp;</div></div></td><td class="plupload_file_status"><span class="plupload_total_status">0%</span></td><td class="plupload_file_size"><span class="plupload_total_file_size">0 kb</span></td><td class="plupload_file_action"></td></tr></table></div><input class="plupload_count" value="0" type="hidden"></div>')}f.widget("ui.plupload",{widgetEventPrefix:"",contents_bak:"",options:{browse_button_hover:"ui-state-hover",browse_button_active:"ui-state-active",filters:{},buttons:{browse:true,start:true,stop:true},views:{list:true,thumbs:false,active:"list",remember:true},thumb_width:100,thumb_height:60,multiple_queues:true,dragdrop:true,autostart:false,sortable:false,rename:false},FILE_COUNT_ERROR:-9001,_create:function(){var h=this.element.attr("id");if(!h){h=c.guid();this.element.attr("id",h)}this.id=h;this.contents_bak=this.element.html();d(this.element);this.container=f(".plupload_container",this.element).attr("id",h+"_container");this.content=f(".plupload_content",this.element);if(f.fn.resizable){this.container.resizable({handles:"s",minHeight:300})}this.filelist=f(".plupload_filelist_content",this.container).attr({id:h+"_filelist",unselectable:"on"});this.browse_button=f(".plupload_add",this.container).attr("id",h+"_browse");this.start_button=f(".plupload_start",this.container).attr("id",h+"_start");this.stop_button=f(".plupload_stop",this.container).attr("id",h+"_stop");this.thumbs_switcher=f("#"+h+"_view_thumbs");this.list_switcher=f("#"+h+"_view_list");if(f.ui.button){this.browse_button.button({icons:{primary:"ui-icon-circle-plus"},disabled:true});this.start_button.button({icons:{primary:"ui-icon-circle-arrow-e"},disabled:true});this.stop_button.button({icons:{primary:"ui-icon-circle-close"}});this.list_switcher.button({text:false,icons:{secondary:"ui-icon-grip-dotted-horizontal"}});this.thumbs_switcher.button({text:false,icons:{secondary:"ui-icon-image"}})}this.progressbar=f(".plupload_progress_container",this.container);if(f.ui.progressbar){this.progressbar.progressbar()}this.counter=f(".plupload_count",this.element).attr({id:h+"_count",name:h+"_count"});this._initUploader()},_initUploader:function(){var h=this,k=this.id,j,i={container:k+"_buttons",browse_button:k+"_browse",required_features:{},filters:{}};f(".plupload_buttons",this.element).attr("id",k+"_buttons");if(h.options.dragdrop){this.filelist.parent().attr("id",this.id+"_dropbox");i.drop_element=this.id+"_dropbox"}this.filelist.on("click",function(l){if(f(l.target).hasClass("plupload_action_icon")){h.removeFile(f(l.target).closest(".plupload_file").attr("id"));l.preventDefault()}});if(h.options.views.thumbs){i.required_features.display_media=true}if(h.options.max_file_count){i.filters.max_file_count=h.options.max_file_count}j=this.uploader=g[k]=new c.Uploader(f.extend(this.options,i));this.options=j.getOption();c.addFileFilter("max_file_count",function(n,m,l){if(n<=this.files.length-(this.total.uploaded+this.total.failed)){h.browse_button.button("disable");this.disableBrowse();this.trigger("Error",{code:h.FILE_COUNT_ERROR,message:b("File count error."),file:m});l(false)}else{l(true)}});j.bind("Error",function(l,o){var n,m="";n="<strong>"+o.message+"</strong>";switch(o.code){case c.FILE_EXTENSION_ERROR:m=c.sprintf(b("File: %s"),o.file.name);break;case c.FILE_SIZE_ERROR:m=c.sprintf(b("File: %s, size: %d, max file size: %d"),o.file.name,c.formatSize(o.file.size),c.formatSize(c.parseSize(l.getOption("filters").max_file_size)));break;case c.FILE_DUPLICATE_ERROR:m=c.sprintf(b("%s already present in the queue."),o.file.name);break;case h.FILE_COUNT_ERROR:m=c.sprintf(b("Upload element accepts only %d file(s) at a time. Extra files were stripped."),l.getOption("filters").max_file_count||0);break;case c.IMAGE_FORMAT_ERROR:m=b("Image format either wrong or not supported.");break;case c.IMAGE_MEMORY_ERROR:m=b("Runtime ran out of available memory.");break;case c.HTTP_ERROR:m=b("Upload URL might be wrong or doesn't exist.");break}n+=" <br /><i>"+m+"</i>";h._trigger("error",null,{up:l,error:o});if(o.code===c.INIT_ERROR){setTimeout(function(){h.destroy()},1)}else{h.notify("error",n)}});j.bind("PostInit",function(l){if(!h.options.buttons.browse){h.browse_button.button("disable").hide();l.disableBrowse(true)}else{h.browse_button.button("enable")}if(!h.options.buttons.start){h.start_button.button("disable").hide()}if(!h.options.buttons.stop){h.stop_button.button("disable").hide()}if(!h.options.unique_names&&h.options.rename){h._enableRenaming()}if(h.options.dragdrop&&l.features.dragdrop){h.filelist.parent().addClass("plupload_dropbox")}h._enableViewSwitcher();h.start_button.click(function(m){if(!f(this).button("option","disabled")){h.start()}m.preventDefault()});h.stop_button.click(function(m){h.stop();m.preventDefault()});h._trigger("ready",null,{up:l})});j.init();j.bind("FileFiltered",function(l,m){h._addFiles(m)});j.bind("FilesAdded",function(l,m){h._trigger("selected",null,{up:l,files:m});if(h.options.sortable&&f.ui.sortable){h._enableSortingList()}h._trigger("updatelist",null,{filelist:h.filelist});if(h.options.autostart){setTimeout(function(){h.start()},10)}});j.bind("FilesRemoved",function(l,m){if(f.ui.sortable&&h.options.sortable){f("tbody",h.filelist).sortable("destroy")}f.each(m,function(o,n){f("#"+n.id).toggle("highlight",function(){f(this).remove()})});if(l.files.length){if(h.options.sortable&&f.ui.sortable){h._enableSortingList()}}h._trigger("updatelist",null,{filelist:h.filelist});h._trigger("removed",null,{up:l,files:m})});j.bind("QueueChanged",function(){h._handleState()});j.bind("StateChanged",function(l){h._handleState();if(c.STARTED===l.state){h._trigger("started",null,{up:this.uploader})}else{if(c.STOPPED===l.state){h._trigger("stopped",null,{up:this.uploader})}}});j.bind("UploadFile",function(l,m){h._handleFileStatus(m)});j.bind("FileUploaded",function(m,n,l){h._handleFileStatus(n);h._trigger("uploaded",null,{up:m,file:n,result:l})});j.bind("UploadProgress",function(l,m){h._handleFileStatus(m);h._updateTotalProgress();h._trigger("progress",null,{up:l,file:m})});j.bind("UploadComplete",function(l,m){h._addFormFields();h._trigger("complete",null,{up:l,files:m})})},_setOption:function(i,j){var h=this;if(i=="buttons"&&typeof(j)=="object"){j=f.extend(h.options.buttons,j);if(!j.browse){h.browse_button.button("disable").hide();h.uploader.disableBrowse(true)}else{h.browse_button.button("enable").show();h.uploader.disableBrowse(false)}if(!j.start){h.start_button.button("disable").hide()}else{h.start_button.button("enable").show()}if(!j.stop){h.stop_button.button("disable").hide()}else{h.start_button.button("enable").show()}}h.uploader.setOption(i,j)},start:function(){this.uploader.start()},stop:function(){this.uploader.stop()},enable:function(){this.browse_button.button("enable");this.uploader.disableBrowse(false)},disable:function(){this.browse_button.button("disable");this.uploader.disableBrowse(true)},getFile:function(i){var h;if(typeof i==="number"){h=this.uploader.files[i]}else{h=this.uploader.getFile(i)}return h},getFiles:function(){return this.uploader.files},removeFile:function(h){if(c.typeOf(h)==="string"){h=this.getFile(h)}this.uploader.removeFile(h)},clearQueue:function(){this.uploader.splice()},getUploader:function(){return this.uploader},refresh:function(){this.uploader.refresh()},notify:function(i,j){var h=f('<div class="plupload_message"><span class="plupload_message_close ui-icon ui-icon-circle-close" title="'+b("Close")+'"></span><p><span class="ui-icon"></span>'+j+"</p></div>");h.addClass("ui-state-"+(i==="error"?"error":"highlight")).find("p .ui-icon").addClass("ui-icon-"+(i==="error"?"alert":"info")).end().find(".plupload_message_close").click(function(){h.remove()}).end();f(".plupload_header",this.container).append(h)},destroy:function(){this.uploader.destroy();f(".plupload_button",this.element).unbind();if(f.ui.button){f(".plupload_add, .plupload_start, .plupload_stop",this.container).button("destroy")}if(f.ui.progressbar){this.progressbar.progressbar("destroy")}if(f.ui.sortable&&this.options.sortable){f("tbody",this.filelist).sortable("destroy")}this.element.empty().html(this.contents_bak);this.contents_bak="";f.Widget.prototype.destroy.apply(this)},_handleState:function(){var h=this.uploader,i=h.files.length-(h.total.uploaded+h.total.failed),j=h.getOption("filters").max_file_count||0;if(c.STARTED===h.state){f([]).add(this.stop_button).add(".plupload_started").removeClass("plupload_hidden");this.start_button.button("disable");if(!this.options.multiple_queues){this.browse_button.button("disable");h.disableBrowse()}f(".plupload_upload_status",this.element).html(c.sprintf(b("Uploaded %d/%d files"),h.total.uploaded,h.files.length));f(".plupload_header_content",this.element).addClass("plupload_header_content_bw")}else{if(c.STOPPED===h.state){f([]).add(this.stop_button).add(".plupload_started").addClass("plupload_hidden");if(i){this.start_button.button("enable")}else{this.start_button.button("disable")}if(this.options.multiple_queues){f(".plupload_header_content",this.element).removeClass("plupload_header_content_bw")}if(this.options.multiple_queues&&j&&j>i){this.browse_button.button("enable");h.disableBrowse(false)}this._updateTotalProgress()}}if(h.total.queued===0){f(".ui-button-text",this.browse_button).html(b("Add Files"))}else{f(".ui-button-text",this.browse_button).html(c.sprintf(b("%d files queued"),h.total.queued))}h.refresh()},_handleFileStatus:function(l){var j=f("#"+l.id),n,i;if(!j.length){return}switch(l.status){case c.DONE:n="plupload_done";i="plupload_action_icon ui-icon ui-icon-circle-check";break;case c.FAILED:n="ui-state-error plupload_failed";i="plupload_action_icon ui-icon ui-icon-alert";break;case c.QUEUED:n="plupload_delete";i="plupload_action_icon ui-icon ui-icon-circle-minus";break;case c.UPLOADING:n="ui-state-highlight plupload_uploading";i="plupload_action_icon ui-icon ui-icon-circle-arrow-w";var h=f(".plupload_scroll",this.container),m=h.scrollTop(),o=h.height(),k=j.position().top+j.height();if(o<k){h.scrollTop(m+k-o)}j.find(".plupload_file_percent").html(l.percent+"%").end().find(".plupload_file_progress").css("width",l.percent+"%").end().find(".plupload_file_size").html(c.formatSize(l.size));break}n+=" ui-state-default plupload_file";j.attr("class",n).find(".plupload_action_icon").attr("class",i)},_updateTotalProgress:function(){var h=this.uploader;this.filelist[0].scrollTop=this.filelist[0].scrollHeight;this.progressbar.progressbar("value",h.total.percent);this.element.find(".plupload_total_status").html(h.total.percent+"%").end().find(".plupload_total_file_size").html(c.formatSize(h.total.size)).end().find(".plupload_upload_status").html(c.sprintf(b("Uploaded %d/%d files"),h.total.uploaded,h.files.length))},_displayThumbs:function(){var u=this,n,i,s,m=0,p=[],k=false;if(!this.options.views.thumbs){return}function r(x,w,v){var y;x.on(w,function(){clearTimeout(y);y=setTimeout(function(){clearTimeout(y);v()},300)})}function h(){if(!n||!i){var x=f(".plupload_file:eq(0)",u.filelist);n=x.outerWidth(true);i=x.outerHeight(true)}var w=u.content.width(),v=u.content.height();s=Math.floor(w/n);m=s*(Math.ceil(v/i)+1)}function j(){var v=Math.floor(u.content.scrollTop()/i)*s;p=f(".plupload_file .plupload_file_thumb",u.filelist).slice(v,v+m).filter(".plupload_thumb_toload").get()}function t(){function v(){if(u.view_mode!=="thumbs"){return}h();j();l()}if(f.fn.resizable){r(u.container,"resize",v)}r(u.window,"resize",v);r(u.content,"scroll",v);u.element.on("viewchanged selected",v);v()}function q(x,v){var w=new c.Image();w.onload=function(){var y=f("#"+x.id+" .plupload_file_thumb",u.filelist);this.embed(y[0],{width:u.options.thumb_width,height:u.options.thumb_height,crop:true,preserveHeaders:false,swf_url:c.resolveUrl(u.options.flash_swf_url),xap_url:c.resolveUrl(u.options.silverlight_xap_url)})};w.bind("embedded error",function(y){f("#"+x.id,u.filelist).find(".plupload_file_thumb").removeClass("plupload_thumb_loading").addClass("plupload_thumb_"+y.type);this.destroy();setTimeout(v,1)});f("#"+x.id,u.filelist).find(".plupload_file_thumb").removeClass("plupload_thumb_toload").addClass("plupload_thumb_loading");w.load(x.getSource())}function l(){if(u.view_mode!=="thumbs"||k){return}j();if(!p.length){return}k=true;q(u.getFile(f(p.shift()).closest(".plupload_file").attr("id")),function(){k=false;l()})}this.element.on("selected",function o(){u.element.off("selected",o);t()})},_addFiles:function(k){var i=this,h,j="";h='<li class="plupload_file ui-state-default plupload_delete" id="{id}" style="width:{thumb_width}px;"><div class="plupload_file_thumb plupload_thumb_toload" style="width: {thumb_width}px; height: {thumb_height}px;"><div class="plupload_file_dummy ui-widget-content" style="line-height: {thumb_height}px;"><span class="ui-state-disabled">{ext} </span></div></div><div class="plupload_file_status"><div class="plupload_file_progress ui-widget-header" style="width: 0%"> </div><span class="plupload_file_percent">{percent} </span></div><div class="plupload_file_name" title="{name}"><span class="plupload_file_name_wrapper">{name} </span></div><div class="plupload_file_action"><div class="plupload_action_icon ui-icon ui-icon-circle-minus"> </div></div><div class="plupload_file_size">{size} </div><div class="plupload_file_fields"> </div></li>';if(c.typeOf(k)!=="array"){k=[k]}f.each(k,function(o,n){var l=n.name.match(/\.([^.]+)$/);var p=l&&l[1].toLowerCase()||"none";j+=h.replace(/\{(\w+)\}/g,function(q,m){switch(m){case"thumb_width":case"thumb_height":return i.options[m];case"size":return c.formatSize(n.size);case"ext":return p;default:return n[m]||""}})});i.filelist.append(j)},_addFormFields:function(){var h=this;f(".plupload_file_fields",this.filelist).html("");c.each(this.uploader.files,function(j,k){var i="",l=h.id+"_"+k;if(j.target_name){i+='<input type="hidden" name="'+l+'_tmpname" value="'+c.xmlEncode(j.target_name)+'" />'}i+='<input type="hidden" name="'+l+'_name" value="'+c.xmlEncode(j.name)+'" />';i+='<input type="hidden" name="'+l+'_status" value="'+(j.status===c.DONE?"done":"failed")+'" />';f("#"+j.id).find(".plupload_file_fields").html(i)});this.counter.val(this.uploader.files.length)},_viewChanged:function(h){if(this.options.views.remember&&f.cookie){f.cookie("plupload_ui_view",h,{expires:7,path:"/"})}if(c.ua.browser==="IE"&&c.ua.version<7){this.content.attr("style",'height:expression(document.getElementById("'+this.id+'_container").clientHeight - '+(h==="list"?132:102)+")")}this.container.removeClass("plupload_view_list plupload_view_thumbs").addClass("plupload_view_"+h);this.view_mode=h;this._trigger("viewchanged",null,{view:h})},_enableViewSwitcher:function(){var i=this,h,l=f(".plupload_view_switch",this.container),k,j;c.each(["list","thumbs"],function(m){if(!i.options.views[m]){l.find('[for="'+i.id+"_view_"+m+'"], #'+i.id+"_view_"+m).remove()}});k=l.find(".plupload_button");if(k.length===1){l.hide();h=k.eq(0).data("view");this._viewChanged(h)}else{if(f.ui.button&&k.length>1){if(this.options.views.remember&&f.cookie){h=f.cookie("plupload_ui_view")}if(!~c.inArray(h,["list","thumbs"])){h=this.options.views.active}l.show().buttonset().find(".ui-button").click(function(m){h=f(this).data("view");i._viewChanged(h);m.preventDefault()});j=l.find('[for="'+i.id+"_view_"+h+'"]');if(j.length){j.trigger("click")}}else{l.show();this._viewChanged(this.options.views.active)}}if(this.options.views.thumbs){this._displayThumbs()}},_enableRenaming:function(){var h=this;this.filelist.dblclick(function(o){var m=f(o.target),l,j,n,i,k="";if(!m.hasClass("plupload_file_name_wrapper")){return}j=h.uploader.getFile(m.closest(".plupload_file")[0].id);i=j.name;n=/^(.+)(\.[^.]+)$/.exec(i);if(n){i=n[1];k=n[2]}l=f('<input class="plupload_file_rename" type="text" />').width(m.width()).insertAfter(m.hide());l.val(i).blur(function(){m.show().parent().scrollLeft(0).end().next().remove()}).keydown(function(q){var p=f(this);if(f.inArray(q.keyCode,[13,27])!==-1){q.preventDefault();if(q.keyCode===13){j.name=p.val()+k;m.html(j.name)}p.blur()}})[0].focus()})},_enableSortingList:function(){var h=this;if(f(".plupload_file",this.filelist).length<2){return}f("tbody",this.filelist).sortable("destroy");this.filelist.sortable({items:".plupload_delete",cancel:"object, .plupload_clearer",stop:function(){var i=[];f.each(f(this).sortable("toArray"),function(j,k){i[i.length]=h.uploader.getFile(k)});i.unshift(i.length);i.unshift(0);Array.prototype.splice.apply(h.uploader.files,i)}})}})}(window,document,plupload,jQuery));