(function(l,i,n,k){var j={};function h(a){return n.translate(a)||a}function m(a){a.id=a.attr("id");a.html('<div class="plupload_wrapper"><div class="ui-widget-content plupload_container"><div class="ui-state-default ui-widget-header plupload_header"><div class="plupload_header_content"><div class="plupload_logo"> </div><div class="plupload_header_title">'+h("Select files")+'</div><div class="plupload_header_text">'+h("Add files to the upload queue and click the start button.")+'</div><div class="plupload_view_switch"><input type="radio" id="'+a.id+'_view_list" name="view_mode_'+a.id+'" checked="checked" /><label class="plupload_button" for="'+a.id+'_view_list" data-view="list">'+h("List")+'</label><input type="radio" id="'+a.id+'_view_thumbs" name="view_mode_'+a.id+'" /><label class="plupload_button"  for="'+a.id+'_view_thumbs" data-view="thumbs">'+h("Thumbnails")+'</label></div></div></div><table class="plupload_filelist plupload_filelist_header ui-widget-header"><tr><td class="plupload_cell plupload_file_name">'+h("Filename")+'</td><td class="plupload_cell plupload_file_status">'+h("Status")+'</td><td class="plupload_cell plupload_file_size">'+h("Size")+'</td><td class="plupload_cell plupload_file_action">&nbsp;</td></tr></table><div class="plupload_content"><div class="plupload_droptext">'+h("Drag files here.")+'</div><ul class="plupload_filelist_content"> </ul><div class="plupload_clearer">&nbsp;</div></div><table class="plupload_filelist plupload_filelist_footer ui-widget-header"><tr><td class="plupload_cell plupload_file_name"><div class="plupload_buttons"><!-- Visible --><a class="plupload_button plupload_add">'+h("Add Files")+'</a>&nbsp;<a class="plupload_button plupload_start">'+h("Start Upload")+'</a>&nbsp;<a class="plupload_button plupload_stop plupload_hidden">'+h("Stop Upload")+'</a>&nbsp;</div><div class="plupload_started plupload_hidden"><!-- Hidden --><div class="plupload_progress plupload_right"><div class="plupload_progress_container"></div></div><div class="plupload_cell plupload_upload_status"></div><div class="plupload_clearer">&nbsp;</div></div></td><td class="plupload_file_status"><span class="plupload_total_status">0%</span></td><td class="plupload_file_size"><span class="plupload_total_file_size">0 kb</span></td><td class="plupload_file_action"></td></tr></table></div><input class="plupload_count" value="0" type="hidden"></div>')}k.widget("ui.plupload",{widgetEventPrefix:"",contents_bak:"",options:{browse_button_hover:"ui-state-hover",browse_button_active:"ui-state-active",filters:{},buttons:{browse:true,start:true,stop:true},views:{list:true,thumbs:false,active:"list",remember:true},thumb_width:100,thumb_height:60,multiple_queues:true,dragdrop:true,autostart:false,sortable:false,rename:false},FILE_COUNT_ERROR:-9001,_create:function(){var a=this.element.attr("id");if(!a){a=n.guid();this.element.attr("id",a)}this.id=a;this.contents_bak=this.element.html();m(this.element);this.container=k(".plupload_container",this.element).attr("id",a+"_container");this.content=k(".plupload_content",this.element);if(k.fn.resizable){this.container.resizable({handles:"s",minHeight:300})}this.filelist=k(".plupload_filelist_content",this.container).attr({id:a+"_filelist",unselectable:"on"});this.browse_button=k(".plupload_add",this.container).attr("id",a+"_browse");this.start_button=k(".plupload_start",this.container).attr("id",a+"_start");this.stop_button=k(".plupload_stop",this.container).attr("id",a+"_stop");this.thumbs_switcher=k("#"+a+"_view_thumbs");this.list_switcher=k("#"+a+"_view_list");if(k.ui.button){this.browse_button.button({icons:{primary:"ui-icon-circle-plus"},disabled:true});this.start_button.button({icons:{primary:"ui-icon-circle-arrow-e"},disabled:true});this.stop_button.button({icons:{primary:"ui-icon-circle-close"}});this.list_switcher.button({text:false,icons:{secondary:"ui-icon-grip-dotted-horizontal"}});this.thumbs_switcher.button({text:false,icons:{secondary:"ui-icon-image"}})}this.progressbar=k(".plupload_progress_container",this.container);if(k.ui.progressbar){this.progressbar.progressbar()}this.counter=k(".plupload_count",this.element).attr({id:a+"_count",name:a+"_count"});this._initUploader()},_initUploader:function(){var d=this,a=this.id,b,c={container:a+"_buttons",browse_button:a+"_browse",required_features:{},filters:{}};k(".plupload_buttons",this.element).attr("id",a+"_buttons");if(d.options.dragdrop){this.filelist.parent().attr("id",this.id+"_dropbox");c.drop_element=this.id+"_dropbox"}this.filelist.on("click",function(e){if(k(e.target).hasClass("plupload_action_icon")){d.removeFile(k(e.target).closest(".plupload_file").attr("id"));e.preventDefault()}});if(d.options.views.thumbs){c.required_features.display_media=true}if(d.options.max_file_count){c.filters.max_file_count=d.options.max_file_count}b=this.uploader=j[a]=new n.Uploader(k.extend(this.options,c));this.options=b.getOption();n.addFileFilter("max_file_count",function(g,e,f){if(g<=this.files.length-(this.total.uploaded+this.total.failed)){d.browse_button.button("disable");this.disableBrowse();this.trigger("Error",{code:d.FILE_COUNT_ERROR,message:h("File count error."),file:e});f(false)}else{f(true)}});b.bind("Error",function(f,g){var p,e="";p="<strong>"+g.message+"</strong>";switch(g.code){case n.FILE_EXTENSION_ERROR:e=n.sprintf(h("File: %s"),g.file.name);break;case n.FILE_SIZE_ERROR:e=n.sprintf(h("File: %s, size: %d, max file size: %d"),g.file.name,n.formatSize(g.file.size),n.formatSize(n.parseSize(f.getOption("filters").max_file_size)));break;case n.FILE_DUPLICATE_ERROR:e=n.sprintf(h("%s already present in the queue."),g.file.name);break;case d.FILE_COUNT_ERROR:e=n.sprintf(h("Upload element accepts only %d file(s) at a time. Extra files were stripped."),f.getOption("filters").max_file_count||0);break;case n.IMAGE_FORMAT_ERROR:e=h("Image format either wrong or not supported.");break;case n.IMAGE_MEMORY_ERROR:e=h("Runtime ran out of available memory.");break;case n.HTTP_ERROR:e=h("Upload URL might be wrong or doesn't exist.");break}p+=" <br /><i>"+e+"</i>";d._trigger("error",null,{up:f,error:g});if(g.code===n.INIT_ERROR){setTimeout(function(){d.destroy()},1)}else{d.notify("error",p)}});b.bind("PostInit",function(e){if(!d.options.buttons.browse){d.browse_button.button("disable").hide();e.disableBrowse(true)}else{d.browse_button.button("enable")}if(!d.options.buttons.start){d.start_button.button("disable").hide()}if(!d.options.buttons.stop){d.stop_button.button("disable").hide()}if(!d.options.unique_names&&d.options.rename){d._enableRenaming()}if(d.options.dragdrop&&e.features.dragdrop){d.filelist.parent().addClass("plupload_dropbox")}d._enableViewSwitcher();d.start_button.click(function(f){if(!k(this).button("option","disabled")){d.start()}f.preventDefault()});d.stop_button.click(function(f){d.stop();f.preventDefault()});d._trigger("ready",null,{up:e})});b.init();b.bind("FileFiltered",function(f,e){d._addFiles(e)});b.bind("FilesAdded",function(f,e){d._trigger("selected",null,{up:f,files:e});if(d.options.sortable&&k.ui.sortable){d._enableSortingList()}d._trigger("updatelist",null,{filelist:d.filelist});if(d.options.autostart){setTimeout(function(){d.start()},10)}});b.bind("FilesRemoved",function(f,e){if(k.ui.sortable&&d.options.sortable){k("tbody",d.filelist).sortable("destroy")}k.each(e,function(g,p){k("#"+p.id).toggle("highlight",function(){k(this).remove()})});if(f.files.length){if(d.options.sortable&&k.ui.sortable){d._enableSortingList()}}d._trigger("updatelist",null,{filelist:d.filelist});d._trigger("removed",null,{up:f,files:e})});b.bind("QueueChanged",function(){d._handleState()});b.bind("StateChanged",function(e){d._handleState();if(n.STARTED===e.state){d._trigger("started",null,{up:this.uploader})}else{if(n.STOPPED===e.state){d._trigger("stopped",null,{up:this.uploader})}}});b.bind("UploadFile",function(f,e){d._handleFileStatus(e)});b.bind("FileUploaded",function(e,g,f){d._handleFileStatus(g);d._trigger("uploaded",null,{up:e,file:g,result:f})});b.bind("UploadProgress",function(f,e){d._handleFileStatus(e);d._updateTotalProgress();d._trigger("progress",null,{up:f,file:e})});b.bind("UploadComplete",function(f,e){d._addFormFields();d._trigger("complete",null,{up:f,files:e})})},_setOption:function(b,a){var c=this;if(b=="buttons"&&typeof(a)=="object"){a=k.extend(c.options.buttons,a);if(!a.browse){c.browse_button.button("disable").hide();c.uploader.disableBrowse(true)}else{c.browse_button.button("enable").show();c.uploader.disableBrowse(false)}if(!a.start){c.start_button.button("disable").hide()}else{c.start_button.button("enable").show()}if(!a.stop){c.stop_button.button("disable").hide()}else{c.start_button.button("enable").show()}}c.uploader.setOption(b,a)},start:function(){this.uploader.start()},stop:function(){this.uploader.stop()},enable:function(){this.browse_button.button("enable");this.uploader.disableBrowse(false)},disable:function(){this.browse_button.button("disable");this.uploader.disableBrowse(true)},getFile:function(a){var b;if(typeof a==="number"){b=this.uploader.files[a]}else{b=this.uploader.getFile(a)}return b},getFiles:function(){return this.uploader.files},removeFile:function(a){if(n.typeOf(a)==="string"){a=this.getFile(a)}this.uploader.removeFile(a)},clearQueue:function(){this.uploader.splice()},getUploader:function(){return this.uploader},refresh:function(){this.uploader.refresh()},notify:function(b,a){var c=k('<div class="plupload_message"><span class="plupload_message_close ui-icon ui-icon-circle-close" title="'+h("Close")+'"></span><p><span class="ui-icon"></span>'+a+"</p></div>");c.addClass("ui-state-"+(b==="error"?"error":"highlight")).find("p .ui-icon").addClass("ui-icon-"+(b==="error"?"alert":"info")).end().find(".plupload_message_close").click(function(){c.remove()}).end();k(".plupload_header",this.container).append(c)},destroy:function(){this.uploader.destroy();k(".plupload_button",this.element).unbind();if(k.ui.button){k(".plupload_add, .plupload_start, .plupload_stop",this.container).button("destroy")}if(k.ui.progressbar){this.progressbar.progressbar("destroy")}if(k.ui.sortable&&this.options.sortable){k("tbody",this.filelist).sortable("destroy")}this.element.empty().html(this.contents_bak);this.contents_bak="";k.Widget.prototype.destroy.apply(this)},_handleState:function(){var c=this.uploader,b=c.files.length-(c.total.uploaded+c.total.failed),a=c.getOption("filters").max_file_count||0;if(n.STARTED===c.state){k([]).add(this.stop_button).add(".plupload_started").removeClass("plupload_hidden");this.start_button.button("disable");if(!this.options.multiple_queues){this.browse_button.button("disable");c.disableBrowse()}k(".plupload_upload_status",this.element).html(n.sprintf(h("Uploaded %d/%d files"),c.total.uploaded,c.files.length));k(".plupload_header_content",this.element).addClass("plupload_header_content_bw")}else{if(n.STOPPED===c.state){k([]).add(this.stop_button).add(".plupload_started").addClass("plupload_hidden");if(b){this.start_button.button("enable")}else{this.start_button.button("disable")}if(this.options.multiple_queues){k(".plupload_header_content",this.element).removeClass("plupload_header_content_bw")}if(this.options.multiple_queues&&a&&a>b){this.browse_button.button("enable");c.disableBrowse(false)}this._updateTotalProgress()}}if(c.total.queued===0){k(".ui-button-text",this.browse_button).html(h("Add Files"))}else{k(".ui-button-text",this.browse_button).html(n.sprintf(h("%d files queued"),c.total.queued))}c.refresh()},_handleFileStatus:function(b){var d=k("#"+b.id),p,e;if(!d.length){return}switch(b.status){case n.DONE:p="plupload_done";e="plupload_action_icon ui-icon ui-icon-circle-check";break;case n.FAILED:p="ui-state-error plupload_failed";e="plupload_action_icon ui-icon ui-icon-alert";break;case n.QUEUED:p="plupload_delete";e="plupload_action_icon ui-icon ui-icon-circle-minus";break;case n.UPLOADING:p="ui-state-highlight plupload_uploading";e="plupload_action_icon ui-icon ui-icon-circle-arrow-w";var f=k(".plupload_scroll",this.container),a=f.scrollTop(),g=f.height(),c=d.position().top+d.height();if(g<c){f.scrollTop(a+c-g)}d.find(".plupload_file_percent").html(b.percent+"%").end().find(".plupload_file_progress").css("width",b.percent+"%").end().find(".plupload_file_size").html(n.formatSize(b.size));break}p+=" ui-state-default plupload_file";d.attr("class",p).find(".plupload_action_icon").attr("class",e)},_updateTotalProgress:function(){var a=this.uploader;this.filelist[0].scrollTop=this.filelist[0].scrollHeight;this.progressbar.progressbar("value",a.total.percent);this.element.find(".plupload_total_status").html(a.total.percent+"%").end().find(".plupload_total_file_size").html(n.formatSize(a.total.size)).end().find(".plupload_upload_status").html(n.sprintf(h("Uploaded %d/%d files"),a.total.uploaded,a.files.length))},_displayThumbs:function(){var z=this,e,x,B,f=0,c=[],v=false;if(!this.options.views.thumbs){return}function a(o,p,q){var r;o.on(p,function(){clearTimeout(r);r=setTimeout(function(){clearTimeout(r);q()},300)})}function y(){if(!e||!x){var o=k(".plupload_file:eq(0)",z.filelist);e=o.outerWidth(true);x=o.outerHeight(true)}var p=z.content.width(),q=z.content.height();B=Math.floor(p/e);f=B*(Math.ceil(q/x)+1)}function w(){var o=Math.floor(z.content.scrollTop()/x)*B;c=k(".plupload_file .plupload_file_thumb",z.filelist).slice(o,o+f).filter(".plupload_thumb_toload").get()}function A(){function o(){if(z.view_mode!=="thumbs"){return}y();w();g()}if(k.fn.resizable){a(z.container,"resize",o)}a(z.window,"resize",o);a(z.content,"scroll",o);z.element.on("viewchanged selected",o);o()}function b(o,q){var p=new n.Image();p.onload=function(){var r=k("#"+o.id+" .plupload_file_thumb",z.filelist);this.embed(r[0],{width:z.options.thumb_width,height:z.options.thumb_height,crop:true,preserveHeaders:false,swf_url:n.resolveUrl(z.options.flash_swf_url),xap_url:n.resolveUrl(z.options.silverlight_xap_url)})};p.bind("embedded error",function(r){k("#"+o.id,z.filelist).find(".plupload_file_thumb").removeClass("plupload_thumb_loading").addClass("plupload_thumb_"+r.type);this.destroy();setTimeout(q,1)});k("#"+o.id,z.filelist).find(".plupload_file_thumb").removeClass("plupload_thumb_toload").addClass("plupload_thumb_loading");p.load(o.getSource())}function g(){if(z.view_mode!=="thumbs"||v){return}w();if(!c.length){return}v=true;b(z.getFile(k(c.shift()).closest(".plupload_file").attr("id")),function(){v=false;g()})}this.element.on("selected",function d(){z.element.off("selected",d);A()})},_addFiles:function(a){var c=this,d,b="";d='<li class="plupload_file ui-state-default plupload_delete" id="{id}" style="width:{thumb_width}px;"><div class="plupload_file_thumb plupload_thumb_toload" style="width: {thumb_width}px; height: {thumb_height}px;"><div class="plupload_file_dummy ui-widget-content" style="line-height: {thumb_height}px;"><span class="ui-state-disabled">{ext} </span></div></div><div class="plupload_file_status"><div class="plupload_file_progress ui-widget-header" style="width: 0%"> </div><span class="plupload_file_percent">{percent} </span></div><div class="plupload_file_name" title="{name}"><span class="plupload_file_name_wrapper">{name} </span></div><div class="plupload_file_action"><div class="plupload_action_icon ui-icon ui-icon-circle-minus"> </div></div><div class="plupload_file_size">{size} </div><div class="plupload_file_fields"> </div></li>';if(n.typeOf(a)!=="array"){a=[a]}k.each(a,function(g,q){var e=q.name.match(/\.([^.]+)$/);var f=e&&e[1].toLowerCase()||"none";b+=d.replace(/\{(\w+)\}/g,function(p,o){switch(o){case"thumb_width":case"thumb_height":return c.options[o];case"size":return n.formatSize(q.size);case"ext":return f;default:return q[o]||""}})});c.filelist.append(b)},_addFormFields:function(){var a=this;k(".plupload_file_fields",this.filelist).html("");n.each(this.uploader.files,function(d,c){var e="",b=a.id+"_"+c;if(d.target_name){e+='<input type="hidden" name="'+b+'_tmpname" value="'+n.xmlEncode(d.target_name)+'" />'}e+='<input type="hidden" name="'+b+'_name" value="'+n.xmlEncode(d.name)+'" />';e+='<input type="hidden" name="'+b+'_status" value="'+(d.status===n.DONE?"done":"failed")+'" />';k("#"+d.id).find(".plupload_file_fields").html(e)});this.counter.val(this.uploader.files.length)},_viewChanged:function(a){if(this.options.views.remember&&k.cookie){k.cookie("plupload_ui_view",a,{expires:7,path:"/"})}if(n.ua.browser==="IE"&&n.ua.version<7){this.content.attr("style",'height:expression(document.getElementById("'+this.id+'_container").clientHeight - '+(a==="list"?132:102)+")")}this.container.removeClass("plupload_view_list plupload_view_thumbs").addClass("plupload_view_"+a);this.view_mode=a;this._trigger("viewchanged",null,{view:a})},_enableViewSwitcher:function(){var d=this,e,a=k(".plupload_view_switch",this.container),b,c;n.each(["list","thumbs"],function(f){if(!d.options.views[f]){a.find('[for="'+d.id+"_view_"+f+'"], #'+d.id+"_view_"+f).remove()}});b=a.find(".plupload_button");if(b.length===1){a.hide();e=b.eq(0).data("view");this._viewChanged(e)}else{if(k.ui.button&&b.length>1){if(this.options.views.remember&&k.cookie){e=k.cookie("plupload_ui_view")}if(!~n.inArray(e,["list","thumbs"])){e=this.options.views.active}a.show().buttonset().find(".ui-button").click(function(f){e=k(this).data("view");d._viewChanged(e);f.preventDefault()});c=a.find('[for="'+d.id+"_view_"+e+'"]');if(c.length){c.trigger("click")}}else{a.show();this._viewChanged(this.options.views.active)}}if(this.options.views.thumbs){this._displayThumbs()}},_enableRenaming:function(){var a=this;this.filelist.dblclick(function(g){var b=k(g.target),c,e,p,f,d="";if(!b.hasClass("plupload_file_name_wrapper")){return}e=a.uploader.getFile(b.closest(".plupload_file")[0].id);f=e.name;p=/^(.+)(\.[^.]+)$/.exec(f);if(p){f=p[1];d=p[2]}c=k('<input class="plupload_file_rename" type="text" />').width(b.width()).insertAfter(b.hide());c.val(f).blur(function(){b.show().parent().scrollLeft(0).end().next().remove()}).keydown(function(o){var r=k(this);if(k.inArray(o.keyCode,[13,27])!==-1){o.preventDefault();if(o.keyCode===13){e.name=r.val()+d;b.html(e.name)}r.blur()}})[0].focus()})},_enableSortingList:function(){var a=this;if(k(".plupload_file",this.filelist).length<2){return}k("tbody",this.filelist).sortable("destroy");this.filelist.sortable({items:".plupload_delete",cancel:"object, .plupload_clearer",stop:function(){var b=[];k.each(k(this).sortable("toArray"),function(d,c){b[b.length]=a.uploader.getFile(c)});b.unshift(b.length);b.unshift(0);Array.prototype.splice.apply(a.uploader.files,b)}})}})}(window,document,plupload,jQuery));