(function(h){var g={};function f(a){return plupload.translate(a)||a}function e(a,b){b.contents().each(function(d,c){c=h(c);if(!c.is(".plupload")){c.remove()}});b.prepend('<div class="plupload_wrapper plupload_scroll"><div id="'+a+'_container" class="plupload_container"><div class="plupload"><div class="plupload_header"><div class="plupload_header_content"><div class="plupload_header_title">'+f("Select files")+'</div><div class="plupload_header_text">'+f("Add files to the upload queue and click the start button.")+'</div></div></div><div class="plupload_content"><div class="plupload_filelist_header"><div class="plupload_file_name">'+f("Filename")+'</div><div class="plupload_file_action">&nbsp;</div><div class="plupload_file_status"><span>'+f("Status")+'</span></div><div class="plupload_file_size">'+f("Size")+'</div><div class="plupload_clearer">&nbsp;</div></div><ul id="'+a+'_filelist" class="plupload_filelist"></ul><div class="plupload_filelist_footer"><div class="plupload_file_name"><div class="plupload_buttons"><a href="#" class="plupload_button plupload_add" id="'+a+'_browse">'+f("Add Files")+'</a><a href="#" class="plupload_button plupload_start">'+f("Start Upload")+'</a></div><span class="plupload_upload_status"></span></div><div class="plupload_file_action"></div><div class="plupload_file_status"><span class="plupload_total_status">0%</span></div><div class="plupload_file_size"><span class="plupload_total_file_size">0 b</span></div><div class="plupload_progress"><div class="plupload_progress_container"><div class="plupload_progress_bar"></div></div></div><div class="plupload_clearer">&nbsp;</div></div></div></div></div><input type="hidden" id="'+a+'_count" name="'+a+'_count" value="0" /></div>')}h.fn.pluploadQueue=function(a){if(a){this.each(function(){var c,d,b,q;d=h(this);b=d.attr("id");if(!b){b=plupload.guid();d.attr("id",b)}q=d.html();e(b,d);a=h.extend({dragdrop:true,browse_button:b+"_browse",container:b},a);if(a.dragdrop){a.drop_element=b+"_filelist"}c=new plupload.Uploader(a);g[b]=c;function n(k){var i;if(k.status==plupload.DONE){i="plupload_done"}if(k.status==plupload.FAILED){i="plupload_failed"}if(k.status==plupload.QUEUED){i="plupload_delete"}if(k.status==plupload.UPLOADING){i="plupload_uploading"}var j=h("#"+k.id).attr("class",i).find("a").css("display","block");if(k.hint){j.attr("title",k.hint)}}function r(){h("span.plupload_total_status",d).html(c.total.percent+"%");h("div.plupload_progress_bar",d).css("width",c.total.percent+"%");h("span.plupload_upload_status",d).html(plupload.sprintf(f("Uploaded %d/%d files"),c.total.uploaded,c.files.length))}function p(){var j=h("ul.plupload_filelist",d).html(""),i=0,k;h.each(c.files,function(l,m){k="";if(m.status==plupload.DONE){if(m.target_name){k+='<input type="hidden" name="'+b+"_"+i+'_tmpname" value="'+plupload.xmlEncode(m.target_name)+'" />'}k+='<input type="hidden" name="'+b+"_"+i+'_name" value="'+plupload.xmlEncode(m.name)+'" />';k+='<input type="hidden" name="'+b+"_"+i+'_status" value="'+(m.status==plupload.DONE?"done":"failed")+'" />';i++;h("#"+b+"_count").val(i)}j.append('<li id="'+m.id+'"><div class="plupload_file_name"><span>'+m.name+'</span></div><div class="plupload_file_action"><a href="#"></a></div><div class="plupload_file_status">'+m.percent+'%</div><div class="plupload_file_size">'+plupload.formatSize(m.size)+'</div><div class="plupload_clearer">&nbsp;</div>'+k+"</li>");n(m);h("#"+m.id+".plupload_delete a").click(function(t){h("#"+m.id).remove();c.removeFile(m);t.preventDefault()})});h("span.plupload_total_file_size",d).html(plupload.formatSize(c.total.size));if(c.total.queued===0){h("span.plupload_add_text",d).html(f("Add Files"))}else{h("span.plupload_add_text",d).html(plupload.sprintf(f("%d files queued"),c.total.queued))}h("a.plupload_start",d).toggleClass("plupload_disabled",c.files.length==(c.total.uploaded+c.total.failed));j[0].scrollTop=j[0].scrollHeight;r();if(!c.files.length&&c.features.dragdrop&&c.settings.dragdrop){h("#"+b+"_filelist").append('<li class="plupload_droptext">'+f("Drag files here.")+"</li>")}}function o(){delete g[b];c.destroy();d.html(q);c=d=q=null}c.bind("UploadFile",function(j,i){h("#"+i.id).addClass("plupload_current_file")});c.bind("Init",function(j,i){if(!a.unique_names&&a.rename){d.on("click","#"+b+"_filelist div.plupload_file_name span",function(k){var m=h(k.target),w,l,x,v="";w=j.getFile(m.parents("li")[0].id);x=w.name;l=/^(.+)(\.[^.]+)$/.exec(x);if(l){x=l[1];v=l[2]}m.hide().after('<input type="text" />');m.next().val(x).focus().blur(function(){m.show().next().remove()}).keydown(function(s){var t=h(this);if(s.keyCode==13){s.preventDefault();w.name=t.val()+v;m.html(w.name);t.blur()}})})}h("#"+b+"_container").attr("title","Using runtime: "+i.runtime);h("a.plupload_start",d).click(function(k){if(!h(this).hasClass("plupload_disabled")){c.start()}k.preventDefault()});h("a.plupload_stop",d).click(function(k){k.preventDefault();c.stop()});h("a.plupload_start",d).addClass("plupload_disabled")});c.bind("Error",function(l,i){var k=i.file,j;if(k){j=i.message;if(i.details){j+=" ("+i.details+")"}if(i.code==plupload.FILE_SIZE_ERROR){alert(f("Error: File too large:")+" "+k.name)}if(i.code==plupload.FILE_EXTENSION_ERROR){alert(f("Error: Invalid file extension:")+" "+k.name)}k.hint=j;h("#"+k.id).attr("class","plupload_failed").find("a").css("display","block").attr("title",j)}if(i.code===plupload.INIT_ERROR){setTimeout(function(){o()},1)}});c.bind("PostInit",function(i){if(i.settings.dragdrop&&i.features.dragdrop){h("#"+b+"_filelist").append('<li class="plupload_droptext">'+f("Drag files here.")+"</li>")}});c.init();c.bind("StateChanged",function(){if(c.state===plupload.STARTED){h("li.plupload_delete a,div.plupload_buttons",d).hide();c.disableBrowse(true);h("span.plupload_upload_status,div.plupload_progress,a.plupload_stop",d).css("display","block");h("span.plupload_upload_status",d).html("Uploaded "+c.total.uploaded+"/"+c.files.length+" files");if(a.multiple_queues){h("span.plupload_total_status,span.plupload_total_file_size",d).show()}}else{p();h("a.plupload_stop,div.plupload_progress",d).hide();h("a.plupload_delete",d).css("display","block");if(a.multiple_queues&&c.total.uploaded+c.total.failed==c.files.length){h(".plupload_buttons,.plupload_upload_status",d).css("display","inline");c.disableBrowse(false);h(".plupload_start",d).addClass("plupload_disabled");h("span.plupload_total_status,span.plupload_total_file_size",d).hide()}}});c.bind("FilesAdded",p);c.bind("FilesRemoved",function(){var i=h("#"+b+"_filelist").scrollTop();p();h("#"+b+"_filelist").scrollTop(i)});c.bind("FileUploaded",function(j,i){n(i)});c.bind("UploadProgress",function(j,i){h("#"+i.id+" div.plupload_file_status",d).html(i.percent+"%");n(i);r()});if(a.setup){a.setup(c)}});return this}else{return g[h(this[0]).attr("id")]}}})(jQuery);