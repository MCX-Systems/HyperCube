(function(b){var a=(typeof self=="object"&&self.self===self&&self)||(typeof global=="object"&&global.global===global&&global);if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(g,h,e){a.Backbone=b(a,e,g,h)})}else{if(typeof exports!=="undefined"){var c=require("underscore"),d;try{d=require("jquery")}catch(f){}b(a,exports,c,d)}else{a.Backbone=b(a,{},a._,(a.jQuery||a.Zepto||a.ender||a.$))}}})(function(B,I,W,H){var M=B.Backbone;var r=Array.prototype.slice;I.VERSION="1.3.3";I.$=H;I.noConflict=function(){B.Backbone=M;return this};I.emulateHTTP=false;I.emulateJSON=false;var U=I.Events={};var D=/\s+/;var z;var E=function(ac,Z,X,ad,aa){var Y=0,ab;if(X&&typeof X==="object"){if(ad!==void 0&&"context" in aa&&aa.context===void 0){aa.context=ad}for(ab=W.keys(X);Y<ab.length;Y++){Z=E(ac,Z,ab[Y],X[ab[Y]],aa)}}else{if(X&&D.test(X)){for(ab=X.split(D);Y<ab.length;Y++){Z=ac(Z,ab[Y],ad,aa)}}else{Z=ac(Z,X,ad,aa)}}return Z};U.on=function(X,aa,Y){this._events=E(G,this._events||{},X,aa,{context:Y,ctx:this,listening:z});if(z){var Z=this._listeners||(this._listeners={});Z[z.id]=z;z.interop=false}return this};U.listenTo=function(ab,Y,ad){if(!ab){return this}var ac=ab._listenId||(ab._listenId=W.uniqueId("l"));var aa=this._listeningTo||(this._listeningTo={});var Z=z=aa[ac];if(!Z){this._listenId||(this._listenId=W.uniqueId("l"));Z=z=aa[ac]=new h(this,ab)}var X=q(ab,Y,ad,this);z=void 0;if(X){throw X}if(Z.interop){Z.on(Y,ad)}return this};var G=function(ad,aa,ae,Z){if(ae){var Y=ad[aa]||(ad[aa]=[]);var ac=Z.context,X=Z.ctx,ab=Z.listening;if(ab){ab.count++}Y.push({callback:ae,context:ac,ctx:ac||X,listening:ab})}return ad};var q=function(aa,X,ab,Y){try{aa.on(X,ab,Y)}catch(Z){return Z}};U.off=function(X,Z,Y){if(!this._events){return this}this._events=E(d,this._events,X,Z,{context:Y,listeners:this._listeners});return this};U.stopListening=function(ac,X,ad){var aa=this._listeningTo;if(!aa){return this}var ab=ac?[ac._listenId]:W.keys(aa);for(var Z=0;Z<ab.length;Z++){var Y=aa[ab[Z]];if(!Y){break}Y.obj.off(X,ad,this);if(Y.interop){Y.off(X,ad)}}if(W.isEmpty(aa)){this._listeningTo=void 0}return this};var d=function(ai,X,ag,aj){if(!ai){return}var Y=aj.context,af=aj.listeners;var ac=0,ae;if(!X&&!Y&&!ag){for(ae=W.keys(af);ac<ae.length;ac++){af[ae[ac]].cleanup()}return}ae=X?[X]:W.keys(ai);for(;ac<ae.length;ac++){X=ae[ac];var Z=ai[X];if(!Z){break}var aa=[];for(var ab=0;ab<Z.length;ab++){var ah=Z[ab];if(ag&&ag!==ah.callback&&ag!==ah.callback._callback||Y&&Y!==ah.context){aa.push(ah)}else{var ad=ah.listening;if(ad){ad.off(X,ag)}}}if(aa.length){ai[X]=aa}else{delete ai[X]}}return ai};U.once=function(X,aa,Z){var Y=E(L,{},X,aa,this.off.bind(this));if(typeof X==="string"&&Z==null){aa=void 0}return this.on(Y,aa,Z)};U.listenToOnce=function(Z,X,aa){var Y=E(L,{},X,aa,this.stopListening.bind(this,Z));return this.listenTo(Z,Y)};var L=function(aa,X,ab,Z){if(ab){var Y=aa[X]=W.once(function(){Z(X,Y);ab.apply(this,arguments)});Y._callback=ab}return aa};U.trigger=function(Y){if(!this._events){return this}var aa=Math.max(0,arguments.length-1);var X=Array(aa);for(var Z=0;Z<aa;Z++){X[Z]=arguments[Z+1]}E(o,this._events,Y,void 0,X);return this};var o=function(X,aa,ac,Z){if(X){var ab=X[aa];var Y=X.all;if(ab&&Y){Y=Y.slice()}if(ab){b(ab,Z)}if(Y){b(Y,[aa].concat(Z))}}return X};var b=function(ac,aa){var ad,ab=-1,Z=ac.length,Y=aa[0],X=aa[1],ae=aa[2];switch(aa.length){case 0:while(++ab<Z){(ad=ac[ab]).callback.call(ad.ctx)}return;case 1:while(++ab<Z){(ad=ac[ab]).callback.call(ad.ctx,Y)}return;case 2:while(++ab<Z){(ad=ac[ab]).callback.call(ad.ctx,Y,X)}return;case 3:while(++ab<Z){(ad=ac[ab]).callback.call(ad.ctx,Y,X,ae)}return;default:while(++ab<Z){(ad=ac[ab]).callback.apply(ad.ctx,aa)}return}};var h=function(X,Y){this.id=X._listenId;this.listener=X;this.obj=Y;this.interop=true;this.count=0;this._events=void 0};h.prototype.on=U.on;h.prototype.off=function(X,Z){var Y;if(this.interop){this._events=E(d,this._events,X,Z,{context:void 0,listeners:void 0});Y=!this._events}else{this.count--;Y=this.count===0}if(Y){this.cleanup()}};h.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId];if(!this.interop){delete this.obj._listeners[this.id]}};U.bind=U.on;U.unbind=U.off;W.extend(I,U);var O=I.Model=function(X,Z){var Y=X||{};Z||(Z={});this.preinitialize.apply(this,arguments);this.cid=W.uniqueId(this.cidPrefix);this.attributes={};if(Z.collection){this.collection=Z.collection}if(Z.parse){Y=this.parse(Y,Z)||{}}var aa=W.result(this,"defaults");Y=W.defaults(W.extend({},aa,Y),aa);this.set(Y,Z);this.changed={};this.initialize.apply(this,arguments)};W.extend(O.prototype,U,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(X){return W.clone(this.attributes)},sync:function(){return I.sync.apply(this,arguments)},get:function(X){return this.attributes[X]},escape:function(X){return W.escape(this.get(X))},has:function(X){return this.get(X)!=null},matches:function(X){return !!W.iteratee(X,this)(this.attributes)},set:function(af,X,aj){if(af==null){return this}var ag;if(typeof af==="object"){ag=af;aj=X}else{(ag={})[af]=X}aj||(aj={});if(!this._validate(ag,aj)){return false}var ah=aj.unset;var ad=aj.silent;var ae=[];var ai=this._changing;this._changing=true;if(!ai){this._previousAttributes=W.clone(this.attributes);this.changed={}}var ac=this.attributes;var aa=this.changed;var Y=this._previousAttributes;for(var ab in ag){X=ag[ab];if(!W.isEqual(ac[ab],X)){ae.push(ab)}if(!W.isEqual(Y[ab],X)){aa[ab]=X}else{delete aa[ab]}ah?delete ac[ab]:ac[ab]=X}if(this.idAttribute in ag){this.id=this.get(this.idAttribute)}if(!ad){if(ae.length){this._pending=aj}for(var Z=0;Z<ae.length;Z++){this.trigger("change:"+ae[Z],this,ac[ae[Z]],aj)}}if(ai){return this}if(!ad){while(this._pending){aj=this._pending;this._pending=false;this.trigger("change",this,aj)}}this._pending=false;this._changing=false;return this},unset:function(X,Y){return this.set(X,void 0,W.extend({},Y,{unset:true}))},clear:function(Y){var X={};for(var Z in this.attributes){X[Z]=void 0}return this.set(X,W.extend({},Y,{unset:true}))},hasChanged:function(X){if(X==null){return !W.isEmpty(this.changed)}return W.has(this.changed,X)},changedAttributes:function(aa){if(!aa){return this.hasChanged()?W.clone(this.changed):false}var Y=this._changing?this._previousAttributes:this.attributes;var ac={};var Z;for(var X in aa){var ab=aa[X];if(W.isEqual(Y[X],ab)){continue}ac[X]=ab;Z=true}return Z?ac:false},previous:function(X){if(X==null||!this._previousAttributes){return null}return this._previousAttributes[X]},previousAttributes:function(){return W.clone(this._previousAttributes)},fetch:function(Y){Y=W.extend({parse:true},Y);var X=this;var Z=Y.success;Y.success=function(ab){var aa=Y.parse?X.parse(ab,Y):ab;if(!X.set(aa,Y)){return false}if(Z){Z.call(Y.context,X,ab,Y)}X.trigger("sync",X,ab,Y)};T(this,Y);return this.sync("read",this,Y)},save:function(ac,Y,ag){var ad;if(ac==null||typeof ac==="object"){ad=ac;ag=Y}else{(ad={})[ac]=Y}ag=W.extend({validate:true,parse:true},ag);var aa=ag.wait;if(ad&&!aa){if(!this.set(ad,ag)){return false}}else{if(!this._validate(ad,ag)){return false}}var ab=this;var ae=ag.success;var Z=this.attributes;ag.success=function(ai){ab.attributes=Z;var ah=ag.parse?ab.parse(ai,ag):ai;if(aa){ah=W.extend({},ad,ah)}if(ah&&!ab.set(ah,ag)){return false}if(ae){ae.call(ag.context,ab,ai,ag)}ab.trigger("sync",ab,ai,ag)};T(this,ag);if(ad&&aa){this.attributes=W.extend({},Z,ad)}var X=this.isNew()?"create":(ag.patch?"patch":"update");if(X==="patch"&&!ag.attrs){ag.attrs=ad}var af=this.sync(X,this,ag);this.attributes=Z;return af},destroy:function(Y){Y=Y?W.clone(Y):{};var X=this;var ac=Y.success;var aa=Y.wait;var Z=function(){X.stopListening();X.trigger("destroy",X,X.collection,Y)};Y.success=function(ad){if(aa){Z()}if(ac){ac.call(Y.context,X,ad,Y)}if(!X.isNew()){X.trigger("sync",X,ad,Y)}};var ab=false;if(this.isNew()){W.defer(Y.success)}else{T(this,Y);ab=this.sync("delete",this,Y)}if(!aa){Z()}return ab},url:function(){var X=W.result(this,"urlRoot")||W.result(this.collection,"url")||x();if(this.isNew()){return X}var Y=this.get(this.idAttribute);return X.replace(/[^\/]$/,"$&/")+encodeURIComponent(Y)},parse:function(Y,X){return Y},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return !this.has(this.idAttribute)},isValid:function(X){return this._validate({},W.extend({},X,{validate:true}))},_validate:function(Z,Y){if(!Y.validate||!this.validate){return true}Z=W.extend({},this.attributes,Z);var X=this.validationError=this.validate(Z,Y)||null;if(!X){return true}this.trigger("invalid",this,X,W.extend(Y,{validationError:X}));return false}});var c=I.Collection=function(Y,X){X||(X={});this.preinitialize.apply(this,arguments);if(X.model){this.model=X.model}if(X.comparator!==void 0){this.comparator=X.comparator}this._reset();this.initialize.apply(this,arguments);if(Y){this.reset(Y,W.extend({silent:true},X))}};var s={add:true,remove:true,merge:true};var V={add:true,remove:false};var A=function(ac,ab,X){X=Math.min(Math.max(X,0),ac.length);var Y=Array(ac.length-X);var aa=ab.length;var Z;for(Z=0;Z<Y.length;Z++){Y[Z]=ac[Z+X]}for(Z=0;Z<aa;Z++){ac[Z+X]=ab[Z]}for(Z=0;Z<Y.length;Z++){ac[Z+aa+X]=Y[Z]}};W.extend(c.prototype,U,{model:O,preinitialize:function(){},initialize:function(){},toJSON:function(X){return this.map(function(Y){return Y.toJSON(X)})},sync:function(){return I.sync.apply(this,arguments)},add:function(Y,X){return this.set(Y,W.extend({merge:false},X,V))},remove:function(aa,X){X=W.extend({},X);var Y=!W.isArray(aa);aa=Y?[aa]:aa.slice();var Z=this._removeModels(aa,X);if(!X.silent&&Z.length){X.changes={added:[],merged:[],removed:Z};this.trigger("update",this,X)}return Y?Z[0]:Z},set:function(ap,Y){if(ap==null){return}Y=W.extend({},s,Y);if(Y.parse&&!this._isModel(ap)){ap=this.parse(ap,Y)||[]}var ab=!W.isArray(ap);ap=ab?[ap]:ap.slice();var ad=Y.at;if(ad!=null){ad=+ad}if(ad>this.length){ad=this.length}if(ad<0){ad+=this.length+1}var ac=[];var aq=[];var ai=[];var aj=[];var ag={};var ae=Y.add;var aa=Y.merge;var ar=Y.remove;var an=false;var X=this.comparator&&ad==null&&Y.sort!==false;var am=W.isString(this.comparator)?this.comparator:null;var Z,al;for(al=0;al<ap.length;al++){Z=ap[al];var af=this.get(Z);if(af){if(aa&&Z!==af){var ah=this._isModel(Z)?Z.attributes:Z;if(Y.parse){ah=af.parse(ah,Y)}af.set(ah,Y);ai.push(af);if(X&&!an){an=af.hasChanged(am)}}if(!ag[af.cid]){ag[af.cid]=true;ac.push(af)}ap[al]=af}else{if(ae){Z=ap[al]=this._prepareModel(Z,Y);if(Z){aq.push(Z);this._addReference(Z,Y);ag[Z.cid]=true;ac.push(Z)}}}}if(ar){for(al=0;al<this.length;al++){Z=this.models[al];if(!ag[Z.cid]){aj.push(Z)}}if(aj.length){this._removeModels(aj,Y)}}var ak=false;var ao=!X&&ae&&ar;if(ac.length&&ao){ak=this.length!==ac.length||W.some(this.models,function(at,au){return at!==ac[au]});this.models.length=0;A(this.models,ac,0);this.length=this.models.length}else{if(aq.length){if(X){an=true}A(this.models,aq,ad==null?this.length:ad);this.length=this.models.length}}if(an){this.sort({silent:true})}if(!Y.silent){for(al=0;al<aq.length;al++){if(ad!=null){Y.index=ad+al}Z=aq[al];Z.trigger("add",Z,this,Y)}if(an||ak){this.trigger("sort",this,Y)}if(aq.length||aj.length||ai.length){Y.changes={added:aq,removed:aj,merged:ai};this.trigger("update",this,Y)}}return ab?ap[0]:ap},reset:function(Z,X){X=X?W.clone(X):{};for(var Y=0;Y<this.models.length;Y++){this._removeReference(this.models[Y],X)}X.previousModels=this.models;this._reset();Z=this.add(Z,W.extend({silent:true},X));if(!X.silent){this.trigger("reset",this,X)}return Z},push:function(Y,X){return this.add(Y,W.extend({at:this.length},X))},pop:function(Y){var X=this.at(this.length-1);return this.remove(X,Y)},unshift:function(Y,X){return this.add(Y,W.extend({at:0},X))},shift:function(Y){var X=this.at(0);return this.remove(X,Y)},slice:function(){return r.apply(this.models,arguments)},get:function(X){if(X==null){return void 0}return this._byId[X]||this._byId[this.modelId(this._isModel(X)?X.attributes:X)]||X.cid&&this._byId[X.cid]},has:function(X){return this.get(X)!=null},at:function(X){if(X<0){X+=this.length}return this.models[X]},where:function(X,Y){return this[Y?"find":"filter"](X)},findWhere:function(X){return this.where(X,true)},sort:function(Y){var X=this.comparator;if(!X){throw new Error("Cannot sort a set without a comparator")}Y||(Y={});var Z=X.length;if(W.isFunction(X)){X=X.bind(this)}if(Z===1||W.isString(X)){this.models=this.sortBy(X)}else{this.models.sort(X)}if(!Y.silent){this.trigger("sort",this,Y)}return this},pluck:function(X){return this.map(X+"")},fetch:function(X){X=W.extend({parse:true},X);var Z=X.success;var Y=this;X.success=function(aa){var ab=X.reset?"reset":"set";Y[ab](aa,X);if(Z){Z.call(X.context,Y,aa,X)}Y.trigger("sync",Y,aa,X)};T(this,X);return this.sync("read",this,X)},create:function(Y,X){X=X?W.clone(X):{};var Z=X.wait;Y=this._prepareModel(Y,X);if(!Y){return false}if(!Z){this.add(Y,X)}var ab=this;var aa=X.success;X.success=function(ad,ae,ac){if(Z){ab.add(ad,ac)}if(aa){aa.call(ac.context,ad,ae,ac)}};Y.save(null,X);return Y},parse:function(Y,X){return Y},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(X){return X[this.model.prototype.idAttribute||"id"]},values:function(){return new R(this,j)},keys:function(){return new R(this,p)},entries:function(){return new R(this,Q)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(Z,Y){if(this._isModel(Z)){if(!Z.collection){Z.collection=this}return Z}Y=Y?W.clone(Y):{};Y.collection=this;var X=new this.model(Z,Y);if(!X.validationError){return X}this.trigger("invalid",this,X.validationError,Y);return false},_removeModels:function(ad,Z){var ab=[];for(var aa=0;aa<ad.length;aa++){var Y=this.get(ad[aa]);if(!Y){continue}var X=this.indexOf(Y);this.models.splice(X,1);this.length--;delete this._byId[Y.cid];var ac=this.modelId(Y.attributes);if(ac!=null){delete this._byId[ac]}if(!Z.silent){Z.index=X;Y.trigger("remove",Y,this,Z)}ab.push(Y);this._removeReference(Y,Z)}return ab},_isModel:function(X){return X instanceof O},_addReference:function(Y,X){this._byId[Y.cid]=Y;var Z=this.modelId(Y.attributes);if(Z!=null){this._byId[Z]=Y}Y.on("all",this._onModelEvent,this)},_removeReference:function(Y,X){delete this._byId[Y.cid];var Z=this.modelId(Y.attributes);if(Z!=null){delete this._byId[Z]}if(this===Y.collection){delete Y.collection}Y.off("all",this._onModelEvent,this)},_onModelEvent:function(Z,Y,ab,X){if(Y){if((Z==="add"||Z==="remove")&&ab!==this){return}if(Z==="destroy"){this.remove(Y,X)}if(Z==="change"){var aa=this.modelId(Y.previousAttributes());var ac=this.modelId(Y.attributes);if(aa!==ac){if(aa!=null){delete this._byId[aa]}if(ac!=null){this._byId[ac]=Y}}}}this.trigger.apply(this,arguments)}});var l=typeof Symbol==="function"&&Symbol.iterator;if(l){c.prototype[l]=c.prototype.values}var R=function(Y,X){this._collection=Y;this._kind=X;this._index=0};var j=1;var p=2;var Q=3;if(l){R.prototype[l]=function(){return this}}R.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var X=this._collection.at(this._index);this._index++;var Y;if(this._kind===j){Y=X}else{var Z=this._collection.modelId(X.attributes);if(this._kind===p){Y=Z}else{Y=[Z,X]}}return{value:Y,done:false}}this._collection=void 0}return{value:void 0,done:true}};var S=I.View=function(X){this.cid=W.uniqueId("view");this.preinitialize.apply(this,arguments);W.extend(this,W.pick(X,f));this._ensureElement();this.initialize.apply(this,arguments)};var C=/^(\S+)\s*(.*)$/;var f=["model","collection","el","id","attributes","className","tagName","events"];W.extend(S.prototype,U,{tagName:"div",$:function(X){return this.$el.find(X)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){this._removeElement();this.stopListening();return this},_removeElement:function(){this.$el.remove()},setElement:function(X){this.undelegateEvents();this._setElement(X);this.delegateEvents();return this},_setElement:function(X){this.$el=X instanceof I.$?X:I.$(X);this.el=this.$el[0]},delegateEvents:function(Z){Z||(Z=W.result(this,"events"));if(!Z){return this}this.undelegateEvents();for(var Y in Z){var aa=Z[Y];if(!W.isFunction(aa)){aa=this[aa]}if(!aa){continue}var X=Y.match(C);this.delegate(X[1],X[2],aa.bind(this))}return this},delegate:function(Y,X,Z){this.$el.on(Y+".delegateEvents"+this.cid,X,Z);return this},undelegateEvents:function(){if(this.$el){this.$el.off(".delegateEvents"+this.cid)}return this},undelegate:function(Y,X,Z){this.$el.off(Y+".delegateEvents"+this.cid,X,Z);return this},_createElement:function(X){return document.createElement(X)},_ensureElement:function(){if(!this.el){var X=W.extend({},W.result(this,"attributes"));if(this.id){X.id=W.result(this,"id")}if(this.className){X["class"]=W.result(this,"className")}this.setElement(this._createElement(W.result(this,"tagName")));this._setAttributes(X)}else{this.setElement(W.result(this,"el"))}},_setAttributes:function(X){this.$el.attr(X)}});var N=function(Z,Y,aa,X){switch(Y){case 1:return function(){return Z[aa](this[X])};case 2:return function(ab){return Z[aa](this[X],ab)};case 3:return function(ac,ab){return Z[aa](this[X],K(ac,this),ab)};case 4:return function(ac,ad,ab){return Z[aa](this[X],K(ac,this),ad,ab)};default:return function(){var ab=r.call(arguments);ab.unshift(this[X]);return Z[aa].apply(Z,ab)}}};var w=function(Y,aa,X,Z){W.each(X,function(ab,ac){if(aa[ac]){Y.prototype[ac]=N(aa,ab,ac,Z)}})};var K=function(Y,X){if(W.isFunction(Y)){return Y}if(W.isObject(Y)&&!X._isModel(Y)){return u(Y)}if(W.isString(Y)){return function(Z){return Z.get(Y)}}return Y};var u=function(X){var Y=W.matches(X);return function(Z){return Y(Z.attributes)}};var F={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};var a={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};W.each([[c,F,"models"],[O,a,"attributes"]],function(Y){var Z=Y[0],X=Y[1],aa=Y[2];Z.mixin=function(ab){var ac=W.reduce(W.functions(ab),function(ad,ae){ad[ae]=0;return ad},{});w(Z,ab,ac,aa)};w(Z,W,X,aa)});I.sync=function(ae,Z,Y){var ab=m[ae];W.defaults(Y||(Y={}),{emulateHTTP:I.emulateHTTP,emulateJSON:I.emulateJSON});var ad={type:ab,dataType:"json"};if(!Y.url){ad.url=W.result(Z,"url")||x()}if(Y.data==null&&Z&&(ae==="create"||ae==="update"||ae==="patch")){ad.contentType="application/json";ad.data=JSON.stringify(Y.attrs||Z.toJSON(Y))}if(Y.emulateJSON){ad.contentType="application/x-www-form-urlencoded";ad.data=ad.data?{model:ad.data}:{}}if(Y.emulateHTTP&&(ab==="PUT"||ab==="DELETE"||ab==="PATCH")){ad.type="POST";if(Y.emulateJSON){ad.data._method=ab}var aa=Y.beforeSend;Y.beforeSend=function(af){af.setRequestHeader("X-HTTP-Method-Override",ab);if(aa){return aa.apply(this,arguments)}}}if(ad.type!=="GET"&&!Y.emulateJSON){ad.processData=false}var X=Y.error;Y.error=function(ag,ah,af){Y.textStatus=ah;Y.errorThrown=af;if(X){X.call(Y.context,ag,ah,af)}};var ac=Y.xhr=I.ajax(W.extend(ad,Y));Z.trigger("request",Z,ac,Y);return ac};var m={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};I.ajax=function(){return I.$.ajax.apply(I.$,arguments)};var t=I.Router=function(X){X||(X={});this.preinitialize.apply(this,arguments);if(X.routes){this.routes=X.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var v=/\((.*?)\)/g;var y=/(\(\?)?:\w+/g;var e=/\*\w+/g;var i=/[\-{}\[\]+?.,\\\^$|#\s]/g;W.extend(t.prototype,U,{preinitialize:function(){},initialize:function(){},route:function(Y,Z,aa){if(!W.isRegExp(Y)){Y=this._routeToRegExp(Y)}if(W.isFunction(Z)){aa=Z;Z=""}if(!aa){aa=this[Z]}var X=this;I.history.route(Y,function(ac){var ab=X._extractParameters(Y,ac);if(X.execute(aa,ab,Z)!==false){X.trigger.apply(X,["route:"+Z].concat(ab));X.trigger("route",Z,ab);I.history.trigger("route",X,Z,ab)}});return this},execute:function(Z,Y,X){if(Z){Z.apply(this,Y)}},navigate:function(Y,X){I.history.navigate(Y,X);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=W.result(this,"routes");var Y,X=W.keys(this.routes);while((Y=X.pop())!=null){this.route(Y,this.routes[Y])}},_routeToRegExp:function(X){X=X.replace(i,"\\$&").replace(v,"(?:$1)?").replace(y,function(Z,Y){return Y?Z:"([^/?]+)"}).replace(e,"([^?]*?)");return new RegExp("^"+X+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(X,Y){var Z=X.exec(Y).slice(1);return W.map(Z,function(ab,aa){if(aa===Z.length-1){return ab||null}return ab?decodeURIComponent(ab):null})}});var k=I.History=function(){this.handlers=[];this.checkUrl=this.checkUrl.bind(this);if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var J=/^[#\/]|\s+$/g;var g=/^\/+|\/+$/g;var P=/#.*$/;k.started=false;W.extend(k.prototype,U,{interval:50,atRoot:function(){var X=this.location.pathname.replace(/[^\/]$/,"$&/");return X===this.root&&!this.getSearch()},matchRoot:function(){var Y=this.decodeFragment(this.location.pathname);var X=Y.slice(0,this.root.length-1)+"/";return X===this.root},decodeFragment:function(X){return decodeURI(X.replace(/%25/g,"%2525"))},getSearch:function(){var X=this.location.href.replace(/#.*/,"").match(/\?.+/);return X?X[0]:""},getHash:function(Y){var X=(Y||this).location.href.match(/#(.*)$/);return X?X[1]:""},getPath:function(){var X=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return X.charAt(0)==="/"?X.slice(1):X},getFragment:function(X){if(X==null){if(this._usePushState||!this._wantsHashChange){X=this.getPath()}else{X=this.getHash()}}return X.replace(J,"")},start:function(Y){if(k.started){throw new Error("Backbone.history has already been started")}k.started=true;this.options=W.extend({root:"/"},this.options,Y);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._hasHashChange="onhashchange" in window&&(document.documentMode===void 0||document.documentMode>7);this._useHashChange=this._wantsHashChange&&this._hasHashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.history&&this.history.pushState);this._usePushState=this._wantsPushState&&this._hasPushState;this.fragment=this.getFragment();this.root=("/"+this.root+"/").replace(g,"/");if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var aa=this.root.slice(0,-1)||"/";this.location.replace(aa+"#"+this.getPath());return true}else{if(this._hasPushState&&this.atRoot()){this.navigate(this.getHash(),{replace:true})}}}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe");this.iframe.src="javascript:0";this.iframe.style.display="none";this.iframe.tabIndex=-1;var X=document.body;var Z=X.insertBefore(this.iframe,X.firstChild).contentWindow;Z.document.open();Z.document.close();Z.location.hash="#"+this.fragment}var ab=window.addEventListener||function(ac,ad){return attachEvent("on"+ac,ad)};if(this._usePushState){ab("popstate",this.checkUrl,false)}else{if(this._useHashChange&&!this.iframe){ab("hashchange",this.checkUrl,false)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}if(!this.options.silent){return this.loadUrl()}},stop:function(){var X=window.removeEventListener||function(Y,Z){return detachEvent("on"+Y,Z)};if(this._usePushState){X("popstate",this.checkUrl,false)}else{if(this._useHashChange&&!this.iframe){X("hashchange",this.checkUrl,false)}}if(this.iframe){document.body.removeChild(this.iframe);this.iframe=null}if(this._checkUrlInterval){clearInterval(this._checkUrlInterval)}k.started=false},route:function(X,Y){this.handlers.unshift({route:X,callback:Y})},checkUrl:function(Y){var X=this.getFragment();if(X===this.fragment&&this.iframe){X=this.getHash(this.iframe.contentWindow)}if(X===this.fragment){return false}if(this.iframe){this.navigate(X)}this.loadUrl()},loadUrl:function(X){if(!this.matchRoot()){return false}X=this.fragment=this.getFragment(X);return W.some(this.handlers,function(Y){if(Y.route.test(X)){Y.callback(X);return true}})},navigate:function(Z,Y){if(!k.started){return false}if(!Y||Y===true){Y={trigger:!!Y}}Z=this.getFragment(Z||"");var ab=this.root;if(Z===""||Z.charAt(0)==="?"){ab=ab.slice(0,-1)||"/"}var X=ab+Z;Z=Z.replace(P,"");var ac=this.decodeFragment(Z);if(this.fragment===ac){return}this.fragment=ac;if(this._usePushState){this.history[Y.replace?"replaceState":"pushState"]({},document.title,X)}else{if(this._wantsHashChange){this._updateHash(this.location,Z,Y.replace);if(this.iframe&&Z!==this.getHash(this.iframe.contentWindow)){var aa=this.iframe.contentWindow;if(!Y.replace){aa.document.open();aa.document.close()}this._updateHash(aa.location,Z,Y.replace)}}else{return this.location.assign(X)}}if(Y.trigger){return this.loadUrl(Z)}},_updateHash:function(X,Z,aa){if(aa){var Y=X.href.replace(/(javascript:|#).*$/,"");X.replace(Y+"#"+Z)}else{X.hash="#"+Z}}});I.history=new k;var n=function(X,Z){var Y=this;var aa;if(X&&W.has(X,"constructor")){aa=X.constructor}else{aa=function(){return Y.apply(this,arguments)}}W.extend(aa,Y,Z);aa.prototype=W.create(Y.prototype,X);aa.prototype.constructor=aa;aa.__super__=Y.prototype;return aa};O.extend=c.extend=t.extend=S.extend=k.extend=n;var x=function(){throw new Error('A "url" property or function must be specified')};var T=function(Z,Y){var X=Y.error;Y.error=function(aa){if(X){X.call(Y.context,Z,aa,Y)}Z.trigger("error",Z,aa,Y)}};return I});