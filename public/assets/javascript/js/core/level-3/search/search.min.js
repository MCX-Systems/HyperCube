(function(a){a.expr[":"].containsi=function(c,d,b){return jQuery(c).text().toUpperCase().indexOf(b[3].toUpperCase())>=0};a.extend(a,{search:function(c,b){if((typeof c)==="string"||c.tagName){c=a(c)}else{if(!c.jquery){c=false}}if(!c||!c.length){b&&b.debug&&window.console&&console.warn("nothing selected, can't search, returning nothing");return}var d=a.data(c,"searcher");if(!d){d=new a.searcher(b,c);a.data(c,"searcher",d)}if(d.settings.createOnly===false){d.nextConcurrence()}return d}});a.extend(a.fn,{search:function(b){return a.search(this,b)}});a.searcher=function(c,b){this.settings=a.extend(true,{},a.searcher.defaults,c);this.currentContainer=b;this.currentPosition=this.settings.position;this.settings.onCreate.apply(this)};a.extend(a.searcher,{defaults:{debug:false,createOnly:true,caseSensitive:false,searchSelector:"",position:-1,searchOrder:"down",searchType:"highlight",text:null,replaceBy:"",scrollTo:false,onCreate:function(){},beforeSearch:function(){},afterSearch:function(b){}},prototype:{reset:function(){this.currentPosition=-1},getText:function(){return this.settings.text},setText:function(b){this.settings.text=b;this.reset()},getPosition:function(){return this.settings.position},setPosition:function(b){if(b>=this.getConcurrencesNumber()){b=-1}this.settings.position=b},getSearchOrder:function(){return this.settings.searchOrder==="up"||this.settings.searchOrder===true?"up":"down"},setSearchOrder:function(b){this.settings.position=b==="up"?"up":"down"},getSearchType:function(){return this.settings.searchType},setSearchType:function(b){this.settings.searchType=b==="replace"?"replace":(b==="highlightSelected"?"highlightSelected":"highlight")},getConcurrencesNumber:function(){if(!this.settings.text){this._debug("Empty string so nothing found");return}var b=this._escape(this.settings.text);return this._filter(b).length},nextConcurrence:function(c){var d=this.getConcurrencesNumber();if(d==0){this._debug("Nothing has been found");return}var b=this.currentPosition;var e=this._getProperty("searchOrder",c);if(d!=1){if(e===true||e==="up"){b=b<=0?d-1:b-1}else{b=b==d-1?0:b+1}}this.findConcurrence(b,this.settings.searchType)},findConcurrence:function(b,c){this.settings.beforeSearch.apply(this);if(!this.settings.text){this._debug("Text shouldn't be empty");return}b=this._getProperty("startPosition",b);c=this._getProperty("searchType",c);var e=this._escape(this.settings.text);var d=this._filter(e).eq(b);if(c==="replace"){this._replace(d)}else{if(c==="highlightSelected"&&a.fn.textSelect){this._highlightSelected(d)}else{this._highlightAll(d)}}this.currentPosition=b;if(this.settings.scrollTo&&a.fn.scrollTo){this.currentContainer.scrollTo(d.parent())}this.settings.afterSearch.apply(this,a.makeArray(d))},_filter:function(b){if(this.settings.searchSelector){var c=this.currentContainer.find(this.settings.searchSelector)}else{var c=this.currentContainer}var d=this.settings.caseSensitive?"contains":"containsi";return c.contents(":"+d+"('"+b+"')")},_highlightSelected:function(e){var b=e.text();var c=this.settings.text;if(!this.settings.caseSensitive){b=b.toUpperCase();c=c.toUpperCase()}var d=b.indexOf(c);var f=d+c.length;a.textSelect("setRange",{start:d,startElement:e.parent(),end:f,endElement:e.parent()})},_highlightAll:function(b){if(a.fn.textSelect){b.parent().textSelect("select")}else{this._highlightAllInternal(b)}},_highlightAllInternal:function(d){var e=d.parent()[0];if(a.browser.msie){var b=document.body.createTextRange();b.moveToElementText(e);b.select()}else{if(a.browser.mozilla||a.browser.opera){var c=window.getSelection();var b=document.createRange();b.selectNodeContents(e);c.removeAllRanges();c.addRange(b)}else{if(a.browser.safari){var c=window.getSelection();c.setBaseAndExtent(e,0,e,1)}}}},_replace:function(c){var b=c.text().replace(this.settings.text,this.settings.replaceBy);c.parent().text(b)},_getProperty:function(c,b){return b==null||typeof b==="undefined"?this.settings[c]:b},_escape:function(b){return b.replace(/([#;&,\.\+\*\~':"\!\^$\[\]\(\)=>\|])/g,"\\$1")},_debug:function(b){this.settings.debug&&window.console&&console.debug(b)}}})})(jQuery);