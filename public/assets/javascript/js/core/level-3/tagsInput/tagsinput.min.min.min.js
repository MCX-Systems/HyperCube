(function(c){var b={tagClass:function(j){return"badge badge-primary"},itemValue:function(j){return j?j.toString():j},itemText:function(j){return this.itemValue(j)},itemTitle:function(j){return null},freeInput:true,addOnBlur:true,maxTags:undefined,maxChars:undefined,confirmKeys:[13,44],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:true,onTagExists:function(k,j){j.hide().fadeIn()},trimValue:false,allowDuplicates:false};function g(k,j){this.itemsArray=[];this.$element=c(k);this.$element.hide();this.isSelect=(k.tagName==="SELECT");this.multiple=(this.isSelect&&k.hasAttribute("multiple"));this.objectItems=j&&j.itemValue;this.placeholderText=k.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=c('<div class="bootstrap-tagsinput"></div>');this.$input=c('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container);this.$element.before(this.$container);this.build(j)}g.prototype={constructor:g,add:function(k,x,u){var l=this;if(l.options.maxTags&&l.itemsArray.length>=l.options.maxTags){return}if(k!==false&&!k){return}if(typeof k==="string"&&l.options.trimValue){k=c.trim(k)}if(typeof k==="object"&&!l.objectItems){throw ("Can't add objects when itemValue option is not set")}if(k.toString().match(/^\s*$/)){return}if(l.isSelect&&!l.multiple&&l.itemsArray.length>0){l.remove(l.itemsArray[0])}if(typeof k==="string"&&this.$element[0].tagName==="INPUT"){var o=(l.options.delimiterRegex)?l.options.delimiterRegex:l.options.delimiter;var y=k.split(o);if(y.length>1){for(var v=0;v<y.length;v++){this.add(y[v],true)}if(!x){l.pushVal()}return}}var r=l.options.itemValue(k),j=l.options.itemText(k),t=l.options.tagClass(k),q=l.options.itemTitle(k);var p=c.grep(l.itemsArray,function(z){return l.options.itemValue(z)===r})[0];if(p&&!l.options.allowDuplicates){if(l.options.onTagExists){var s=c(".tag",l.$container).filter(function(){return c(this).data("item")===p});l.options.onTagExists(k,s)}return}if(l.items().toString().length+k.length+1>l.options.maxInputLength){return}var m=c.Event("beforeItemAdd",{item:k,cancel:false,options:u});l.$element.trigger(m);if(m.cancel){return}l.itemsArray.push(k);var w=c('<span class="tag '+f(t)+(q!==null?('" title="'+q):"")+'">'+f(j)+'<span data-role="remove"></span></span>');w.data("item",k);l.findInputWrapper().before(w);w.after(" ");if(l.isSelect&&!c('option[value="'+encodeURIComponent(r)+'"]',l.$element)[0]){var n=c("<option selected>"+f(j)+"</option>");n.data("item",k);n.attr("value",r);l.$element.append(n)}if(!x){l.pushVal()}if(l.options.maxTags===l.itemsArray.length||l.items().toString().length===l.options.maxInputLength){l.$container.addClass("bootstrap-tagsinput-max")}l.$element.trigger(c.Event("itemAdded",{item:k,options:u}))},remove:function(j,k,n){var m=this;if(m.objectItems){if(typeof j==="object"){j=c.grep(m.itemsArray,function(o){return m.options.itemValue(o)==m.options.itemValue(j)})}else{j=c.grep(m.itemsArray,function(o){return m.options.itemValue(o)==j})}j=j[j.length-1]}if(j){var l=c.Event("beforeItemRemove",{item:j,cancel:false,options:n});m.$element.trigger(l);if(l.cancel){return}c(".tag",m.$container).filter(function(){return c(this).data("item")===j}).remove();c("option",m.$element).filter(function(){return c(this).data("item")===j}).remove();if(c.inArray(j,m.itemsArray)!==-1){m.itemsArray.splice(c.inArray(j,m.itemsArray),1)}}if(!k){m.pushVal()}if(m.options.maxTags>m.itemsArray.length){m.$container.removeClass("bootstrap-tagsinput-max")}m.$element.trigger(c.Event("itemRemoved",{item:j,options:n}))},removeAll:function(){var j=this;c(".tag",j.$container).remove();c("option",j.$element).remove();while(j.itemsArray.length>0){j.itemsArray.pop()}j.pushVal()},refresh:function(){var j=this;c(".tag",j.$container).each(function(){var p=c(this),l=p.data("item"),m=j.options.itemValue(l),o=j.options.itemText(l),n=j.options.tagClass(l);p.attr("class",null);p.addClass("tag "+f(n));p.contents().filter(function(){return this.nodeType==3})[0].nodeValue=f(o);if(j.isSelect){var k=c("option",j.$element).filter(function(){return c(this).data("item")===l});k.attr("value",m)}})},items:function(){return this.itemsArray},pushVal:function(){var j=this,k=c.map(j.items(),function(l){return j.options.itemValue(l).toString()});j.$element.val(k,true).trigger("change")},build:function(o){var n=this;n.options=c.extend({},b,o);if(n.objectItems){n.options.freeInput=false}a(n.options,"itemValue");a(n.options,"itemText");h(n.options,"tagClass");if(n.options.typeahead){var l=n.options.typeahead||{};h(l,"source");n.$input.typeahead(c.extend({},l,{source:function(r,t){function p(w){var u=[];for(var x=0;x<w.length;x++){var v=n.options.itemText(w[x]);s[v]=w[x];u.push(v)}t(u)}this.map={};var s=this.map,q=l.source(r);if(c.isFunction(q.success)){q.success(p)}else{if(c.isFunction(q.then)){q.then(p)}else{c.when(q).then(p)}}},updater:function(p){n.add(this.map[p]);return this.map[p]},matcher:function(p){return(p.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1)},sorter:function(p){return p.sort()},highlighter:function(q){var p=new RegExp("("+this.query+")","gi");return q.replace(p,"<strong>$1</strong>")}}))}if(n.options.typeaheadjs){var k=null;var m={};var j=n.options.typeaheadjs;if(c.isArray(j)){k=j[0];m=j[1]}else{m=j}n.$input.typeahead(k,m).on("typeahead:selected",c.proxy(function(q,p){if(m.valueKey){n.add(p[m.valueKey])}else{n.add(p)}n.$input.typeahead("val","")},n))}n.$container.on("click",c.proxy(function(p){if(!n.$element.attr("disabled")){n.$input.removeAttr("disabled")}n.$input.focus()},n));if(n.options.addOnBlur&&n.options.freeInput){n.$input.on("focusout",c.proxy(function(p){if(c(".typeahead, .twitter-typeahead",n.$container).length===0){n.add(n.$input.val());n.$input.val("")}},n))}n.$container.on("keydown","input",c.proxy(function(t){var y=c(t.target),p=n.findInputWrapper();if(n.$element.attr("disabled")){n.$input.attr("disabled","disabled");return}switch(t.which){case 8:if(e(y[0])===0){var u=p.prev();if(u.length){n.remove(u.data("item"))}}break;case 46:if(e(y[0])===0){var v=p.next();if(v.length){n.remove(v.data("item"))}}break;case 37:var q=p.prev();if(y.val().length===0&&q[0]){q.before(p);y.focus()}break;case 39:var x=p.next();if(y.val().length===0&&x[0]){x.after(p);y.focus()}break;default:}var w=y.val().length,r=Math.ceil(w/5),s=w+r+1;y.attr("size",Math.max(this.inputSize,y.val().length))},n));n.$container.on("keypress","input",c.proxy(function(r){var t=c(r.target);if(n.$element.attr("disabled")){n.$input.attr("disabled","disabled");return}var s=t.val(),q=n.options.maxChars&&s.length>=n.options.maxChars;if(n.options.freeInput&&(d(r,n.options.confirmKeys)||q)){if(s.length!==0){n.add(q?s.substr(0,n.options.maxChars):s);t.val("")}if(n.options.cancelConfirmKeysOnEmpty===false){r.preventDefault()}}var p=t.val().length,v=Math.ceil(p/5),u=p+v+1;t.attr("size",Math.max(this.inputSize,t.val().length))},n));n.$container.on("click","[data-role=remove]",c.proxy(function(p){if(n.$element.attr("disabled")){return}n.remove(c(p.target).closest(".tag").data("item"))},n));if(n.options.itemValue===b.itemValue){if(n.$element[0].tagName==="INPUT"){n.add(n.$element.val())}else{c("option",n.$element).each(function(){n.add(c(this).attr("value"),true)})}}},destroy:function(){var j=this;j.$container.off("keypress","input");j.$container.off("click","[role=remove]");j.$container.remove();j.$element.removeData("tagsinput");j.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){var k=this.$input[0],j=this.$container[0];while(k&&k.parentNode!==j){k=k.parentNode}return c(k)}};c.fn.tagsinput=function(j,m,l){var k=[];this.each(function(){var o=c(this).data("tagsinput");if(!o){o=new g(this,j);c(this).data("tagsinput",o);k.push(o);if(this.tagName==="SELECT"){c("option",c(this)).attr("selected","selected")}c(this).val(c(this).val())}else{if(!j&&!m){k.push(o)}else{if(o[j]!==undefined){if(o[j].length===3&&l!==undefined){var n=o[j](m,null,l)}else{var n=o[j](m)}if(n!==undefined){k.push(n)}}}}});if(typeof j=="string"){return k.length>1?k:k[0]}else{return k}};c.fn.tagsinput.Constructor=g;function a(j,k){if(typeof j[k]!=="function"){var l=j[k];j[k]=function(m){return m[l]}}}function h(l,j){if(typeof l[j]!=="function"){var k=l[j];l[j]=function(){return k}}}var i=c("<div />");function f(j){if(j){return i.text(j).html()}else{return""}}function e(j){var k=0;if(document.selection){j.focus();var l=document.selection.createRange();l.moveStart("character",-j.value.length);k=l.text.length}else{if(j.selectionStart||j.selectionStart=="0"){k=j.selectionStart}}return(k)}function d(l,k){var j=false;c.each(k,function(n,m){if(typeof(m)==="number"&&l.which===m){j=true;return false}if(l.which===m.which){var p=!m.hasOwnProperty("altKey")||l.altKey===m.altKey,q=!m.hasOwnProperty("shiftKey")||l.shiftKey===m.shiftKey,o=!m.hasOwnProperty("ctrlKey")||l.ctrlKey===m.ctrlKey;if(p&&q&&o){j=true;return false}}});return j}c(function(){c("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);