!function(p){var q,n;var m=function(c){var a=arguments,b=true,d=1;c=c.replace(/%s/g,function(){var e=a[d++];if(typeof e==="undefined"){b=false;return""}return e});return b?c:""};var k=function(b,c){var a={};b.forEach(function(d){var e=c(d);a[e]=a[e]||[];a[e].push(d)});return a};p.extend(p.fn.bootstrapTable.defaults,{groupBy:false,groupByField:""});var r=p.fn.bootstrapTable.Constructor,l=r.prototype.initSort,j=r.prototype.initBody,o=r.prototype.updateSelected;r.prototype.initSort=function(){l.apply(this,Array.prototype.slice.apply(arguments));var b=this;n=[];if((this.options.groupBy)&&(this.options.groupByField!=="")){if((this.options.sortName!=this.options.groupByField)){this.data.sort(function(d,e){return d[b.options.groupByField].localeCompare(e[b.options.groupByField])})}var b=this;var a=k(b.data,function(d){return[d[b.options.groupByField]]});var c=0;p.each(a,function(e,d){n.push({id:c,name:e});d.forEach(function(f){if(!f._data){f._data={}}f._data["parent-index"]=c});c++})}};r.prototype.initBody=function(){q=true;j.apply(this,Array.prototype.slice.apply(arguments));if((this.options.groupBy)&&(this.options.groupByField!=="")){var b=this,c=false,a=0;this.columns.forEach(function(d){if(d.checkbox){c=true}else{if(d.visible){a+=1}}});if(this.options.detailView&&!this.options.cardView){a+=1}n.forEach(function(d){var e=[];e.push(m('<tr class="info groupBy expanded" data-group-index="%s">',d.id));if(b.options.detailView&&!b.options.cardView){e.push('<td class="detail"></td>')}if(c){e.push('<td class="bs-checkbox">','<input name="btSelectGroup" type="checkbox" />',"</td>")}e.push("<td",m(' colspan="%s"',a),">",d.name,"</td>");e.push("</tr>");b.$body.find("tr[data-parent-index="+d.id+"]:first").before(p(e.join("")))});this.$selectGroup=[];this.$body.find('[name="btSelectGroup"]').each(function(){var d=p(this);b.$selectGroup.push({group:d,item:b.$selectItem.filter(function(){return(p(this).closest("tr").data("parent-index")===d.closest("tr").data("group-index"))})})});this.$container.off("click",".groupBy").on("click",".groupBy",function(){p(this).toggleClass("expanded");b.$body.find("tr[data-parent-index="+p(this).closest("tr").data("group-index")+"]").toggleClass("hidden")});this.$container.off("click",'[name="btSelectGroup"]').on("click",'[name="btSelectGroup"]',function(f){f.stopImmediatePropagation();var e=p(this);var d=e.prop("checked");b[d?"checkGroup":"uncheckGroup"](p(this).closest("tr").data("group-index"))})}q=false;this.updateSelected()};r.prototype.updateSelected=function(){if(!q){o.apply(this,Array.prototype.slice.apply(arguments));if((this.options.groupBy)&&(this.options.groupByField!=="")){this.$selectGroup.forEach(function(a){var b=a.item.filter(":enabled").length===a.item.filter(":enabled").filter(":checked").length;a.group.prop("checked",b)})}}};r.prototype.getGroupSelections=function(b){var a=this;return p.grep(this.data,function(c){return(c[a.header.stateField]&&(c._data["parent-index"]===b))})};r.prototype.checkGroup=function(a){this.checkGroup_(a,true)};r.prototype.uncheckGroup=function(a){this.checkGroup_(a,false)};r.prototype.checkGroup_=function(b,d){var c;var a=function(){return(p(this).closest("tr").data("parent-index")===b)};if(!d){c=this.getGroupSelections(b)}this.$selectItem.filter(a).prop("checked",d);this.updateRows();this.updateSelected();if(d){c=this.getGroupSelections(b)}this.trigger(d?"check-all":"uncheck-all",c)}}(jQuery);