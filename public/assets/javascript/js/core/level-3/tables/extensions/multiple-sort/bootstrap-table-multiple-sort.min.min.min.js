(function(b){var d=false;var c=function(g){var f=g.sortModalSelector,k="#"+f;if(!b(k).hasClass("modal")){var h='  <div class="modal fade" id="'+f+'" tabindex="-1" role="dialog" aria-labelledby="'+f+'Label" aria-hidden="true">';h+='         <div class="modal-dialog">';h+='             <div class="modal-content">';h+='                 <div class="modal-header">';h+='                     <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>';h+='                     <h4 class="modal-title" id="'+f+'Label">'+g.options.formatMultipleSort()+"</h4>";h+="                 </div>";h+='                 <div class="modal-body">';h+='                     <div class="bootstrap-table">';h+='                         <div class="fixed-table-toolbar">';h+='                             <div class="bars">';h+='                                 <div id="toolbar">';h+='                                     <button id="add" type="button" class="btn btn-default"><i class="'+g.options.iconsPrefix+" "+g.options.icons.plus+'"></i> '+g.options.formatAddLevel()+"</button>";h+='                                     <button id="delete" type="button" class="btn btn-default" disabled><i class="'+g.options.iconsPrefix+" "+g.options.icons.minus+'"></i> '+g.options.formatDeleteLevel()+"</button>";h+="                                 </div>";h+="                             </div>";h+="                         </div>";h+='                         <div class="fixed-table-container">';h+='                             <table id="multi-sort" class="table">';h+="                                 <thead>";h+="                                     <tr>";h+="                                         <th></th>";h+='                                         <th><div class="th-inner">'+g.options.formatColumn()+"</div></th>";h+='                                         <th><div class="th-inner">'+g.options.formatOrder()+"</div></th>";h+="                                     </tr>";h+="                                 </thead>";h+="                                 <tbody></tbody>";h+="                             </table>";h+="                         </div>";h+="                     </div>";h+="                 </div>";h+='                 <div class="modal-footer">';h+='                     <button type="button" class="btn btn-default" data-dismiss="modal">'+g.options.formatCancel()+"</button>";h+='                     <button type="button" class="btn btn-primary">'+g.options.formatSort()+"</button>";h+="                 </div>";h+="             </div>";h+="         </div>";h+="     </div>";b("body").append(b(h));g.$sortModal=b(k);var i=g.$sortModal.find("tbody > tr");g.$sortModal.off("click","#add").on("click","#add",function(){var m=g.$sortModal.find(".multi-sort-name:first option").length,n=g.$sortModal.find("tbody tr").length;if(n<m){n++;g.addLevel();g.setButtonStates()}});g.$sortModal.off("click","#delete").on("click","#delete",function(){var m=g.$sortModal.find(".multi-sort-name:first option").length,n=g.$sortModal.find("tbody tr").length;if(n>1&&n<=m){n--;g.$sortModal.find("tbody tr:last").remove();g.setButtonStates()}});g.$sortModal.off("click",".btn-primary").on("click",".btn-primary",function(){var m=g.$sortModal.find("tbody > tr"),s=g.$sortModal.find("div.alert"),q=[],r=[];g.options.sortPriority=b.map(m,function(v){var l=b(v),u=l.find(".multi-sort-name").val(),t=l.find(".multi-sort-order").val();q.push(u);return{sortName:u,sortOrder:t}});var o=q.sort();for(var p=0;p<q.length-1;p++){if(o[p+1]==o[p]){r.push(o[p])}}if(r.length>0){if(s.length===0){s='<div class="alert alert-danger" role="alert"><strong>'+g.options.formatDuplicateAlertTitle()+"</strong> "+g.options.formatDuplicateAlertDescription()+"</div>";b(s).insertBefore(g.$sortModal.find(".bars"))}}else{if(s.length===1){b(s).remove()}g.$sortModal.modal("hide");g.options.sortName="";if(g.options.sidePagination==="server"){var n=g.options.queryParams;g.options.queryParams=function(l){l.multiSort=g.options.sortPriority;return n(l)};d=false;g.initServer(g.options.silentSort);return}g.onMultipleSort()}});if(g.options.sortPriority===null||g.options.sortPriority.length===0){if(g.options.sortName){g.options.sortPriority=[{sortName:g.options.sortName,sortOrder:g.options.sortOrder}]}}if(g.options.sortPriority!==null&&g.options.sortPriority.length>0){if(i.length<g.options.sortPriority.length&&typeof g.options.sortPriority==="object"){for(var j=0;j<g.options.sortPriority.length;j++){g.addLevel(j,g.options.sortPriority[j])}}}else{g.addLevel(0)}g.setButtonStates()}};b.fn.bootstrapTable.methods.push("multipleSort");b.extend(b.fn.bootstrapTable.defaults,{showMultiSort:false,showMultiSortButton:true,sortPriority:null,onMultipleSort:function(){return false}});b.extend(b.fn.bootstrapTable.defaults.icons,{sort:"glyphicon-sort",plus:"glyphicon-plus",minus:"glyphicon-minus"});b.extend(b.fn.bootstrapTable.Constructor.EVENTS,{"multiple-sort.bs.table":"onMultipleSort"});b.extend(b.fn.bootstrapTable.locales,{formatMultipleSort:function(){return"Multiple Sort"},formatAddLevel:function(){return"Add Level"},formatDeleteLevel:function(){return"Delete Level"},formatColumn:function(){return"Column"},formatOrder:function(){return"Order"},formatSortBy:function(){return"Sort by"},formatThenBy:function(){return"Then by"},formatSort:function(){return"Sort"},formatCancel:function(){return"Cancel"},formatDuplicateAlertTitle:function(){return"Duplicate(s) detected!"},formatDuplicateAlertDescription:function(){return"Please remove or change any duplicate column."},formatSortOrders:function(){return{asc:"Ascending",desc:"Descending"}}});b.extend(b.fn.bootstrapTable.defaults,b.fn.bootstrapTable.locales);var e=b.fn.bootstrapTable.Constructor,a=e.prototype.initToolbar;e.prototype.initToolbar=function(){this.showToolbar=this.showToolbar||this.options.showMultiSort;var k=this,h="sortModal_"+this.$el.attr("id"),g="#"+h;this.$sortModal=b(g);this.sortModalSelector=h;a.apply(this,Array.prototype.slice.apply(arguments));if(k.options.sidePagination==="server"&&!d&&k.options.sortPriority!==null){var i=k.options.queryParams;k.options.queryParams=function(l){l.multiSort=k.options.sortPriority;return i(l)}}if(this.options.showMultiSort){var f=this.$toolbar.find(">.btn-group").first(),j=this.$toolbar.find("div.multi-sort");if(!j.length&&this.options.showMultiSortButton){j='  <button class="multi-sort btn btn-default'+(this.options.iconSize===undefined?"":" btn-"+this.options.iconSize)+'" type="button" data-toggle="modal" data-target="'+g+'" title="'+this.options.formatMultipleSort()+'">';j+='     <i class="'+this.options.iconsPrefix+" "+this.options.icons.sort+'"></i>';j+="</button>";f.append(j);c(k)}this.$el.on("sort.bs.table",function(){d=true});this.$el.on("multiple-sort.bs.table",function(){d=false});this.$el.on("load-success.bs.table",function(){if(!d&&k.options.sortPriority!==null&&typeof k.options.sortPriority==="object"&&k.options.sidePagination!=="server"){k.onMultipleSort()}});this.$el.on("column-switch.bs.table",function(m,l){for(var n=0;n<k.options.sortPriority.length;n++){if(k.options.sortPriority[n].sortName===l){k.options.sortPriority.splice(n,1)}}k.assignSortableArrows();k.$sortModal.remove();c(k)});this.$el.on("reset-view.bs.table",function(){if(!d&&k.options.sortPriority!==null&&typeof k.options.sortPriority==="object"){k.assignSortableArrows()}})}};e.prototype.multipleSort=function(){var f=this;if(!d&&f.options.sortPriority!==null&&typeof f.options.sortPriority==="object"&&f.options.sidePagination!=="server"){f.onMultipleSort()}};e.prototype.onMultipleSort=function(){var f=this;var h=function(i,j){return i>j?1:i<j?-1:0};var g=function(o,n){var i=[],p=[];for(var j=0;j<f.options.sortPriority.length;j++){var m=f.options.sortPriority[j].sortOrder==="desc"?-1:1,k=o[f.options.sortPriority[j].sortName],l=n[f.options.sortPriority[j].sortName];if(k===undefined||k===null){k=""}if(l===undefined||l===null){l=""}if(b.isNumeric(k)&&b.isNumeric(l)){k=parseFloat(k);l=parseFloat(l)}if(typeof k!=="string"){k=k.toString()}i.push(m*h(k,l));p.push(m*h(l,k))}return h(i,p)};this.data.sort(function(j,i){return g(j,i)});this.initBody();this.assignSortableArrows();this.trigger("multiple-sort")};e.prototype.addLevel=function(i,j){var g=i===0?this.options.formatSortBy():this.options.formatThenBy();this.$sortModal.find("tbody").append(b("<tr>").append(b("<td>").text(g)).append(b("<td>").append(b('<select class="form-control multi-sort-name">'))).append(b("<td>").append(b('<select class="form-control multi-sort-order">'))));var f=this.$sortModal.find(".multi-sort-name").last(),h=this.$sortModal.find(".multi-sort-order").last();b.each(this.columns,function(l,k){if(k.sortable===false||k.visible===false){return true}f.append('<option value="'+k.field+'">'+k.title+"</option>")});b.each(this.options.formatSortOrders(),function(k,l){h.append('<option value="'+k+'">'+l+"</option>")});if(j!==undefined){f.find('option[value="'+j.sortName+'"]').attr("selected",true);h.find('option[value="'+j.sortOrder+'"]').attr("selected",true)}};e.prototype.assignSortableArrows=function(){var i=this,f=i.$header.find("th");for(var h=0;h<f.length;h++){for(var g=0;g<i.options.sortPriority.length;g++){if(b(f[h]).data("field")===i.options.sortPriority[g].sortName){b(f[h]).find(".sortable").removeClass("desc asc").addClass(i.options.sortPriority[g].sortOrder)}}}};e.prototype.setButtonStates=function(){var f=this.$sortModal.find(".multi-sort-name:first option").length,g=this.$sortModal.find("tbody tr").length;if(g==f){this.$sortModal.find("#add").attr("disabled","disabled")}if(g>1){this.$sortModal.find("#delete").removeAttr("disabled")}if(g<f){this.$sortModal.find("#add").removeAttr("disabled")}if(g==1){this.$sortModal.find("#delete").attr("disabled","disabled")}}})(jQuery);