(function(c){var b=function(e,d){this.options=c.extend({},c.fn.letterfx.defaults,d);this.num_completed_fx=0;this.is_done=false;this.monitor_timer=null;this.killswitch=null;this.$element=c(e);if(this.options.restore){this.original_html=this.$element.html()}this.init()};b.prototype.init=function(){this.new_html=this.$element.text().replace(this.options.pattern,this.options.replacement);this.$element.addClass(this.options.css.element.base).addClass(this.options.css.element.before);this.$element.html(this.new_html);this.$letters=this.$element.find(this.options.selector);this.$letters.css("transition-duration",this.options.fx_duration).addClass(this.options.css.letters.base).addClass(this.options.css.letters.before);this.bindLetterFxEnd();this.num_letters=this.$letters.length;this.fx();return this};b.prototype.bindLetterFxEnd=function(){var e=this.options;var d=this;this.$letters.bind("transitionend",function(){e.onLetterComplete(c(this),d.$element,d);d.notifyFXEnd();switch(e.letter_end){case"destroy":c(this).remove();break;case"rewind":d.applyLetterFx(c(this),e.timing,e.css.letters.after,e.css.letters.before);break;case"stay":break;default:c(this).replaceWith(c(this).text())}});return d};b.prototype.terminate=function(){this.is_done=true;this.options.onElementComplete(this.$element,this);clearTimeout(this.killswitch);switch(this.options.element_end){case"destroy":this.$element.remove();break;case"stay":break;default:this.$element.html(this.original_html);this.$element.removeClass(this.options.css.element.base).removeClass(this.options.css.element.after);break}};b.prototype.notifyFXEnd=function(){clearTimeout(this.monitor_timer);this.num_completed_fx++;var d=this;this.monitor_timer=setTimeout(function(){if(d.num_completed_fx%d.num_letters===0){d.terminate()}},Math.max(this.options.timing+10,50));return this};b.prototype.startKillWatch=function(){var e=this.options.fx_duration.match(/\d+s/)?parseInt(this.options.fx_duration):1;var f=Math.ceil(1.5*this.num_letters*this.options.timing*e);var d=this;this.killswitch=window.setTimeout(function(){if(!d.isDone()){d.terminate()}},f)};b.prototype.fx=function(){var e=this;this.startKillWatch();this.$element.removeClass(this.options.css.element.before).addClass(this.options.css.element.after);var f=this.options.sort(this.$letters);var d=this.options;f.each(function(g,h){e.applyLetterFx(c(h),(g+1)*d.timing,d.css.letters.before,d.css.letters.after)});return this};b.prototype.applyLetterFx=function(h,f,e,g){var d=this.options;window.setTimeout(function(){h.removeClass(e).addClass(g)},f);return this};b.prototype.isDone=function(){return this.is_done};var a=function(d){this.config=c.extend({},c.fn.letterfx.defaults,d);this.buildCss(this.config.backwards);if(this.config.words){this.config.pattern=/(\S+)/g}};a.prototype.buildCss=function(g){var d=this.config;var f=g?"after":"before";var h=g?"before":"after";var e={element:{},letters:{}};e.element.base=d.element_class+"-container "+d.fx.replace(/(\S+)/g,d.element_class+"-$1-container");e.element[f]=d.fx.replace(/(\S+)/g,d.element_class+"-$1-before-container");e.element[h]=d.fx.replace(/(\S+)/g,d.element_class+"-$1-after-container");e.letters.base=d.element_class;e.letters[f]=d.fx.replace(/(\S+)/g,d.element_class+"-$1-before");e.letters[h]=d.fx.replace(/(\S+)/g,d.element_class+"-$1-after");this.config=c.extend(d,{css:e})};a.prototype.getConfig=function(){return this.config};a.parse=function(d){return(new a(d)).getConfig()};c.fn.letterfx=function(d){d=a.parse(d);return c(this).each(function(){var e=c(this);if(!e.data("letterfx-obj")||e.data("letterfx-obj").isDone()){e.data("letterfx-obj",new b(e,d))}})};c.fn.letterfx.sort={random:function(g){var f=g.length,e,d;while(0!==f){d=Math.floor(Math.random()*f);f-=1;e=g[f];g[f]=g[d];g[d]=e}return g},reverse:function(d){return d.toArray().reverse()}};c.fn.letterfx.patterns={letters:/(\S)/gi};c.fn.letterfx.defaults={fx:"spin fly-top",pattern:/(\S)/gi,word:false,backwards:false,replacement:"<span>$1</span>",selector:"span",timing:50,fx_duration:"1s",sort:function(d){return d},onLetterComplete:function(f,d,e){},onElementComplete:function(d,e){},letter_end:"restore",element_end:"restore",restore:true,destroy:false,element_class:"letterfx",css:{element:{base:"",before:"",after:""},letters:{base:"",before:"",after:""}}}}(jQuery));