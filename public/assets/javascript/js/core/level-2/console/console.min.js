(function(b){var a=!!~window.navigator.userAgent.indexOf("AppleWebKit/");b.fn.console=function(Q){var G={37:q,39:y,38:aj,40:x,8:aa,46:A,35:j,36:I,13:M,18:H,9:ae};var U={65:I,69:j,68:A,78:x,80:aj,66:q,70:y,75:K,76:r,85:N};if(Q.ctrlCodes){b.extend(U,Q.ctrlCodes)}var k={70:ab,66:J,68:p};var al={13:ad};var h='<span class="console-cursor">&nbsp;</span>';var L=b(this);var F=b('<div class="console-inner"></div>');var X=b('<textarea autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="console-typer"></textarea>');var c;var V;var ak=Q&&Q.continuedPromptLabel?Q.continuedPromptLabel:"> ";var W=0;var n="";var R="";var g="";var P=Q.fadeOnReset!==undefined?Q.fadeOnReset:true;var o=[];var v=0;var S=0;var ai=true;var af=false;var Z={};(function(){Z.promptLabel=Q&&Q.promptLabel?Q.promptLabel:"> ";L.append(F);F.append(X);X.css({position:"absolute",top:0,left:"-9999px"});if(Q.welcomeMessage){l(Q.welcomeMessage,"console-welcome")}z();if(Q.autofocus){F.addClass("console-focus");X.focus();setTimeout(function(){F.addClass("console-focus");X.focus()},100)}Z.inner=F;Z.typer=X;Z.scrollToBottom=ah;Z.report=ac;Z.showCompletion=T;Z.clearScreen=r})();Z.reset=function(){var an=(typeof Q.welcomeMessage!=="undefined");var am=function(){F.find("div").each(function(){if(!an){b(this).remove()}else{an=false}})};if(P){F.parent().fadeOut(function(){am();z();F.parent().fadeIn(m)})}else{am();z();m()}};var m=function(){F.addClass("console-focus");X.focus()};Z.focus=function(){m()};Z.notice=function(aq,ao){var ar=b('<div class="notice"></div>').append(b("<div></div>").text(aq)).css({visibility:"hidden"});L.append(ar);var ap=true;if(ao==="fadeout"){setTimeout(function(){ar.fadeOut(function(){ar.remove()})},4000)}else{if(ao==="prompt"){var am=b('<br/><div class="action"><a href="javascript:">OK</a><div class="clear"></div></div>');ar.append(am);ap=false;am.click(function(){ar.fadeOut(function(){ar.remove();F.css({opacity:1})})})}}var an=ar.height();ar.css({height:"0px",visibility:"visible"}).animate({height:an+"px"},function(){if(!ap){F.css({opacity:0.5})}});ar.css("cursor","default");return ar};function z(){W=0;n="";v=0;i();c=b('<div class="console-prompt-box"></div>');var am=b('<span class="console-prompt-label"></span>');var an=Z.continuedPrompt?ak:Z.promptLabel;c.append(am.text(an).show());am.html(am.html().replace(" ","&nbsp;"));V=b('<span class="console-prompt"></span>');c.append(V);F.append(c);f()}L.click(function(){if(window.getSelection().toString()){return false}F.addClass("console-focus");F.removeClass("console-nofocus");if(a){X.focusWithoutScrolling()}else{X.css("position","fixed").focus()}ah();return false});X.blur(function(){F.removeClass("console-focus");F.addClass("console-nofocus")});X.bind("paste",function(am){X.val("");setTimeout(function(){X.consoleInsert(X.val());X.val("")},0)});X.keydown(function(an){S=0;var am=an.keyCode;if(an.ctrlKey&&am===67){S=am;B();return false}if(ai){if(an.shiftKey&&am in al){S=am;(al[am])();return false}else{if(an.altKey&&am in k){S=am;(k[am])();return false}else{if(an.ctrlKey&&am in U){S=am;(U[am])();return false}else{if(am in G){S=am;(G[am])();return false}}}}}});X.keypress(function(an){var am=an.keyCode||an.which;if(t(an)){return false}if((an.ctrlKey||an.metaKey)&&String.fromCharCode(am).toLowerCase()==="v"){return true}if(ai&&S!==am&&am>=32){if(S){return false}if(typeof Q.charInsertTrigger==="undefined"||(typeof Q.charInsertTrigger==="function"&&Q.charInsertTrigger(am,n))){X.consoleInsert(am)}}if(a){return false}});function t(am){return((am.keyCode===G.tab||am.keyCode===192)&&am.altKey)}function d(an){if(o.length===0){return}v+=an;if(v<0){v=o.length}else{if(v>o.length){v=0}}var am=n;if(v===0){n=R}else{n=o[v-1]}if(Q.historyPreserveColumn){if(n.length<W+1){W=n.length}else{if(W===0){W=n.length}}}else{W=n.length}f()}function aj(){d(-1)}function x(){d(1)}function s(am){o.push(am);R=""}function D(){if(W<n.length){n=n.substring(0,W)+n.substring(W+1);R=n;return true}else{return false}}function aa(){if(O(-1)){D();f()}}function A(){if(D()){f()}}function K(){while(D()){f()}}function N(){Z.promptText("")}function r(){F.children(".console-prompt-box, .console-message").slice(0,-1).remove();Z.report(" ");Z.focus()}function p(){while(W<n.length&&!w(n[W])){D();f()}while(W<n.length&&w(n[W])){D();f()}}function ad(){var an=n.split("\n");var am=an.slice(-1)[0];var ao=am.match(/^(\s*)/g)[0];var ap="\n"+ao;n+=ap;O(ap.length);f()}function M(){var am=n;if(typeof Q.commandValidate==="function"){var an=Q.commandValidate(am);if(an===true||an===false){if(an){e()}}else{E(an,"console-message-error")}}else{e()}}function ah(){var am=jQuery.fn.jquery.split(".");var an=parseInt(am[0]);var ao=parseInt(am[1]);if((an===1&&ao>6)||an>1){F.prop({scrollTop:F.prop("scrollHeight")})}else{F.attr({scrollTop:F.attr("scrollHeight")})}}function B(){if(typeof Q.cancelHandle==="function"){Q.cancelHandle()}}function e(){if(typeof Q.commandHandle==="function"){Y();s(n);var an=n;if(Z.continuedPrompt){if(g){g+="\n"+n}else{g=n}}else{g=undefined}if(g){an=g}var am=Q.commandHandle(an,function(ao){E(ao)});if(Z.continuedPrompt&&!g){g=n}if(typeof am==="boolean"){if(am){E()}else{E("Command failed.","console-message-error")}}else{if(typeof am==="string"){E(am,"console-message-success")}else{if(typeof am==="object"&&am.length){E(am)}else{if(Z.continuedPrompt){E()}}}}}}function Y(){ai=false}function i(){ai=true}function E(ap,ao){W=-1;f();if(typeof ap==="string"){l(ap,ao)}else{if(b.isArray(ap)){for(var am in ap){var an=ap[am];l(an.msg,an.className)}}else{F.append(ap)}}z()}function ac(ao,am){var an=n;c.remove();E(ao,am);Z.promptText(an)}function l(ao,an){var am=b('<div class="console-message"></div>');if(an){am.addClass(an)}am.filledText(ao).hide();F.append(am);am.show()}X.consoleInsert=function(an){var ap=(typeof an==="number")?String.fromCharCode(an):an;var am=n.substring(0,W);var ao=n.substring(W);n=am+ap+ao;O(ap.length);R=n;f()};function O(am){if(W+am>=0&&W+am<=n.length){W+=am;return true}else{return false}}function y(){if(O(1)){f();return true}return false}function q(){if(O(-1)){f();return true}return false}function I(){if(O(-W)){f()}}function j(){if(O(n.length-W)){f()}}function ab(){while(W<n.length&&!w(n[W])&&y()){}while(W<n.length&&w(n[W])&&y()){}}function J(){while(W-1>=0&&!w(n[W-1])&&q()){}while(W-1>=0&&w(n[W-1])&&q()){}}function w(an){if(typeof an==="string"){var am=an.charCodeAt();return(am>="A".charCodeAt()&&am<="Z".charCodeAt())||(am>="a".charCodeAt()&&am<="z".charCodeAt())||(am>="0".charCodeAt()&&am<="9".charCodeAt())}return false}function ae(){if(typeof Q.completeHandle==="function"){C()}else{ag()}}function C(){if(typeof Q.completeHandle==="function"){var aw=Q.completeHandle(n);var au=aw.length;if(au===1){Z.promptText(n+aw[0])}else{if(au>1&&Q.cols){var am=n;var av=0;for(var at=0;at<au;at++){av=Math.max(av,aw[at].length)}av+=2;var an=Math.floor(Q.cols/av);var ar="";var ao=0;for(at=0;at<au;at++){var ap=aw[at];ar+=aw[at];for(var aq=ap.length;aq<av;aq++){ar+=" "}if(++ao>=an){ar+="\n";ao=0}}E(ar,"console-message-value");Z.promptText(am)}}}}function ag(){if(typeof Q.completeIssuer==="function"){Q.completeIssuer(n)}}function T(am,ax){var av=ax.length;if(av===1){Z.promptText(am+ax[0])}else{if(av>1&&Q.cols){var an=am;var aw=0;for(var au=0;au<av;au++){aw=Math.max(aw,ax[au].length)}aw+=2;var ap=Math.floor(Q.cols/aw);var at="";var ao=0;for(au=0;au<av;au++){var aq=ax[au];at+=ax[au];for(var ar=aq.length;ar<aw;ar++){at+=" "}if(++ao>=ap){at+="\n";ao=0}}E(at,"console-message-value");Z.promptText(an)}}}function H(){}Z.promptText=function(am){if(typeof am==="string"){n=am;W=n.length;f()}return n};function f(){var am=n;var an="";if(W>0&&am===""){an=h}else{if(W===n.length){an=u(am)+h}else{var ao=am.substring(0,W);var ap=am.substring(W,W+1);if(ap){ap='<span class="console-cursor">'+u(ap)+"</span>"}var aq=am.substring(W+1);an=u(ao)+ap+u(aq)}}V.html(an);ah()}function u(am){return(am.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/</g,"&lt;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br />"))}return Z};b.fn.filledText=function(c){b(this).text(c);b(this).html(b(this).html().replace(/\t/g,"&nbsp;&nbsp;").replace(/\n/g,"<br/>"));return this};b.fn.focusWithoutScrolling=function(){var c=window.scrollX,d=window.scrollY;b(this).focus();window.scrollTo(c,d)}})(jQuery);