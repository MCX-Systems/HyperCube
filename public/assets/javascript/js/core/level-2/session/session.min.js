/*! jQuery Session Timeout - v0.1.0 - 2012-06-30
* https://github.com/asabaylus/jQuery-sessionTimeout
* Copyright (c) 2012 Asa Baylus; Licensed MIT, GPL */
(function(e){var d,b,a,j={},i=[],c=new Date(),g="sessionTimeout_"+c.getTime(),f="0.0.1",l,k,h;e.fn.sessionTimeout=function(m,o){d={autoping:true,timeout:3600000,resource:"https://hypercube.si/assets/favicon/favicon.ico",promptfor:600000,beforetimeout:e.noop,ontimeout:e.noop};b={_init:function(){window.clearInterval(k);k=window.setInterval(function(){if(m.autoping===false){if(e.isFunction(m.ontimeout)){m.ontimeout.call(this);window.clearInterval(k);var p=new Date();n("$.fn.sessionTimeout status: session expired @"+p.toTimeString());e(document).trigger("expired.sessionTimeout")}else{e.error("The jQuery.sessionTimeout ontimeout parameter is expecting a function")}}else{b.ping.apply(this,arguments)}},m.timeout);if(!m.autoping){h=window.setTimeout(function(){var p=new Date();n("$.fn.sessionTimeout status: beforeTimeout triggered @"+p.toTimeString());if(e.isFunction(m.beforetimeout)){m.beforetimeout.call(this)}else{e.error("The jQuery.sessionTimeout beforetimeout parameter is expecting a function")}e(document).trigger("prompt.sessionTimeout")},m.timeout-m.promptfor)}l=new Date();n("$.fn.sessionTimeout status: initialized");e(document).trigger("create.sessionTimeout",[f,c,(l-c)])},ping:function(){var q=new Date(),p=q.getTime();if(typeof k==="undefined"){e.error('Initialize $.fn.sessionTimeout before invoking method "ping".');return}b._fetch.apply();n("$.fn.sessionTimeout status: session restarted @ "+q.toTimeString());e(document).trigger("ping.sessionTimeout")},_fetch:function(){var t=new Date(),p=t.getTime(),q=/^(.+)\.([^\.]*)?$/,s=/^jpg|jpeg|png|gif|bmp$/,r=m.resource.match(q),v=r[2],u=s.test(v);if(!e("#"+g).length){if(u){e("body").append("<img id='"+g+"' src='"+m.resource+"?tstamp="+p+'\' style=\'position: "absolute", height: "1px", width: "1px"\' alt=\'web page session management helper\'>')}else{e("body").append("<iframe id='"+g+"' src='"+m.resource+"?tstamp="+p+'\' style=\'position: "absolute", height: "1px", width: "1px", display: "none"\' alt=\'web page session management helper\'></iframe>')}}else{e("#"+g).attr("src",m.resource+"?timestamp="+p)}},_beforeTimeout:function(){if(e.isFunction(m.beforetimeout)){h=window.setTimeout(function(){var p=new Date();n("$.fn.sessionTimeout status: beforeTimeout triggered @"+p.toTimeString());m.beforetimeout.call(this);e(document).trigger("prompt.sessionTimeout")},m.timeout-m.promptfor)}else{e.error("The jQuery.sessionTimeout beforetimeout parameter is expecting a function")}},duration:function(){n("$.fn.sessionTimeout status: duration "+m.timeout);return m.timeout},elapsed:function(){var p=new Date()-l;n("$.fn.sessionTimeout status: elapsed "+p+" ms");return p},remaining:function(){var r=new Date(),q=new Date(l.getTime()+m.timeout),p=(q-r)>0?q-r:0;n("$.fn.sessionTimeout status: remaining "+p+" ms");return p},destroy:function(){if(typeof l!=="undefined"){e("#"+g).remove();window.clearInterval(k);window.clearTimeout(h);l=undefined;n("$.fn.sessionTimeout status: destroy");e(document).trigger("destroy.sessionTimeout");e(document).unbind("sessionTimeout");i.length=0}else{e.error("Could not destroy, initialize the plugin before calling destroy.")}},printLog:function(){return i}};if(b[m]){o=m}e.extend(j,m);m=e.extend(d,j);if(b[o]){return b[o].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof o==="object"||!o){return b._init.apply(this,arguments)}else{e.error("Method "+o+" does not exist on jQuery.sessionTimeout")}}function n(p){i.push(p);e(document).trigger("eventLogged.sessionTimeout")}return b[o].apply(this,Array.prototype.slice.call(arguments,1))}}(jQuery));