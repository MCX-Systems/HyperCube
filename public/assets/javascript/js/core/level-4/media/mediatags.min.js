(function(b){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=b()}else{if(typeof define==="function"&&define.amd){define([],b)}else{var a;if(typeof window!=="undefined"){a=window}else{if(typeof global!=="undefined"){a=global}else{if(typeof self!=="undefined"){a=self}else{a=this}}}a.jsmediatags=b()}}})(function(){var d,b,a;return(function c(f,k,h){function g(q,n){if(!k[q]){if(!f[q]){var m=typeof require=="function"&&require;if(!n&&m){return m(q,!0)}if(e){return e(q,!0)}var p=new Error("Cannot find module '"+q+"'");throw p.code="MODULE_NOT_FOUND",p}var i=k[q]={exports:{}};f[q][0].call(i.exports,function(l){var o=f[q][1][l];return g(o?o:l)},i,i.exports,c,f,k,h)}return k[q].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(f,g,e){},{}],2:[function(f,g,e){g.exports=XMLHttpRequest},{}],3:[function(f,e,i){var g=function(){function n(r,p){for(var o=0;o<p.length;o++){var q=p[o];q.enumerable=q.enumerable||false;q.configurable=true;if("value" in q){q.writable=true}Object.defineProperty(r,q.key,q)}}return function(q,o,p){if(o){n(q.prototype,o)}if(p){n(q,p)}return q}}();function j(n,o){if(!(n instanceof o)){throw new TypeError("Cannot call a class as a function")}}function l(n,o){if(!n){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return o&&(typeof o==="object"||typeof o==="function")?o:n}function m(o,n){if(typeof n!=="function"&&n!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof n)}o.prototype=Object.create(n&&n.prototype,{constructor:{value:o,enumerable:false,writable:true,configurable:true}});if(n){Object.setPrototypeOf?Object.setPrototypeOf(o,n):o.__proto__=n}}var k=f("./MediaFileReader");var h=function(p){m(o,p);function o(u){j(this,o);var t=l(this,Object.getPrototypeOf(o).call(this));t._array=u;t._size=u.length;t._isInitialized=true;return t}g(o,[{key:"init",value:function r(t){setTimeout(t.onSuccess,0)}},{key:"loadRange",value:function n(t,u){setTimeout(u.onSuccess,0)}},{key:"getByteAt",value:function s(t){if(t>=this._array.length){throw new Error("Offset "+t+" hasn't been loaded yet.")}return this._array[t]}}],[{key:"canReadFile",value:function q(t){return Array.isArray(t)||typeof Buffer==="function"&&Buffer.isBuffer(t)}}]);return o}(k);e.exports=h},{"./MediaFileReader":11}],4:[function(g,e,j){var h=function(){function o(s,q){for(var p=0;p<q.length;p++){var r=q[p];r.enumerable=r.enumerable||false;r.configurable=true;if("value" in r){r.writable=true}Object.defineProperty(s,r.key,r)}}return function(r,p,q){if(p){o(r.prototype,p)}if(q){o(r,q)}return r}}();function l(o,p){if(!(o instanceof p)){throw new TypeError("Cannot call a class as a function")}}function m(o,p){if(!o){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return p&&(typeof p==="object"||typeof p==="function")?p:o}function n(p,o){if(typeof o!=="function"&&o!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof o)}p.prototype=Object.create(o&&o.prototype,{constructor:{value:p,enumerable:false,writable:true,configurable:true}});if(o){Object.setPrototypeOf?Object.setPrototypeOf(p,o):p.__proto__=o}}var f=g("./ChunkedFileData");var k=g("./MediaFileReader");var i=function(q){n(p,q);function p(u){l(this,p);var v=m(this,Object.getPrototypeOf(p).call(this));v._blob=u;v._fileData=new f();return v}h(p,[{key:"_init",value:function s(u){this._size=this._blob.size;setTimeout(u.onSuccess,1)}},{key:"loadRange",value:function o(w,z){var v=this;var y=this._blob.slice||this._blob.mozSlice||this._blob.webkitSlice;var u=y.call(this._blob,w[0],w[1]+1);var x=new FileReader();x.onloadend=function(A){var B=new Uint8Array(Number(x.result));v._fileData.addData(w[0],B);z.onSuccess()};x.onerror=x.onabort=function(A){if(z.onError){z.onError({type:"blob",info:x.error})}};x.readAsArrayBuffer(u)}},{key:"getByteAt",value:function t(u){return this._fileData.getByteAt(u)}}],[{key:"canReadFile",value:function r(u){return typeof Blob!=="undefined"&&u instanceof Blob||typeof File!=="undefined"&&u instanceof File}}]);return p}(k);e.exports=i},{"./ChunkedFileData":5,"./MediaFileReader":11}],5:[function(g,j,f){var i=function(){function l(p,n){for(var m=0;m<n.length;m++){var o=n[m];o.enumerable=o.enumerable||false;o.configurable=true;if("value" in o){o.writable=true}Object.defineProperty(p,o.key,o)}}return function(o,m,n){if(m){l(o.prototype,m)}if(n){l(o,n)}return o}}();function k(l,m){if(!(l instanceof m)){throw new TypeError("Cannot call a class as a function")}}var e=-1;var h=function(){i(m,null,[{key:"NOT_FOUND",get:function(){return e}}]);function m(){k(this,m);this._fileData=[]}i(m,[{key:"addData",value:function r(u,v){var A=u+v.length-1;var w=this._getChunkRange(u,A);if(w.startIx===e){this._fileData.splice(w.insertIx||0,0,{offset:u,data:v})}else{var t=this._fileData[w.startIx];var x=this._fileData[w.endIx];var y=u>t.offset;var s=A<x.offset+x.data.length-1;var z={offset:Math.min(u,t.offset),data:v};if(y){var B=this._sliceData(t.data,0,u-t.offset);z.data=this._concatData(B,v)}if(s){var B=this._sliceData(z.data,0,x.offset-z.offset);z.data=this._concatData(B,x.data)}this._fileData.splice(w.startIx,w.endIx-w.startIx+1,z)}}},{key:"_concatData",value:function p(t,s){if(typeof ArrayBuffer!=="undefined"&&ArrayBuffer.isView&&ArrayBuffer.isView(t)){var u=new t.constructor(t.length+s.length);u.set(t,0);u.set(s,t.length);return u}else{return t.concat(s)}}},{key:"_sliceData",value:function o(u,t,s){if(u.slice){return u.slice(t,s)}else{return u.subarray(t,s)}}},{key:"_getChunkRange",value:function n(z,y){var w=e;var v=e;var x=0;for(var u=0;u<this._fileData.length;u++,x=u){var t=this._fileData[u].offset;var s=t+this._fileData[u].data.length;if(y<t-1){break}if(z<=s+1&&y>=t-1){w=u;break}}if(w===e){return{startIx:e,endIx:e,insertIx:x}}for(var u=w;u<this._fileData.length;u++){var t=this._fileData[u].offset;var s=t+this._fileData[u].data.length;if(y>=t-1){v=u}if(y<=s+1){break}}if(v===e){v=w}return{startIx:w,endIx:v}}},{key:"hasDataRange",value:function l(v,u){for(var t=0;t<this._fileData.length;t++){var s=this._fileData[t];if(u<s.offset){return false}if(v>=s.offset&&u<s.offset+s.data.length){return true}}return false}},{key:"getByteAt",value:function q(v){var t;for(var s=0;s<this._fileData.length;s++){var u=this._fileData[s].offset;var w=u+this._fileData[s].data.length-1;if(v>=u&&v<=w){t=this._fileData[s];break}}if(t){return t.data[v-t.offset]}throw new Error("Offset "+v+" hasn't been loaded yet.")}}]);return m}();j.exports=h},{}],6:[function(g,f,j){var h=function(){function r(v,t){for(var s=0;s<t.length;s++){var u=t[s];u.enumerable=u.enumerable||false;u.configurable=true;if("value" in u){u.writable=true}Object.defineProperty(v,u.key,u)}}return function(u,s,t){if(s){r(u.prototype,s)}if(t){r(u,t)}return u}}();function k(r,s){if(!(r instanceof s)){throw new TypeError("Cannot call a class as a function")}}function n(r,s){if(!r){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return s&&(typeof s==="object"||typeof s==="function")?s:r}function o(s,r){if(typeof r!=="function"&&r!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof r)}s.prototype=Object.create(r&&r.prototype,{constructor:{value:s,enumerable:false,writable:true,configurable:true}});if(r){Object.setPrototypeOf?Object.setPrototypeOf(s,r):s.__proto__=r}}var m=g("./MediaTagReader");var e=4;var q=[4,132];var p=[6,134];var l=["Other","32x32 pixels 'file icon' (PNG only)","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. label side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"];var i=function(w){o(x,w);function x(){k(this,x);return n(this,Object.getPrototypeOf(x).apply(this,arguments))}h(x,[{key:"_loadData",value:function r(B,A){var z=this;B.loadRange([4,7],{onSuccess:function(){z._loadBlock(B,4,A)}})}},{key:"_loadBlock",value:function y(D,F,C){var z=this;var E=D.getByteAt(F);var B=D.getInteger24At(F+1,true);if(q.indexOf(E)!==-1){var A=F+4;D.loadRange([A,A+B],{onSuccess:function(){z._commentOffset=A;z._nextBlock(D,F,E,B,C)}})}else{if(p.indexOf(E)!==-1){var A=F+4;D.loadRange([A,A+B],{onSuccess:function(){z._pictureOffset=A;z._nextBlock(D,F,E,B,C)}})}else{z._nextBlock(D,F,E,B,C)}}}},{key:"_nextBlock",value:function v(C,E,D,A,B){var z=this;if(D>127){if(!z._commentOffset){B.onError({type:"loadData",info:"Comment block could not be found."})}else{B.onSuccess()}}else{C.loadRange([E+4+A,E+4+4+A],{onSuccess:function(){z._loadBlock(C,E+4+A,B)}})}}},{key:"_parseData",value:function s(ab,N){var aa=ab.getLongAt(this._commentOffset,false);var L=this._commentOffset+4;var ae=aa+L;var F=ab.getLongAt(ae,false);var K=ae+4;var ad,E,T,Q,C,I;for(var W=0;W<F;W++){var U=ab.getLongAt(K,false);var O=ab.getStringWithCharsetAt(K+4,U,"utf-8").toString();var Y=O.indexOf("=");var S=[O.slice(0,Y),O.slice(Y+1)];switch(S[0]){case"TITLE":ad=S[1];break;case"ARTIST":E=S[1];break;case"ALBUM":T=S[1];break;case"TRACKNUMBER":Q=S[1];break;case"GENRE":C=S[1];break}K+=4+U}if(this._pictureOffset){var z=ab.getLongAt(this._pictureOffset,true);var P=this._pictureOffset+4;var R=ab.getLongAt(P,true);var J=P+4;var G=ab.getStringAt(J,R);var B=J+R;var M=ab.getLongAt(B,true);var A=B+4;var V=ab.getStringWithCharsetAt(A,M,"utf-8").toString();var Z=A+M+16;var H=ab.getLongAt(Z,true);var D=Z+4;var X=ab.getBytesAt(D,H,true);I={format:G,type:l[z],description:V,data:X}}var ac={type:"FLAC",version:"1",tags:{title:ad,artist:E,album:T,track:Q,genre:C,picture:I}};return ac}}],[{key:"getTagIdentifierByteRange",value:function u(){return{offset:0,length:e}}},{key:"canReadTagFormat",value:function t(z){var A=String.fromCharCode.apply(String,z.slice(0,4));return A==="fLaC"}}]);return x}(m);f.exports=i},{"./MediaTagReader":12}],7:[function(f,e,h){var g=function(){function p(t,r){for(var q=0;q<r.length;q++){var s=r[q];s.enumerable=s.enumerable||false;s.configurable=true;if("value" in s){s.writable=true}Object.defineProperty(t,s.key,s)}}return function(s,q,r){if(q){p(s.prototype,q)}if(r){p(s,r)}return s}}();function j(p,q){if(!(p instanceof q)){throw new TypeError("Cannot call a class as a function")}}function n(p,q){if(!p){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return q&&(typeof q==="object"||typeof q==="function")?q:p}function o(q,p){if(typeof p!=="function"&&p!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof p)}q.prototype=Object.create(p&&p.prototype,{constructor:{value:q,enumerable:false,writable:true,configurable:true}});if(p){Object.setPrototypeOf?Object.setPrototypeOf(q,p):q.__proto__=p}}var m=f("./MediaTagReader");var i=f("./MediaFileReader");var l=function(t){o(u,t);function u(){j(this,u);return n(this,Object.getPrototypeOf(u).apply(this,arguments))}g(u,[{key:"_loadData",value:function p(x,w){var v=x.getSize();x.loadRange([v-128,v-1],w)}},{key:"_parseData",value:function q(z,I){var x=z.getSize()-128;var G=z.getStringWithCharsetAt(x+3,30).toString();var y=z.getStringWithCharsetAt(x+33,30).toString();var w=z.getStringWithCharsetAt(x+63,30).toString();var F=z.getStringWithCharsetAt(x+93,4).toString();var A=z.getByteAt(x+97+28);var v=z.getByteAt(x+97+29);if(A==0&&v!=0){var E="1.1";var B=z.getStringWithCharsetAt(x+97,28).toString()}else{var E="1.0";var B=z.getStringWithCharsetAt(x+97,30).toString();v=0}var D=z.getByteAt(x+97+30);if(D<255){var C=k[D]}else{var C=""}var H={type:"ID3",version:E,tags:{title:G,artist:y,album:w,year:F,comment:B,genre:C}};if(v){H.tags.track=v}return H}}],[{key:"getTagIdentifierByteRange",value:function s(){return{offset:-128,length:128}}},{key:"canReadTagFormat",value:function r(v){var w=String.fromCharCode.apply(String,v.slice(0,3));return w==="TAG"}}]);return u}(m);var k=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychadelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk-Rock","National Folk","Swing","Fast Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","Acapella","Euro-House","Dance Hall"];e.exports=l},{"./MediaFileReader":11,"./MediaTagReader":12}],8:[function(o,e,z){var x=function(){function B(F,D){for(var C=0;C<D.length;C++){var E=D[C];E.enumerable=E.enumerable||false;E.configurable=true;if("value" in E){E.writable=true}Object.defineProperty(F,E.key,E)}}return function(E,C,D){if(C){B(E.prototype,C)}if(D){B(E,D)}return E}}();function h(B,C){if(!(B instanceof C)){throw new TypeError("Cannot call a class as a function")}}var i=o("./MediaFileReader");var A=o("./StringUtils");var u=o("./ArrayFileReader");var l={BUF:"Recommended buffer size",CNT:"Play counter",COM:"Comments",CRA:"Audio encryption",CRM:"Encrypted meta frame",ETC:"Event timing codes",EQU:"Equalization",GEO:"General encapsulated object",IPL:"Involved people list",LNK:"Linked information",MCI:"Music CD Identifier",MLL:"MPEG location lookup table",PIC:"Attached picture",POP:"Popularimeter",REV:"Reverb",RVA:"Relative volume adjustment",SLT:"Synchronized lyric/text",STC:"Synced tempo codes",TAL:"Album/Movie/Show title",TBP:"BPM (Beats Per Minute)",TCM:"Composer",TCO:"Content type",TCR:"Copyright message",TDA:"Date",TDY:"Playlist delay",TEN:"Encoded by",TFT:"File type",TIM:"Time",TKE:"Initial key",TLA:"Language(s)",TLE:"Length",TMT:"Media type",TOA:"Original artist(s)/performer(s)",TOF:"Original filename",TOL:"Original Lyricist(s)/text writer(s)",TOR:"Original release year",TOT:"Original album/Movie/Show title",TP1:"Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group",TP2:"Band/Orchestra/Accompaniment",TP3:"Conductor/Performer refinement",TP4:"Interpreted, remixed, or otherwise modified by",TPA:"Part of a set",TPB:"Publisher",TRC:"ISRC (International Standard Recording Code)",TRD:"Recording dates",TRK:"Track number/Position in set",TSI:"Size",TSS:"Software/hardware and settings used for encoding",TT1:"Content group description",TT2:"Title/Songname/Content description",TT3:"Subtitle/Description refinement",TXT:"Lyricist/text writer",TXX:"User defined text information frame",TYE:"Year",UFI:"Unique file identifier",ULT:"Unsychronized lyric/text transcription",WAF:"Official audio file webpage",WAR:"Official artist/performer webpage",WAS:"Official audio source webpage",WCM:"Commercial information",WCP:"Copyright/Legal information",WPB:"Publishers official webpage",WXX:"User defined URL link frame",AENC:"Audio encryption",APIC:"Attached picture",ASPI:"Audio seek point index",CHAP:"Chapter",CTOC:"Table of contents",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQU2:"Equalisation (2)",EQUA:"Equalization",ETCO:"Event timing codes",GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVA2:"Relative volume adjustment (2)",RVAD:"Relative volume adjustment",RVRB:"Reverb",SEEK:"Seek frame",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TDRC:"Recording time",TDRL:"Release time",TDTG:"Tagging time",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",TIME:"Time",TIPL:"Involved people list",TIT1:"Content group description",TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMCL:"Musician credits list",TMED:"Media type",TMOO:"Mood",TOAL:"Original album/movie/show title",TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPRO:"Produced notice",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSOA:"Album sort order",TSOP:"Performer sort order",TSOT:"Title sort order",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TSST:"Set subtitle",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"};var s=function(){function E(){h(this,E)}x(E,null,[{key:"getFrameReaderFunction",value:function G(J){if(J in j){return j[J]}else{if(J[0]==="T"){return j["T*"]}else{if(J[0]==="W"){return j["W*"]}else{return null}}}}},{key:"readFrames",value:function D(N,M,aa,Q,T){var R={};var J=this._getFrameHeaderSize(Q);while(N<M-J){var Y=this._readFrameHeader(aa,N,Q);var L=Y.id;if(!L){break}var O=Y.flags;var V=Y.size;var P=N+Y.headerSize;var K=aa;N+=Y.headerSize+Y.size;if(T&&T.indexOf(L)===-1){continue}if(L==="MP3e"||L==="\x00MP3"||L==="\x00\x00MP"||L===" MP3"){break}var U;if(O&&O.format.unsynchronisation){K=this.getUnsyncFileReader(K,P,V);P=0;V=K.getSize()}if(O&&O.format.data_length_indicator){P+=4;V-=4}var X=E.getFrameReaderFunction(L);var W=X?X.apply(this,[P,V,K,O,Q]):null;var Z=this._getFrameDescription(L);var S={id:L,size:V,description:Z,data:W};if(L in R){if(R[L].id){R[L]=[R[L]]}R[L].push(S)}else{R[L]=S}}return R}},{key:"_getFrameHeaderSize",value:function I(J){var K=J.major;if(K==2){return 6}else{if(K==3||K==4){return 10}else{return 0}}}},{key:"_readFrameHeader",value:function H(P,Q,K){var N=K.major;var J=null;var M=this._getFrameHeaderSize(K);switch(N){case 2:var O=P.getStringAt(Q,3);var L=P.getInteger24At(Q+3,true);break;case 3:var O=P.getStringAt(Q,4);var L=P.getLongAt(Q+4,true);break;case 4:var O=P.getStringAt(Q,4);var L=P.getSynchsafeInteger32At(Q+4);break}if(O==String.fromCharCode(0,0,0)||O==String.fromCharCode(0,0,0,0)){O=""}if(O){if(N>2){J=this._readFrameFlags(P,Q+8)}}return{id:O||"",size:L||0,headerSize:M||0,flags:J}}},{key:"_readFrameFlags",value:function F(J,K){return{message:{tag_alter_preservation:J.isBitSetAt(K,6),file_alter_preservation:J.isBitSetAt(K,5),read_only:J.isBitSetAt(K,4)},format:{grouping_identity:J.isBitSetAt(K+1,7),compression:J.isBitSetAt(K+1,3),encryption:J.isBitSetAt(K+1,2),unsynchronisation:J.isBitSetAt(K+1,1),data_length_indicator:J.isBitSetAt(K+1,0)}}}},{key:"_getFrameDescription",value:function C(J){if(J in l){return l[J]}else{return"Unknown"}}},{key:"getUnsyncFileReader",value:function B(M,N,K){var L=M.getBytesAt(N,K);for(var J=0;J<L.length-1;J++){if(L[J]===255&&L[J+1]===0){L.splice(J+1,1)}}return new u(L)}}]);return E}();var j={};j.APIC=function k(F,C,G,D,J){var B=F;var E=m(G.getByteAt(F));switch(J&&J.major){case 2:var L=G.getStringAt(F+1,3);F+=4;break;case 3:case 4:var L=G.getStringWithCharsetAt(F+1,C-1);F+=1+L.bytesReadCount;break;default:throw new Error("Couldn't read ID3v2 major version.")}var H=G.getByteAt(F);var K=t[H];var I=G.getStringWithCharsetAt(F+1,C-(F-B)-1,E);F+=1+I.bytesReadCount;return{format:L.toString(),type:K,description:I.toString(),data:G.getBytesAt(F,B+C-F)}};j.CHAP=function w(F,D,G,E,H){var I=F;var J={};var B=A.readNullTerminatedString(G.getBytesAt(F,D));J.id=B.toString();F+=B.bytesReadCount;J.startTime=G.getLongAt(F,true);F+=4;J.endTime=G.getLongAt(F,true);F+=4;J.startOffset=G.getLongAt(F,true);F+=4;J.endOffset=G.getLongAt(F,true);F+=4;var C=D-(F-I);J.subFrames=this.readFrames(F,F+C,G,H);return J};j.CTOC=function f(G,D,I,E,J){var K=G;var L={childElementIds:[],id:undefined,topLevel:undefined,ordered:undefined,entryCount:undefined,subFrames:undefined};var B=A.readNullTerminatedString(I.getBytesAt(G,D));L.id=B.toString();G+=B.bytesReadCount;L.topLevel=I.isBitSetAt(G,1);L.ordered=I.isBitSetAt(G,0);G++;L.entryCount=I.getByteAt(G);G++;for(var H=0;H<L.entryCount;H++){var F=A.readNullTerminatedString(I.getBytesAt(G,D-(G-K)));L.childElementIds.push(F.toString());G+=F.bytesReadCount}var C=D-(G-K);L.subFrames=this.readFrames(G,G+C,I,J);return L};j.COMM=function r(F,C,H,D,I){var B=F;var E=m(H.getByteAt(F));var G=H.getStringAt(F+1,3);var J=H.getStringWithCharsetAt(F+4,C-4,E);F+=4+J.bytesReadCount;var K=H.getStringWithCharsetAt(F,B+C-F,E);return{language:G,short_description:J.toString(),text:K.toString()}};j.COM=j.COMM;j.PIC=function(F,D,E,C,B){return j.APIC(F,D,E,C,B)};j.PCNT=function v(F,D,E,C,B){return E.getLongAt(F,false)};j.CNT=j.PCNT;j["T*"]=function n(F,D,E,C,B){var G=m(E.getByteAt(F));return E.getStringWithCharsetAt(F+1,D-1,G).toString()};j.TXXX=function n(F,D,E,C,B){var G=m(E.getByteAt(F));return g(F,D,E,G)};j["W*"]=function y(F,D,E,C,B){var G=m(E.getByteAt(F));if(G!==undefined){return g(F,D,E,G)}else{return E.getStringWithCharsetAt(F,D,G).toString()}};j.TCON=function q(F,C,D,B){var E=j["T*"].apply(this,arguments);return E.replace(/^\(\d+\)/,"")};j.TCO=j.TCON;j.USLT=function p(H,D,J,E,K){var C=H;var G=m(J.getByteAt(H));var I=J.getStringAt(H+1,3);var B=J.getStringWithCharsetAt(H+4,D-4,G);H+=4+B.bytesReadCount;var F=J.getStringWithCharsetAt(H,C+D-H,G);return{language:I,descriptor:B.toString(),lyrics:F.toString()}};j.ULT=j.USLT;j.UFID=function p(H,F,G,D,C){var B=A.readNullTerminatedString(G.getBytesAt(H,F));H+=B.bytesReadCount;var E=G.getBytesAt(H,F-B.bytesReadCount);return{ownerIdentifier:B.toString(),identifier:E}};function m(C){var B;switch(C){case 0:B="iso-8859-1";break;case 1:B="utf-16";break;case 2:B="utf-16be";break;case 3:B="utf-8";break;default:B="iso-8859-1"}return B}function g(F,C,E,G){var B=E.getStringWithCharsetAt(F+1,C-1,G);var D=E.getStringWithCharsetAt(F+1+B.bytesReadCount,C-1-B.bytesReadCount);return{user_description:B.toString(),data:D.toString()}}var t=["Other","32x32 pixels 'file icon' (PNG only)","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. label side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"];e.exports=s},{"./ArrayFileReader":3,"./MediaFileReader":11,"./StringUtils":13}],9:[function(g,f,j){var h=function(){function r(v,t){for(var s=0;s<t.length;s++){var u=t[s];u.enumerable=u.enumerable||false;u.configurable=true;if("value" in u){u.writable=true}Object.defineProperty(v,u.key,u)}}return function(u,s,t){if(s){r(u.prototype,s)}if(t){r(u,t)}return u}}();function l(r,s){if(!(r instanceof s)){throw new TypeError("Cannot call a class as a function")}}function n(r,s){if(!r){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return s&&(typeof s==="object"||typeof s==="function")?s:r}function q(s,r){if(typeof r!=="function"&&r!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof r)}s.prototype=Object.create(r&&r.prototype,{constructor:{value:s,enumerable:false,writable:true,configurable:true}});if(r){Object.setPrototypeOf?Object.setPrototypeOf(s,r):s.__proto__=r}}var m=g("./MediaTagReader");var k=g("./MediaFileReader");var o=g("./ID3v2FrameReader");var i=10;var e=function(w){q(y,w);function y(){l(this,y);return n(this,Object.getPrototypeOf(y).apply(this,arguments))}h(y,[{key:"_loadData",value:function r(A,z){A.loadRange([6,9],{onSuccess:function(){A.loadRange([0,i+A.getSynchsafeInteger32At(6)-1],z)},onError:z.onError})}},{key:"_parseData",value:function t(E,P){var D=0;var I=E.getByteAt(D+3);if(I>4){return{type:"ID3",version:">2.4",tags:{}}}var J=E.getByteAt(D+4);var F=E.isBitSetAt(D+5,7);var H=E.isBitSetAt(D+5,6);var B=E.isBitSetAt(D+5,5);var O=E.getSynchsafeInteger32At(D+6);D+=10;if(H){var N=E.getLongAt(D,true);D+=N+4}var M={type:"ID3",version:"2."+I+"."+J,major:I,revision:J,flags:{unsynchronisation:F,extended_header:H,experimental_indicator:B,footer_present:false},size:O,tags:{}};if(P){var z=this._expandShortcutTags(P)}var L=O+10;if(M.flags.unsynchronisation){E=o.getUnsyncFileReader(E,D,O);D=0;L=E.getSize()}var G=o.readFrames(D,L,E,M,z);for(var A in p){if(p.hasOwnProperty(A)){var K=this._getFrameData(G,p[A]);if(K){M.tags[A]=K}}}for(var C in G){if(G.hasOwnProperty(C)){M.tags[C]=G[C]}}return M}},{key:"_getFrameData",value:function s(C,A){var B;for(var z=0,D;D=A[z];z++){if(D in C){if(C[D] instanceof Array){B=C[D][0]}else{B=C[D]}return B.data}}}},{key:"getShortcuts",value:function x(){return p}}],[{key:"getTagIdentifierByteRange",value:function v(){return{offset:0,length:i}}},{key:"canReadTagFormat",value:function u(z){var A=String.fromCharCode.apply(String,z.slice(0,3));return A==="ID3"}}]);return y}(m);var p={title:["TIT2","TT2"],artist:["TPE1","TP1"],album:["TALB","TAL"],year:["TYER","TYE"],comment:["COMM","COM"],track:["TRCK","TRK"],genre:["TCON","TCO"],picture:["APIC","PIC"],lyrics:["USLT","ULT"]};f.exports=e},{"./ID3v2FrameReader":8,"./MediaFileReader":11,"./MediaTagReader":12}],10:[function(j,h,l){var k=function(){function s(w,u){for(var t=0;t<u.length;t++){var v=u[t];v.enumerable=v.enumerable||false;v.configurable=true;if("value" in v){v.writable=true}Object.defineProperty(w,v.key,v)}}return function(v,t,u){if(t){s(v.prototype,t)}if(u){s(v,u)}return v}}();function n(s,t){if(!(s instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(s,t){if(!s){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:s}function r(t,s){if(typeof s!=="function"&&s!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof s)}t.prototype=Object.create(s&&s.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}});if(s){Object.setPrototypeOf?Object.setPrototypeOf(t,s):t.__proto__=s}}var o=j("./MediaTagReader");var m=j("./MediaFileReader");var f=function(w){r(s,w);function s(){n(this,s);return p(this,Object.getPrototypeOf(s).apply(this,arguments))}k(s,[{key:"_loadData",value:function A(G,F){var E=this;G.loadRange([0,16],{onSuccess:function(){E._loadAtom(G,0,"",F)},onError:F.onError})}},{key:"_loadAtom",value:function C(J,L,H,I){if(L>=J.getSize()){I.onSuccess();return}var G=this;var F=J.getLongAt(L,true);if(F==0||isNaN(F)){I.onSuccess();return}var E=J.getStringAt(L+4,4);if(this._isContainerAtom(E)){if(E=="meta"){L+=4}var K=(H?H+".":"")+E;if(K==="moov.udta.meta.ilst"){J.loadRange([L,L+F],I)}else{J.loadRange([L+8,L+8+8],{onSuccess:function(){G._loadAtom(J,L+8,K,I)},onError:I.onError})}}else{J.loadRange([L+F,L+F+8],{onSuccess:function(){G._loadAtom(J,L+F,H,I)},onError:I.onError})}}},{key:"_isContainerAtom",value:function x(E){return["moov","udta","meta","ilst"].indexOf(E)>=0}},{key:"_canReadAtom",value:function B(E){return E!=="----"}},{key:"_parseData",value:function u(I,F){var H={};F=this._expandShortcutTags(F);this._readAtom(H,I,0,I.getSize(),F);for(var G in q){if(q.hasOwnProperty(G)){var E=H[q[G]];if(E){if(G==="track"){H[G]=E.data.track}else{H[G]=E.data}}}}return{type:"MP4",ftyp:I.getStringAt(8,4),version:I.getLongAt(12,true),tags:H}}},{key:"_readAtom",value:function v(O,L,K,F,H,E,I){I=I===undefined?"":I+"  ";var G=K;while(G<K+F){var M=L.getLongAt(G,true);if(M==0){return}var N=L.getStringAt(G+4,4);if(this._isContainerAtom(N)){if(N=="meta"){G+=4}var J=(E?E+".":"")+N;this._readAtom(O,L,G+8,M-8,H,J,I);return}if((!H||H.indexOf(N)>=0)&&E==="moov.udta.meta.ilst"&&this._canReadAtom(N)){O[N]=this._readMetadataAtom(L,G)}G+=M}}},{key:"_readMetadataAtom",value:function y(J,I){var H=16;var K=J.getLongAt(I,true);var L=J.getStringAt(I+4,4);var M=J.getInteger24At(I+H+1,true);var N=i[M];var P;if(L=="trkn"){P={track:J.getByteAt(I+H+11),total:J.getByteAt(I+H+13)}}else{if(L=="disk"){P={disk:J.getByteAt(I+H+11),total:J.getByteAt(I+H+13)}}else{var O=H+4+4;var G=I+O;var F=K-O;var P;if(L==="covr"&&N==="uint8"){N="jpeg"}switch(N){case"text":P=J.getStringWithCharsetAt(G,F,"utf-8").toString();break;case"uint8":P=J.getShortAt(G,false);break;case"int":case"uint":var E=N=="int"?F==1?J.getSByteAt:F==2?J.getSShortAt:F==4?J.getSLongAt:J.getLongAt:F==1?J.getByteAt:F==2?J.getShortAt:J.getLongAt;P=E.call(J,G+(F==8?4:0),true);break;case"jpeg":case"png":P={format:"image/"+N,data:J.getBytesAt(G,F)};break}}}return{id:L,size:K,description:g[L]||"Unknown",data:P}}},{key:"getShortcuts",value:function t(){return q}}],[{key:"getTagIdentifierByteRange",value:function z(){return{offset:0,length:16}}},{key:"canReadTagFormat",value:function D(E){var F=String.fromCharCode.apply(String,E.slice(4,8));return F==="ftyp"}}]);return s}(o);var i={"0":"uint8","1":"text","13":"jpeg","14":"png","21":"int","22":"uint"};var g={"©alb":"Album","©ART":"Artist",aART:"Album Artist","©day":"Release Date","©nam":"Title","©gen":"Genre",gnre:"Genre",trkn:"Track Number","©wrt":"Composer","©too":"Encoding Tool","©enc":"Encoded By",cprt:"Copyright",covr:"Cover Art","©grp":"Grouping",keyw:"Keywords","©lyr":"Lyrics","©cmt":"Comment",tmpo:"Tempo",cpil:"Compilation",disk:"Disc Number",tvsh:"TV Show Name",tven:"TV Episode ID",tvsn:"TV Season",tves:"TV Episode",tvnn:"TV Network",desc:"Description",ldes:"Long Description",sonm:"Sort Name",soar:"Sort Artist",soaa:"Sort Album",soco:"Sort Composer",sosn:"Sort Show",purd:"Purchase Date",pcst:"Podcast",purl:"Podcast URL",catg:"Category",hdvd:"HD Video",stik:"Media Type",rtng:"Content Rating",pgap:"Gapless Playback",apID:"Purchase Account",sfID:"Country Code",atID:"Artist ID",cnID:"Catalog ID",plID:"Collection ID",geID:"Genre ID","xid ":"Vendor Information",flvr:"Codec Flavor"};var e={"----":1};var q={title:"©nam",artist:"©ART",album:"©alb",year:"©day",comment:"©cmt",track:"trkn",genre:"©gen",picture:"covr",lyrics:"©lyr"};h.exports=f},{"./MediaFileReader":11,"./MediaTagReader":12}],11:[function(g,i,f){var h=function(){function l(p,n){for(var m=0;m<n.length;m++){var o=n[m];o.enumerable=o.enumerable||false;o.configurable=true;if("value" in o){o.writable=true}Object.defineProperty(p,o.key,o)}}return function(o,m,n){if(m){l(o.prototype,m)}if(n){l(o,n)}return o}}();function j(l,m){if(!(l instanceof m)){throw new TypeError("Cannot call a class as a function")}}var k=g("./StringUtils");var e=function(){function o(E){j(this,o);this._isInitialized=false;this._size=0}h(o,[{key:"init",value:function z(F){var E=this;if(this._isInitialized){setTimeout(F.onSuccess,1)}else{return this._init({onSuccess:function(){E._isInitialized=true;F.onSuccess()},onError:F.onError})}}},{key:"_init",value:function t(E){throw new Error("Must implement init function")}},{key:"loadRange",value:function m(E,F){throw new Error("Must implement loadRange function")}},{key:"getSize",value:function l(){if(!this._isInitialized){throw new Error("init() must be called first.")}return this._size}},{key:"getByteAt",value:function s(E){throw new Error("Must implement getByteAt function")}},{key:"getBytesAt",value:function n(H,G){var E=new Array(G);for(var F=0;F<G;F++){E[F]=this.getByteAt(H+F)}return E}},{key:"isBitSetAt",value:function A(G,F){var E=this.getByteAt(G);return(E&1<<F)!=0}},{key:"getSByteAt",value:function x(F){var E=this.getByteAt(F);if(E>127){return E-256}else{return E}}},{key:"getShortAt",value:function B(F,G){var E=G?(this.getByteAt(F)<<8)+this.getByteAt(F+1):(this.getByteAt(F+1)<<8)+this.getByteAt(F);if(E<0){E+=65536}return E}},{key:"getSShortAt",value:function v(F,G){var E=this.getShortAt(F,G);if(E>32767){return E-65536}else{return E}}},{key:"getLongAt",value:function w(J,K){var H=this.getByteAt(J),G=this.getByteAt(J+1),F=this.getByteAt(J+2),E=this.getByteAt(J+3);var I=K?(((H<<8)+G<<8)+F<<8)+E:(((E<<8)+F<<8)+G<<8)+H;if(I<0){I+=4294967296}return I}},{key:"getSLongAt",value:function u(F,G){var E=this.getLongAt(F,G);if(E>2147483647){return E-4294967296}else{return E}}},{key:"getInteger24At",value:function D(I,J){var G=this.getByteAt(I),F=this.getByteAt(I+1),E=this.getByteAt(I+2);var H=J?((G<<8)+F<<8)+E:((E<<8)+F<<8)+G;if(H<0){H+=16777216}return H}},{key:"getStringAt",value:function y(I,H){var F=[];for(var G=I,E=0;G<I+H;G++,E++){F[E]=String.fromCharCode(this.getByteAt(G))}return F.join("")}},{key:"getStringWithCharsetAt",value:function C(H,G,I){var E=this.getBytesAt(H,G);var F;switch((I||"").toLowerCase()){case"utf-16":case"utf-16le":case"utf-16be":F=k.readUTF16String(E,I==="utf-16be");break;case"utf-8":F=k.readUTF8String(E);break;default:F=k.readNullTerminatedString(E);break}return F}},{key:"getCharAt",value:function r(E){return String.fromCharCode(this.getByteAt(E))}},{key:"getSynchsafeInteger32At",value:function q(J){var I=this.getByteAt(J);var H=this.getByteAt(J+1);var G=this.getByteAt(J+2);var E=this.getByteAt(J+3);var F=E&127|(G&127)<<7|(H&127)<<14|(I&127)<<21;return F}}],[{key:"canReadFile",value:function p(E){throw new Error("Must implement canReadFile function")}}]);return o}();i.exports=e},{"./StringUtils":13}],12:[function(g,i,f){var h=function(){function l(p,n){for(var m=0;m<n.length;m++){var o=n[m];o.enumerable=o.enumerable||false;o.configurable=true;if("value" in o){o.writable=true}Object.defineProperty(p,o.key,o)}}return function(o,m,n){if(m){l(o.prototype,m)}if(n){l(o,n)}return o}}();function k(l,m){if(!(l instanceof m)){throw new TypeError("Cannot call a class as a function")}}var e=g("./MediaFileReader");var j=function(){function r(u){k(this,r);this._mediaFileReader=u;this._tags=null}h(r,[{key:"setTagsToRead",value:function t(u){this._tags=u;return this}},{key:"read",value:function m(v){var u=this;this._mediaFileReader.init({onSuccess:function(){u._loadData(u._mediaFileReader,{onSuccess:function(){try{var w=u._parseData(u._mediaFileReader,u._tags)}catch(x){if(v.onError){v.onError({type:"parseData",info:x.message});return}}v.onSuccess(w)},onError:v.onError})},onError:v.onError})}},{key:"getShortcuts",value:function l(){return{}}},{key:"_loadData",value:function q(v,u){throw new Error("Must implement _loadData function")}},{key:"_parseData",value:function n(v,u){throw new Error("Must implement _parseData function")}},{key:"_expandShortcutTags",value:function o(y){if(!y){return null}var v=[];var u=this.getShortcuts();for(var x=0,w;w=y[x];x++){v=v.concat(u[w]||[w])}return v}}],[{key:"getTagIdentifierByteRange",value:function p(){throw new Error("Must implement")}},{key:"canReadTagFormat",value:function s(u){throw new Error("Must implement")}}]);return r}();i.exports=j},{"./MediaFileReader":11}],13:[function(f,h,e){var g=function(){function l(p,n){for(var m=0;m<n.length;m++){var o=n[m];o.enumerable=o.enumerable||false;o.configurable=true;if("value" in o){o.writable=true}Object.defineProperty(p,o.key,o)}}return function(o,m,n){if(m){l(o.prototype,m)}if(n){l(o,n)}return o}}();function j(l,m){if(!(l instanceof m)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function m(n,o){j(this,m);this._value=n;this.bytesReadCount=o;this.length=n.length}g(m,[{key:"toString",value:function l(){return this._value}}]);return m}();var k={readUTF16String:function(y,n,u){var o=0;var m=1,l=0;u=Math.min(u||y.length,y.length);if(y[0]==254&&y[1]==255){n=true;o=2}else{if(y[0]==255&&y[1]==254){n=false;o=2}}if(n){m=0;l=1}var q=[];for(var p=0;o<u;p++){var x=y[o+m];var w=y[o+l];var s=(x<<8)+w;o+=2;if(s==0){break}else{if(x<216||x>=224){q[p]=String.fromCharCode(s)}else{var v=y[o+m];var t=y[o+l];var r=(v<<8)+t;o+=2;q[p]=String.fromCharCode(s,r)}}}return new i(q.join(""),o)},readUTF8String:function(u,p){var l=0;p=Math.min(p||u.length,u.length);if(u[0]==239&&u[1]==187&&u[2]==191){l=3}var n=[];for(var m=0;l<p;m++){var s=u[l++];if(s==0){break}else{if(s<128){n[m]=String.fromCharCode(s)}else{if(s>=194&&s<224){var r=u[l++];n[m]=String.fromCharCode(((s&31)<<6)+(r&63))}else{if(s>=224&&s<240){var r=u[l++];var q=u[l++];n[m]=String.fromCharCode(((s&255)<<12)+((r&63)<<6)+(q&63))}else{if(s>=240&&s<245){var r=u[l++];var q=u[l++];var o=u[l++];var t=((s&7)<<18)+((r&63)<<12)+((q&63)<<6)+(o&63)-65536;n[m]=String.fromCharCode((t>>10)+55296,(t&1023)+56320)}}}}}}return new i(n.join(""),l)},readNullTerminatedString:function(n,o){var l=[];o=o||n.length;for(var p=0;p<o;){var m=n[p++];if(m==0){break}l[p-1]=String.fromCharCode(m)}return new i(l.join(""),p)}};h.exports=k},{}],14:[function(g,e,j){var h=function(){function p(t,r){for(var q=0;q<r.length;q++){var s=r[q];s.enumerable=s.enumerable||false;s.configurable=true;if("value" in s){s.writable=true}Object.defineProperty(t,s.key,s)}}return function(s,q,r){if(q){p(s.prototype,q)}if(r){p(s,r)}return s}}();function m(p,q){if(!(p instanceof q)){throw new TypeError("Cannot call a class as a function")}}function n(p,q){if(!p){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return q&&(typeof q==="object"||typeof q==="function")?q:p}function o(q,p){if(typeof p!=="function"&&p!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof p)}q.prototype=Object.create(p&&p.prototype,{constructor:{value:q,enumerable:false,writable:true,configurable:true}});if(p){Object.setPrototypeOf?Object.setPrototypeOf(q,p):q.__proto__=p}}var f=g("./ChunkedFileData");var l=g("./MediaFileReader");var i=1024;var k=function(q){o(u,q);function u(J){m(this,u);var K=n(this,Object.getPrototypeOf(u).call(this));K._url=J;K._fileData=new f();return K}h(u,[{key:"_init",value:function w(J){if(u._config.avoidHeadRequests){this._fetchSizeWithGetRequest(J)}else{this._fetchSizeWithHeadRequest(J)}}},{key:"_fetchSizeWithHeadRequest",value:function v(K){var J=this;this._makeXHRRequest("HEAD",null,{onSuccess:function(M){var L=J._parseContentLength(M);if(L){J._size=L;K.onSuccess()}else{J._fetchSizeWithGetRequest(K)}},onError:K.onError})}},{key:"_fetchSizeWithGetRequest",value:function B(L){var K=this;var J=this._roundRangeToChunkMultiple([0,0]);this._makeXHRRequest("GET",J,{onSuccess:function(O){var N=K._parseContentRange(O);var M=K._getXhrResponseContent(O);if(N){if(N.instanceLength==null){K._fetchEntireFile(L);return}K._size=N.instanceLength}else{K._size=M.length}K._fileData.addData(0,M);L.onSuccess()},onError:L.onError})}},{key:"_fetchEntireFile",value:function x(K){var J=this;this._makeXHRRequest("GET",null,{onSuccess:function(M){var L=J._getXhrResponseContent(M);J._size=L.length;J._fileData.addData(0,L);K.onSuccess()},onError:K.onError})}},{key:"_getXhrResponseContent",value:function s(J){return J.responseBody||J.responseText||""}},{key:"_parseContentLength",value:function H(K){var J=this._getResponseHeader(K,"Content-Length");if(J==null){return J}else{return parseInt(J,10)}}},{key:"_parseContentRange",value:function G(L){var K=this._getResponseHeader(L,"Content-Range");if(K){var J=K.match(/bytes (\d+)-(\d+)\/(?:(\d+)|\*)/i);if(!J){throw new Error("FIXME: Unknown Content-Range syntax: "+K)}return{firstBytePosition:parseInt(J[1],10),lastBytePosition:parseInt(J[2],10),instanceLength:J[3]?parseInt(J[3],10):null}}else{return null}}},{key:"loadRange",value:function p(K,L){var J=this;if(J._fileData.hasDataRange(K[0],Math.min(J._size,K[1]))){setTimeout(L.onSuccess,1);return}K=this._roundRangeToChunkMultiple(K);K[1]=Math.min(J._size,K[1]);this._makeXHRRequest("GET",K,{onSuccess:function(N){var M=J._getXhrResponseContent(N);J._fileData.addData(K[0],M);L.onSuccess()},onError:L.onError})}},{key:"_roundRangeToChunkMultiple",value:function E(J){var K=J[1]-J[0]+1;var L=Math.ceil(K/i)*i;return[J[0],J[0]+L-1]}},{key:"_makeXHRRequest",value:function C(N,J,K){var M=this._createXHRObject();M.open(N,this._url);var L=function(){if(M.status===200||M.status===206){K.onSuccess(M)}else{if(K.onError){K.onError({type:"xhr",info:"Unexpected HTTP status "+M.status+".",xhr:M})}}M=null};if(typeof M.onload!=="undefined"){M.onload=L;M.onerror=function(){if(K.onError){K.onError({type:"xhr",info:"Generic XHR error, check xhr object.",xhr:M})}}}else{M.onreadystatechange=function(){if(M.readyState===4){L()}}}if(u._config.timeoutInSec){M.timeout=u._config.timeoutInSec*1000;M.ontimeout=function(){if(K.onError){K.onError({type:"xhr",info:"Timeout after "+M.timeout/1000+"s. Use jsmediatags.Config.setXhrTimeout to override.",xhr:M})}}}M.overrideMimeType("text/plain; charset=x-user-defined");if(J){this._setRequestHeader(M,"Range","bytes="+J[0]+"-"+J[1])}this._setRequestHeader(M,"If-Modified-Since","Sat, 01 Jan 1970 00:00:00 GMT");M.send(null)}},{key:"_setRequestHeader",value:function I(K,L,J){if(u._config.disallowedXhrHeaders.indexOf(L.toLowerCase())<0){K.setRequestHeader(L,J)}}},{key:"_hasResponseHeader",value:function F(N,O){var L=N.getAllResponseHeaders();if(!L){return false}var M=L.split("\r\n");var K=[];for(var J=0;J<M.length;J++){K[J]=M[J].split(":")[0].toLowerCase()}return K.indexOf(O.toLowerCase())>=0}},{key:"_getResponseHeader",value:function z(J,K){if(!this._hasResponseHeader(J,K)){return null}return J.getResponseHeader(K)}},{key:"getByteAt",value:function t(K){var J=this._fileData.getByteAt(K);return J.charCodeAt(0)&255}},{key:"_isWebWorker",value:function D(){return typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope}},{key:"_createXHRObject",value:function y(){if(typeof window==="undefined"&&!this._isWebWorker()){return new (g("xhr2").XMLHttpRequest)()}if(typeof XMLHttpRequest!=="undefined"){return new XMLHttpRequest()}throw new Error("XMLHttpRequest is not supported")}}],[{key:"canReadFile",value:function r(J){return typeof J==="string"&&/^[a-z]+:\/\//i.test(J)}},{key:"setConfig",value:function A(K){for(var M in K){if(K.hasOwnProperty(M)){this._config[M]=K[M]}}var J=this._config.disallowedXhrHeaders;for(var L=0;L<J.length;L++){J[L]=J[L].toLowerCase()}}}]);return u}(l);k._config={avoidHeadRequests:false,disallowedXhrHeaders:[],timeoutInSec:30};e.exports=k},{"./ChunkedFileData":5,"./MediaFileReader":11,xhr2:2}],15:[function(l,f,y){var t=function(){function z(D,B){for(var A=0;A<B.length;A++){var C=B[A];C.enumerable=C.enumerable||false;C.configurable=true;if("value" in C){C.writable=true}Object.defineProperty(D,C.key,C)}}return function(C,A,B){if(A){z(C.prototype,A)}if(B){z(C,B)}return C}}();function g(z,A){if(!(z instanceof A)){throw new TypeError("Cannot call a class as a function")}}var h=l("./MediaFileReader");var o=l("./NodeFileReader");var k=l("./XhrFileReader");var i=l("./BlobFileReader");var q=l("./ArrayFileReader");var j=l("./MediaTagReader");var n=l("./ID3v1TagReader");var u=l("./ID3v2TagReader");var w=l("./MP4TagReader");var e=l("./FLACTagReader");var v=[];var p=[];function s(z,A){new x(z).read(A)}function r(A,z){var C=A.offset>=0&&A.offset+A.length>=z;var B=A.offset<0&&(-A.offset>z||A.offset+A.length>0);return !(C||B)}var x=function(){function G(J){g(this,G);this._file=J}t(G,[{key:"setTagsToRead",value:function I(J){this._tagsToRead=J;return this}},{key:"setFileReader",value:function B(J){this._fileReader=J;return this}},{key:"setTagReader",value:function E(J){this._tagReader=J;return this}},{key:"read",value:function z(L){var M=this._getFileReader();var J=new M(this._file);var K=this;J.init({onSuccess:function(){K._getTagReader(J,{onSuccess:function(N){new N(J).setTagsToRead(K._tagsToRead).read(L)},onError:L.onError})},onError:L.onError})}},{key:"_getFileReader",value:function D(){if(this._fileReader){return this._fileReader}else{return this._findFileReader()}}},{key:"_findFileReader",value:function F(){for(var J=0;J<v.length;J++){if(v[J].canReadFile(this._file)){return v[J]}}throw new Error("No suitable file reader found for "+this._file)}},{key:"_getTagReader",value:function H(J,K){if(this._tagReader){var L=this._tagReader;setTimeout(function(){K.onSuccess(L)},1)}else{this._findTagReader(J,K)}}},{key:"_findTagReader",value:function C(L,P){var J=[];var M=[];var K=L.getSize();for(var N=0;N<p.length;N++){var O=p[N].getTagIdentifierByteRange();if(!r(O,K)){continue}if(O.offset>=0&&O.offset<K/2||O.offset<0&&O.offset<-K/2){J.push(p[N])}else{M.push(p[N])}}var R=false;var Q={onSuccess:function(){if(!R){R=true;return}for(var U=0;U<p.length;U++){var S=p[U].getTagIdentifierByteRange();if(!r(S,K)){continue}try{var V=L.getBytesAt(S.offset>=0?S.offset:S.offset+K,S.length)}catch(T){if(P.onError){P.onError({type:"fileReader",info:T.message})}return}if(p[U].canReadTagFormat(V)){P.onSuccess(p[U]);return}}if(P.onError){P.onError({type:"tagFormat",info:"No suitable tag reader found"})}},onError:P.onError};this._loadTagIdentifierRanges(L,J,Q);this._loadTagIdentifierRanges(L,M,Q)}},{key:"_loadTagIdentifierRanges",value:function A(N,M,Q){if(M.length===0){setTimeout(Q.onSuccess,1);return}var R=[Number.MAX_VALUE,0];var K=N.getSize();for(var O=0;O<M.length;O++){var P=M[O].getTagIdentifierByteRange();var J=P.offset>=0?P.offset:P.offset+K;var L=J+P.length-1;R[0]=Math.min(J,R[0]);R[1]=Math.max(L,R[1])}N.loadRange(R,Q)}}]);return G}();var m=function(){function B(){g(this,B)}t(B,null,[{key:"addFileReader",value:function F(G){v.push(G);return B}},{key:"addTagReader",value:function E(G){p.push(G);return B}},{key:"removeTagReader",value:function D(H){var G=p.indexOf(H);if(G>=0){p.splice(G,1)}return B}},{key:"EXPERIMENTAL_avoidHeadRequests",value:function A(){k.setConfig({avoidHeadRequests:true})}},{key:"setDisallowedXhrHeaders",value:function C(G){k.setConfig({disallowedXhrHeaders:G})}},{key:"setXhrTimeoutInSec",value:function z(G){k.setConfig({timeoutInSec:G})}}]);return B}();m.addFileReader(k).addFileReader(i).addFileReader(q).addTagReader(u).addTagReader(n).addTagReader(w).addTagReader(e);if(typeof process!=="undefined"&&!process.browser){m.addFileReader(o)}f.exports={read:s,Reader:x,Config:m}},{"./ArrayFileReader":3,"./BlobFileReader":4,"./FLACTagReader":6,"./ID3v1TagReader":7,"./ID3v2TagReader":9,"./MP4TagReader":10,"./MediaFileReader":11,"./MediaTagReader":12,"./NodeFileReader":1,"./XhrFileReader":14}]},{},[15])(15)});