(function(a){a.fn.videoKnob=function(b){return this.each(function(){var w,u,m,t;a(this).hide();a('<div class="knob-surround"><div class="video-knob"></div><div class="ticks"><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div></div><div class="knoblabel"></div><div class="knobvalue"></div></div>').insertAfter(a(this));var r=0;var k=0;var q=280;var j=a(this);var n=parseFloat(a(this).prop("min"));var c=parseFloat(a(this).prop("max"));var l=a(this).next().find(".video-knob");var x=a(document);var g=parseFloat(a(this).prop("step"))||1;var o=180/Math.PI;var e=-1;var d=0;var p=0;var v=0;var i=0;var s=g.toString().split(".")[1];if(s!==undefined){i=s.length}a(this).next().find(".knoblabel").html(a(this).data("label"));a(this).on("input change",function(){a(this).next().find(".knobvalue").html(a(this).val());if(n<0){var y=null;if(parseInt(a(this).val())<0){y=Math.abs(n)+parseInt(a(this).val());r=Math.round((y/c)*280)/2}else{y=parseInt(a(this).val());r=140+(Math.round((y/c)*280)/2)}}else{r=Math.round((a(this).val()/c)*280)}f(a(this).next(),false)});function h(A,z,B){var y=null;if(A==="up"){if(r<=q){if(B){r=r+10;f(z,true)}else{y=parseFloat(j.val())+g;if(y<=n){y=n}else{if(y>=c){y=c}}j.val(y).trigger("change")}if(r>=q){r=q;f(z,true)}}}else{if(A==="down"){if((r)>=k){if(B){r=r-10;f(z,true)}else{y=parseFloat(j.val())-g;if(y<=n){y=n}else{if(y>=c){y=c}}j.val(y).trigger("change")}if(r<=k){r=k;f(z,true)}}}}}a(this).next().bind("wheel",function(y){if(y.originalEvent.deltaY<0){h("up",a(this),false)}else{h("down",a(this),false)}});l.bind("mousedown",function(D){D.preventDefault();var E=a(this).offset();var z={y:E.top+l.height()/2,x:E.left+l.width()/2};var A,y,C,B;x.on("mousemove.rem ",function(F){A=z.y-F.pageY;y=z.x-F.pageX;C=Math.atan2(A,y)*o;if(C<0){C=360+C}if(e===-1){e=C}B=Math.floor((C-e)+p);if(B<0){B=360+B}else{if(B>280){B=B%360}}if(Math.abs(B-v)>180){return false}r=B;if(r>q){r=q}f(l.parent(),true);v=B});x.on("mouseup.rem",function(){l.off(".rem");x.off(".rem");p=d;e=-1})});l.bind("touchstart",function(D){D.preventDefault();var E=a(this).offset();var z={y:E.top+l.height()/2,x:E.left+l.width()/2};var A,y,C,B;x.on("touchmove.rem ",function(F){A=z.y-F.originalEvent.touches[0].pageY;y=z.x-F.originalEvent.touches[0].pageX;C=Math.atan2(A,y)*o;if(C<0){C=360+C}if(e===-1){e=C}B=Math.floor((C-e)+p);if(B<0){B=360+B}else{if(B>280){B=B%360}}if(Math.abs(B-v)>180){return false}r=B;if(r>q){r=q}f(l.parent(),true);v=B});x.on("touchend.rem",function(){l.off(".rem");x.off(".rem");p=d;e=-1})});function f(D,E){var C=null;var B;var y;D.find(".video-knob").css({"-moz-transform":"rotate("+r+"deg)","-webkit-transform":"rotate("+r+"deg)","-o-transform":"rotate("+r+"deg)","-ms-transform":"rotate("+r+"deg)",transform:"rotate("+r+"deg)"});if(n<0){var A=D.find(".tick").length;if(r<135){y=(Math.round(r/10));B=Math.abs(y-14);D.find(".tick").removeClass("activetick");for(C=0;C<=B;C++){D.find(".tick:eq("+Math.round(14+C)+")").removeClass("activetick");D.find(".tick:eq("+Math.round(14-C)+")").addClass("activetick")}}else{if(r>145){y=(Math.round(r/10));B=y-14;D.find(".tick").removeClass("activetick");for(C=0;C<=B;C++){D.find(".tick:eq("+Math.round(14-C)+")").removeClass("activetick");D.find(".tick:eq("+Math.round(14+C)+")").addClass("activetick")}}else{D.find(".tick").removeClass("activetick");D.find(".tick:eq("+Math.round(14)+")").addClass("activetick")}}}else{B=(Math.round(r/10)+1);D.find(".tick").removeClass("activetick");D.find(".tick").slice(0,B).addClass("activetick");if(r===0){D.find(".tick").removeClass("activetick")}}var z;if(E){if(n<0){if(r<140){z=(r/140)*Math.abs(n);z=parseInt(n)+Math.abs(z)}else{if(r>140){z=((r/140)*c)-parseInt(c)}else{z=0}}}else{z=(r/280)*c}D.prev().val(z.toFixed(i));D.find(".knobvalue").html(z.toFixed(i))}}a(this).trigger("change")})}}(jQuery));